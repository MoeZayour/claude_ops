<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        OPS Matrix Inventory Report Templates - Premium Executive Suite
        ================================================================
        v19.0.1: Inventory Intelligence Engine PDF Reports

        DESIGN PHILOSOPHY:
        - Dynamic colors from company primary_color/secondary_color
        - Smart value coloring: Green=Positive, Red=Negative, Muted=Zero
        - Executive dashboard styling with KPI cards
        - TABLE-BASED layouts (wkhtmltopdf compatible)
        - Georgia serif for numbers, Arial for text

        REPORTS:
        1. Stock Valuation Report
        2. Inventory Aging (Dead Stock) Report
        3. Negative Stock Alert Report
        4. Fast/Slow Moving Analysis Report
    -->

    <!-- ========================================
         STOCK VALUATION REPORT
         ======================================== -->
    <record id="report_inventory_valuation_pdf" model="ir.actions.report">
        <field name="name">Stock Valuation Report</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_valuation_document</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_valuation_document</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_inventory_valuation_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="wizard">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <t t-set="data" t-value="wizard._get_report_data()"/>

                    <!-- Dynamic Company Colors -->
                    <t t-set="company" t-value="wizard.company_id or env.company"/>
                    <t t-set="primary_color" t-value="company.primary_color or '#1a2744'"/>
                    <t t-set="secondary_color" t-value="company.secondary_color or '#3b82f6'"/>
                    <t t-set="primary_dark" t-value="'#0a1628'"/>
                    <t t-set="success_color" t-value="'#059669'"/>
                    <t t-set="danger_color" t-value="'#dc2626'"/>
                    <t t-set="warning_color" t-value="'#d97706'"/>
                    <t t-set="gold_color" t-value="'#C9A962'"/>

                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Executive Header Band -->
                        <div t-attf-style="background: #{primary_dark} !important; padding: 20px 25px !important; margin: -10mm -10mm 0 -10mm !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <span t-attf-style="display: inline-block; width: 50px; height: 50px; background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); border-radius: 10px; text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; color: #ffffff; margin-right: 15px; -webkit-print-color-adjust: exact !important;">
                                            <t t-esc="(data.get('company_name', 'C') or 'C')[0]"/>
                                        </span>
                                        <span style="display: inline-block; vertical-align: middle;">
                                            <span style="display: block; font-size: 20px; font-weight: 700; color: #ffffff;"><t t-esc="data.get('company_name', 'Company')"/></span>
                                            <span style="display: block; font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 2px;">Inventory Intelligence</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px 15px; display: inline-block;">
                                            <div style="font-size: 10px; color: #94a3b8; text-transform: uppercase;">As of Date</div>
                                            <div style="font-size: 14px; font-weight: 600; color: #ffffff;"><t t-esc="data.get('date_to', '')"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Gold Accent Bar -->
                        <div t-attf-style="height: 4px; background: linear-gradient(90deg, #{gold_color} 0%, #{secondary_color} 50%, #{success_color} 100%); margin: 0 -10mm 20px -10mm; -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Report Title Section -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 t-attf-style="font-size: 28px; font-weight: 700; color: #{primary_color}; margin: 0 0 8px 0;">Stock Valuation Report</h2>
                            <p style="font-size: 14px; color: #64748b; margin: 0;">Inventory Value Analysis by Location</p>
                        </div>

                        <!-- KPI Summary Cards -->
                        <div style="margin-bottom: 25px;">
                            <table style="width: 100%; border-collapse: separate; border-spacing: 10px 0;">
                                <tr>
                                    <td style="width: 25%; vertical-align: top;">
                                        <div t-attf-style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; border-left: 4px solid #{gold_color}; -webkit-print-color-adjust: exact !important;">
                                            <div style="font-size: 10px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Total Value</div>
                                            <div style="font-size: 20px; font-weight: 700; color: #1a1a1a; font-family: Georgia, serif;"><t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/></div>
                                        </div>
                                    </td>
                                    <td style="width: 25%; vertical-align: top;">
                                        <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; border-left: 4px solid #3b82f6; -webkit-print-color-adjust: exact !important;">
                                            <div style="font-size: 10px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Total Quantity</div>
                                            <div style="font-size: 20px; font-weight: 700; color: #3b82f6; font-family: Georgia, serif;"><t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('total_quantity', 0))"/></div>
                                        </div>
                                    </td>
                                    <td style="width: 25%; vertical-align: top;">
                                        <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; border-left: 4px solid #059669; -webkit-print-color-adjust: exact !important;">
                                            <div style="font-size: 10px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Item Count</div>
                                            <div style="font-size: 20px; font-weight: 700; color: #059669; font-family: Georgia, serif;"><t t-esc="data.get('totals', {}).get('item_count', 0)"/></div>
                                        </div>
                                    </td>
                                    <td style="width: 25%; vertical-align: top;">
                                        <div t-attf-style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; border-left: 4px solid #{secondary_color}; -webkit-print-color-adjust: exact !important;">
                                            <div style="font-size: 10px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Currency</div>
                                            <div t-attf-style="font-size: 20px; font-weight: 700; color: #{secondary_color};"><t t-esc="data.get('company_currency', 'USD')"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Report Info Box -->
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 20px; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%;">
                                        <span style="font-size: 11px; color: #64748b; font-weight: 600;">REPORT TYPE:</span>
                                        <span style="font-size: 12px; color: #1e293b; margin-left: 8px;">Stock Valuation</span>
                                    </td>
                                    <td style="width: 50%; text-align: right;">
                                        <span style="font-size: 11px; color: #64748b; font-weight: 600;">GENERATED:</span>
                                        <span style="font-size: 12px; color: #1e293b; margin-left: 8px;"><t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/></span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Grouped Data (if grouped) -->
                        <t t-if="data.get('grouped_data')">
                            <t t-foreach="data.get('grouped_data', {}).items()" t-as="group">
                                <t t-set="group_name" t-value="group[0]"/>
                                <t t-set="group_data" t-value="group[1]"/>

                                <!-- Group Header -->
                                <div t-attf-style="padding: 10px 14px; background-color: #{primary_color} !important; color: #ffffff; font-weight: 700; font-size: 11pt; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 15px; -webkit-print-color-adjust: exact !important;">
                                    <table width="100%">
                                        <tr>
                                            <td><t t-esc="group_name"/></td>
                                            <td style="text-align: right; font-family: Georgia, serif;">
                                                <t t-esc="'{:,.2f}'.format(group_data.get('total_value', 0))"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <!-- Group Items Table -->
                                <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                                    <thead>
                                        <tr style="background: #f1f5f9; -webkit-print-color-adjust: exact !important;">
                                            <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Product</th>
                                            <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Location</th>
                                            <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Quantity</th>
                                            <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Unit Cost</th>
                                            <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="group_data.get('items', [])" t-as="item">
                                            <tr t-attf-style="background: #{item_odd and '#ffffff' or '#f8fafc'}; -webkit-print-color-adjust: exact !important;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #1e293b; font-weight: 500;">
                                                    <t t-esc="item.get('product_name', '-')"/>
                                                    <t t-if="item.get('product_code')">
                                                        <span style="color: #94a3b8; font-size: 9px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                                    </t>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><t t-esc="item.get('location_name', '-')"/></td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif;">
                                                    <t t-set="qty" t-value="item.get('quantity', 0)"/>
                                                    <span t-attf-style="color: #{qty &lt; 0 and '#dc2626' or qty == 0 and '#94a3b8' or '#1e293b'};">
                                                        <t t-if="qty &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(qty))"/>)</t>
                                                        <t t-elif="qty == 0">0.00</t>
                                                        <t t-else=""><t t-esc="'{:,.2f}'.format(qty)"/></t>
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; color: #64748b;">
                                                    <t t-esc="'{:,.2f}'.format(item.get('unit_cost', 0))"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; font-weight: 600;">
                                                    <t t-set="val" t-value="item.get('value', 0)"/>
                                                    <span t-attf-style="color: #{val &lt; 0 and '#dc2626' or val == 0 and '#94a3b8' or '#059669'};">
                                                        <t t-if="val &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</t>
                                                        <t t-elif="val == 0">0.00</t>
                                                        <t t-else=""><t t-esc="'{:,.2f}'.format(val)"/></t>
                                                    </span>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                    <tfoot>
                                        <tr style="background: #f1f5f9; -webkit-print-color-adjust: exact !important;">
                                            <td colspan="2" style="padding: 10px 8px; text-align: right; font-weight: 700; color: #1e293b; border-top: 2px solid #cbd5e1;">Subtotal</td>
                                            <td style="padding: 10px 8px; text-align: right; font-weight: 700; color: #1e293b; border-top: 2px solid #cbd5e1; font-family: Georgia, serif;">
                                                <t t-esc="'{:,.2f}'.format(group_data.get('total_qty', 0))"/>
                                            </td>
                                            <td style="border-top: 2px solid #cbd5e1;"></td>
                                            <td style="padding: 10px 8px; text-align: right; font-weight: 700; color: #059669; border-top: 2px solid #cbd5e1; font-family: Georgia, serif;">
                                                <t t-esc="'{:,.2f}'.format(group_data.get('total_value', 0))"/>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </t>
                        </t>

                        <!-- Ungrouped Data -->
                        <t t-if="not data.get('grouped_data') and data.get('data')">
                            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                                <thead>
                                    <tr style="background: #f1f5f9; -webkit-print-color-adjust: exact !important;">
                                        <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Product</th>
                                        <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Location</th>
                                        <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Category</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Quantity</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Unit Cost</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="data.get('data', [])" t-as="item">
                                        <tr t-attf-style="background: #{item_odd and '#ffffff' or '#f8fafc'}; -webkit-print-color-adjust: exact !important;">
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #1e293b; font-weight: 500;">
                                                <t t-esc="item.get('product_name', '-')"/>
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><t t-esc="item.get('location_name', '-')"/></td>
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><t t-esc="item.get('category_name', '-')"/></td>
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif;">
                                                <t t-esc="'{:,.2f}'.format(item.get('quantity', 0))"/>
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; color: #64748b;">
                                                <t t-esc="'{:,.2f}'.format(item.get('unit_cost', 0))"/>
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; font-weight: 600; color: #059669;">
                                                <t t-esc="'{:,.2f}'.format(item.get('value', 0))"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr style="background: #1a1a1a; -webkit-print-color-adjust: exact !important;">
                                        <td colspan="3" style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000;">GRAND TOTAL</td>
                                        <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                            <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_quantity', 0))"/>
                                        </td>
                                        <td style="border-top: 2px solid #000;"></td>
                                        <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                            <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </t>

                        <!-- Empty State -->
                        <t t-if="not data.get('data') and not data.get('grouped_data')">
                            <div style="padding: 40px; text-align: center; color: #94a3b8; font-style: italic; border: 1px dashed #e2e8f0; border-radius: 8px;">
                                No stock items found matching the criteria
                            </div>
                        </t>

                        <!-- Report Footer -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                            <table style="width: 100%; font-size: 10px; color: #64748b;">
                                <tr>
                                    <td style="width: 70%;">
                                        <strong style="color: #1e293b;">Notes:</strong> Stock value = Quantity Ã— Unit Cost. All values in company currency.
                                    </td>
                                    <td style="width: 30%; text-align: right;">
                                        <span style="color: #94a3b8;">Generated by OPS Matrix</span>
                                    </td>
                                </tr>
                            </table>
                            <div style="text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #e2e8f0;">
                                <span style="font-size: 9px; color: #94a3b8; letter-spacing: 1px;">CONFIDENTIAL - FOR INTERNAL USE ONLY</span>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ========================================
         INVENTORY AGING (DEAD STOCK) REPORT
         ======================================== -->
    <record id="report_inventory_aging_pdf" model="ir.actions.report">
        <field name="name">Inventory Aging Report</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_aging_document</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_aging_document</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_inventory_aging_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="wizard">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <t t-set="data" t-value="wizard._get_report_data()"/>

                    <!-- Dynamic Company Colors -->
                    <t t-set="company" t-value="wizard.company_id or env.company"/>
                    <t t-set="primary_color" t-value="company.primary_color or '#1a2744'"/>
                    <t t-set="secondary_color" t-value="company.secondary_color or '#3b82f6'"/>
                    <t t-set="primary_dark" t-value="'#0a1628'"/>
                    <t t-set="gold_color" t-value="'#C9A962'"/>

                    <!-- Aging color scale: Fresh=Green, Normal=Blue, Aging=Orange, Old=Red, Dead=Dark Red -->
                    <t t-set="aging_colors" t-value="['#059669', '#3b82f6', '#d97706', '#dc2626', '#991b1b']"/>

                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Executive Header Band -->
                        <div t-attf-style="background: #{primary_dark} !important; padding: 20px 25px !important; margin: -10mm -10mm 0 -10mm !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <span t-attf-style="display: inline-block; width: 50px; height: 50px; background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); border-radius: 10px; text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; color: #ffffff; margin-right: 15px; -webkit-print-color-adjust: exact !important;">
                                            <t t-esc="(data.get('company_name', 'C') or 'C')[0]"/>
                                        </span>
                                        <span style="display: inline-block; vertical-align: middle;">
                                            <span style="display: block; font-size: 20px; font-weight: 700; color: #ffffff;"><t t-esc="data.get('company_name', 'Company')"/></span>
                                            <span style="display: block; font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 2px;">Inventory Aging Analysis</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px 15px; display: inline-block;">
                                            <div style="font-size: 10px; color: #94a3b8; text-transform: uppercase;">As of Date</div>
                                            <div style="font-size: 14px; font-weight: 600; color: #ffffff;"><t t-esc="data.get('date_to', '')"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Gold Accent Bar -->
                        <div t-attf-style="height: 4px; background: linear-gradient(90deg, #{gold_color} 0%, #d97706 50%, #dc2626 100%); margin: 0 -10mm 20px -10mm; -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Report Title Section -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 t-attf-style="font-size: 28px; font-weight: 700; color: #{primary_color}; margin: 0 0 8px 0;">Inventory Aging Analysis</h2>
                            <p style="font-size: 14px; color: #64748b; margin: 0;">Dead Stock &amp; Slow Moving Inventory Report</p>
                        </div>

                        <!-- Dead Stock Alert (if significant) -->
                        <t t-set="dead_stock_value" t-value="data.get('totals', {}).get('dead_stock_value', 0)"/>
                        <t t-set="total_value" t-value="data.get('totals', {}).get('total_value', 0)"/>
                        <t t-set="dead_pct" t-value="(dead_stock_value / total_value * 100) if total_value > 0 else 0"/>

                        <t t-if="dead_pct > 10">
                            <div style="padding: 14px 18px; margin: 15px 0 20px 0; border-left: 4px solid #dc2626; background-color: #fef2f2; color: #991b1b; font-size: 10pt; -webkit-print-color-adjust: exact !important;">
                                <strong>Dead Stock Alert:</strong> <t t-esc="'{:.1f}'.format(dead_pct)"/>% of inventory value is dead stock (><t t-esc="data.get('aging_periods', {}).get('p4', 180)"/> days). Value at risk: <strong><t t-esc="'{:,.2f}'.format(dead_stock_value)"/></strong>
                            </div>
                        </t>

                        <!-- Aging Buckets Summary -->
                        <div style="margin-bottom: 25px;">
                            <table style="width: 100%; border-collapse: separate; border-spacing: 8px 0;">
                                <tr>
                                    <t t-foreach="data.get('aging_buckets', [])" t-as="bucket">
                                        <t t-set="bucket_color" t-value="bucket_index &lt; len(aging_colors) and aging_colors[bucket_index] or '#94a3b8'"/>
                                        <td style="vertical-align: top;">
                                            <div t-attf-style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; border-left: 4px solid #{bucket_color}; -webkit-print-color-adjust: exact !important;">
                                                <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;"><t t-esc="bucket.get('label', '')"/></div>
                                                <div t-attf-style="font-size: 16px; font-weight: 700; color: #{bucket_color}; font-family: Georgia, serif;"><t t-esc="'{:,.0f}'.format(bucket.get('total_value', 0))"/></div>
                                                <div style="font-size: 9px; color: #94a3b8; margin-top: 2px;"><t t-esc="'{:,.0f}'.format(bucket.get('total_qty', 0))"/> units</div>
                                            </div>
                                        </td>
                                    </t>
                                </tr>
                            </table>
                        </div>

                        <!-- Aging Detail Table -->
                        <div style="padding: 10px 14px; background-color: #1a1a1a !important; color: #ffffff; font-weight: 700; font-size: 11pt; text-transform: uppercase; letter-spacing: 0.5px; -webkit-print-color-adjust: exact !important;">
                            <table width="100%">
                                <tr>
                                    <td>Inventory by Age</td>
                                    <td style="text-align: right; font-family: Georgia, serif;"><t t-esc="len(data.get('all_items', []))"/> Items</td>
                                </tr>
                            </table>
                        </div>

                        <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                            <thead>
                                <tr style="background: #f1f5f9; -webkit-print-color-adjust: exact !important;">
                                    <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Product</th>
                                    <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Location</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Age (Days)</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Quantity</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Value</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('all_items', [])[:100]" t-as="item">
                                    <t t-set="age_days" t-value="item.get('age_days', 0)"/>
                                    <t t-set="p1" t-value="data.get('aging_periods', {}).get('p1', 30)"/>
                                    <t t-set="p2" t-value="data.get('aging_periods', {}).get('p2', 60)"/>
                                    <t t-set="p3" t-value="data.get('aging_periods', {}).get('p3', 90)"/>
                                    <t t-set="p4" t-value="data.get('aging_periods', {}).get('p4', 180)"/>
                                    <t t-set="age_color" t-value="age_days &lt;= p1 and '#059669' or age_days &lt;= p2 and '#3b82f6' or age_days &lt;= p3 and '#d97706' or age_days &lt;= p4 and '#dc2626' or '#991b1b'"/>
                                    <t t-set="age_label" t-value="age_days &lt;= p1 and 'Fresh' or age_days &lt;= p2 and 'Normal' or age_days &lt;= p3 and 'Aging' or age_days &lt;= p4 and 'Old' or 'Dead Stock'"/>

                                    <tr t-attf-style="background: #{item_odd and '#ffffff' or '#f8fafc'}; -webkit-print-color-adjust: exact !important;">
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #1e293b; font-weight: 500;">
                                            <t t-esc="item.get('product_name', '-')"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><t t-esc="item.get('location_name', '-')"/></td>
                                        <td t-attf-style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-family: Georgia, serif; font-weight: 600; color: #{age_color};">
                                            <t t-esc="age_days"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif;">
                                            <t t-esc="'{:,.2f}'.format(item.get('quantity', 0))"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(item.get('value', 0))"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                            <span t-attf-style="display: inline-block; padding: 2px 10px; border-radius: 10px; font-size: 9px; font-weight: 600; color: #ffffff; background: #{age_color}; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="age_label"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="not data.get('all_items')">
                                    <tr>
                                        <td colspan="6" style="padding: 30px; text-align: center; color: #94a3b8; font-style: italic;">
                                            No aged inventory items found
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot t-if="data.get('all_items')">
                                <tr style="background: #1a1a1a; -webkit-print-color-adjust: exact !important;">
                                    <td colspan="3" style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000;">TOTAL</td>
                                    <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_quantity', 0))"/>
                                    </td>
                                    <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                    </td>
                                    <td style="border-top: 2px solid #000;"></td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Report Footer -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                            <table style="width: 100%; font-size: 10px; color: #64748b;">
                                <tr>
                                    <td style="width: 70%;">
                                        <strong style="color: #1e293b;">Notes:</strong> Age calculated from stock receipt date. Dead Stock = items with no movement in ><t t-esc="data.get('aging_periods', {}).get('p4', 180)"/> days.
                                    </td>
                                    <td style="width: 30%; text-align: right;">
                                        <span style="color: #94a3b8;">Generated by OPS Matrix</span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ========================================
         MOVEMENT ANALYSIS (FAST/SLOW) REPORT
         ======================================== -->
    <record id="report_inventory_movement_pdf" model="ir.actions.report">
        <field name="name">Movement Analysis Report</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_movement_document</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_movement_document</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_inventory_movement_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="wizard">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <t t-set="data" t-value="wizard._get_report_data()"/>

                    <!-- Dynamic Company Colors -->
                    <t t-set="company" t-value="wizard.company_id or env.company"/>
                    <t t-set="primary_color" t-value="company.primary_color or '#1a2744'"/>
                    <t t-set="secondary_color" t-value="company.secondary_color or '#3b82f6'"/>
                    <t t-set="primary_dark" t-value="'#0a1628'"/>
                    <t t-set="gold_color" t-value="'#C9A962'"/>

                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Executive Header Band -->
                        <div t-attf-style="background: #{primary_dark} !important; padding: 20px 25px !important; margin: -10mm -10mm 0 -10mm !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <span t-attf-style="display: inline-block; width: 50px; height: 50px; background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); border-radius: 10px; text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; color: #ffffff; margin-right: 15px; -webkit-print-color-adjust: exact !important;">
                                            <t t-esc="(data.get('company_name', 'C') or 'C')[0]"/>
                                        </span>
                                        <span style="display: inline-block; vertical-align: middle;">
                                            <span style="display: block; font-size: 20px; font-weight: 700; color: #ffffff;"><t t-esc="data.get('company_name', 'Company')"/></span>
                                            <span style="display: block; font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 2px;">Movement Analysis</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px 15px; display: inline-block;">
                                            <div style="font-size: 10px; color: #94a3b8; text-transform: uppercase;">Analysis Period</div>
                                            <div style="font-size: 12px; font-weight: 600; color: #ffffff;"><t t-esc="data.get('date_from', '')"/> - <t t-esc="data.get('date_to', '')"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Gold Accent Bar -->
                        <div t-attf-style="height: 4px; background: linear-gradient(90deg, #{gold_color} 0%, #059669 50%, #dc2626 100%); margin: 0 -10mm 20px -10mm; -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Report Title Section -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 t-attf-style="font-size: 28px; font-weight: 700; color: #{primary_color}; margin: 0 0 8px 0;">Fast vs Slow Moving Analysis</h2>
                            <p style="font-size: 14px; color: #64748b; margin: 0;">ABC Inventory Movement Classification</p>
                        </div>

                        <!-- Movement Summary Cards -->
                        <div style="margin-bottom: 25px;">
                            <table style="width: 100%; border-collapse: separate; border-spacing: 10px 0;">
                                <tr>
                                    <t t-foreach="data.get('movement_summary', [])" t-as="summary">
                                        <t t-set="mv_color" t-value="summary.get('label') == 'Fast Moving' and '#059669' or summary.get('label') == 'Slow Moving' and '#d97706' or '#dc2626'"/>
                                        <td style="width: 33%; vertical-align: top;">
                                            <div t-attf-style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; border-left: 4px solid #{mv_color}; -webkit-print-color-adjust: exact !important;">
                                                <div style="font-size: 10px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;"><t t-esc="summary.get('label', '')"/></div>
                                                <div t-attf-style="font-size: 20px; font-weight: 700; color: #{mv_color}; font-family: Georgia, serif;"><t t-esc="'{:,.0f}'.format(summary.get('value', 0))"/></div>
                                                <div style="font-size: 9px; color: #94a3b8; margin-top: 2px;"><t t-esc="summary.get('count', 0)"/> products | <t t-esc="'{:,.0f}'.format(summary.get('qty', 0))"/> units</div>
                                            </div>
                                        </td>
                                    </t>
                                </tr>
                            </table>
                        </div>

                        <!-- Movement Detail Table -->
                        <div style="padding: 10px 14px; background-color: #1a1a1a !important; color: #ffffff; font-weight: 700; font-size: 11pt; text-transform: uppercase; letter-spacing: 0.5px; -webkit-print-color-adjust: exact !important;">
                            <table width="100%">
                                <tr>
                                    <td>Product Movement Classification</td>
                                    <td style="text-align: right; font-family: Georgia, serif;"><t t-esc="data.get('totals', {}).get('total_products', 0)"/> Products</td>
                                </tr>
                            </table>
                        </div>

                        <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                            <thead>
                                <tr style="background: #f1f5f9; -webkit-print-color-adjust: exact !important;">
                                    <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Product</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Current Qty</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Current Value</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Moves</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Qty Moved</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Turnover</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0;">Class</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('data', [])[:100]" t-as="item">
                                    <t t-set="mv_class" t-value="item.get('movement_class', 'dead')"/>
                                    <t t-set="mv_color" t-value="mv_class == 'fast' and '#059669' or mv_class == 'slow' and '#d97706' or '#dc2626'"/>

                                    <tr t-attf-style="background: #{item_odd and '#ffffff' or '#f8fafc'}; -webkit-print-color-adjust: exact !important;">
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #1e293b; font-weight: 500;">
                                            <t t-esc="item.get('product_name', '-')"/>
                                            <t t-if="item.get('product_code')">
                                                <span style="color: #94a3b8; font-size: 9px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                            </t>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif;">
                                            <t t-esc="'{:,.2f}'.format(item.get('current_qty', 0))"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif; font-weight: 500;">
                                            <t t-esc="'{:,.2f}'.format(item.get('current_value', 0))"/>
                                        </td>
                                        <td t-attf-style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-family: Georgia, serif; font-weight: 600; color: #{mv_color};">
                                            <t t-esc="item.get('move_count', 0)"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: right; font-family: Georgia, serif;">
                                            <t t-esc="'{:,.2f}'.format(item.get('qty_moved', 0))"/>
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-family: Georgia, serif;">
                                            <t t-esc="'{:.2f}'.format(item.get('turnover_ratio', 0))"/>x
                                        </td>
                                        <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                            <span t-attf-style="display: inline-block; padding: 2px 10px; border-radius: 10px; font-size: 9px; font-weight: 600; color: #ffffff; background: #{mv_color}; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="item.get('movement_label', 'Unknown')"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="not data.get('data')">
                                    <tr>
                                        <td colspan="7" style="padding: 30px; text-align: center; color: #94a3b8; font-style: italic;">
                                            No movement data found for the selected period
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot t-if="data.get('data')">
                                <tr style="background: #1a1a1a; -webkit-print-color-adjust: exact !important;">
                                    <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000;">TOTAL</td>
                                    <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_qty', 0))"/>
                                    </td>
                                    <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #000; font-family: Georgia, serif;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                    </td>
                                    <td colspan="4" style="border-top: 2px solid #000;"></td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Report Footer -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                            <table style="width: 100%; font-size: 10px; color: #64748b;">
                                <tr>
                                    <td style="width: 70%;">
                                        <strong style="color: #1e293b;">Notes:</strong> Fast Moving = ><t t-esc="data.get('slow_threshold', 5)"/> moves in <t t-esc="data.get('movement_period', 90)"/> days. Turnover = Qty Moved / Current Qty.
                                    </td>
                                    <td style="width: 30%; text-align: right;">
                                        <span style="color: #94a3b8;">Generated by OPS Matrix</span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ========================================
         NEGATIVE STOCK ALERT REPORT
         ======================================== -->
    <record id="report_inventory_negative_pdf" model="ir.actions.report">
        <field name="name">Negative Stock Alert</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_negative_document</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_negative_document</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_inventory_negative_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="wizard">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <t t-set="data" t-value="wizard._get_report_data()"/>

                    <!-- Dynamic Company Colors -->
                    <t t-set="company" t-value="wizard.company_id or env.company"/>
                    <t t-set="primary_color" t-value="company.primary_color or '#1a2744'"/>
                    <t t-set="secondary_color" t-value="company.secondary_color or '#3b82f6'"/>
                    <t t-set="primary_dark" t-value="'#0a1628'"/>

                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Executive Header Band - Red themed for alert -->
                        <div style="background: #7f1d1d !important; padding: 20px 25px !important; margin: -10mm -10mm 0 -10mm !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <span style="display: inline-block; width: 50px; height: 50px; background: #dc2626; border-radius: 10px; text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; color: #ffffff; margin-right: 15px; -webkit-print-color-adjust: exact !important;">!</span>
                                        <span style="display: inline-block; vertical-align: middle;">
                                            <span style="display: block; font-size: 20px; font-weight: 700; color: #ffffff;"><t t-esc="data.get('company_name', 'Company')"/></span>
                                            <span style="display: block; font-size: 11px; color: #fca5a5; text-transform: uppercase; letter-spacing: 2px;">Negative Stock Alert</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px 15px; display: inline-block;">
                                            <div style="font-size: 10px; color: #fca5a5; text-transform: uppercase;">Critical Items</div>
                                            <div style="font-size: 18px; font-weight: 600; color: #ffffff;"><t t-esc="data.get('totals', {}).get('alert_count', 0)"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Red Accent Bar -->
                        <div style="height: 4px; background: linear-gradient(90deg, #dc2626 0%, #f87171 50%, #fca5a5 100%); margin: 0 -10mm 20px -10mm; -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Report Title Section -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 style="font-size: 28px; font-weight: 700; color: #dc2626; margin: 0 0 8px 0;">Negative Stock Alert Report</h2>
                            <p style="font-size: 14px; color: #64748b; margin: 0;">Stock Discrepancy &amp; Correction Required</p>
                        </div>

                        <!-- Alert Summary -->
                        <t t-if="data.get('totals', {}).get('alert_count', 0) > 0">
                            <div style="padding: 14px 18px; margin: 15px 0 20px 0; border-left: 4px solid #dc2626; background-color: #fef2f2; color: #991b1b; font-size: 10pt; -webkit-print-color-adjust: exact !important;">
                                <strong>Immediate Action Required:</strong> <t t-esc="data.get('totals', {}).get('alert_count', 0)"/> items have negative stock levels.
                                <t t-if="data.get('totals', {}).get('critical_count', 0) > 0">
                                    <strong><t t-esc="data.get('totals', {}).get('critical_count', 0)"/> items are CRITICAL</strong> (qty &lt; -10).
                                </t>
                                Total negative value: <strong><t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_negative_value', 0))"/></strong>
                            </div>
                        </t>
                        <t t-else="">
                            <div style="padding: 14px 18px; margin: 15px 0 20px 0; border-left: 4px solid #059669; background-color: #ecfdf5; color: #065f46; font-size: 10pt; -webkit-print-color-adjust: exact !important;">
                                <strong>All Clear:</strong> No negative stock items found. Inventory levels are healthy.
                            </div>
                        </t>

                        <!-- Negative Stock Table -->
                        <t t-if="data.get('data')">
                            <div style="padding: 10px 14px; background-color: #7f1d1d !important; color: #ffffff; font-weight: 700; font-size: 11pt; text-transform: uppercase; letter-spacing: 0.5px; -webkit-print-color-adjust: exact !important;">
                                <table width="100%">
                                    <tr>
                                        <td>Negative Stock Items</td>
                                        <td style="text-align: right; font-family: Georgia, serif;"><t t-esc="data.get('totals', {}).get('alert_count', 0)"/> Alerts</td>
                                    </tr>
                                </table>
                            </div>

                            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                                <thead>
                                    <tr style="background: #fef2f2; -webkit-print-color-adjust: exact !important;">
                                        <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Product</th>
                                        <th style="padding: 10px 8px; text-align: left; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Location</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Quantity</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Reserved</th>
                                        <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Value</th>
                                        <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: #991b1b; border-bottom: 2px solid #dc2626;">Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="data.get('data', [])" t-as="item">
                                        <t t-set="severity" t-value="item.get('severity', 'warning')"/>
                                        <t t-set="severity_color" t-value="severity == 'critical' and '#7f1d1d' or '#dc2626'"/>

                                        <tr t-attf-style="background: #{item_odd and '#ffffff' or '#fef2f2'}; -webkit-print-color-adjust: exact !important;">
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; color: #1e293b; font-weight: 500;">
                                                <t t-esc="item.get('product_name', '-')"/>
                                                <t t-if="item.get('product_code')">
                                                    <span style="color: #94a3b8; font-size: 9px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                                </t>
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; color: #64748b;"><t t-esc="item.get('location_name', '-')"/></td>
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; text-align: right; font-family: Georgia, serif; font-weight: 700; color: #dc2626;">
                                                (<t t-esc="'{:,.2f}'.format(abs(item.get('quantity', 0)))"/>)
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; text-align: right; font-family: Georgia, serif; color: #64748b;">
                                                <t t-esc="'{:,.2f}'.format(item.get('reserved_quantity', 0))"/>
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; text-align: right; font-family: Georgia, serif; font-weight: 600; color: #dc2626;">
                                                (<t t-esc="'{:,.2f}'.format(abs(item.get('value', 0)))"/>)
                                            </td>
                                            <td style="padding: 8px; border-bottom: 1px solid #fecaca; text-align: center;">
                                                <span t-attf-style="display: inline-block; padding: 2px 10px; border-radius: 10px; font-size: 9px; font-weight: 600; color: #ffffff; background: #{severity_color}; -webkit-print-color-adjust: exact !important;">
                                                    <t t-if="severity == 'critical'">CRITICAL</t>
                                                    <t t-else="">WARNING</t>
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr style="background: #7f1d1d; -webkit-print-color-adjust: exact !important;">
                                        <td colspan="2" style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #dc2626;">TOTAL NEGATIVE</td>
                                        <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #dc2626; font-family: Georgia, serif;">
                                            (<t t-esc="'{:,.2f}'.format(abs(data.get('totals', {}).get('total_negative_qty', 0)))"/>)
                                        </td>
                                        <td style="border-top: 2px solid #dc2626;"></td>
                                        <td style="padding: 12px 8px; text-align: right; font-weight: 700; color: #ffffff; border-top: 2px solid #dc2626; font-family: Georgia, serif;">
                                            (<t t-esc="'{:,.2f}'.format(abs(data.get('totals', {}).get('total_negative_value', 0)))"/>)
                                        </td>
                                        <td style="border-top: 2px solid #dc2626;"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </t>

                        <!-- Report Footer -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                            <table style="width: 100%; font-size: 10px; color: #64748b;">
                                <tr>
                                    <td style="width: 70%;">
                                        <strong style="color: #1e293b;">Notes:</strong> Critical = qty &lt; -10 units. Negative stock requires inventory adjustment or correction.
                                    </td>
                                    <td style="width: 30%; text-align: right;">
                                        <span style="color: #94a3b8;">Generated by OPS Matrix</span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>
