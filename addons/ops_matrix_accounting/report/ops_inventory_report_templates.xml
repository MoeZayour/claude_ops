<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        ================================================================
        OPS CORPORATE INVENTORY REPORTS
        Phase 4B: Corporate Report Template Redesign
        ================================================================

        DESIGN: Corporate branding with shared components
        REPORTS: Stock Valuation, Inventory Aging, Movement Analysis, Negative Stock Alert
        PILLAR: Inventory Intelligence

        SHARED COMPONENTS USED:
        - report_corporate_header (logo, company info, meta)
        - report_corporate_title (title, pillar, period)
        - report_filter_bar (scope, filters, status)
        - report_corporate_footer (OPS badge, page numbers)
    -->

    <!-- ================================================================
         STOCK VALUATION REPORT
         ================================================================ -->

    <template id="report_inventory_valuation_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="pc" t-value="company.ops_report_primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="company.ops_report_text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="company.get_report_primary_light()"/>
                <t t-set="pd" t-value="company.get_report_primary_dark()"/>
                <t t-set="body_text_color" t-value="company.ops_report_body_text_color or '#1a1a1a'"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Stock Valuation Report'"/>
                        <t t-set="report_pillar" t-value="'Inventory Intelligence'"/>
                        <t t-set="date_end" t-value="data.get('date_to', '')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- KPI Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #0891b2; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Total Value</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #1e293b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #2563eb; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Total Quantity</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #2563eb; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('total_quantity', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #16a34a; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Item Count</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #16a34a; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="data.get('totals', {}).get('item_count', 0)"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Grouped Data (if grouped) -->
                    <t t-if="data.get('grouped_data')">
                        <t t-foreach="data.get('grouped_data', {}).items()" t-as="group">
                            <t t-set="group_name" t-value="group[0]"/>
                            <t t-set="group_data" t-value="group[1]"/>

                            <!-- Group Header -->
                            <div style="background-color: #f0fdf4; border-left: 4px solid #0891b2; padding: 8px 12px; margin: 15px 0 10px 0;">
                                <table width="100%" style="border-collapse: collapse;">
                                    <tr>
                                        <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                            <t t-esc="group_name"/>
                                        </td>
                                        <td style="text-align: right; font-size: 12px; font-weight: 600; color: #1e293b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(group_data.get('total_value', 0))"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Group Items Table -->
                            <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                                <thead>
                                    <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                        <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Product</th>
                                        <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Location</th>
                                        <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Quantity</th>
                                        <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Unit Cost</th>
                                        <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="group_data.get('items', [])" t-as="item">
                                        <tr style="border-bottom: 1px solid #f1f5f9;">
                                            <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                                <t t-esc="item.get('product_name', '-')"/>
                                                <t t-if="item.get('product_code')">
                                                    <span style="color: #94a3b8; font-size: 8px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                                </t>
                                            </td>
                                            <td style="padding: 6px 8px; color: #64748b;">
                                                <t t-esc="item.get('location_name', '-')"/>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                                <t t-set="qty" t-value="item.get('quantity', 0)"/>
                                                <span t-attf-style="color: #{qty &lt; 0 and '#dc2626' or qty == 0 and '#94a3b8' or '#1e293b'};">
                                                    <t t-if="qty &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(qty))"/>)</t>
                                                    <t t-elif="qty == 0">-</t>
                                                    <t t-else=""><t t-esc="'{:,.2f}'.format(qty)"/></t>
                                                </span>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #64748b;">
                                                <t t-esc="'{:,.2f}'.format(item.get('unit_cost', 0))"/>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                                <t t-set="val" t-value="item.get('value', 0)"/>
                                                <span t-attf-style="color: #{val &lt; 0 and '#dc2626' or val == 0 and '#94a3b8' or '#0891b2'};">
                                                    <t t-if="val &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</t>
                                                    <t t-elif="val == 0">-</t>
                                                    <t t-else=""><t t-esc="'{:,.2f}'.format(val)"/></t>
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr style="border-top: 1px solid #e2e8f0; background-color: #f8fafc;">
                                        <td colspan="2" style="padding: 8px; font-weight: 600; text-align: right; color: #475569;">Subtotal</td>
                                        <td style="text-align: right; padding: 8px; font-weight: 600; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(group_data.get('total_qty', 0))"/>
                                        </td>
                                        <td></td>
                                        <td style="text-align: right; padding: 8px; font-weight: 600; color: #0891b2; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(group_data.get('total_value', 0))"/>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </t>
                    </t>

                    <!-- Ungrouped Data -->
                    <t t-if="not data.get('grouped_data') and data.get('data')">
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Product</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Location</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Category</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Quantity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Unit Cost</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('data', [])" t-as="item">
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="item.get('product_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="item.get('location_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="item.get('category_name', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(item.get('quantity', 0))"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #64748b;">
                                            <t t-esc="'{:,.2f}'.format(item.get('unit_cost', 0))"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: #0891b2;">
                                            <t t-esc="'{:,.2f}'.format(item.get('value', 0))"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                    <td colspan="3" style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase;">GRAND TOTAL</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_quantity', 0))"/>
                                    </td>
                                    <td></td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #0891b2; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                        <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- Empty State -->
                    <t t-if="not data.get('data') and not data.get('grouped_data')">
                        <div style="padding: 30px; text-align: center; color: #94a3b8; font-style: italic; border: 1px dashed #e2e8f0; border-radius: 4px;">
                            No stock items found matching the criteria
                        </div>
                    </t>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #0891b2; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Stock Valuation
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Stock value = Quantity Ã— Unit Cost</li>
                            <li>All values in company currency (<t t-esc="company.currency_id.name"/>)</li>
                            <li>Valuation based on configured costing method (FIFO, AVCO, Standard)</li>
                            <li>Negative stock shown in red with parentheses</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         INVENTORY AGING (DEAD STOCK) REPORT
         ================================================================ -->

    <template id="report_inventory_aging_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="pc" t-value="company.ops_report_primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="company.ops_report_text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="company.get_report_primary_light()"/>
                <t t-set="pd" t-value="company.get_report_primary_dark()"/>
                <t t-set="body_text_color" t-value="company.ops_report_body_text_color or '#1a1a1a'"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Inventory Aging Analysis'"/>
                        <t t-set="report_pillar" t-value="'Inventory Intelligence'"/>
                        <t t-set="date_end" t-value="data.get('date_to', '')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Dead Stock Alert (if significant) -->
                    <t t-set="dead_stock_value" t-value="data.get('totals', {}).get('dead_stock_value', 0)"/>
                    <t t-set="total_value" t-value="data.get('totals', {}).get('total_value', 0)"/>
                    <t t-set="dead_pct" t-value="(dead_stock_value / total_value * 100) if total_value > 0 else 0"/>

                    <t t-if="dead_pct > 10">
                        <div style="background-color: #fef2f2; border-left: 4px solid #dc2626; padding: 12px 15px; margin-bottom: 15px;">
                            <span style="font-size: 10px; font-weight: 600; color: #991b1b;">Dead Stock Alert:</span>
                            <span style="font-size: 9px; color: #7f1d1d; margin-left: 5px;">
                                <t t-esc="'{:.1f}'.format(dead_pct)"/>% of inventory value is dead stock (>180 days). Value at risk: <strong><t t-esc="'{:,.2f}'.format(dead_stock_value)"/></strong>
                            </span>
                        </div>
                    </t>

                    <!-- Aging Buckets Summary -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 8px 0;">
                            <tr>
                                <t t-foreach="data.get('aging_buckets', [])" t-as="bucket">
                                    <t t-set="bucket_colors" t-value="['#16a34a', '#2563eb', '#d97706', '#dc2626', '#991b1b']"/>
                                    <t t-set="bucket_color" t-value="bucket_index &lt; len(bucket_colors) and bucket_colors[bucket_index] or '#94a3b8'"/>
                                    <td style="vertical-align: top;">
                                        <div t-attf-style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #{bucket_color}; border-radius: 4px; padding: 10px; text-align: center;">
                                            <div style="font-size: 8px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">
                                                <t t-esc="bucket.get('label', '')"/>
                                            </div>
                                            <div t-attf-style="font-size: 14px; font-weight: 700; color: #{bucket_color}; font-family: Consolas, Monaco, monospace;">
                                                <t t-esc="'{:,.0f}'.format(bucket.get('total_value', 0))"/>
                                            </div>
                                            <div style="font-size: 8px; color: #94a3b8; margin-top: 2px;">
                                                <t t-esc="'{:,.0f}'.format(bucket.get('total_qty', 0))"/> units
                                            </div>
                                        </div>
                                    </td>
                                </t>
                            </tr>
                        </table>
                    </div>

                    <!-- Aging Detail Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Product</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Location</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Age (Days)</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Quantity</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Value</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('all_items', [])[:100]" t-as="item">
                                <t t-set="age_days" t-value="item.get('age_days', 0)"/>
                                <t t-set="p1" t-value="data.get('aging_periods', {}).get('p1', 30)"/>
                                <t t-set="p2" t-value="data.get('aging_periods', {}).get('p2', 60)"/>
                                <t t-set="p3" t-value="data.get('aging_periods', {}).get('p3', 90)"/>
                                <t t-set="p4" t-value="data.get('aging_periods', {}).get('p4', 180)"/>
                                <t t-set="age_color" t-value="age_days &lt;= p1 and '#16a34a' or age_days &lt;= p2 and '#2563eb' or age_days &lt;= p3 and '#d97706' or age_days &lt;= p4 and '#dc2626' or '#991b1b'"/>
                                <t t-set="age_label" t-value="age_days &lt;= p1 and 'Fresh' or age_days &lt;= p2 and 'Normal' or age_days &lt;= p3 and 'Aging' or age_days &lt;= p4 and 'Old' or 'Dead'"/>

                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                        <t t-esc="item.get('product_name', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #64748b;">
                                        <t t-esc="item.get('location_name', '-')"/>
                                    </td>
                                    <td t-attf-style="text-align: center; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: #{age_color};">
                                        <t t-esc="age_days"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-esc="'{:,.2f}'.format(item.get('quantity', 0))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-esc="'{:,.2f}'.format(item.get('value', 0))"/>
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px;">
                                        <span t-attf-style="display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 8px; font-weight: 600; color: #ffffff; background-color: #{age_color};">
                                            <t t-esc="age_label"/>
                                        </span>
                                    </td>
                                </tr>
                            </t>

                            <!-- Empty State -->
                            <t t-if="not data.get('all_items')">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px; color: #94a3b8; font-style: italic;">
                                        No aged inventory items found
                                    </td>
                                </tr>
                            </t>
                        </tbody>

                        <!-- Totals -->
                        <tfoot t-if="data.get('all_items')">
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td colspan="3" style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase;">TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_quantity', 0))"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #0891b2; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Inventory Aging
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Age calculated from stock receipt date</li>
                            <li>Dead Stock = items with no movement in >180 days</li>
                            <li>Aging buckets: 0-30 (Fresh), 31-60 (Normal), 61-90 (Aging), 91-180 (Old), 180+ (Dead)</li>
                            <li>Review dead stock for write-off or disposal consideration</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         MOVEMENT ANALYSIS (FAST/SLOW) REPORT
         ================================================================ -->

    <template id="report_inventory_movement_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="pc" t-value="company.ops_report_primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="company.ops_report_text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="company.get_report_primary_light()"/>
                <t t-set="pd" t-value="company.get_report_primary_dark()"/>
                <t t-set="body_text_color" t-value="company.ops_report_body_text_color or '#1a1a1a'"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Movement Analysis Report'"/>
                        <t t-set="report_pillar" t-value="'Inventory Intelligence'"/>
                        <t t-set="date_from" t-value="data.get('date_from', '')"/>
                        <t t-set="date_to" t-value="data.get('date_to', '')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Movement Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <t t-foreach="data.get('movement_summary', [])" t-as="summary">
                                    <t t-set="mv_color" t-value="summary.get('label') == 'Fast Moving' and '#16a34a' or summary.get('label') == 'Slow Moving' and '#d97706' or '#dc2626'"/>
                                    <td style="width: 33%; vertical-align: top;">
                                        <div t-attf-style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #{mv_color}; border-radius: 4px; padding: 12px; text-align: center;">
                                            <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">
                                                <t t-esc="summary.get('label', '')"/>
                                            </div>
                                            <div t-attf-style="font-size: 18px; font-weight: 700; color: #{mv_color}; font-family: Consolas, Monaco, monospace;">
                                                <t t-esc="'{:,.0f}'.format(summary.get('value', 0))"/>
                                            </div>
                                            <div style="font-size: 8px; color: #94a3b8; margin-top: 2px;">
                                                <t t-esc="summary.get('count', 0)"/> products | <t t-esc="'{:,.0f}'.format(summary.get('qty', 0))"/> units
                                            </div>
                                        </div>
                                    </td>
                                </t>
                            </tr>
                        </table>
                    </div>

                    <!-- Movement Detail Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Product</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Current Qty</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Current Value</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Moves</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Qty Moved</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Turnover</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Class</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('data', [])[:100]" t-as="item">
                                <t t-set="mv_class" t-value="item.get('movement_class', 'dead')"/>
                                <t t-set="mv_color" t-value="mv_class == 'fast' and '#16a34a' or mv_class == 'slow' and '#d97706' or '#dc2626'"/>

                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                        <t t-esc="item.get('product_name', '-')"/>
                                        <t t-if="item.get('product_code')">
                                            <span style="color: #94a3b8; font-size: 8px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-esc="'{:,.2f}'.format(item.get('current_qty', 0))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 500;">
                                        <t t-esc="'{:,.2f}'.format(item.get('current_value', 0))"/>
                                    </td>
                                    <td t-attf-style="text-align: center; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: #{mv_color};">
                                        <t t-esc="item.get('move_count', 0)"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-esc="'{:,.2f}'.format(item.get('qty_moved', 0))"/>
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-esc="'{:.2f}'.format(item.get('turnover_ratio', 0))"/>x
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px;">
                                        <span t-attf-style="display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 8px; font-weight: 600; color: #ffffff; background-color: #{mv_color};">
                                            <t t-esc="item.get('movement_label', 'Unknown')"/>
                                        </span>
                                    </td>
                                </tr>
                            </t>

                            <!-- Empty State -->
                            <t t-if="not data.get('data')">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 20px; color: #94a3b8; font-style: italic;">
                                        No movement data found for the selected period
                                    </td>
                                </tr>
                            </t>
                        </tbody>

                        <!-- Totals -->
                        <tfoot t-if="data.get('data')">
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase;">TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_qty', 0))"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_value', 0))"/>
                                </td>
                                <td colspan="4"></td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #0891b2; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Movement Analysis
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Fast Moving = >5 moves in analysis period</li>
                            <li>Slow Moving = 1-5 moves in analysis period</li>
                            <li>Dead Stock = No moves in analysis period</li>
                            <li>Turnover = Qty Moved / Current Qty (higher is better)</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         NEGATIVE STOCK ALERT REPORT
         ================================================================ -->

    <template id="report_inventory_negative_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="pc" t-value="company.ops_report_primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="company.ops_report_text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="company.get_report_primary_light()"/>
                <t t-set="pd" t-value="company.get_report_primary_dark()"/>
                <t t-set="body_text_color" t-value="company.ops_report_body_text_color or '#1a1a1a'"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Negative Stock Alert Report'"/>
                        <t t-set="report_pillar" t-value="'Inventory Intelligence'"/>
                        <t t-set="date_end" t-value="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Alert Summary -->
                    <t t-if="data.get('totals', {}).get('alert_count', 0) > 0">
                        <div style="background-color: #fef2f2; border-left: 4px solid #dc2626; padding: 12px 15px; margin-bottom: 15px;">
                            <span style="font-size: 10px; font-weight: 600; color: #991b1b;">Immediate Action Required:</span>
                            <span style="font-size: 9px; color: #7f1d1d; margin-left: 5px;">
                                <t t-esc="data.get('totals', {}).get('alert_count', 0)"/> items have negative stock levels.
                                <t t-if="data.get('totals', {}).get('critical_count', 0) > 0">
                                    <strong><t t-esc="data.get('totals', {}).get('critical_count', 0)"/> items are CRITICAL</strong> (qty &lt; -10).
                                </t>
                                Total negative value: <strong><t t-esc="'{:,.2f}'.format(data.get('totals', {}).get('total_negative_value', 0))"/></strong>
                            </span>
                        </div>
                    </t>
                    <t t-else="">
                        <div style="background-color: #ecfdf5; border-left: 4px solid #16a34a; padding: 12px 15px; margin-bottom: 15px;">
                            <span style="font-size: 10px; font-weight: 600; color: #065f46;">All Clear:</span>
                            <span style="font-size: 9px; color: #064e3b; margin-left: 5px;">
                                No negative stock items found. Inventory levels are healthy.
                            </span>
                        </div>
                    </t>

                    <!-- Negative Stock Table -->
                    <t t-if="data.get('data')">
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #dc2626; background-color: #fef2f2;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #991b1b;">Product</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #991b1b;">Location</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #991b1b;">Quantity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #991b1b;">Reserved</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #991b1b;">Value</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #991b1b;">Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('data', [])" t-as="item">
                                    <t t-set="severity" t-value="item.get('severity', 'warning')"/>
                                    <t t-set="severity_color" t-value="severity == 'critical' and '#7f1d1d' or '#dc2626'"/>

                                    <tr style="border-bottom: 1px solid #fecaca;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="item.get('product_name', '-')"/>
                                            <t t-if="item.get('product_code')">
                                                <span style="color: #94a3b8; font-size: 8px;"> [<t t-esc="item.get('product_code')"/>]</span>
                                            </t>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="item.get('location_name', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; color: #dc2626;">
                                            (<t t-esc="'{:,.2f}'.format(abs(item.get('quantity', 0)))"/>)
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #64748b;">
                                            <t t-esc="'{:,.2f}'.format(item.get('reserved_quantity', 0))"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: #dc2626;">
                                            (<t t-esc="'{:,.2f}'.format(abs(item.get('value', 0)))"/>)
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px;">
                                            <span t-attf-style="display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 8px; font-weight: 600; color: #ffffff; background-color: #{severity_color};">
                                                <t t-if="severity == 'critical'">CRITICAL</t>
                                                <t t-else="">WARNING</t>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>

                            <!-- Totals -->
                            <tfoot>
                                <tr style="border-top: 2px solid #dc2626; border-bottom: 3px double #dc2626; background-color: #fee2e2;">
                                    <td colspan="2" style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #991b1b;">TOTAL NEGATIVE</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                        (<t t-esc="'{:,.2f}'.format(abs(data.get('totals', {}).get('total_negative_qty', 0)))"/>)
                                    </td>
                                    <td></td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                        (<t t-esc="'{:,.2f}'.format(abs(data.get('totals', {}).get('total_negative_value', 0)))"/>)
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #dc2626; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Negative Stock Alert
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Critical = qty &lt; -10 units</li>
                            <li>Warning = qty &lt; 0 but > -10 units</li>
                            <li>Negative stock requires inventory adjustment or correction</li>
                            <li>Review reserved quantities for potential over-allocation</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         REPORT ACTIONS
         ================================================================ -->

    <!-- Stock Valuation Report PDF -->
    <record id="report_inventory_valuation_pdf" model="ir.actions.report">
        <field name="name">Stock Valuation Report (Corporate)</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_valuation_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_valuation_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Inventory Aging Report PDF -->
    <record id="report_inventory_aging_pdf" model="ir.actions.report">
        <field name="name">Inventory Aging Report (Corporate)</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_aging_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_aging_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Movement Analysis Report PDF -->
    <record id="report_inventory_movement_pdf" model="ir.actions.report">
        <field name="name">Movement Analysis Report (Corporate)</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_movement_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_movement_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Negative Stock Alert Report PDF -->
    <record id="report_inventory_negative_pdf" model="ir.actions.report">
        <field name="name">Negative Stock Alert (Corporate)</field>
        <field name="model">ops.inventory.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_inventory_negative_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_inventory_negative_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_inventory_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
