<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        ================================================================
        OPS CORPORATE FINANCIAL INTELLIGENCE TEMPLATES
        Phase 4E: Financial Intelligence Reports (Final Phase)
        ================================================================

        Corporate templates for remaining financial reports:
        - Trial Balance (tb)
        - Profit & Loss Statement (pl)
        - Cash Flow Statement (cf)
        - Aged Partner Balance (aged)
        - Partner Ledger (partner)
        - Statement of Account (soa)

        NOTE: General Ledger has a dedicated template file:
        - ops_general_ledger_template.xml
        Balance Sheet corporate template is defined below in this file.

        SHARED COMPONENTS USED:
        - report_corporate_header
        - report_corporate_title
        - report_filter_bar
        - report_corporate_footer

        Phase 4 Corporate Pattern Compliance:
        - Consistent branding across all 16+ OPS reports
        - Professional typography and spacing
        - Color-coded sections
        - Standardized number formatting
    -->

    <!-- ================================================================
         REPORT ACTIONS
         ================================================================ -->

    <!-- Trial Balance Report Action -->
    <record id="action_report_trial_balance_corporate" model="ir.actions.report">
        <field name="name">OPS Trial Balance Report</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_trial_balance_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_trial_balance_corporate</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Trial_Balance_%s_%s' % (object.date_from, object.date_to)</field>
        <field name="binding_type">report</field>
    </record>

    <!-- Profit & Loss Report Action -->
    <record id="action_report_profit_loss_corporate" model="ir.actions.report">
        <field name="name">OPS Profit &amp; Loss Statement</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_profit_loss_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_profit_loss_corporate</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Profit_Loss_%s_%s' % (object.date_from, object.date_to)</field>
        <field name="binding_type">report</field>
    </record>

    <!-- Cash Flow Report Action -->
    <record id="action_report_cash_flow_corporate" model="ir.actions.report">
        <field name="name">OPS Cash Flow Statement</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_cash_flow_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_cash_flow_corporate</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Cash_Flow_%s_%s' % (object.date_from, object.date_to)</field>
        <field name="binding_type">report</field>
    </record>

    <!-- Aged Partner Balance Report Action -->
    <record id="action_report_aged_partner_corporate" model="ir.actions.report">
        <field name="name">OPS Aged Partner Balance</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_aged_partner_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_aged_partner_corporate</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Aged_Partner_%s_%s' % (object.date_from, object.date_to)</field>
        <field name="binding_type">report</field>
    </record>
    <!-- Balance Sheet Report Action -->
    <record id="action_report_balance_sheet_corporate" model="ir.actions.report">
        <field name="name">OPS Balance Sheet</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_balance_sheet_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_balance_sheet_corporate</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Balance_Sheet_%s' % (object.as_of_date or object.date_to)</field>
        <field name="binding_type">report</field>
    </record>

    <!-- ================================================================
         TRIAL BALANCE CORPORATE TEMPLATE
         ================================================================ -->

    <template id="report_trial_balance_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="report_data" t-value="doc._get_report_data()"/>
                <t t-set="company" t-value="doc.company_id or env.company"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Trial Balance'"/>
                        <t t-set="report_pillar" t-value="'Financial Intelligence'"/>
                        <t t-set="date_from" t-value="doc.date_from"/>
                        <t t-set="date_to" t-value="doc.date_to"/>
                    </t>

                    <!-- Filter Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Balance Check Badge -->
                    <t t-set="total_debit" t-value="report_data.get('total_debit', 0)"/>
                    <t t-set="total_credit" t-value="report_data.get('total_credit', 0)"/>
                    <t t-set="tb_diff" t-value="abs(total_debit - total_credit)"/>

                    <div t-attf-style="background-color: #{tb_diff &lt; 0.01 and '#d1fae5' or '#fee2e2'}; border-left: 4px solid #{tb_diff &lt; 0.01 and '#16a34a' or '#dc2626'}; padding: 12px 15px; margin: 20px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 11px; font-weight: 700; color: #1e293b;">
                                    <t t-if="tb_diff &lt; 0.01">✓ Trial Balance is Balanced</t>
                                    <t t-else="">⚠ Trial Balance Out of Balance</t>
                                </td>
                                <td style="text-align: right; font-size: 10px; font-family: Consolas, Monaco, monospace; color: #475569;">
                                    <t t-if="tb_diff >= 0.01">
                                        Difference: <span style="color: #dc2626; font-weight: 700;"><t t-esc="'{:,.2f}'.format(tb_diff)"/></span>
                                    </t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Trial Balance Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Code</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 40%;">Account Name</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Debit</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Credit</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('lines', [])" t-as="line">
                                <t t-set="debit" t-value="line.get('debit', 0)"/>
                                <t t-set="credit" t-value="line.get('credit', 0)"/>
                                <t t-set="balance" t-value="line.get('balance', 0)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;">
                                        <t t-esc="line.get('code', '')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="debit == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(debit)"/>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="credit == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(credit)"/>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-if="balance == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="balance &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(balance))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(balance)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>

                            <!-- Grand Total Row -->
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td colspan="2" style="padding: 10px 8px; font-weight: 700; font-size: 10px; text-transform: uppercase;">GRAND TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(total_debit)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(total_credit)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(total_debit - total_credit)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Notes -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b;">Notes</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569;">
                            <li>Trial Balance lists all accounts with their debit, credit, and net balance</li>
                            <li>Total debits must equal total credits for the books to be balanced</li>
                            <li>This report verifies the fundamental accounting equation: Assets = Liabilities + Equity</li>
                            <li>Zero balances shown as dash (-) for clarity</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>
                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         PROFIT & LOSS STATEMENT CORPORATE TEMPLATE
         ================================================================ -->

    <template id="report_profit_loss_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="report_data" t-value="doc._get_report_data()"/>
                <t t-set="company" t-value="doc.company_id or env.company"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Profit &amp; Loss Statement'"/>
                        <t t-set="report_pillar" t-value="'Financial Intelligence'"/>
                        <t t-set="date_from" t-value="doc.date_from"/>
                        <t t-set="date_to" t-value="doc.date_to"/>
                    </t>

                    <!-- Filter Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Calculate Totals -->
                    <t t-set="income" t-value="report_data.get('income_total', 0)"/>
                    <t t-set="expense" t-value="report_data.get('expense_total', 0)"/>
                    <t t-set="net" t-value="report_data.get('net_profit', income - expense)"/>
                    <t t-set="margin" t-value="(net / income * 100) if income > 0 else 0"/>

                    <!-- Performance Alert -->
                    <t t-if="net &lt; 0">
                        <div style="background-color: #fee2e2; border-left: 4px solid #dc2626; padding: 12px 15px; margin: 20px 0;">
                            <span style="font-size: 10px; font-weight: 700; color: #991b1b;">⚠ WARNING:</span>
                            <span style="font-size: 9px; color: #7f1d1d;"> Net loss detected. Immediate attention required.</span>
                        </div>
                    </t>
                    <t t-elif="margin &lt; 5">
                        <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 15px; margin: 20px 0;">
                            <span style="font-size: 10px; font-weight: 700; color: #92400e;">⚠ CAUTION:</span>
                            <span style="font-size: 9px; color: #78350f;"> Profit margin below 5% threshold.</span>
                        </div>
                    </t>

                    <!-- ==================== REVENUE SECTION ==================== -->

                    <div style="background-color: #d1fae5; border-left: 4px solid #16a34a; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    REVENUE
                                </td>
                                <td style="text-align: right; font-size: 13px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: #16a34a;">
                                    <t t-esc="'{:,.2f}'.format(income)"/>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Account</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 20%;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('income_lines', [])" t-as="line">
                                <t t-set="amt" t-value="line.get('amount', line.get('balance', 0))"/>
                                <t t-set="level" t-value="line.get('level', 0)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td t-attf-style="padding: 6px 8px; padding-left: #{8 + level * 12}px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="amt == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="amt &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(amt))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(amt)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not report_data.get('income_lines')">
                                <tr>
                                    <td colspan="2" style="padding: 10px 8px; color: #94a3b8; text-align: center; font-style: italic;">
                                        No revenue entries for this period
                                    </td>
                                </tr>
                            </t>
                            <!-- Revenue Subtotal -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">TOTAL REVENUE</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #16a34a;">
                                    <t t-esc="'{:,.2f}'.format(income)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== EXPENSES SECTION ==================== -->

                    <div style="background-color: #fee2e2; border-left: 4px solid #dc2626; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    EXPENSES
                                </td>
                                <td style="text-align: right; font-size: 13px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: #dc2626;">
                                    <t t-esc="'{:,.2f}'.format(expense)"/>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Account</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 20%;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('expense_lines', [])" t-as="line">
                                <t t-set="amt" t-value="line.get('amount', line.get('balance', 0))"/>
                                <t t-set="level" t-value="line.get('level', 0)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td t-attf-style="padding: 6px 8px; padding-left: #{8 + level * 12}px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="amt == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="amt &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(amt))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(amt)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not report_data.get('expense_lines')">
                                <tr>
                                    <td colspan="2" style="padding: 10px 8px; color: #94a3b8; text-align: center; font-style: italic;">
                                        No expense entries for this period
                                    </td>
                                </tr>
                            </t>
                            <!-- Expense Subtotal -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">TOTAL EXPENSES</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #dc2626;">
                                    <t t-esc="'{:,.2f}'.format(expense)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== NET PROFIT SUMMARY ==================== -->

                    <div t-attf-style="background-color: #{net >= 0 and '#d1fae5' or '#fee2e2'}; border-left: 4px solid #{net >= 0 and '#16a34a' or '#dc2626'}; padding: 15px 20px; margin: 25px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="width: 60%; vertical-align: middle;">
                                    <div style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        NET PROFIT / (LOSS)
                                    </div>
                                    <div style="font-size: 9px; color: #64748b; margin-top: 3px;">Revenue - Expenses</div>
                                </td>
                                <td style="width: 40%; text-align: right; vertical-align: middle;">
                                    <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 20px; font-weight: 700; color: #{net >= 0 and '#16a34a' or '#dc2626'};">
                                        <t t-if="net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(net))"/>)</t>
                                        <t t-else=""><t t-esc="'{:,.2f}'.format(net)"/></t>
                                    </div>
                                    <div style="font-size: 11px; font-weight: 600; color: #475569; margin-top: 3px;">
                                        Margin: <t t-esc="'{:.1f}'.format(margin)"/>%
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Notes -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b;">Notes</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569;">
                            <li>Profit &amp; Loss Statement shows financial performance for the reporting period</li>
                            <li>Net Profit Margin = (Net Profit / Total Revenue) × 100</li>
                            <li>Margins: Excellent (≥20%), Healthy (≥10%), Acceptable (≥5%), Low (&lt;5%), Loss (&lt;0%)</li>
                            <li>All figures exclude unposted entries unless "All Entries" filter is selected</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>
                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         CASH FLOW STATEMENT CORPORATE TEMPLATE
         ================================================================ -->

    <template id="report_cash_flow_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="report_data" t-value="doc._get_report_data()"/>
                <t t-set="company" t-value="doc.company_id or env.company"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Cash Flow Statement'"/>
                        <t t-set="report_pillar" t-value="'Financial Intelligence'"/>
                        <t t-set="date_from" t-value="doc.date_from"/>
                        <t t-set="date_to" t-value="doc.date_to"/>
                    </t>

                    <!-- Filter Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Calculate Totals -->
                    <t t-set="operating_net" t-value="report_data.get('operating_net', 0)"/>
                    <t t-set="investing_net" t-value="report_data.get('investing_net', 0)"/>
                    <t t-set="financing_net" t-value="report_data.get('financing_net', 0)"/>
                    <t t-set="net_cf" t-value="report_data.get('net_cash_flow', operating_net + investing_net + financing_net)"/>
                    <t t-set="opening_cash" t-value="report_data.get('opening_cash', 0)"/>
                    <t t-set="closing_cash" t-value="report_data.get('closing_cash', opening_cash + net_cf)"/>

                    <!-- Cash Flow Summary KPIs -->
                    <div style="margin: 20px 0;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <td style="background-color: #dbeafe; border-left: 4px solid #0891b2; padding: 12px 15px; width: 25%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">Operating</div>
                                    <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #{operating_net >= 0 and '#0891b2' or '#dc2626'}; margin-top: 4px;">
                                        <t t-if="operating_net &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(operating_net))"/>)</t>
                                        <t t-else=""><t t-esc="'{:,.0f}'.format(operating_net)"/></t>
                                    </div>
                                </td>
                                <td style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 15px; width: 25%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">Investing</div>
                                    <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #{investing_net >= 0 and '#f59e0b' or '#dc2626'}; margin-top: 4px;">
                                        <t t-if="investing_net &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(investing_net))"/>)</t>
                                        <t t-else=""><t t-esc="'{:,.0f}'.format(investing_net)"/></t>
                                    </div>
                                </td>
                                <td style="background-color: #e9d5ff; border-left: 4px solid #9333ea; padding: 12px 15px; width: 25%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">Financing</div>
                                    <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #{financing_net >= 0 and '#9333ea' or '#dc2626'}; margin-top: 4px;">
                                        <t t-if="financing_net &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(financing_net))"/>)</t>
                                        <t t-else=""><t t-esc="'{:,.0f}'.format(financing_net)"/></t>
                                    </div>
                                </td>
                                <td t-attf-style="background-color: #{net_cf >= 0 and '#d1fae5' or '#fee2e2'}; border-left: 4px solid #{net_cf >= 0 and '#16a34a' or '#dc2626'}; padding: 12px 15px; width: 25%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">Net Change</div>
                                    <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #{net_cf >= 0 and '#16a34a' or '#dc2626'}; margin-top: 4px;">
                                        <t t-if="net_cf &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(net_cf))"/>)</t>
                                        <t t-else=""><t t-esc="'{:,.0f}'.format(net_cf)"/></t>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- ==================== OPERATING ACTIVITIES ==================== -->

                    <div style="background-color: #dbeafe; border-left: 4px solid #0891b2; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    CASH FLOW FROM OPERATING ACTIVITIES
                                </td>
                                <td style="text-align: right; font-size: 13px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: #0891b2;">
                                    <t t-if="operating_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(operating_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(operating_net)"/></t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Description</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Inflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Outflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Net</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('operating_lines', report_data.get('lines', []))" t-as="line">
                                <t t-set="inflow" t-value="line.get('inflow', 0)"/>
                                <t t-set="outflow" t-value="line.get('outflow', 0)"/>
                                <t t-set="net_flow" t-value="line.get('net', inflow - outflow)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="inflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(inflow)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="outflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(outflow)"/>)</span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-if="net_flow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="net_flow &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(net_flow))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(net_flow)"/></span>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not report_data.get('operating_lines') and not report_data.get('lines')">
                                <tr>
                                    <td colspan="4" style="padding: 10px 8px; color: #94a3b8; text-align: center; font-style: italic;">
                                        No operating cash flow entries
                                    </td>
                                </tr>
                            </t>
                            <!-- Operating Subtotal -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">NET CASH FROM OPERATING</td>
                                <td colspan="2"></td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #0891b2;">
                                    <t t-if="operating_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(operating_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(operating_net)"/></t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== INVESTING ACTIVITIES ==================== -->

                    <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    CASH FLOW FROM INVESTING ACTIVITIES
                                </td>
                                <td style="text-align: right; font-size: 13px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: #f59e0b;">
                                    <t t-if="investing_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(investing_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(investing_net)"/></t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Description</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Inflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Outflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Net</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('investing_lines', [])" t-as="line">
                                <t t-set="inflow" t-value="line.get('inflow', 0)"/>
                                <t t-set="outflow" t-value="line.get('outflow', 0)"/>
                                <t t-set="net_flow" t-value="line.get('net', inflow - outflow)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="inflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(inflow)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="outflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(outflow)"/>)</span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-if="net_flow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="net_flow &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(net_flow))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(net_flow)"/></span>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not report_data.get('investing_lines')">
                                <tr>
                                    <td colspan="4" style="padding: 10px 8px; color: #94a3b8; text-align: center; font-style: italic;">
                                        No investing cash flow entries
                                    </td>
                                </tr>
                            </t>
                            <!-- Investing Subtotal -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">NET CASH FROM INVESTING</td>
                                <td colspan="2"></td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #f59e0b;">
                                    <t t-if="investing_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(investing_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(investing_net)"/></t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== FINANCING ACTIVITIES ==================== -->

                    <div style="background-color: #e9d5ff; border-left: 4px solid #9333ea; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    CASH FLOW FROM FINANCING ACTIVITIES
                                </td>
                                <td style="text-align: right; font-size: 13px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: #9333ea;">
                                    <t t-if="financing_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(financing_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(financing_net)"/></t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Description</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Inflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Outflow</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 18%;">Net</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('financing_lines', [])" t-as="line">
                                <t t-set="inflow" t-value="line.get('inflow', 0)"/>
                                <t t-set="outflow" t-value="line.get('outflow', 0)"/>
                                <t t-set="net_flow" t-value="line.get('net', inflow - outflow)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="line.get('account', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="inflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(inflow)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="outflow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(outflow)"/>)</span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-if="net_flow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="net_flow &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(net_flow))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(net_flow)"/></span>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not report_data.get('financing_lines')">
                                <tr>
                                    <td colspan="4" style="padding: 10px 8px; color: #94a3b8; text-align: center; font-style: italic;">
                                        No financing cash flow entries
                                    </td>
                                </tr>
                            </t>
                            <!-- Financing Subtotal -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">NET CASH FROM FINANCING</td>
                                <td colspan="2"></td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #9333ea;">
                                    <t t-if="financing_net &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(financing_net))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(financing_net)"/></t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== CASH RECONCILIATION ==================== -->

                    <div style="background-color: #f1f5f9; border-left: 4px solid #64748b; padding: 10px 15px; margin: 25px 0 10px 0;">
                        <div style="font-size: 12px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                            CASH RECONCILIATION
                        </div>
                    </div>

                    <table width="100%" style="border-collapse: collapse; font-size: 10px; margin-bottom: 20px;">
                        <tbody>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 8px; color: #475569;">Cash at Beginning of Period</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; width: 25%;">
                                    <t t-esc="'{:,.2f}'.format(opening_cash)"/>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 8px; color: #475569; padding-left: 20px;">Net Cash from Operating</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace;">
                                    <t t-if="operating_net &lt; 0">
                                        <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(operating_net))"/>)</span>
                                    </t>
                                    <t t-else="">
                                        <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(operating_net)"/></span>
                                    </t>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 8px; color: #475569; padding-left: 20px;">Net Cash from Investing</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace;">
                                    <t t-if="investing_net &lt; 0">
                                        <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(investing_net))"/>)</span>
                                    </t>
                                    <t t-else="">
                                        <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(investing_net)"/></span>
                                    </t>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 8px; color: #475569; padding-left: 20px;">Net Cash from Financing</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace;">
                                    <t t-if="financing_net &lt; 0">
                                        <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(financing_net))"/>)</span>
                                    </t>
                                    <t t-else="">
                                        <span style="color: #16a34a;"><t t-esc="'{:,.2f}'.format(financing_net)"/></span>
                                    </t>
                                </td>
                            </tr>
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f8fafc;">
                                <td style="padding: 10px 8px; font-weight: 700; text-transform: uppercase;">CASH AT END OF PERIOD</td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700;">
                                    <t t-esc="'{:,.2f}'.format(closing_cash)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Notes -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b;">Notes</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569;">
                            <li>Cash Flow Statement shows sources and uses of cash during the period</li>
                            <li>Operating Activities: Cash from normal business operations</li>
                            <li>Investing Activities: Cash from buying/selling assets and investments</li>
                            <li>Financing Activities: Cash from debt, equity, and dividends</li>
                            <li>Inflows shown in green, outflows in red (parentheses)</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>
                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         AGED PARTNER BALANCE CORPORATE TEMPLATE
         ================================================================ -->

    <template id="report_aged_partner_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="report_data" t-value="doc._get_report_data()"/>
                <t t-set="company" t-value="doc.company_id or env.company"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Aged Partner Balance'"/>
                        <t t-set="report_pillar" t-value="'Financial Intelligence'"/>
                        <t t-set="date_from" t-value="doc.date_from"/>
                        <t t-set="date_to" t-value="doc.date_to"/>
                    </t>

                    <!-- Filter Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Aging Summary -->
                    <t t-set="total_current" t-value="report_data.get('total_current', 0)"/>
                    <t t-set="total_30" t-value="report_data.get('total_30', 0)"/>
                    <t t-set="total_60" t-value="report_data.get('total_60', 0)"/>
                    <t t-set="total_90" t-value="report_data.get('total_90', 0)"/>
                    <t t-set="total_older" t-value="report_data.get('total_older', 0)"/>
                    <t t-set="total_balance" t-value="total_current + total_30 + total_60 + total_90 + total_older"/>

                    <div style="margin: 20px 0;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 8px 0;">
                            <tr>
                                <td style="background-color: #d1fae5; border-left: 4px solid #16a34a; padding: 10px 12px; width: 20%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">Current</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 12px; font-weight: 700; color: #16a34a; margin-top: 4px;">
                                        <t t-esc="'{:,.0f}'.format(total_current)"/>
                                    </div>
                                </td>
                                <td style="background-color: #fef3c7; border-left: 4px solid #eab308; padding: 10px 12px; width: 20%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">1-30 Days</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 12px; font-weight: 700; color: #ca8a04; margin-top: 4px;">
                                        <t t-esc="'{:,.0f}'.format(total_30)"/>
                                    </div>
                                </td>
                                <td style="background-color: #fed7aa; border-left: 4px solid #f59e0b; padding: 10px 12px; width: 20%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">31-60 Days</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 12px; font-weight: 700; color: #d97706; margin-top: 4px;">
                                        <t t-esc="'{:,.0f}'.format(total_60)"/>
                                    </div>
                                </td>
                                <td style="background-color: #fecaca; border-left: 4px solid #ef4444; padding: 10px 12px; width: 20%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">61-90 Days</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 12px; font-weight: 700; color: #dc2626; margin-top: 4px;">
                                        <t t-esc="'{:,.0f}'.format(total_90)"/>
                                    </div>
                                </td>
                                <td style="background-color: #fee2e2; border-left: 4px solid #dc2626; padding: 10px 12px; width: 20%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase;">90+ Days</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 12px; font-weight: 700; color: #991b1b; margin-top: 4px;">
                                        <t t-esc="'{:,.0f}'.format(total_older)"/>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Aged Partner Balance Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 25%;">Partner</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 13%;">Current</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 13%;">1-30</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 13%;">31-60</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 13%;">61-90</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 13%;">90+</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Total Due</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="report_data.get('lines', [])" t-as="line">
                                <t t-set="current" t-value="line.get('current', 0)"/>
                                <t t-set="age_30" t-value="line.get('30', line.get('age_30', 0))"/>
                                <t t-set="age_60" t-value="line.get('60', line.get('age_60', 0))"/>
                                <t t-set="age_90" t-value="line.get('90', line.get('age_90', 0))"/>
                                <t t-set="older" t-value="line.get('older', line.get('age_older', 0))"/>
                                <t t-set="total" t-value="line.get('total', line.get('balance', current + age_30 + age_60 + age_90 + older))"/>

                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="line.get('partner', line.get('name', ''))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="current == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(current)"/>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="age_30 == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #ca8a04;"><t t-esc="'{:,.2f}'.format(age_30)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="age_60 == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #f59e0b;"><t t-esc="'{:,.2f}'.format(age_60)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="age_90 == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #ef4444;"><t t-esc="'{:,.2f}'.format(age_90)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-if="older == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #dc2626; font-weight: 700;"><t t-esc="'{:,.2f}'.format(older)"/></span>
                                        </t>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                        <t t-esc="'{:,.2f}'.format(total)"/>
                                    </td>
                                </tr>
                            </t>

                            <!-- Grand Total Row -->
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 10px 8px; font-weight: 700; font-size: 10px; text-transform: uppercase;">GRAND TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(total_current)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #ca8a04;">
                                    <t t-esc="'{:,.2f}'.format(total_30)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #f59e0b;">
                                    <t t-esc="'{:,.2f}'.format(total_60)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #ef4444;">
                                    <t t-esc="'{:,.2f}'.format(total_90)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #dc2626;">
                                    <t t-esc="'{:,.2f}'.format(total_older)"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(total_balance)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Notes -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b;">Notes</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569;">
                            <li>Aged Partner Balance shows receivables/payables by aging bucket</li>
                            <li>Current: Not yet due or due within current period</li>
                            <li>Color coding: Green (Current) → Yellow (1-30) → Orange (31-60) → Red (61-90) → Dark Red (90+)</li>
                            <li>Older balances require immediate attention and collection action</li>
                            <li>Use this report to manage credit risk and cash flow</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>
                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         BALANCE SHEET CORPORATE TEMPLATE
         Phase 4E: Financial Intelligence Report
         Data source: doc._get_report_data() with hierarchy + sections + summary
         ================================================================ -->

    <template id="report_balance_sheet_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="report_data" t-value="doc._get_report_data()"/>
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="summary" t-value="report_data.get('summary', {})"/>
                <t t-set="hierarchy" t-value="report_data.get('hierarchy', {})"/>

                <!-- Extract totals (summary values already abs() for liabilities/equity) -->
                <t t-set="total_assets" t-value="summary.get('total_assets', hierarchy.get('asset_total', 0))"/>
                <t t-set="total_liabilities" t-value="summary.get('total_liabilities', hierarchy.get('liability_total', 0))"/>
                <t t-set="total_equity" t-value="summary.get('total_equity', hierarchy.get('equity_total', 0))"/>
                <t t-set="check_diff" t-value="abs(total_assets - (total_liabilities + total_equity))"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Balance Sheet'"/>
                        <t t-set="report_pillar" t-value="'Financial Intelligence'"/>
                        <t t-set="date_end" t-value="doc.as_of_date or doc.date_to"/>
                    </t>

                    <!-- Filter Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Balance Check Badge -->
                    <t t-call="ops_matrix_accounting.balance_check_badge">
                        <t t-set="is_balanced" t-value="check_diff &lt; 0.01"/>
                        <t t-set="difference" t-value="check_diff"/>
                    </t>

                    <!-- ==================== KPI SUMMARY ==================== -->
                    <div style="margin: 20px 0;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <td style="background-color: #f0fdf4; border-left: 4px solid #16a34a; padding: 12px 15px; width: 33%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase; letter-spacing: 0.5px;">Total Assets</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #16a34a; margin-top: 4px;">
                                        <t t-esc="'{:,.2f}'.format(total_assets)"/>
                                    </div>
                                </td>
                                <td style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 12px 15px; width: 33%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase; letter-spacing: 0.5px;">Total Liabilities</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #f59e0b; margin-top: 4px;">
                                        <t t-esc="'{:,.2f}'.format(total_liabilities)"/>
                                    </div>
                                </td>
                                <td style="background-color: #faf5ff; border-left: 4px solid #9333ea; padding: 12px 15px; width: 33%;">
                                    <div style="font-size: 8px; font-weight: 600; color: #475569; text-transform: uppercase; letter-spacing: 0.5px;">Shareholders' Equity</div>
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 14px; font-weight: 700; color: #9333ea; margin-top: 4px;">
                                        <t t-esc="'{:,.2f}'.format(total_equity)"/>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- ==================== ASSETS SECTION ==================== -->

                    <t t-call="ops_matrix_accounting.section_header_asset">
                        <t t-set="section_title" t-value="'ASSETS'"/>
                    </t>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Code</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 55%;">Account Name</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 30%;">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Hierarchical asset lines -->
                            <t t-foreach="hierarchy.get('asset_hierarchy', [])" t-as="line">
                                <t t-set="bal" t-value="line.get('balance', 0)"/>
                                <tr t-att-style="
                                    (line.get('is_subtotal') and 'border-top: 1px solid #e2e8f0; background-color: #f8fafc;' or '')
                                    + (line.get('type') == 'group' and 'background-color: #fafafa;' or '')
                                ">
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;'">
                                        <t t-esc="line.get('code', '')"/>
                                    </td>
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #475569;'
                                        + (line.get('type') in ('group', 'subtotal') and ' font-weight: 600;' or '')
                                        + (line.get('is_subtotal') and ' font-size: 10px;' or '')
                                    ">
                                        <t t-esc="line.get('name', '')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;"
                                        t-att-style="(line.get('type') in ('group', 'subtotal') and 'font-weight: 600;' or '')">
                                        <t t-if="bal == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="bal &lt; 0">
                                            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(bal))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(bal)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <!-- Fallback: Flat section data if hierarchy is empty -->
                            <t t-if="not hierarchy.get('asset_hierarchy')">
                                <t t-foreach="report_data.get('sections', [])" t-as="section">
                                    <t t-if="section.get('type', '').startswith('asset_')">
                                        <!-- Section sub-header -->
                                        <tr style="background-color: #fafafa;">
                                            <td colspan="2" style="padding: 6px 8px; font-weight: 600; color: #475569; font-size: 9px;">
                                                <t t-esc="section.get('label', '')"/>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(section.get('total_balance', 0))"/>
                                            </td>
                                        </tr>
                                        <t t-foreach="section.get('accounts', [])" t-as="acct">
                                            <t t-set="bal" t-value="acct.get('balance', 0)"/>
                                            <tr style="border-bottom: 1px solid #f1f5f9;">
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;">
                                                    <t t-esc="acct.get('account_code', '')"/>
                                                </td>
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #475569;">
                                                    <t t-esc="acct.get('account_name', '')"/>
                                                </td>
                                                <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                                    <t t-if="bal == 0"><span style="color: #94a3b8;">-</span></t>
                                                    <t t-elif="bal &lt; 0"><span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(bal))"/>)</span></t>
                                                    <t t-else=""><t t-esc="'{:,.2f}'.format(bal)"/></t>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                            </t>

                            <!-- Grand Total: Assets -->
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td colspan="2" style="padding: 10px 8px; font-weight: 700; font-size: 10px; text-transform: uppercase;">TOTAL ASSETS</td>
                                <td style="text-align: right; padding: 10px 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #16a34a;">
                                    <t t-esc="'{:,.2f}'.format(total_assets)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== LIABILITIES SECTION ==================== -->

                    <t t-call="ops_matrix_accounting.section_header_liability">
                        <t t-set="section_title" t-value="'LIABILITIES'"/>
                    </t>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Code</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 55%;">Account Name</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 30%;">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Hierarchical liability lines -->
                            <t t-foreach="hierarchy.get('liability_hierarchy', [])" t-as="line">
                                <t t-set="bal" t-value="abs(line.get('balance', 0))"/>
                                <tr t-att-style="
                                    (line.get('is_subtotal') and 'border-top: 1px solid #e2e8f0; background-color: #f8fafc;' or '')
                                    + (line.get('type') == 'group' and 'background-color: #fafafa;' or '')
                                ">
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;'">
                                        <t t-esc="line.get('code', '')"/>
                                    </td>
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #475569;'
                                        + (line.get('type') in ('group', 'subtotal') and ' font-weight: 600;' or '')
                                        + (line.get('is_subtotal') and ' font-size: 10px;' or '')
                                    ">
                                        <t t-esc="line.get('name', '')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;"
                                        t-att-style="(line.get('type') in ('group', 'subtotal') and 'font-weight: 600;' or '')">
                                        <t t-if="bal == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(bal)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <!-- Fallback: Flat section data -->
                            <t t-if="not hierarchy.get('liability_hierarchy')">
                                <t t-foreach="report_data.get('sections', [])" t-as="section">
                                    <t t-if="section.get('type', '').startswith('liability_')">
                                        <tr style="background-color: #fafafa;">
                                            <td colspan="2" style="padding: 6px 8px; font-weight: 600; color: #475569; font-size: 9px;">
                                                <t t-esc="section.get('label', '')"/>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(abs(section.get('total_balance', 0)))"/>
                                            </td>
                                        </tr>
                                        <t t-foreach="section.get('accounts', [])" t-as="acct">
                                            <tr style="border-bottom: 1px solid #f1f5f9;">
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;">
                                                    <t t-esc="acct.get('account_code', '')"/>
                                                </td>
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #475569;">
                                                    <t t-esc="acct.get('account_name', '')"/>
                                                </td>
                                                <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                                    <t t-esc="'{:,.2f}'.format(abs(acct.get('balance', 0)))"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                            </t>

                            <!-- Subtotal: Liabilities -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td colspan="2" style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">TOTAL LIABILITIES</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #f59e0b;">
                                    <t t-esc="'{:,.2f}'.format(total_liabilities)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== EQUITY SECTION ==================== -->

                    <t t-call="ops_matrix_accounting.section_header_equity">
                        <t t-set="section_title" t-value="'SHAREHOLDERS&#39; EQUITY'"/>
                    </t>

                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 15%;">Code</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569; width: 55%;">Account Name</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569; width: 30%;">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Hierarchical equity lines -->
                            <t t-foreach="hierarchy.get('equity_hierarchy', [])" t-as="line">
                                <t t-set="bal" t-value="abs(line.get('balance', 0))"/>
                                <tr t-att-style="
                                    (line.get('is_subtotal') and 'border-top: 1px solid #e2e8f0; background-color: #f8fafc;' or '')
                                    + (line.get('type') == 'group' and 'background-color: #fafafa;' or '')
                                ">
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;'">
                                        <t t-esc="line.get('code', '')"/>
                                    </td>
                                    <td t-att-style="'padding: 6px 8px; padding-left: ' + str(8 + line.get('indent', 0) * 12) + 'px; color: #475569;'
                                        + (line.get('type') in ('group', 'subtotal') and ' font-weight: 600;' or '')
                                        + (line.get('is_subtotal') and ' font-size: 10px;' or '')
                                    ">
                                        <t t-esc="line.get('name', '')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;"
                                        t-att-style="(line.get('type') in ('group', 'subtotal') and 'font-weight: 600;' or '')">
                                        <t t-if="bal == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.2f}'.format(bal)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <!-- Fallback: Flat section data -->
                            <t t-if="not hierarchy.get('equity_hierarchy')">
                                <t t-foreach="report_data.get('sections', [])" t-as="section">
                                    <t t-if="section.get('type', '').startswith('equity')">
                                        <tr style="background-color: #fafafa;">
                                            <td colspan="2" style="padding: 6px 8px; font-weight: 600; color: #475569; font-size: 9px;">
                                                <t t-esc="section.get('label', '')"/>
                                            </td>
                                            <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(abs(section.get('total_balance', 0)))"/>
                                            </td>
                                        </tr>
                                        <t t-foreach="section.get('accounts', [])" t-as="acct">
                                            <tr style="border-bottom: 1px solid #f1f5f9;">
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #64748b; font-family: Consolas, Monaco, monospace; font-size: 8px;">
                                                    <t t-esc="acct.get('account_code', '')"/>
                                                </td>
                                                <td style="padding: 6px 8px; padding-left: 20px; color: #475569;">
                                                    <t t-esc="acct.get('account_name', '')"/>
                                                </td>
                                                <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                                    <t t-esc="'{:,.2f}'.format(abs(acct.get('balance', 0)))"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                            </t>

                            <!-- Subtotal: Equity -->
                            <tr style="border-top: 2px solid #1e293b; background-color: #f1f5f9;">
                                <td colspan="2" style="padding: 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">TOTAL EQUITY</td>
                                <td style="text-align: right; padding: 8px; font-family: Consolas, Monaco, monospace; font-weight: 700; font-size: 10px; color: #9333ea;">
                                    <t t-esc="'{:,.2f}'.format(total_equity)"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ==================== GRAND TOTAL: LIABILITIES + EQUITY ==================== -->

                    <div style="background-color: #f1f5f9; border-left: 4px solid #1e293b; padding: 15px 20px; margin: 25px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="width: 70%; vertical-align: middle;">
                                    <div style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        TOTAL LIABILITIES + EQUITY
                                    </div>
                                    <div style="font-size: 9px; color: #64748b; margin-top: 3px;">Must equal Total Assets (A = L + E)</div>
                                </td>
                                <td style="width: 30%; text-align: right; vertical-align: middle;">
                                    <div style="font-family: Consolas, Monaco, monospace; font-size: 20px; font-weight: 700; color: #1e293b;">
                                        <t t-esc="'{:,.2f}'.format(total_liabilities + total_equity)"/>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Notes -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b;">Notes</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569;">
                            <li>Balance Sheet shows the company's financial position at a specific point in time</li>
                            <li>Fundamental accounting equation: Assets = Liabilities + Shareholders' Equity</li>
                            <li>Liabilities and equity balances displayed as absolute values</li>
                            <li>Negative asset values shown in red with parentheses</li>
                            <li>All figures exclude unposted entries unless "All Entries" filter is selected</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>
                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         LEGACY TEMPLATE (DEPRECATED - Kept for backward compatibility)
         ================================================================ -->

    <!-- Main Financial Report Action - Points to minimal template -->
    <record id="action_report_ops_financial" model="ir.actions.report">
        <field name="name">Financial Report (Legacy)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_minimal</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_minimal</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="print_report_name">'Financial_Report_%s_%s_%s' % (object.report_type, object.date_from, object.date_to)</field>
        <field name="paperformat_id" ref="ops_matrix_accounting.paperformat_ops_a4_financial"/>
    </record>

</odoo>
