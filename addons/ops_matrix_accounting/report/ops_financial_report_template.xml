<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        OPS Financial Report Template - Premium Executive Suite
        =======================================================
        v19.4.0: Dynamic Company Colors + Smart Value Styling

        DESIGN PHILOSOPHY:
        - Dynamic colors from company primary_color/secondary_color
        - Smart value coloring: Green=Good, Red=Bad, Muted=Zero
        - Executive dashboard styling (accent cards, clean tables)
        - All sections shown including zeros (muted styling)
        - Professional, pleasing finish for executive review

        REPORTS INCLUDED:
        - Profit & Loss Statement (pl)
        - Balance Sheet (bs)
        - Trial Balance (tb)
        - Cash Flow Statement (cf)
        - Aged Partner Balance (aged)
        - General Ledger (gl)
    -->

    <!-- Define the PDF Report Action -->
    <record id="action_report_ops_financial" model="ir.actions.report">
        <field name="name">Financial Report</field>
        <field name="model">ops.financial.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="print_report_name">'Financial_Report_%s_%s_%s' % (object.report_type, object.date_from, object.date_to)</field>
        <field name="paperformat_id" ref="ops_matrix_accounting.paperformat_ops_a4_financial"/>
    </record>

    <!-- QWeb PDF Template -->
    <template id="report_ops_financial_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="ops_matrix_accounting.ops_external_layout">

                    <!-- Set color variables from report_data -->
                    <t t-set="colors" t-value="report_data.get('colors', {})"/>
                    <t t-set="primary_color" t-value="colors.get('primary', '#1a2744')"/>
                    <t t-set="primary_dark" t-value="colors.get('primary_dark', '#0a1628')"/>
                    <t t-set="secondary_color" t-value="colors.get('secondary', '#3b82f6')"/>
                    <t t-set="success_color" t-value="colors.get('success', '#059669')"/>
                    <t t-set="danger_color" t-value="colors.get('danger', '#dc2626')"/>
                    <t t-set="warning_color" t-value="colors.get('warning', '#d97706')"/>
                    <t t-set="muted_color" t-value="colors.get('muted', '#94a3b8')"/>
                    <t t-set="currency" t-value="report_data.get('currency_symbol', '')"/>

                    <!-- ================================================
                         PAGE 1: EXECUTIVE COVER PAGE
                         ================================================ -->
                    <div class="page ops-cover-page" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Cover Header Band - Uses Company Primary Color -->
                        <div class="ops-cover-header-band" t-attf-style="background: #{primary_dark} !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <!-- Company Logo Initial -->
                                        <span class="ops-cover-logo-box" t-attf-style="background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); -webkit-print-color-adjust: exact !important;">
                                            <t t-esc="(report_data.get('company', 'O') or 'O')[0]"/>
                                        </span>
                                        <span class="ops-cover-company-name">
                                            <span class="ops-cover-company-text"><t t-esc="report_data.get('company', 'Company')"/></span>
                                            <span class="ops-cover-tagline">Financial Intelligence</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <!-- Period Badge -->
                                        <div class="ops-cover-fiscal-box">
                                            <div class="ops-cover-fiscal-label">Report Period</div>
                                            <div class="ops-cover-fiscal-year">
                                                <t t-if="report_data.get('date_to')">
                                                    <t t-esc="report_data['date_to']"/>
                                                </t>
                                                <t t-else="">Current</t>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Accent Bar - Gradient using company colors -->
                        <div class="ops-cover-accent-bar" t-attf-style="background: linear-gradient(90deg, #{primary_color} 0%, #{secondary_color} 50%, #{success_color} 100%); -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Cover Title Area -->
                        <div class="ops-cover-title-area" t-attf-style="background: #{primary_dark} !important; -webkit-print-color-adjust: exact !important;">
                            <div class="ops-cover-doc-type" t-attf-style="color: #{secondary_color};">Financial Statement</div>
                            <h1 class="ops-cover-main-title">
                                <t t-esc="report_data.get('title', 'Financial Report')"/>
                            </h1>
                            <p class="ops-cover-subtitle">
                                <t t-esc="report_data.get('branch', 'All Branches')"/>
                            </p>
                        </div>

                        <!-- Cover Content Area - KPI Cards -->
                        <div class="ops-cover-content">
                            <!-- P&L KPI Cards -->
                            <t t-if="doc.report_type == 'pl'">
                                <t t-set="income" t-value="report_data.get('income_total', 0)"/>
                                <t t-set="expense" t-value="report_data.get('expense_total', 0)"/>
                                <t t-set="net" t-value="report_data.get('net_profit', 0)"/>
                                <t t-set="margin" t-value="(net / income * 100) if income > 0 else 0"/>

                                <table style="width: 100%; border-collapse: separate; border-spacing: 12px 0;">
                                    <tr>
                                        <!-- Revenue Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-kpi-card success" style="border-left-color: #059669 !important;">
                                                <div class="ops-kpi-label">Total Revenue</div>
                                                <div class="ops-kpi-value ops-value-revenue"><t t-esc="'{:,.2f}'.format(income)"/></div>
                                                <div class="ops-kpi-change" style="color: #64748b;">Income Accounts</div>
                                            </div>
                                        </td>
                                        <!-- Expense Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-kpi-card danger" style="border-left-color: #dc2626 !important;">
                                                <div class="ops-kpi-label">Total Expenses</div>
                                                <div class="ops-kpi-value ops-value-expense"><t t-esc="'{:,.2f}'.format(expense)"/></div>
                                                <div class="ops-kpi-change" style="color: #64748b;">Cost Accounts</div>
                                            </div>
                                        </td>
                                        <!-- Net Profit Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div t-attf-class="ops-kpi-card #{net >= 0 and 'success' or 'danger'}" t-attf-style="border-left-color: #{net >= 0 and '#059669' or '#dc2626'} !important;">
                                                <div class="ops-kpi-label">Net Profit</div>
                                                <div t-attf-class="ops-kpi-value #{net >= 0 and 'ops-value-positive' or 'ops-value-negative'}">
                                                    <t t-esc="'{:,.2f}'.format(net)"/>
                                                </div>
                                                <div t-attf-class="ops-kpi-change #{margin >= 10 and 'positive' or (margin >= 0 and '' or 'negative')}">
                                                    <t t-esc="'{:.1f}'.format(margin)"/>% Margin
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </t>

                            <!-- Balance Sheet KPI Cards -->
                            <t t-if="doc.report_type == 'bs'">
                                <t t-set="assets" t-value="report_data.get('asset_total', 0)"/>
                                <t t-set="liabilities" t-value="report_data.get('liability_total', 0)"/>
                                <t t-set="equity" t-value="report_data.get('equity_total', 0)"/>

                                <table style="width: 100%; border-collapse: separate; border-spacing: 12px 0;">
                                    <tr>
                                        <!-- Assets Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-kpi-card neutral" style="border-left-color: #2563eb !important;">
                                                <div class="ops-kpi-label">Total Assets</div>
                                                <div class="ops-kpi-value" style="color: #2563eb !important;"><t t-esc="'{:,.2f}'.format(assets)"/></div>
                                                <div class="ops-kpi-change" style="color: #64748b;">What You Own</div>
                                            </div>
                                        </td>
                                        <!-- Liabilities Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-kpi-card danger" style="border-left-color: #dc2626 !important;">
                                                <div class="ops-kpi-label">Total Liabilities</div>
                                                <div class="ops-kpi-value ops-value-expense"><t t-esc="'{:,.2f}'.format(abs(liabilities))"/></div>
                                                <div class="ops-kpi-change" style="color: #64748b;">What You Owe</div>
                                            </div>
                                        </td>
                                        <!-- Equity Card -->
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-kpi-card success" style="border-left-color: #059669 !important;">
                                                <div class="ops-kpi-label">Shareholders' Equity</div>
                                                <div class="ops-kpi-value ops-value-positive"><t t-esc="'{:,.2f}'.format(abs(equity))"/></div>
                                                <div class="ops-kpi-change" style="color: #64748b;">Net Worth</div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </t>

                            <!-- Trial Balance / GL / Cash Flow - Simpler Cards -->
                            <t t-if="doc.report_type in ('tb', 'gl', 'cf', 'aged')">
                                <table style="width: 100%; border-collapse: separate; border-spacing: 12px 0;">
                                    <tr>
                                        <td style="width: 50%; vertical-align: top;">
                                            <div class="ops-kpi-card neutral" t-attf-style="border-left-color: #{primary_color} !important;">
                                                <div class="ops-kpi-label">Report Type</div>
                                                <div class="ops-kpi-value" style="font-size: 18px; color: #1e293b;">
                                                    <t t-esc="report_data.get('title', 'Report')"/>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="width: 50%; vertical-align: top;">
                                            <div class="ops-kpi-card neutral" t-attf-style="border-left-color: #{secondary_color} !important;">
                                                <div class="ops-kpi-label">Records</div>
                                                <div class="ops-kpi-value" style="color: #1e293b;">
                                                    <t t-esc="len(report_data.get('lines', []))"/>
                                                </div>
                                                <div class="ops-kpi-change" style="color: #64748b;">Entries</div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </t>

                            <!-- Cover Footer Meta -->
                            <div style="padding-top: 25px; border-top: 1px solid #e2e8f0; margin-top: 35px;">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="vertical-align: bottom;">
                                            <table style="border-spacing: 35px 0; border-collapse: separate;">
                                                <tr>
                                                    <td>
                                                        <div style="font-size: 9px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px;">Period</div>
                                                        <div style="font-size: 12px; font-weight: 500; color: #1e293b; margin-top: 3px;">
                                                            <t t-if="report_data.get('date_from') and report_data.get('date_to')">
                                                                <t t-esc="report_data['date_from']"/> to <t t-esc="report_data['date_to']"/>
                                                            </t>
                                                            <t t-else="">
                                                                As of <t t-esc="report_data.get('date_to', 'Current')"/>
                                                            </t>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div style="font-size: 9px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px;">Prepared By</div>
                                                        <div style="font-size: 12px; font-weight: 500; color: #1e293b; margin-top: 3px;"><t t-esc="report_data.get('user', 'System')"/></div>
                                                    </td>
                                                    <td>
                                                        <div style="font-size: 9px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px;">Target Moves</div>
                                                        <div style="font-size: 12px; font-weight: 500; color: #1e293b; margin-top: 3px;"><t t-esc="report_data.get('target_move', 'Posted')"/></div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style="text-align: right; vertical-align: bottom;">
                                            <div t-attf-style="background: #{primary_dark} !important; color: #ffffff; padding: 5px 12px; border-radius: 4px; font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; -webkit-print-color-adjust: exact !important;">Confidential</div>
                                            <div style="font-size: 9px; color: #94a3b8; margin-top: 6px;">
                                                Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ================================================
                         PAGE 2+: FINANCIAL STATEMENT DETAIL
                         ================================================ -->
                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Page Header -->
                        <table class="ops-page-header" t-attf-style="border-bottom-color: #{primary_color} !important;">
                            <tr>
                                <td class="ops-page-header-left">
                                    <span class="ops-header-logo" t-attf-style="background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); -webkit-print-color-adjust: exact !important;">
                                        <t t-esc="(report_data.get('company', 'O') or 'O')[0]"/>
                                    </span>
                                    <span class="ops-header-info">
                                        <span class="ops-header-company" t-attf-style="color: #{primary_color};"><t t-esc="report_data.get('company', 'Company')"/></span>
                                        <span class="ops-header-subtitle">Consolidated Financial Statements</span>
                                    </span>
                                </td>
                                <td class="ops-page-number-box">
                                    <span class="ops-page-number">OPS Matrix Report</span><br/>
                                    <span class="ops-page-date"><t t-esc="report_data.get('branch', 'All Branches')"/></span>
                                </td>
                            </tr>
                        </table>

                        <!-- Statement Title Section -->
                        <div class="ops-statement-title-section">
                            <h2 class="ops-statement-title" t-attf-style="color: #{primary_color};"><t t-esc="report_data.get('title', 'Financial Report')"/></h2>
                            <div class="ops-statement-subtitle">OPS Matrix Financial Intelligence</div>
                            <span class="ops-statement-period">
                                <t t-if="report_data.get('date_from') and report_data.get('date_to')">
                                    For the Period <t t-esc="report_data['date_from']"/> to <t t-esc="report_data['date_to']"/>
                                </t>
                                <t t-else="">
                                    As of <t t-esc="report_data.get('date_to', 'Current Date')"/>
                                </t>
                            </span>
                        </div>

                        <!-- ====== PROFIT &amp; LOSS STATEMENT ====== -->
                        <t t-if="doc.report_type == 'pl'">
                            <t t-set="income" t-value="report_data.get('income_total', 0)"/>
                            <t t-set="expense" t-value="report_data.get('expense_total', 0)"/>
                            <t t-set="net" t-value="report_data.get('net_profit', 0)"/>
                            <t t-set="margin" t-value="(net / income * 100) if income > 0 else 0"/>

                            <!-- Performance Alert -->
                            <t t-if="net &lt; 0">
                                <div class="ops-alert danger">
                                    <strong>Critical Warning:</strong> Negative net profit of <strong><t t-esc="'{:,.2f}'.format(net)"/></strong> detected.
                                    Immediate review required - expenses exceed revenue.
                                </div>
                            </t>
                            <t t-elif="margin &lt; 5 and margin >= 0">
                                <div class="ops-alert warning">
                                    <strong>Caution:</strong> Profit margin below 5% threshold.
                                    Current margin: <strong><t t-esc="'{:.1f}'.format(margin)"/>%</strong>
                                </div>
                            </t>
                            <t t-elif="margin >= 20">
                                <div class="ops-alert success">
                                    <strong>Excellent Performance:</strong> Strong profit margin of <strong><t t-esc="'{:.1f}'.format(margin)"/>%</strong>
                                </div>
                            </t>

                            <!-- REVENUE SECTION -->
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #059669 !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Revenue</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(income)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('income_lines', [])" t-as="line">
                                            <t t-set="amt" t-value="line.get('amount', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{amt == 0 and 'ops-value-zero' or 'ops-value-revenue'}">
                                                    <t t-esc="'{:,.2f}'.format(amt)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <!-- Show message if no lines -->
                                        <t t-if="not report_data.get('income_lines')">
                                            <tr>
                                                <td colspan="2" class="ops-value-zero" style="text-align: center; font-style: italic;">No revenue entries for this period</td>
                                            </tr>
                                        </t>
                                        <!-- Subtotal -->
                                        <tr class="subtotal">
                                            <td style="font-weight: 600;">Total Revenue</td>
                                            <td class="text-end ops-value-revenue" style="font-weight: 700; border-top: 1px solid #059669 !important; border-bottom: 3px double #059669 !important; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="'{:,.2f}'.format(income)"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- EXPENSES SECTION -->
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #dc2626 !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Expenses</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(expense)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('expense_lines', [])" t-as="line">
                                            <t t-set="amt" t-value="line.get('amount', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{amt == 0 and 'ops-value-zero' or 'ops-value-expense'}">
                                                    <t t-esc="'{:,.2f}'.format(amt)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <!-- Show message if no lines -->
                                        <t t-if="not report_data.get('expense_lines')">
                                            <tr>
                                                <td colspan="2" class="ops-value-zero" style="text-align: center; font-style: italic;">No expense entries for this period</td>
                                            </tr>
                                        </t>
                                        <!-- Subtotal -->
                                        <tr class="subtotal">
                                            <td style="font-weight: 600;">Total Expenses</td>
                                            <td class="text-end ops-value-expense" style="font-weight: 700; border-top: 1px solid #dc2626 !important; border-bottom: 3px double #dc2626 !important; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="'{:,.2f}'.format(expense)"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- NET PROFIT SUMMARY -->
                            <div t-attf-class="ops-summary-box #{net >= 0 and 'success' or 'loss'}">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 35%; vertical-align: middle;">
                                            <div class="ops-summary-label">Net Profit / (Loss)</div>
                                            <div class="ops-summary-equation">Revenue - Expenses</div>
                                        </td>
                                        <td style="width: 40%; text-align: center; vertical-align: middle;">
                                            <div class="ops-summary-value">
                                                <t t-esc="'{:,.2f}'.format(net)"/>
                                            </div>
                                        </td>
                                        <td style="width: 25%; text-align: right; vertical-align: middle;">
                                            <div class="ops-summary-badge">
                                                <div t-attf-class="ops-summary-badge-icon #{margin >= 10 and 'success' or (margin >= 0 and 'warning' or 'danger')}">
                                                    <t t-if="margin >= 10">+</t>
                                                    <t t-elif="margin >= 0">~</t>
                                                    <t t-else="">-</t>
                                                </div>
                                                <div class="ops-summary-badge-text">
                                                    <t t-esc="'{:.1f}'.format(margin)"/>% Margin
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Margin Indicator Card -->
                            <div style="margin-top: 18px;">
                                <div class="ops-margin-card" t-attf-style="border-left-color: #{margin >= 10 and '#059669' or (margin >= 0 and '#2563eb' or '#dc2626')} !important; -webkit-print-color-adjust: exact !important;">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td style="width: 35%; vertical-align: middle;">
                                                <div class="ops-margin-label">Net Profit Margin</div>
                                                <div class="ops-margin-formula">Net Income / Revenue Ã— 100</div>
                                            </td>
                                            <td style="width: 35%; text-align: center; vertical-align: middle;">
                                                <span t-attf-class="ops-margin-value #{margin >= 10 and 'ops-value-positive' or (margin >= 0 and '' or 'ops-value-negative')}">
                                                    <t t-esc="'{:.1f}'.format(margin)"/>%
                                                </span>
                                            </td>
                                            <td style="width: 30%; text-align: right; vertical-align: middle;">
                                                <span t-attf-class="ops-status-pill #{margin >= 20 and 'excellent' or (margin >= 10 and 'healthy' or (margin >= 5 and 'acceptable' or (margin >= 0 and 'warning' or 'loss')))}">
                                                    <t t-if="margin >= 20">Excellent</t>
                                                    <t t-elif="margin >= 10">Healthy</t>
                                                    <t t-elif="margin >= 5">Acceptable</t>
                                                    <t t-elif="margin >= 0">Low</t>
                                                    <t t-else="">Loss</t>
                                                </span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </t>

                        <!-- ====== BALANCE SHEET ====== -->
                        <t t-if="doc.report_type == 'bs'">
                            <t t-set="assets" t-value="report_data.get('asset_total', 0)"/>
                            <t t-set="liabilities" t-value="report_data.get('liability_total', 0)"/>
                            <t t-set="equity" t-value="report_data.get('equity_total', 0)"/>
                            <t t-set="balance_check" t-value="assets - (abs(liabilities) + abs(equity))"/>

                            <!-- ASSETS SECTION -->
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #2563eb !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Assets</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(assets)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('asset_lines', [])" t-as="line">
                                            <t t-set="amt" t-value="line.get('amount', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{amt == 0 and 'ops-value-zero' or ''}">
                                                    <t t-esc="'{:,.2f}'.format(amt)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('asset_lines')">
                                            <tr>
                                                <td colspan="2" class="ops-value-zero" style="text-align: center; font-style: italic;">No asset entries</td>
                                            </tr>
                                        </t>
                                        <tr class="subtotal">
                                            <td style="font-weight: 600;">TOTAL ASSETS</td>
                                            <td class="text-end" style="font-weight: 700; color: #2563eb !important; border-top: 1px solid #2563eb !important; border-bottom: 3px double #2563eb !important; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="'{:,.2f}'.format(assets)"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- LIABILITIES SECTION -->
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #d97706 !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Liabilities</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(abs(liabilities))"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('liability_lines', [])" t-as="line">
                                            <t t-set="amt" t-value="abs(line.get('amount', 0))"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{amt == 0 and 'ops-value-zero' or 'ops-value-expense'}">
                                                    <t t-esc="'{:,.2f}'.format(amt)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('liability_lines')">
                                            <tr>
                                                <td colspan="2" class="ops-value-zero" style="text-align: center; font-style: italic;">No liability entries</td>
                                            </tr>
                                        </t>
                                        <tr class="subtotal">
                                            <td style="font-weight: 600;">TOTAL LIABILITIES</td>
                                            <td class="text-end ops-value-expense" style="font-weight: 700; border-top: 1px solid #d97706 !important; border-bottom: 3px double #d97706 !important; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="'{:,.2f}'.format(abs(liabilities))"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- EQUITY SECTION -->
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #059669 !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Shareholders' Equity</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(abs(equity))"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('equity_lines', [])" t-as="line">
                                            <t t-set="amt" t-value="abs(line.get('amount', 0))"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{amt == 0 and 'ops-value-zero' or 'ops-value-positive'}">
                                                    <t t-esc="'{:,.2f}'.format(amt)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('equity_lines')">
                                            <tr>
                                                <td colspan="2" class="ops-value-zero" style="text-align: center; font-style: italic;">No equity entries</td>
                                            </tr>
                                        </t>
                                        <tr class="subtotal">
                                            <td style="font-weight: 600;">TOTAL EQUITY</td>
                                            <td class="text-end ops-value-positive" style="font-weight: 700; border-top: 1px solid #059669 !important; border-bottom: 3px double #059669 !important; -webkit-print-color-adjust: exact !important;">
                                                <t t-esc="'{:,.2f}'.format(abs(equity))"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- BALANCE CHECK SUMMARY -->
                            <div class="ops-summary-box neutral">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 35%; vertical-align: middle;">
                                            <div class="ops-summary-label">Accounting Equation</div>
                                            <div class="ops-summary-equation">Assets = Liabilities + Equity</div>
                                        </td>
                                        <td style="width: 40%; text-align: center; vertical-align: middle;">
                                            <div class="ops-summary-value">
                                                <t t-esc="'{:,.2f}'.format(abs(liabilities) + abs(equity))"/>
                                            </div>
                                        </td>
                                        <td style="width: 25%; text-align: right; vertical-align: middle;">
                                            <div class="ops-summary-badge">
                                                <div t-attf-class="ops-summary-badge-icon #{abs(balance_check) &lt; 0.01 and 'success' or 'danger'}">
                                                    <t t-if="abs(balance_check) &lt; 0.01">&#10003;</t>
                                                    <t t-else="">!</t>
                                                </div>
                                                <div class="ops-summary-badge-text">
                                                    <t t-if="abs(balance_check) &lt; 0.01">Balanced</t>
                                                    <t t-else="">Unbalanced</t>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>

                        <!-- ====== TRIAL BALANCE ====== -->
                        <t t-if="doc.report_type == 'tb'">
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" t-attf-style="background: #{primary_color} !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Trial Balance</td>
                                            <td class="ops-section-amount"><t t-esc="len(report_data.get('lines', []))"/> Accounts</td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Credit</th>
                                            <th class="text-end">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('lines', [])" t-as="line">
                                            <t t-set="debit" t-value="line.get('debit', 0)"/>
                                            <t t-set="credit" t-value="line.get('credit', 0)"/>
                                            <t t-set="balance" t-value="line.get('balance', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{debit == 0 and 'ops-value-zero' or 'ops-value-positive'}">
                                                    <t t-esc="'{:,.2f}'.format(debit)"/>
                                                </td>
                                                <td t-attf-class="text-end #{credit == 0 and 'ops-value-zero' or 'ops-value-negative'}">
                                                    <t t-esc="'{:,.2f}'.format(credit)"/>
                                                </td>
                                                <td class="text-end" style="font-weight: 600;">
                                                    <t t-esc="'{:,.2f}'.format(balance)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('lines')">
                                            <tr>
                                                <td colspan="4" class="ops-value-zero" style="text-align: center; font-style: italic;">No entries for this period</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Grand Total -->
                            <div class="ops-summary-box neutral">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 40%; vertical-align: middle;">
                                            <div class="ops-summary-label">Total</div>
                                        </td>
                                        <td style="width: 20%; text-align: center; vertical-align: middle;">
                                            <div style="font-size: 10pt; color: rgba(255,255,255,0.7);">Debit</div>
                                            <div style="font-size: 16pt; font-weight: 700; color: #ffffff; font-family: 'DejaVu Sans Mono', monospace;">
                                                <t t-esc="'{:,.2f}'.format(report_data.get('total_debit', 0))"/>
                                            </div>
                                        </td>
                                        <td style="width: 20%; text-align: center; vertical-align: middle;">
                                            <div style="font-size: 10pt; color: rgba(255,255,255,0.7);">Credit</div>
                                            <div style="font-size: 16pt; font-weight: 700; color: #ffffff; font-family: 'DejaVu Sans Mono', monospace;">
                                                <t t-esc="'{:,.2f}'.format(report_data.get('total_credit', 0))"/>
                                            </div>
                                        </td>
                                        <td style="width: 20%; text-align: right; vertical-align: middle;">
                                            <t t-set="tb_diff" t-value="report_data.get('total_debit', 0) - report_data.get('total_credit', 0)"/>
                                            <div class="ops-summary-badge">
                                                <div t-attf-class="ops-summary-badge-icon #{abs(tb_diff) &lt; 0.01 and 'success' or 'danger'}">
                                                    <t t-if="abs(tb_diff) &lt; 0.01">&#10003;</t>
                                                    <t t-else="">!</t>
                                                </div>
                                                <div class="ops-summary-badge-text">
                                                    <t t-if="abs(tb_diff) &lt; 0.01">Balanced</t>
                                                    <t t-else="">Off by <t t-esc="'{:,.2f}'.format(abs(tb_diff))"/></t>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>

                        <!-- ====== CASH FLOW STATEMENT ====== -->
                        <t t-if="doc.report_type == 'cf'">
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #2563eb !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Cash Flow Statement</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(report_data.get('net_cash_flow', 0))"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Inflow</th>
                                            <th class="text-end">Outflow</th>
                                            <th class="text-end">Net</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('lines', [])" t-as="line">
                                            <t t-set="inflow" t-value="line.get('inflow', 0)"/>
                                            <t t-set="outflow" t-value="line.get('outflow', 0)"/>
                                            <t t-set="net_flow" t-value="line.get('net', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('account', '')"/></td>
                                                <td t-attf-class="text-end #{inflow == 0 and 'ops-value-zero' or 'ops-value-positive'}">
                                                    <t t-esc="'{:,.2f}'.format(inflow)"/>
                                                </td>
                                                <td t-attf-class="text-end #{outflow == 0 and 'ops-value-zero' or 'ops-value-negative'}">
                                                    <t t-esc="'{:,.2f}'.format(outflow)"/>
                                                </td>
                                                <td class="text-end" style="font-weight: 600;">
                                                    <t t-esc="'{:,.2f}'.format(net_flow)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('lines')">
                                            <tr>
                                                <td colspan="4" class="ops-value-zero" style="text-align: center; font-style: italic;">No cash flow entries for this period</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Net Cash Flow Summary -->
                            <t t-set="net_cf" t-value="report_data.get('net_cash_flow', 0)"/>
                            <div t-attf-class="ops-summary-box #{net_cf >= 0 and 'success' or 'loss'}">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 35%; vertical-align: middle;">
                                            <div class="ops-summary-label">Net Cash Flow</div>
                                            <div class="ops-summary-equation">Inflows - Outflows</div>
                                        </td>
                                        <td style="width: 40%; text-align: center; vertical-align: middle;">
                                            <div class="ops-summary-value">
                                                <t t-esc="'{:,.2f}'.format(net_cf)"/>
                                            </div>
                                        </td>
                                        <td style="width: 25%; text-align: right; vertical-align: middle;">
                                            <div class="ops-summary-badge">
                                                <div t-attf-class="ops-summary-badge-icon #{net_cf >= 0 and 'success' or 'danger'}">
                                                    <t t-if="net_cf >= 0">+</t>
                                                    <t t-else="">-</t>
                                                </div>
                                                <div class="ops-summary-badge-text">
                                                    <t t-if="net_cf >= 0">Positive</t>
                                                    <t t-else="">Negative</t>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>

                        <!-- ====== GENERAL LEDGER ====== -->
                        <t t-if="doc.report_type == 'gl'">
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" t-attf-style="background: #{primary_color} !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">General Ledger</td>
                                            <td class="ops-section-amount"><t t-esc="len(report_data.get('lines', []))"/> Entries</td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Entry</th>
                                            <th>Account</th>
                                            <th>Partner</th>
                                            <th>Label</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Credit</th>
                                            <th class="text-end">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('lines', [])" t-as="line">
                                            <t t-set="debit" t-value="line.get('debit', 0)"/>
                                            <t t-set="credit" t-value="line.get('credit', 0)"/>
                                            <tr>
                                                <td style="font-size: 9pt;"><t t-esc="line.get('date', '')"/></td>
                                                <td style="font-size: 9pt;"><t t-esc="line.get('move_name', '')"/></td>
                                                <td style="font-size: 9pt;"><t t-esc="line.get('account', '')"/></td>
                                                <td style="font-size: 9pt;"><t t-esc="line.get('partner', '')"/></td>
                                                <td style="font-size: 9pt;"><t t-esc="line.get('label', '')"/></td>
                                                <td t-attf-class="text-end #{debit == 0 and 'ops-value-zero' or 'ops-value-positive'}">
                                                    <t t-esc="'{:,.2f}'.format(debit)"/>
                                                </td>
                                                <td t-attf-class="text-end #{credit == 0 and 'ops-value-zero' or 'ops-value-negative'}">
                                                    <t t-esc="'{:,.2f}'.format(credit)"/>
                                                </td>
                                                <td class="text-end" style="font-weight: 600;">
                                                    <t t-esc="'{:,.2f}'.format(line.get('balance', 0))"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('lines')">
                                            <tr>
                                                <td colspan="8" class="ops-value-zero" style="text-align: center; font-style: italic;">No ledger entries for this period</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>

                        <!-- ====== AGED PARTNER BALANCE ====== -->
                        <t t-if="doc.report_type == 'aged'">
                            <div class="ops-section-block">
                                <div class="ops-section-header-bar" style="background: #d97706 !important; -webkit-print-color-adjust: exact !important;">
                                    <table>
                                        <tr>
                                            <td class="ops-section-title-text">Aged Partner Balance</td>
                                            <td class="ops-section-amount"><t t-esc="len(report_data.get('lines', []))"/> Partners</td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-section-table">
                                    <thead>
                                        <tr>
                                            <th>Partner</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Credit</th>
                                            <th class="text-end">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="report_data.get('lines', [])" t-as="line">
                                            <t t-set="debit" t-value="line.get('debit', 0)"/>
                                            <t t-set="credit" t-value="line.get('credit', 0)"/>
                                            <t t-set="balance" t-value="line.get('balance', 0)"/>
                                            <tr>
                                                <td><t t-esc="line.get('partner', '')"/></td>
                                                <td t-attf-class="text-end #{debit == 0 and 'ops-value-zero' or 'ops-value-positive'}">
                                                    <t t-esc="'{:,.2f}'.format(debit)"/>
                                                </td>
                                                <td t-attf-class="text-end #{credit == 0 and 'ops-value-zero' or 'ops-value-negative'}">
                                                    <t t-esc="'{:,.2f}'.format(credit)"/>
                                                </td>
                                                <td t-attf-class="text-end #{balance == 0 and 'ops-value-zero' or (balance > 0 and 'ops-value-positive' or 'ops-value-negative')}" style="font-weight: 600;">
                                                    <t t-esc="'{:,.2f}'.format(balance)"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not report_data.get('lines')">
                                            <tr>
                                                <td colspan="4" class="ops-value-zero" style="text-align: center; font-style: italic;">No partner entries for this period</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>

                        <!-- Notes Section -->
                        <div class="ops-notes-section" t-attf-style="border-left-color: #{secondary_color} !important;">
                            <div class="ops-notes-title">Notes to Financial Statements</div>
                            <ul class="ops-notes-list">
                                <li>This report was generated by the OPS Matrix Financial Reporting System</li>
                                <li>All figures are in the company's base currency<t t-if="currency"> (<t t-esc="currency"/>)</t></li>
                                <li>For audit trail purposes, all journal entries are traceable via move IDs</li>
                                <li>Target Moves: <t t-esc="report_data.get('target_move', 'Posted')"/></li>
                            </ul>
                        </div>

                        <!-- Page Footer -->
                        <div class="ops-page-footer">
                            <table style="width: 100%;">
                                <tr>
                                    <td class="ops-footer-text">
                                        Prepared by: <t t-esc="report_data.get('user', 'System')"/> |
                                        Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                    </td>
                                    <td style="text-align: right;">
                                        <span class="ops-footer-confidential">Confidential</span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
