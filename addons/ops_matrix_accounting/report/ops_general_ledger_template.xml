<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        General Ledger Report - QWeb Template
        ======================================
        Uses OPS Matrix corporate branding.

        v19.0.2.5: Phase 5 - Applied ops_report_layout styles
    -->

    <template id="report_general_ledger">
        <t t-call="web.html_container">
            <t t-call="ops_matrix_accounting.ops_external_layout">
                <div class="page ops-report-container">
                    <!-- Professional Header -->
                    <div class="ops-report-header text-center">
                        <h2>General Ledger Report</h2>
                        <p class="ops-subtitle">Detailed Transaction History by Account</p>
                    </div>

                    <!-- Report Info Box -->
                    <div class="ops-info-box">
                        <div class="row">
                            <div class="col-6">
                                <span class="ops-info-label">Period:</span>
                                <span t-esc="date_from"/> to <span t-esc="date_to"/><br/>
                                <span class="ops-info-label">Company:</span>
                                <span t-esc="company.name"/>
                            </div>
                            <div class="col-6 text-end">
                                <span class="ops-info-label">Generated:</span>
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/><br/>
                                <span class="ops-info-label">Total Accounts:</span>
                                <span t-esc="len(accounts)"/>
                            </div>
                        </div>
                    </div>

                    <!-- Account Legend -->
                    <div class="ops-legend mb16">
                        <strong>Account Type Colors:</strong>
                        <span class="ops-legend-item" style="background-color: #4CAF50;">Asset</span>
                        <span class="ops-legend-item" style="background-color: #f44336;">Liability</span>
                        <span class="ops-legend-item" style="background-color: #2196F3;">Revenue</span>
                        <span class="ops-legend-item" style="background-color: #FF9800;">Expense</span>
                    </div>

                    <!-- Account Details with Corporate Styling -->
                    <t t-foreach="accounts" t-as="account">
                        <div class="mt-4" style="page-break-inside: avoid;">
                            <!-- Account Header with Type-Based Color -->
                            <t t-set="account_type" t-value="account.get('account_type', 'other')"/>
                            <t t-set="header_class" t-value="'ops-section-header-asset' if 'asset' in account_type.lower() else 'ops-section-header-liability' if 'liability' in account_type.lower() else 'ops-section-header-revenue' if 'income' in account_type.lower() or 'revenue' in account_type.lower() else 'ops-section-header-expense' if 'expense' in account_type.lower() else 'ops-section-header'"/>

                            <h4 t-attf-class="ops-section-header #{header_class}">
                                <strong>
                                    <span t-esc="account['account_code']"/> - <span t-esc="account['account_name']"/>
                                </strong>
                                <span style="float: right; font-size: 11px; opacity: 0.9;">
                                    <t t-if="account.get('account_type')">
                                        <span t-esc="account['account_type'].replace('_', ' ').title()"/>
                                    </t>
                                </span>
                            </h4>

                            <!-- Transaction Table with OPS Matrix Styling -->
                            <table class="ops_table_matrix">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Journal</th>
                                        <th>Partner</th>
                                        <th>Ref</th>
                                        <th>Label</th>
                                        <th class="text-end">Debit</th>
                                        <th class="text-end">Credit</th>
                                        <th class="text-end">Balance</th>
                                        <th class="text-center">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="account['lines']" t-as="line">
                                        <tr>
                                            <td><span t-esc="line['move_date']"/></td>
                                            <td><span t-esc="line['journal']"/></td>
                                            <td><span t-esc="line['partner'] or '-'"/></td>
                                            <td><span t-esc="line['reference'] or '-'"/></td>
                                            <td><span t-esc="line['label']"/></td>
                                            <td class="text-end">
                                                <t t-if="line['debit'] > 0">
                                                    <span class="ops-number ops-debit">
                                                        <span t-esc="'%.2f' % line['debit']"/>
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-number ops-number-zero">
                                                        <span t-esc="'%.2f' % line['debit']"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-end">
                                                <t t-if="line['credit'] > 0">
                                                    <span class="ops-number ops-credit">
                                                        <span t-esc="'%.2f' % line['credit']"/>
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-number ops-number-zero">
                                                        <span t-esc="'%.2f' % line['credit']"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-end">
                                                <t t-set="balance_class" t-value="'ops-number-positive' if line['balance'] > 0 else 'ops-number-negative' if line['balance'] &lt; 0 else 'ops-number-zero'"/>
                                                <strong t-attf-class="ops-number #{balance_class}">
                                                    <span t-esc="'%.2f' % line['balance']"/>
                                                </strong>
                                            </td>
                                            <td class="text-center">
                                                <!-- Reconciliation Status Badge -->
                                                <t t-if="line.get('reconciled', False)">
                                                    <span class="ops-badge ops-badge-success">Reconciled</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-badge ops-badge-muted">Pending</span>
                                                </t>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="ops-total-row">
                                        <td colspan="5" class="text-end"><strong>Account Total:</strong></td>
                                        <td class="text-end ops-number ops-debit">
                                            <span t-esc="'%.2f' % account['total_debit']"/>
                                        </td>
                                        <td class="text-end ops-number ops-credit">
                                            <span t-esc="'%.2f' % account['total_credit']"/>
                                        </td>
                                        <td class="text-end">
                                            <t t-set="total_balance_class" t-value="'ops-number-positive' if account['total_balance'] > 0 else 'ops-number-negative' if account['total_balance'] &lt; 0 else 'ops-number-zero'"/>
                                            <strong t-attf-class="ops-number #{total_balance_class}">
                                                <span t-esc="'%.2f' % account['total_balance']"/>
                                            </strong>
                                        </td>
                                        <td class="text-center">
                                            <small><span t-esc="len(account['lines'])"/> entries</small>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </t>

                    <!-- Grand Total Summary -->
                    <div class="mt-4" style="page-break-inside: avoid;">
                        <table class="ops_table_matrix">
                            <tfoot>
                                <tr class="ops-grand-total">
                                    <td colspan="5" class="text-end" style="padding: 15px;"><strong>GRAND TOTAL:</strong></td>
                                    <td class="text-end" style="padding: 15px;">
                                        <span t-esc="'%.2f' % grand_total['debit']"/>
                                    </td>
                                    <td class="text-end" style="padding: 15px;">
                                        <span t-esc="'%.2f' % grand_total['credit']"/>
                                    </td>
                                    <td class="text-end" style="padding: 15px;">
                                        <span t-esc="'%.2f' % grand_total['balance']"/>
                                    </td>
                                    <td style="padding: 15px;"></td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Balance Verification -->
                        <t t-set="balance_check" t-value="abs(grand_total['debit'] - grand_total['credit'])"/>
                        <t t-if="balance_check &lt; 0.01">
                            <div class="ops-alert ops-alert-success">
                                <strong>Books Balanced:</strong> Debits equal credits. Ledger is in balance.
                            </div>
                        </t>
                        <t t-else="">
                            <div class="ops-alert ops-alert-warning">
                                <strong>Balance Difference:</strong>
                                <span t-esc="'%.2f' % balance_check"/> - Review required.
                            </div>
                        </t>
                    </div>

                    <!-- Report Footer -->
                    <div class="ops-report-footer">
                        <p class="ops-footer-note">
                            <strong>Audit Trail:</strong> All transactions shown above are sourced from posted journal entries.
                            Reconciliation status indicates whether line items have been matched with bank statements or other documents.
                            For detailed transaction drill-down, reference the move IDs in the accounting system.
                        </p>
                    </div>
                </div>
            </t>
        </t>
    </template>

    <record id="action_report_general_ledger" model="ir.actions.report">
        <field name="name">General Ledger</field>
        <field name="model">ops.general.ledger.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_general_ledger</field>
        <field name="report_file">ops_matrix_accounting.report_general_ledger</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Enhanced General Ledger Report with Matrix Dimensions -->
    <record id="report_general_ledger_matrix" model="ir.actions.report">
        <field name="name">General Ledger (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_general_ledger</field>
        <field name="report_file">ops_matrix_accounting.report_general_ledger</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Trial Balance Report (Matrix Enhanced) -->
    <record id="report_trial_balance_matrix" model="ir.actions.report">
        <field name="name">Trial Balance (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Profit & Loss Report (Matrix Enhanced) -->
    <record id="report_profit_loss_matrix" model="ir.actions.report">
        <field name="name">Profit &amp; Loss (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Balance Sheet Report (Matrix Enhanced) -->
    <record id="report_balance_sheet_matrix" model="ir.actions.report">
        <field name="name">Balance Sheet (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Cash Flow Report (Matrix Enhanced) -->
    <record id="report_cash_flow_matrix" model="ir.actions.report">
        <field name="name">Cash Flow (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Aged Partner Balance Report (Matrix Enhanced) -->
    <record id="report_aged_partner_matrix" model="ir.actions.report">
        <field name="name">Aged Partner Balance (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Partner Ledger Report (Matrix Enhanced) -->
    <record id="report_partner_ledger_matrix" model="ir.actions.report">
        <field name="name">Partner Ledger (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Statement of Account Report (Matrix Enhanced) -->
    <record id="report_statement_of_account_matrix" model="ir.actions.report">
        <field name="name">Statement of Account (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
