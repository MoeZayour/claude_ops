<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        General Ledger Report Template
        ===============================
        PHASE 23: EXECUTIVE CONSULTING SUITE (PRINT-FIRST)

        DESIGN PHILOSOPHY:
        - Management Consulting / Legal Document aesthetic
        - High contrast: Deep Black (#000000) + Executive Red (#DA291C)
        - Two-column header architecture
        - "Consulting Table" with proper styling
        - Print-first A4 optimization

        VALUE DISPLAY:
        - Zeros: Show as "0.00" in Light Grey (#cccccc)
        - Negatives: Red (#DA291C) with parentheses
        - Positives: Black
    -->

    <template id="report_general_ledger">
        <t t-call="web.html_container">
            <t t-call="ops_matrix_accounting.ops_report_styles"/>

            <!-- Get company info -->
            <t t-set="company" t-value="env.company"/>
            <t t-set="company_name" t-value="company.name"/>

            <div class="page ops-consulting-page">

                <!-- Two-Column Header -->
                <div class="ops-header-split">
                    <table class="ops-header-split-table">
                        <tr>
                            <td class="ops-header-left">
                                <div class="ops-company-name"><t t-esc="company_name"/></div>
                                <div class="ops-department-name">Finance Department</div>
                            </td>
                            <td class="ops-header-right">
                                <div class="ops-report-title">General Ledger</div>
                                <div class="ops-report-subtitle">
                                    <t t-esc="date_from"/> to <t t-esc="date_to"/>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <hr class="ops-header-separator"/>

                <!-- Meta Info Bar -->
                <div class="ops-meta-bar">
                    <table>
                        <tr>
                            <td style="width: 20%;">
                                <span class="ops-meta-label">Company</span><br/>
                                <span class="ops-meta-value"><t t-esc="company_name"/></span>
                            </td>
                            <td style="width: 20%;">
                                <span class="ops-meta-label">Total Accounts</span><br/>
                                <span class="ops-meta-value"><t t-esc="len(accounts)"/></span>
                            </td>
                            <td style="width: 20%;">
                                <span class="ops-meta-label">Total Debit</span><br/>
                                <span class="ops-meta-value ops-value-positive"><t t-esc="'{:,.2f}'.format(grand_total.get('debit', 0))"/></span>
                            </td>
                            <td style="width: 20%;">
                                <span class="ops-meta-label">Total Credit</span><br/>
                                <span class="ops-meta-value ops-value-negative">(<t t-esc="'{:,.2f}'.format(grand_total.get('credit', 0))"/>)</span>
                            </td>
                            <td style="width: 20%; text-align: right;">
                                <span class="ops-meta-label">Generated</span><br/>
                                <span class="ops-meta-value"><t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d')"/></span>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Balance Status Alert -->
                <t t-set="balance_diff" t-value="abs(grand_total.get('debit', 0) - grand_total.get('credit', 0))"/>
                <t t-if="balance_diff &lt; 0.01">
                    <div class="ops-alert success">
                        <strong>Books Balanced:</strong> Total debits equal total credits. General Ledger is in balance.
                    </div>
                </t>
                <t t-else="">
                    <div class="ops-alert danger">
                        <strong>Balance Difference Detected:</strong> Difference of <strong><t t-esc="'{:,.2f}'.format(balance_diff)"/></strong> - Manual review required.
                    </div>
                </t>

                <!-- Account Type Legend -->
                <div style="margin-bottom: 20px; padding: 12px 16px; background: #f8f9fa; border: 1px solid #e5e7eb; -webkit-print-color-adjust: exact !important;">
                    <span style="font-size: 9pt; font-weight: 600; color: #374151; margin-right: 15px;">Account Types:</span>
                    <span style="display: inline-block; padding: 3px 10px; border-radius: 3px; font-size: 8pt; font-weight: 600; color: #ffffff; background: #2563eb; margin-right: 8px; -webkit-print-color-adjust: exact !important;">Asset</span>
                    <span style="display: inline-block; padding: 3px 10px; border-radius: 3px; font-size: 8pt; font-weight: 600; color: #ffffff; background: #d97706; margin-right: 8px; -webkit-print-color-adjust: exact !important;">Liability</span>
                    <span style="display: inline-block; padding: 3px 10px; border-radius: 3px; font-size: 8pt; font-weight: 600; color: #ffffff; background: #059669; margin-right: 8px; -webkit-print-color-adjust: exact !important;">Revenue</span>
                    <span style="display: inline-block; padding: 3px 10px; border-radius: 3px; font-size: 8pt; font-weight: 600; color: #ffffff; background: #DA291C; -webkit-print-color-adjust: exact !important;">Expense</span>
                </div>

                <!-- ================================================
                     ACCOUNT DETAILS SECTION
                     ================================================ -->
                <t t-foreach="accounts" t-as="account">
                    <div class="ops-section-block no-break" style="margin-bottom: 30px;">

                        <!-- Account Header with Type-Based Color -->
                        <t t-set="account_type" t-value="account.get('account_type', 'other')"/>
                        <t t-set="type_color" t-value="'#2563eb' if 'asset' in account_type.lower() else '#d97706' if 'liability' in account_type.lower() else '#059669' if 'income' in account_type.lower() or 'revenue' in account_type.lower() else '#DA291C' if 'expense' in account_type.lower() else '#000000'"/>

                        <div t-attf-style="background: #{type_color} !important; color: #ffffff; padding: 10px 14px; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="font-size: 12pt; font-weight: 700;">
                                        <t t-esc="account['account_code']"/> - <t t-esc="account['account_name']"/>
                                    </td>
                                    <td style="text-align: right; font-size: 9pt; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9;">
                                        <t t-if="account.get('account_type')">
                                            <t t-esc="account['account_type'].replace('_', ' ').title()"/>
                                        </t>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Transaction Table -->
                        <table class="ops-table-consulting" style="font-size: 9pt;">
                            <thead>
                                <tr>
                                    <th style="width: 70px;">Date</th>
                                    <th style="width: 70px;">Journal</th>
                                    <th>Partner</th>
                                    <th style="width: 80px;">Ref</th>
                                    <th>Label</th>
                                    <th class="text-end" style="width: 85px;">Debit</th>
                                    <th class="text-end" style="width: 85px;">Credit</th>
                                    <th class="text-end" style="width: 95px;">Balance</th>
                                    <th class="text-end" style="width: 65px;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="account['lines']" t-as="line">
                                    <tr>
                                        <td><t t-esc="line['move_date']"/></td>
                                        <td><t t-esc="line['journal']"/></td>
                                        <td><t t-esc="line['partner'] or '-'"/></td>
                                        <td style="font-size: 8pt; color: #6b7280;"><t t-esc="line['reference'] or '-'"/></td>
                                        <td><t t-esc="line['label']"/></td>
                                        <!-- Debit -->
                                        <td class="num">
                                            <t t-if="line['debit'] == 0">
                                                <span class="ops-value-zero">0.00</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-value-positive"><t t-esc="'{:,.2f}'.format(line['debit'])"/></span>
                                            </t>
                                        </td>
                                        <!-- Credit -->
                                        <td class="num">
                                            <t t-if="line['credit'] == 0">
                                                <span class="ops-value-zero">0.00</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-value-negative">(<t t-esc="'{:,.2f}'.format(line['credit'])"/>)</span>
                                            </t>
                                        </td>
                                        <!-- Balance -->
                                        <td class="num" style="font-weight: 600;">
                                            <t t-if="line['balance'] == 0">
                                                <span class="ops-value-zero">0.00</span>
                                            </t>
                                            <t t-elif="line['balance'] &lt; 0">
                                                <span class="ops-value-negative">(<t t-esc="'{:,.2f}'.format(abs(line['balance']))"/>)</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-value-positive"><t t-esc="'{:,.2f}'.format(line['balance'])"/></span>
                                            </t>
                                        </td>
                                        <!-- Reconciliation Status -->
                                        <td class="text-center">
                                            <t t-if="line.get('reconciled', False)">
                                                <span style="display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 7pt; font-weight: 600; color: #ffffff; background: #059669; -webkit-print-color-adjust: exact !important;">Rec</span>
                                            </t>
                                            <t t-else="">
                                                <span style="display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 7pt; font-weight: 600; color: #6b7280; background: #e5e7eb; -webkit-print-color-adjust: exact !important;">Open</span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                                <!-- Empty state if no lines -->
                                <t t-if="not account['lines']">
                                    <tr>
                                        <td colspan="9" class="ops-value-zero" style="text-align: center; font-style: italic; padding: 20px;">No transactions in this period</td>
                                    </tr>
                                </t>
                            </tbody>
                            <!-- Account Total Footer -->
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="5" style="text-align: right; font-weight: 700;">Account Total:</td>
                                    <td class="num">
                                        <t t-if="account['total_debit'] == 0">
                                            <span class="ops-value-zero">0.00</span>
                                        </t>
                                        <t t-else="">
                                            <span class="ops-value-positive"><t t-esc="'{:,.2f}'.format(account['total_debit'])"/></span>
                                        </t>
                                    </td>
                                    <td class="num">
                                        <t t-if="account['total_credit'] == 0">
                                            <span class="ops-value-zero">0.00</span>
                                        </t>
                                        <t t-else="">
                                            <span class="ops-value-negative">(<t t-esc="'{:,.2f}'.format(account['total_credit'])"/>)</span>
                                        </t>
                                    </td>
                                    <td class="num" style="font-weight: 700;">
                                        <t t-if="account['total_balance'] == 0">
                                            <span class="ops-value-zero">0.00</span>
                                        </t>
                                        <t t-elif="account['total_balance'] &lt; 0">
                                            <span class="ops-value-negative">(<t t-esc="'{:,.2f}'.format(abs(account['total_balance']))"/>)</span>
                                        </t>
                                        <t t-else="">
                                            <span class="ops-value-positive"><t t-esc="'{:,.2f}'.format(account['total_balance'])"/></span>
                                        </t>
                                    </td>
                                    <td class="text-center" style="font-size: 8pt; color: #6b7280;">
                                        <t t-esc="len(account['lines'])"/> txn
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </t>

                <!-- ================================================
                     GRAND TOTAL SECTION
                     ================================================ -->
                <div class="ops-summary-box neutral no-break" style="margin-top: 30px;">
                    <table style="width: 100%;">
                        <tr>
                            <td style="width: 30%; vertical-align: middle;">
                                <div style="font-size: 16pt; font-weight: 700; letter-spacing: -0.5px;">GRAND TOTAL</div>
                                <div style="font-size: 9pt; color: rgba(255,255,255,0.6); margin-top: 3px;"><t t-esc="len(accounts)"/> Accounts</div>
                            </td>
                            <td style="width: 20%; text-align: center; vertical-align: middle;">
                                <div style="font-size: 9pt; color: rgba(255,255,255,0.7); text-transform: uppercase;">Total Debit</div>
                                <div style="font-size: 18pt; font-weight: 700; font-family: 'Consolas', monospace; margin-top: 3px;"><t t-esc="'{:,.2f}'.format(grand_total.get('debit', 0))"/></div>
                            </td>
                            <td style="width: 20%; text-align: center; vertical-align: middle;">
                                <div style="font-size: 9pt; color: rgba(255,255,255,0.7); text-transform: uppercase;">Total Credit</div>
                                <div style="font-size: 18pt; font-weight: 700; font-family: 'Consolas', monospace; margin-top: 3px;"><t t-esc="'{:,.2f}'.format(grand_total.get('credit', 0))"/></div>
                            </td>
                            <td style="width: 30%; text-align: right; vertical-align: middle;">
                                <t t-set="net_bal" t-value="grand_total.get('balance', 0)"/>
                                <div style="font-size: 9pt; color: rgba(255,255,255,0.7); text-transform: uppercase;">Net Balance</div>
                                <div style="font-size: 18pt; font-weight: 700; font-family: 'Consolas', monospace; margin-top: 3px;">
                                    <t t-if="net_bal &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(net_bal))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.2f}'.format(net_bal)"/></t>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Balance Verification -->
                <t t-set="balance_check" t-value="abs(grand_total.get('debit', 0) - grand_total.get('credit', 0))"/>
                <t t-if="balance_check &lt; 0.01">
                    <div class="ops-margin-card excellent" style="margin-top: 20px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 70%; vertical-align: middle;">
                                    <div class="ops-margin-label">Balance Verification</div>
                                    <div class="ops-margin-formula">Debits must equal Credits</div>
                                </td>
                                <td style="width: 30%; text-align: right; vertical-align: middle;">
                                    <span class="ops-status-pill excellent">BALANCED</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </t>
                <t t-else="">
                    <div class="ops-margin-card critical" style="margin-top: 20px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%; vertical-align: middle;">
                                    <div class="ops-margin-label">Balance Verification</div>
                                    <div class="ops-margin-formula">Debits must equal Credits</div>
                                </td>
                                <td style="width: 25%; text-align: center; vertical-align: middle;">
                                    <span class="ops-margin-value critical"><t t-esc="'{:,.2f}'.format(balance_check)"/></span>
                                </td>
                                <td style="width: 25%; text-align: right; vertical-align: middle;">
                                    <span class="ops-status-pill loss">UNBALANCED</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </t>

                <!-- Notes Section -->
                <div class="ops-notes-section">
                    <div class="ops-notes-title">Notes to General Ledger</div>
                    <ul class="ops-notes-list">
                        <li>All transactions are sourced from posted journal entries</li>
                        <li>Reconciliation status indicates whether items have been matched with bank statements</li>
                        <li>Values of zero are displayed as "0.00" for transparency</li>
                        <li>Negative values are shown in red with parentheses</li>
                        <li>Account balances are cumulative through the reporting period</li>
                    </ul>
                </div>

                <!-- Page Footer -->
                <div class="ops-page-footer">
                    <table style="width: 100%;">
                        <tr>
                            <td class="ops-footer-text">
                                <strong>Audit Trail:</strong> All transactions sourced from posted journal entries. |
                                Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                            </td>
                            <td style="text-align: right;">
                                <span class="ops-footer-confidential">Confidential</span>
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </t>
    </template>

    <!-- Report Actions -->
    <record id="action_report_general_ledger" model="ir.actions.report">
        <field name="name">General Ledger</field>
        <field name="model">ops.general.ledger.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_general_ledger</field>
        <field name="report_file">ops_matrix_accounting.report_general_ledger</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Enhanced General Ledger Report with Matrix Dimensions -->
    <record id="report_general_ledger_matrix" model="ir.actions.report">
        <field name="name">General Ledger (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_general_ledger</field>
        <field name="report_file">ops_matrix_accounting.report_general_ledger</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Trial Balance Report (Matrix Enhanced) -->
    <record id="report_trial_balance_matrix" model="ir.actions.report">
        <field name="name">Trial Balance (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Profit & Loss Report (Matrix Enhanced) -->
    <record id="report_profit_loss_matrix" model="ir.actions.report">
        <field name="name">Profit &amp; Loss (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Balance Sheet Report (Matrix Enhanced) -->
    <record id="report_balance_sheet_matrix" model="ir.actions.report">
        <field name="name">Balance Sheet (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Cash Flow Report (Matrix Enhanced) -->
    <record id="report_cash_flow_matrix" model="ir.actions.report">
        <field name="name">Cash Flow (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Aged Partner Balance Report (Matrix Enhanced) -->
    <record id="report_aged_partner_matrix" model="ir.actions.report">
        <field name="name">Aged Partner Balance (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Partner Ledger Report (Matrix Enhanced) -->
    <record id="report_partner_ledger_matrix" model="ir.actions.report">
        <field name="name">Partner Ledger (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Statement of Account Report (Matrix Enhanced) -->
    <record id="report_statement_of_account_matrix" model="ir.actions.report">
        <field name="name">Statement of Account (Matrix Enhanced)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_document</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Financial Matrix XLSX Export (disabled - report_xlsx dependency unavailable)
    <record id="report_financial_matrix_xlsx" model="ir.actions.report">
        <field name="name">Financial Report (Excel)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">xlsx</field>
        <field name="report_name">ops_matrix_accounting.report_financial_matrix_xlsx</field>
        <field name="report_file">ops_matrix_accounting.report_financial_matrix_xlsx</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard_enhanced"/>
        <field name="binding_type">report</field>
    </record>
    -->

</odoo>
