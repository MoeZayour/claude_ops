<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        General Ledger Report - MINIMAL DESIGN
        ======================================
        Content only - no branding (handled by web.external_layout)
    -->

    <template id="report_general_ledger_minimal">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <!-- Minimal styles only for tables/values -->
                <style type="text/css">
                    .ops-report {
                        font-family: 'Segoe UI', Arial, sans-serif;
                        font-size: 10pt;
                        color: #1a1a1a;
                        padding: 10px 0;
                    }
                    .ops-title {
                        font-size: 18pt;
                        font-weight: 700;
                        color: #0F2942;
                        margin-bottom: 4px;
                    }
                    .ops-meta {
                        font-size: 9pt;
                        color: #666;
                        margin-bottom: 16px;
                    }
                    .ops-meta strong {
                        color: #1a1a1a;
                    }
                    .ops-kpi-row {
                        display: flex;
                        gap: 20px;
                        margin-bottom: 20px;
                        padding: 12px 0;
                        border-bottom: 1px solid #E2E8F0;
                    }
                    .ops-kpi {
                        flex: 1;
                    }
                    .ops-kpi-label {
                        font-size: 8pt;
                        color: #666;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    .ops-kpi-value {
                        font-size: 18pt;
                        font-weight: 700;
                        color: #0F2942;
                        font-family: 'Consolas', monospace;
                    }
                    .ops-table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 9pt;
                        margin-bottom: 16px;
                    }
                    .ops-table th {
                        text-align: left;
                        padding: 8px 10px;
                        border-bottom: 2px solid #0F2942;
                        font-size: 8pt;
                        font-weight: 600;
                        color: #666;
                        text-transform: uppercase;
                    }
                    .ops-table th.num {
                        text-align: right;
                    }
                    .ops-table td {
                        padding: 6px 10px;
                        border-bottom: 1px solid #E2E8F0;
                    }
                    .ops-table td.num {
                        text-align: right;
                        font-family: 'Consolas', monospace;
                    }
                    .ops-table tr.total td {
                        font-weight: 700;
                        border-top: 2px solid #0F2942;
                        border-bottom: 3px double #0F2942;
                        background: #F8F9FA;
                    }
                    .ops-table tr.subtotal td {
                        font-weight: 600;
                        background: #F8F9FA;
                    }
                    .ops-section {
                        font-weight: 600;
                        color: #0F2942;
                        padding: 8px 0 4px 0;
                        border-bottom: 1px solid #0F2942;
                        margin-bottom: 8px;
                    }
                    .ops-positive {
                        color: #1a1a1a;
                    }
                    .ops-negative {
                        color: #C41E3A;
                    }
                    .ops-zero {
                        color: #999;
                    }
                    .ops-notes {
                        font-size: 8pt;
                        color: #666;
                        border-left: 3px solid #E2E8F0;
                        padding-left: 12px;
                        margin-top: 20px;
                    }
                    .ops-notes-title {
                        font-weight: 600;
                        color: #1a1a1a;
                        margin-bottom: 6px;
                    }
                    .ops-notes ul {
                        margin: 0;
                        padding-left: 16px;
                    }
                    .ops-notes li {
                        margin: 2px 0;
                    }
                    .no-break {
                        page-break-inside: avoid;
                    }
                </style>

                <!-- Get company info -->
                <t t-set="company" t-value="env.company"/>
                <t t-set="currency_symbol" t-value="company.currency_id.symbol or ''"/>
                <t t-set="accounts_list" t-value="accounts or []"/>
                <t t-set="totals" t-value="grand_total or {}"/>

                <div class="ops-report">

                    <!-- Title -->
                    <h1 class="ops-title">General Ledger</h1>

                    <!-- Meta Info -->
                    <div class="ops-meta">
                        Period: <strong><t t-esc="date_from or '-'"/> to <t t-esc="date_to or '-'"/></strong>
                        <span style="margin-left: 20px;">Currency: <strong><t t-esc="currency_symbol"/></strong></span>
                        <span style="margin-left: 20px;">Accounts: <strong><t t-esc="len(accounts_list)"/></strong></span>
                    </div>

                    <!-- KPI Summary -->
                    <div class="ops-kpi-row">
                        <div class="ops-kpi">
                            <div class="ops-kpi-label">Total Debit</div>
                            <div class="ops-kpi-value"><t t-esc="'{:,.2f}'.format(totals.get('debit', 0))"/></div>
                        </div>
                        <div class="ops-kpi">
                            <div class="ops-kpi-label">Total Credit</div>
                            <div class="ops-kpi-value"><t t-esc="'{:,.2f}'.format(totals.get('credit', 0))"/></div>
                        </div>
                        <div class="ops-kpi">
                            <t t-set="net_bal" t-value="totals.get('balance', 0)"/>
                            <div class="ops-kpi-label">Net Balance</div>
                            <div t-attf-class="ops-kpi-value #{net_bal &lt; 0 and 'ops-negative' or ''}">
                                <t t-if="net_bal &lt; 0">(<t t-esc="'{:,.2f}'.format(abs(net_bal))"/>)</t>
                                <t t-else=""><t t-esc="'{:,.2f}'.format(net_bal)"/></t>
                            </div>
                        </div>
                    </div>

                    <!-- Account Details -->
                    <t t-foreach="accounts_list" t-as="account">
                        <div class="no-break" style="margin-bottom: 20px;">

                            <!-- Account Header -->
                            <div class="ops-section">
                                <t t-esc="account['account_code']"/> - <t t-esc="account['account_name']"/>
                            </div>

                            <!-- Transaction Table -->
                            <table class="ops-table">
                                <thead>
                                    <tr>
                                        <th style="width: 70px;">Date</th>
                                        <th style="width: 60px;">Journal</th>
                                        <th>Partner</th>
                                        <th>Label</th>
                                        <th class="num" style="width: 90px;">Debit</th>
                                        <th class="num" style="width: 90px;">Credit</th>
                                        <th class="num" style="width: 100px;">Balance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="account['lines']" t-as="line">
                                        <tr>
                                            <td><t t-esc="line['move_date']"/></td>
                                            <td><t t-esc="line['journal']"/></td>
                                            <td><t t-esc="line['partner'] or '-'"/></td>
                                            <td><t t-esc="line['label']"/></td>
                                            <!-- Debit -->
                                            <td class="num">
                                                <t t-if="line['debit'] == 0">
                                                    <span class="ops-zero">0.00</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-positive"><t t-esc="'{:,.2f}'.format(line['debit'])"/></span>
                                                </t>
                                            </td>
                                            <!-- Credit -->
                                            <td class="num">
                                                <t t-if="line['credit'] == 0">
                                                    <span class="ops-zero">0.00</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-positive"><t t-esc="'{:,.2f}'.format(line['credit'])"/></span>
                                                </t>
                                            </td>
                                            <!-- Balance -->
                                            <td class="num" style="font-weight: 600;">
                                                <t t-if="line['balance'] == 0">
                                                    <span class="ops-zero">0.00</span>
                                                </t>
                                                <t t-elif="line['balance'] &lt; 0">
                                                    <span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(line['balance']))"/>)</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="ops-positive"><t t-esc="'{:,.2f}'.format(line['balance'])"/></span>
                                                </t>
                                            </td>
                                        </tr>
                                    </t>
                                    <!-- Empty state -->
                                    <t t-if="not account['lines']">
                                        <tr>
                                            <td colspan="7" class="ops-zero" style="text-align: center; font-style: italic; padding: 16px;">
                                                No transactions in this period
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                                <!-- Account Total Footer -->
                                <tfoot>
                                    <tr class="subtotal">
                                        <td colspan="4" style="text-align: right;">Account Total:</td>
                                        <td class="num">
                                            <t t-if="account['total_debit'] == 0">
                                                <span class="ops-zero">0.00</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-positive"><t t-esc="'{:,.2f}'.format(account['total_debit'])"/></span>
                                            </t>
                                        </td>
                                        <td class="num">
                                            <t t-if="account['total_credit'] == 0">
                                                <span class="ops-zero">0.00</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-positive"><t t-esc="'{:,.2f}'.format(account['total_credit'])"/></span>
                                            </t>
                                        </td>
                                        <td class="num">
                                            <t t-if="account['total_balance'] == 0">
                                                <span class="ops-zero">0.00</span>
                                            </t>
                                            <t t-elif="account['total_balance'] &lt; 0">
                                                <span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(account['total_balance']))"/>)</span>
                                            </t>
                                            <t t-else="">
                                                <span class="ops-positive"><t t-esc="'{:,.2f}'.format(account['total_balance'])"/></span>
                                            </t>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </t>

                    <!-- Grand Total -->
                    <table class="ops-table">
                        <tr class="total">
                            <td style="width: 50%;">GRAND TOTAL (<t t-esc="len(accounts_list)"/> Accounts)</td>
                            <td class="num" style="width: 16%;">
                                <t t-esc="'{:,.2f}'.format(totals.get('debit', 0))"/>
                            </td>
                            <td class="num" style="width: 16%;">
                                <t t-esc="'{:,.2f}'.format(totals.get('credit', 0))"/>
                            </td>
                            <td class="num" style="width: 18%;">
                                <t t-set="net_bal" t-value="totals.get('balance', 0)"/>
                                <t t-if="net_bal &lt; 0">
                                    <span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(net_bal))"/>)</span>
                                </t>
                                <t t-else="">
                                    <t t-esc="'{:,.2f}'.format(net_bal)"/>
                                </t>
                            </td>
                        </tr>
                    </table>

                    <!-- Notes -->
                    <div class="ops-notes">
                        <div class="ops-notes-title">Notes</div>
                        <ul>
                            <li>All transactions are sourced from posted journal entries</li>
                            <li>Values of zero are displayed as "0.00" for transparency</li>
                            <li>Negative values are shown in red with parentheses</li>
                            <li>Account balances are cumulative through the reporting period</li>
                        </ul>
                    </div>

                </div>

            </t>
        </t>
    </template>

    <!-- Report Action for Minimal General Ledger -->
    <record id="action_report_general_ledger_minimal" model="ir.actions.report">
        <field name="name">General Ledger (Minimal)</field>
        <field name="model">ops.general.ledger.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_general_ledger_minimal</field>
        <field name="report_file">ops_matrix_accounting.report_general_ledger_minimal</field>
        <field name="binding_model_id" ref="model_ops_general_ledger_wizard"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
