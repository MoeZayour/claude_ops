<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        OPS Matrix Consolidated Report Templates
        ========================================
        Professional Enterprise Financial Styling
        v19.4.1.0: Phase 15 - PDF-Compatible (Table-Based Layout)

        IMPORTANT: Uses table-based layout for wkhtmltopdf compatibility
    -->

    <!-- Company Consolidation Report PDF Template -->
    <record id="report_company_consolidation_pdf" model="ir.actions.report">
        <field name="name">Company Consolidation Report</field>
        <field name="model">ops.company.consolidation</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_company_consolidation_document</field>
        <field name="report_file">ops_matrix_accounting.report_company_consolidation_document</field>
        <field name="binding_model_id" ref="model_ops_company_consolidation"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_company_consolidation_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <!-- Dynamic Company Colors -->
                    <t t-set="primary_color" t-value="o.company_id.primary_color or '#1a2744'"/>
                    <t t-set="secondary_color" t-value="o.company_id.secondary_color or '#3b82f6'"/>
                    <t t-set="primary_dark" t-value="'#0a1628'"/>
                    <t t-set="success_color" t-value="'#059669'"/>
                    <t t-set="danger_color" t-value="'#dc2626'"/>

                    <div class="page ops-report-container" style="background: #ffffff !important; -webkit-print-color-adjust: exact !important;">

                        <!-- Executive Header Band -->
                        <div t-attf-style="background: #{primary_dark} !important; padding: 20px 25px !important; margin: -10mm -10mm 0 -10mm !important; -webkit-print-color-adjust: exact !important;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="vertical-align: middle;">
                                        <span t-attf-style="display: inline-block; width: 50px; height: 50px; background: linear-gradient(135deg, #{primary_color} 0%, #{secondary_color} 100%); border-radius: 10px; text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; color: #ffffff; margin-right: 15px; -webkit-print-color-adjust: exact !important;">
                                            <t t-esc="(o.company_id.name or 'C')[0]"/>
                                        </span>
                                        <span style="display: inline-block; vertical-align: middle;">
                                            <span style="display: block; font-size: 20px; font-weight: 700; color: #ffffff;"><t t-esc="o.company_id.name"/></span>
                                            <span style="display: block; font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 2px;">Consolidated Financial Statements</span>
                                        </span>
                                    </td>
                                    <td style="text-align: right; vertical-align: middle;">
                                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px 15px; display: inline-block;">
                                            <div style="font-size: 10px; color: #94a3b8; text-transform: uppercase;">Report Period</div>
                                            <div style="font-size: 14px; font-weight: 600; color: #ffffff;"><t t-esc="o.date_to"/></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!-- Accent Bar -->
                        <div t-attf-style="height: 4px; background: linear-gradient(90deg, #{primary_color} 0%, #{secondary_color} 50%, #{success_color} 100%); margin: 0 -10mm 20px -10mm; -webkit-print-color-adjust: exact !important;"></div>

                        <!-- Statement Title Section -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 t-attf-style="font-size: 28px; font-weight: 700; color: #{primary_color}; margin: 0 0 8px 0;">Consolidated P&amp;L Report</h2>
                            <p style="font-size: 14px; color: #64748b; margin: 0;">Company-Wide Financial Performance</p>
                            <span class="ops-statement-period">
                                For the Period <t t-esc="o.date_from"/> to <t t-esc="o.date_to"/>
                            </span>
                        </div>

                        <!-- Report Info Box -->
                        <div class="ops-info-box">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%; vertical-align: top;">
                                        <span class="ops-info-label">Company:</span>
                                        <span t-field="o.company_id.name"/><br/>
                                        <span class="ops-info-label">Detail Level:</span>
                                        <span t-field="o.report_detail_level"/>
                                    </td>
                                    <td style="width: 50%; vertical-align: top; text-align: right;">
                                        <span class="ops-info-label">Generated:</span>
                                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <t t-if="o.report_data">
                            <t t-set="totals" t-value="o.report_data.get('totals', {})"/>
                            <t t-set="total_income" t-value="totals.get('total_income', 0)"/>
                            <t t-set="total_expense" t-value="totals.get('total_expense', 0)"/>
                            <t t-set="net_profit" t-value="totals.get('net_profit', 0)"/>
                            <t t-set="profit_margin" t-value="(net_profit / total_income * 100) if total_income > 0 else 0"/>

                            <!-- KPI Cards (Table Layout for PDF) -->
                            <div class="ops-highlights">
                                <table style="width: 100%; border-collapse: separate; border-spacing: 10px 0;">
                                    <tr>
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-highlight-card revenue">
                                                <div class="ops-highlight-label">Total Income</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(total_income)"/>
                                                </div>
                                                <div class="ops-highlight-change positive">Revenue</div>
                                            </div>
                                        </td>
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-highlight-card expense">
                                                <div class="ops-highlight-label">Total Expenses</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(total_expense)"/>
                                                </div>
                                                <div class="ops-highlight-change negative">Costs</div>
                                            </div>
                                        </td>
                                        <td style="width: 33%; vertical-align: top;">
                                            <div class="ops-highlight-card profit">
                                                <div class="ops-highlight-label">Net Profit</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                                </div>
                                                <div t-attf-class="ops-highlight-change #{net_profit >= 0 and 'positive' or 'negative'}">
                                                    <t t-esc="'{:.1f}'.format(profit_margin)"/>% Margin
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Financial Summary Table -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row income">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Financial Summary</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(net_profit)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Total Income</td>
                                            <td class="text-end amount-positive">
                                                <t t-esc="'{:,.2f}'.format(total_income)"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Total Expenses</td>
                                            <td class="text-end amount-negative">
                                                (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                            </td>
                                        </tr>
                                        <tr class="grand-total-row">
                                            <td><strong>NET PROFIT</strong></td>
                                            <td class="text-end">
                                                <strong><t t-esc="'{:,.2f}'.format(net_profit)"/></strong>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Totals Summary Box -->
                            <div t-attf-class="ops-totals-summary #{net_profit >= 0 and 'success' or 'loss'}">
                                <table style="width: 100%;">
                                    <tr>
                                        <td class="ops-totals-left" style="width: 40%;">
                                            <div class="ops-totals-label">Net Profit Margin</div>
                                            <div class="ops-totals-equation">Net Income / Total Revenue x 100</div>
                                        </td>
                                        <td class="ops-totals-value" style="width: 35%;">
                                            <t t-esc="'{:.1f}'.format(profit_margin)"/>%
                                        </td>
                                        <td style="width: 25%; text-align: right;">
                                            <div class="ops-totals-badge">
                                                <span t-attf-class="ops-badge-icon #{profit_margin >= 10 and '' or 'warning'}">
                                                    <t t-if="profit_margin >= 10">&#10003;</t>
                                                    <t t-else="">!</t>
                                                </span><br/>
                                                <span class="ops-badge-text">
                                                    <t t-if="profit_margin >= 15">Excellent</t>
                                                    <t t-elif="profit_margin >= 10">Good</t>
                                                    <t t-elif="profit_margin >= 5">Acceptable</t>
                                                    <t t-else="">Review</t>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="ops-alert ops-alert-warning">
                                <strong>No Data Available:</strong>
                                Report data is computed dynamically. For detailed analysis, use the report wizard.
                            </div>
                        </t>

                        <!-- Notes Section -->
                        <div class="ops-notes-section">
                            <div class="ops-notes-title">Notes to Financial Statements</div>
                            <ul class="ops-notes-list">
                                <li>This report consolidates all company financial data</li>
                                <li>All figures are in the company's base currency</li>
                                <li>Detail Level: <t t-esc="o.report_detail_level or 'Summary'"/></li>
                            </ul>
                        </div>

                        <!-- Page Footer -->
                        <div class="ops-page-footer">
                            <table style="width: 100%;">
                                <tr>
                                    <td class="ops-footer-text">
                                        Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/> |
                                        OPS Matrix Financial Intelligence
                                    </td>
                                    <td class="ops-footer-confidential">Confidential</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Branch P&L Report PDF Template -->
    <record id="report_branch_pl_pdf" model="ir.actions.report">
        <field name="name">Branch P&amp;L Report</field>
        <field name="model">ops.branch.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_branch_pl_document</field>
        <field name="report_file">ops_matrix_accounting.report_branch_pl_document</field>
        <field name="binding_model_id" ref="model_ops_branch_report"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_branch_pl_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <div class="page ops-report-container">

                        <!-- Page Header -->
                        <table class="ops-page-header">
                            <tr>
                                <td class="ops-page-header-left">
                                    <span class="ops-header-logo"><t t-esc="(o.branch_id.name or 'B')[0]"/></span>
                                    <span class="ops-header-info">
                                        <span class="ops-header-company"><t t-esc="o.branch_id.company_id.name"/></span><br/>
                                        <span class="ops-header-subtitle">Branch Financial Statements</span>
                                    </span>
                                </td>
                                <td class="ops-page-number-box">
                                    <span class="ops-page-number">Branch P&amp;L</span><br/>
                                    <span class="ops-page-date"><t t-esc="o.branch_id.code or ''"/></span>
                                </td>
                            </tr>
                        </table>

                        <!-- Statement Title Section -->
                        <div class="ops-statement-title-section">
                            <h2 class="ops-statement-title">Branch Profit &amp; Loss Report</h2>
                            <p class="ops-statement-subtitle"><t t-esc="o.branch_id.name"/></p>
                            <span class="ops-statement-period">
                                For the Period <t t-esc="o.date_from"/> to <t t-esc="o.date_to"/>
                            </span>
                        </div>

                        <!-- Report Info Box -->
                        <div class="ops-info-box">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%; vertical-align: top;">
                                        <span class="ops-info-label">Branch:</span>
                                        <span t-field="o.branch_id.name"/><br/>
                                        <span class="ops-info-label">Branch Code:</span>
                                        <span t-field="o.branch_id.code"/>
                                    </td>
                                    <td style="width: 50%; vertical-align: top; text-align: right;">
                                        <span class="ops-info-label">Manager:</span>
                                        <span t-field="o.branch_id.manager_id.name"/><br/>
                                        <span class="ops-info-label">Business Units:</span>
                                        <span t-esc="len(o.branch_id.business_unit_ids)"/> active
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <t t-if="o.report_data">
                            <t t-set="totals" t-value="o.report_data.get('totals', {})"/>
                            <t t-set="total_income" t-value="totals.get('total_income', 0)"/>
                            <t t-set="total_expense" t-value="totals.get('total_expense', 0)"/>
                            <t t-set="net_profit" t-value="totals.get('net_profit', 0)"/>
                            <t t-set="profit_margin" t-value="(net_profit / total_income * 100) if total_income > 0 else 0"/>

                            <!-- KPI Cards (4-Column Table Layout) -->
                            <div class="ops-highlights">
                                <table style="width: 100%; border-collapse: separate; border-spacing: 8px 0;">
                                    <tr>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card revenue">
                                                <div class="ops-highlight-label">Total Income</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.0f}'.format(total_income)"/>
                                                </div>
                                                <div class="ops-highlight-change positive">Revenue</div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card expense">
                                                <div class="ops-highlight-label">Total Expenses</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.0f}'.format(total_expense)"/>
                                                </div>
                                                <div class="ops-highlight-change negative">Costs</div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card profit">
                                                <div class="ops-highlight-label">Net Profit</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.0f}'.format(net_profit)"/>
                                                </div>
                                                <div t-attf-class="ops-highlight-change #{net_profit >= 0 and 'positive' or 'negative'}">
                                                    <t t-if="net_profit >= 0">Profit</t>
                                                    <t t-else="">Loss</t>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card margin">
                                                <div class="ops-highlight-label">Profit Margin</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:.1f}'.format(profit_margin)"/>%
                                                </div>
                                                <div t-attf-class="ops-highlight-change #{profit_margin >= 10 and 'positive' or 'negative'}">
                                                    <t t-if="profit_margin >= 15">Excellent</t>
                                                    <t t-elif="profit_margin >= 10">Good</t>
                                                    <t t-elif="profit_margin >= 5">Acceptable</t>
                                                    <t t-else="">Below Target</t>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Performance Alerts -->
                            <t t-if="net_profit &lt; 0">
                                <div class="ops-alert ops-alert-danger">
                                    <strong>Critical Alert:</strong>
                                    This branch is operating at a loss of <strong><t t-esc="'{:,.2f}'.format(abs(net_profit))"/></strong>.
                                    Immediate review of cost structure and revenue streams recommended.
                                </div>
                            </t>
                            <t t-elif="net_profit >= 0 and profit_margin &lt; 5">
                                <div class="ops-alert ops-alert-warning">
                                    <strong>Warning:</strong>
                                    Profit margin is below target threshold (<t t-esc="'{:.1f}'.format(profit_margin)"/>% vs. 5% minimum).
                                    Consider cost optimization or pricing review.
                                </div>
                            </t>
                            <t t-elif="profit_margin >= 20">
                                <div class="ops-alert ops-alert-success">
                                    <strong>Excellent Performance:</strong>
                                    Profit margin of <t t-esc="'{:.1f}'.format(profit_margin)"/>% exceeds excellent threshold (20%).
                                    Strong financial health maintained.
                                </div>
                            </t>

                            <!-- Financial Summary Table -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row income">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Financial Summary</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(net_profit)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Revenue / Income</td>
                                            <td class="text-end amount-positive">
                                                <t t-esc="'{:,.2f}'.format(total_income)"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Operating Expenses</td>
                                            <td class="text-end amount-negative">
                                                (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                            </td>
                                        </tr>
                                        <tr class="subtotal-row">
                                            <td><strong>Gross Margin</strong></td>
                                            <td class="text-end">
                                                <strong><t t-esc="'{:,.2f}'.format(total_income - total_expense)"/></strong>
                                            </td>
                                        </tr>
                                        <tr class="grand-total-row">
                                            <td><strong>NET PROFIT / (LOSS)</strong></td>
                                            <td class="text-end">
                                                <strong><t t-esc="'{:,.2f}'.format(net_profit)"/></strong>
                                                <t t-if="net_profit &lt; 0"> (LOSS)</t>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Totals Summary Box -->
                            <div t-attf-class="ops-totals-summary #{net_profit >= 0 and 'success' or 'loss'}">
                                <table style="width: 100%;">
                                    <tr>
                                        <td class="ops-totals-left" style="width: 40%;">
                                            <div class="ops-totals-label">Net Profit Margin</div>
                                            <div class="ops-totals-equation">Net Income / Total Revenue x 100</div>
                                        </td>
                                        <td class="ops-totals-value" style="width: 35%;">
                                            <t t-esc="'{:.2f}'.format(profit_margin)"/>%
                                        </td>
                                        <td style="width: 25%; text-align: right;">
                                            <div class="ops-totals-badge">
                                                <span t-attf-class="ops-badge-icon #{profit_margin >= 10 and '' or (profit_margin >= 5 and 'warning' or 'danger')}">
                                                    <t t-if="profit_margin >= 10">&#10003;</t>
                                                    <t t-else="">!</t>
                                                </span><br/>
                                                <span class="ops-badge-text">
                                                    <t t-if="profit_margin >= 15">Excellent</t>
                                                    <t t-elif="profit_margin >= 10">Good</t>
                                                    <t t-elif="profit_margin >= 5">Acceptable</t>
                                                    <t t-else="">Review</t>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Performance Thresholds -->
                            <div class="ops-performance-thresholds">
                                <p>
                                    <strong>Performance Thresholds:</strong><br/>
                                    <span class="threshold-excellent">Excellent:</span> Profit margin &gt;= 20% |
                                    <span class="threshold-good">Good:</span> Profit margin 15-20% |
                                    <span class="threshold-acceptable">Acceptable:</span> Profit margin 5-15% |
                                    <span class="threshold-below">Below Target:</span> Profit margin &lt; 5% or negative profit
                                </p>
                            </div>

                        </t>
                        <t t-else="">
                            <div class="ops-alert ops-alert-warning">
                                <strong>No Data Available:</strong>
                                Report data is computed dynamically. Use the report wizard to generate detailed analysis
                                or ensure transactions exist for the selected period.
                            </div>
                        </t>

                        <!-- Notes Section -->
                        <div class="ops-notes-section">
                            <div class="ops-notes-title">Notes to Financial Statements</div>
                            <ul class="ops-notes-list">
                                <li>This report shows branch-level financial performance</li>
                                <li>All figures are in the company's base currency</li>
                                <li>For detailed breakdown, use the report wizard</li>
                            </ul>
                        </div>

                        <!-- Page Footer -->
                        <div class="ops-page-footer">
                            <table style="width: 100%;">
                                <tr>
                                    <td class="ops-footer-text">
                                        Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/> |
                                        OPS Matrix - Branch Financial Analysis
                                    </td>
                                    <td class="ops-footer-confidential">Confidential</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Business Unit Report PDF Template -->
    <record id="report_business_unit_pdf" model="ir.actions.report">
        <field name="name">Business Unit Report</field>
        <field name="model">ops.business.unit.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_business_unit_document</field>
        <field name="report_file">ops_matrix_accounting.report_business_unit_document</field>
        <field name="binding_model_id" ref="model_ops_business_unit_report"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_business_unit_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <div class="page ops-report-container">

                        <!-- Page Header -->
                        <table class="ops-page-header">
                            <tr>
                                <td class="ops-page-header-left">
                                    <span class="ops-header-logo"><t t-esc="(o.business_unit_id.name or 'B')[0]"/></span>
                                    <span class="ops-header-info">
                                        <span class="ops-header-company"><t t-esc="o.business_unit_id.branch_id.company_id.name or 'Company'"/></span><br/>
                                        <span class="ops-header-subtitle">Business Unit Financial Statements</span>
                                    </span>
                                </td>
                                <td class="ops-page-number-box">
                                    <span class="ops-page-number">Business Unit Report</span><br/>
                                    <span class="ops-page-date"><t t-esc="o.business_unit_id.code or ''"/></span>
                                </td>
                            </tr>
                        </table>

                        <!-- Statement Title Section -->
                        <div class="ops-statement-title-section">
                            <h2 class="ops-statement-title">Business Unit Profitability Report</h2>
                            <p class="ops-statement-subtitle"><t t-esc="o.business_unit_id.name"/></p>
                            <span class="ops-statement-period">
                                For the Period <t t-esc="o.date_from"/> to <t t-esc="o.date_to"/>
                            </span>
                        </div>

                        <!-- Report Info Box -->
                        <div class="ops-info-box">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%; vertical-align: top;">
                                        <span class="ops-info-label">Business Unit:</span>
                                        <span t-field="o.business_unit_id.name"/><br/>
                                        <span class="ops-info-label">BU Code:</span>
                                        <span t-field="o.business_unit_id.code"/>
                                    </td>
                                    <td style="width: 50%; vertical-align: top; text-align: right;">
                                        <span class="ops-info-label">Branch:</span>
                                        <span t-field="o.business_unit_id.branch_id.name"/><br/>
                                        <span class="ops-info-label">Generated:</span>
                                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <t t-if="o.report_data">
                            <t t-set="totals" t-value="o.report_data.get('totals', {})"/>
                            <t t-set="total_income" t-value="totals.get('total_income', 0)"/>
                            <t t-set="total_expense" t-value="totals.get('total_expense', 0)"/>
                            <t t-set="net_profit" t-value="totals.get('net_profit', 0)"/>
                            <t t-set="profit_margin" t-value="totals.get('profit_margin', (net_profit / total_income * 100) if total_income > 0 else 0)"/>

                            <!-- KPI Cards (4-Column Table Layout) -->
                            <div class="ops-highlights">
                                <table style="width: 100%; border-collapse: separate; border-spacing: 8px 0;">
                                    <tr>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card revenue">
                                                <div class="ops-highlight-label">Total Income</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(total_income)"/>
                                                </div>
                                                <div class="ops-highlight-change positive">Revenue</div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card expense">
                                                <div class="ops-highlight-label">Total Expenses</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(total_expense)"/>
                                                </div>
                                                <div class="ops-highlight-change negative">Costs</div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card profit">
                                                <div class="ops-highlight-label">Net Profit</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                                </div>
                                                <div t-attf-class="ops-highlight-change #{net_profit >= 0 and 'positive' or 'negative'}">
                                                    <t t-if="net_profit >= 0">Profit</t>
                                                    <t t-else="">Loss</t>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="width: 25%; vertical-align: top;">
                                            <div class="ops-highlight-card margin">
                                                <div class="ops-highlight-label">Profit Margin</div>
                                                <div class="ops-highlight-value">
                                                    <t t-esc="'{:.2f}'.format(profit_margin)"/>%
                                                </div>
                                                <div t-attf-class="ops-highlight-change #{profit_margin >= 10 and 'positive' or 'negative'}">Margin</div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Financial Summary Table -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row income">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Performance Summary</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(net_profit)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Total Income</td>
                                            <td class="text-end amount-positive">
                                                <t t-esc="'{:,.2f}'.format(total_income)"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Total Expenses</td>
                                            <td class="text-end amount-negative">
                                                (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                            </td>
                                        </tr>
                                        <tr class="grand-total-row">
                                            <td><strong>NET PROFIT</strong></td>
                                            <td class="text-end">
                                                <strong><t t-esc="'{:,.2f}'.format(net_profit)"/></strong>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Profit Margin %</td>
                                            <td class="text-end">
                                                <strong><t t-esc="'{:.2f}'.format(profit_margin)"/>%</strong>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="ops-alert ops-alert-warning">
                                <strong>No Data Available:</strong>
                                Report data is computed dynamically. For detailed analysis, use the report wizard.
                            </div>
                        </t>

                        <!-- Notes Section -->
                        <div class="ops-notes-section">
                            <div class="ops-notes-title">Notes to Financial Statements</div>
                            <ul class="ops-notes-list">
                                <li>This report shows business unit level profitability</li>
                                <li>All figures are in the company's base currency</li>
                                <li>For detailed breakdown, use the report wizard</li>
                            </ul>
                        </div>

                        <!-- Page Footer -->
                        <div class="ops-page-footer">
                            <table style="width: 100%;">
                                <tr>
                                    <td class="ops-footer-text">
                                        Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/> |
                                        OPS Matrix Financial Intelligence
                                    </td>
                                    <td class="ops-footer-confidential">Confidential</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Consolidated Balance Sheet PDF Template -->
    <record id="report_consolidated_balance_sheet_pdf" model="ir.actions.report">
        <field name="name">Consolidated Balance Sheet</field>
        <field name="model">ops.consolidated.balance.sheet</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_consolidated_balance_sheet_document</field>
        <field name="report_file">ops_matrix_accounting.report_consolidated_balance_sheet_document</field>
        <field name="binding_model_id" ref="model_ops_consolidated_balance_sheet"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_consolidated_balance_sheet_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="ops_matrix_accounting.ops_external_layout">
                    <div class="page ops-report-container">

                        <!-- Page Header -->
                        <table class="ops-page-header">
                            <tr>
                                <td class="ops-page-header-left">
                                    <span class="ops-header-logo">C</span>
                                    <span class="ops-header-info">
                                        <span class="ops-header-company">Consolidated Group</span><br/>
                                        <span class="ops-header-subtitle">Consolidated Financial Statements</span>
                                    </span>
                                </td>
                                <td class="ops-page-number-box">
                                    <span class="ops-page-number">Balance Sheet</span><br/>
                                    <span class="ops-page-date"><t t-esc="o.date"/></span>
                                </td>
                            </tr>
                        </table>

                        <!-- Statement Title Section -->
                        <div class="ops-statement-title-section">
                            <h2 class="ops-statement-title">Consolidated Balance Sheet</h2>
                            <p class="ops-statement-subtitle">Statement of Financial Position</p>
                            <span class="ops-statement-period">
                                As of <t t-esc="o.date"/>
                            </span>
                        </div>

                        <!-- Report Info Box -->
                        <div class="ops-info-box">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%; vertical-align: top;">
                                        <span class="ops-info-label">Currency:</span>
                                        <span t-field="o.currency_id.name"/><br/>
                                        <span class="ops-info-label">Companies:</span>
                                        <span t-esc="', '.join(o.company_ids.mapped('name'))"/>
                                    </td>
                                    <td style="width: 50%; vertical-align: top; text-align: right;">
                                        <span class="ops-info-label">Generated:</span>
                                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <t t-if="o.report_data">
                            <t t-set="consolidated" t-value="o.report_data.get('consolidated', {})"/>
                            <t t-set="total_assets" t-value="consolidated.get('total_assets', 0)"/>
                            <t t-set="total_liabilities" t-value="consolidated.get('total_liabilities', 0)"/>
                            <t t-set="total_equity" t-value="consolidated.get('total_equity', 0)"/>

                            <!-- ASSETS SECTION -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row assets">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Assets</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(total_assets)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Current Assets</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Non-Current Assets</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr class="grand-total-row">
                                            <td><strong>TOTAL ASSETS</strong></td>
                                            <td class="text-end"><t t-esc="'{:,.2f}'.format(total_assets)"/></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- LIABILITIES SECTION -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row liabilities">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Liabilities</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(total_liabilities)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Current Liabilities</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Non-Current Liabilities</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr class="total-row">
                                            <td><strong>TOTAL LIABILITIES</strong></td>
                                            <td class="text-end"><t t-esc="'{:,.2f}'.format(total_liabilities)"/></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- EQUITY SECTION -->
                            <div class="ops-financial-section">
                                <div class="ops-section-header-row equity">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td class="ops-section-title-text">Shareholders' Equity</td>
                                            <td class="ops-section-amount"><t t-esc="'{:,.2f}'.format(total_equity)"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <table class="ops-financial-table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="indent-1">Share Capital</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr>
                                            <td class="indent-1">Retained Earnings</td>
                                            <td class="text-end">-</td>
                                        </tr>
                                        <tr class="grand-total-row">
                                            <td><strong>TOTAL SHAREHOLDERS' EQUITY</strong></td>
                                            <td class="text-end"><t t-esc="'{:,.2f}'.format(total_equity)"/></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Totals Summary Box -->
                            <t t-set="total_liab_equity" t-value="total_liabilities + total_equity"/>
                            <t t-set="balance_diff" t-value="total_assets - total_liab_equity"/>
                            <div class="ops-totals-summary">
                                <table style="width: 100%;">
                                    <tr>
                                        <td class="ops-totals-left" style="width: 40%;">
                                            <div class="ops-totals-label">Total Liabilities + Equity</div>
                                            <div class="ops-totals-equation">Assets = Liabilities + Shareholders' Equity</div>
                                        </td>
                                        <td class="ops-totals-value" style="width: 35%;">
                                            <t t-esc="'{:,.2f}'.format(total_liab_equity)"/>
                                        </td>
                                        <td style="width: 25%; text-align: right;">
                                            <div class="ops-totals-badge">
                                                <span t-attf-class="ops-badge-icon #{abs(balance_diff) &lt; 0.01 and '' or 'danger'}">
                                                    <t t-if="abs(balance_diff) &lt; 0.01">&#10003;</t>
                                                    <t t-else="">!</t>
                                                </span><br/>
                                                <span class="ops-badge-text">
                                                    <t t-if="abs(balance_diff) &lt; 0.01">Balanced</t>
                                                    <t t-else="">Unbalanced</t>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="ops-alert ops-alert-warning">
                                <strong>No Data Available:</strong>
                                Report data is computed dynamically. For detailed analysis, use the report wizard.
                            </div>
                        </t>

                        <!-- Notes Section -->
                        <div class="ops-notes-section">
                            <div class="ops-notes-title">Notes to Financial Statements</div>
                            <ul class="ops-notes-list">
                                <li>This report consolidates balance sheets across multiple companies</li>
                                <li>All figures are in the reporting currency</li>
                                <li>Inter-company eliminations may apply</li>
                            </ul>
                        </div>

                        <!-- Page Footer -->
                        <div class="ops-page-footer">
                            <table style="width: 100%;">
                                <tr>
                                    <td class="ops-footer-text">
                                        Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/> |
                                        OPS Matrix - Consolidated Reporting
                                    </td>
                                    <td class="ops-footer-confidential">Confidential</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>
