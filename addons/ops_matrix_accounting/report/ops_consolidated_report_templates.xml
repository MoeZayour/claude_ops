<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        OPS Matrix Consolidated Report Templates â€” Corporate Redesign
        =============================================================
        GL Gold Standard pattern: ops_corporate_pdf_layout, inline CSS,
        table layouts, wkhtmltopdf-safe. No flexbox, no CSS classes.

        Reports:
        1. Company Consolidation P&L
        2. Branch P&L
        3. BU Profitability
        4. Consolidated Balance Sheet
    -->

    <!-- ============================================================ -->
    <!-- REPORT ACTIONS                                                -->
    <!-- ============================================================ -->

    <record id="report_company_consolidation_pdf" model="ir.actions.report">
        <field name="name">Company Consolidation P&amp;L</field>
        <field name="model">ops.company.consolidation</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_company_consol</field>
        <field name="report_file">ops_matrix_accounting.report_company_consol</field>
        <field name="binding_model_id" ref="model_ops_company_consolidation"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_ops_corporate_a4"/>
    </record>

    <record id="report_branch_pl_pdf" model="ir.actions.report">
        <field name="name">Branch P&amp;L Report</field>
        <field name="model">ops.branch.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_branch_pl_document</field>
        <field name="report_file">ops_matrix_accounting.report_branch_pl_document</field>
        <field name="binding_model_id" ref="model_ops_branch_report"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_ops_corporate_a4"/>
    </record>

    <record id="report_business_unit_pdf" model="ir.actions.report">
        <field name="name">BU Profitability Report</field>
        <field name="model">ops.business.unit.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_business_unit_document</field>
        <field name="report_file">ops_matrix_accounting.report_business_unit_document</field>
        <field name="binding_model_id" ref="model_ops_business_unit_report"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_ops_corporate_a4"/>
    </record>

    <record id="report_consolidated_balance_sheet_pdf" model="ir.actions.report">
        <field name="name">Consolidated Balance Sheet</field>
        <field name="model">ops.consolidated.balance.sheet</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_consol_balance_sheet</field>
        <field name="report_file">ops_matrix_accounting.report_consol_balance_sheet</field>
        <field name="binding_model_id" ref="model_ops_consolidated_balance_sheet"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_ops_corporate_a4"/>
    </record>

    <!-- ============================================================ -->
    <!-- TEMPLATE 1: COMPANY CONSOLIDATION P&L                        -->
    <!-- ============================================================ -->

    <template id="report_company_consol">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <!-- Color shorthand variables -->
                <t t-set="pc" t-value="primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="primary_light or '#e8eaf6'"/>
                <t t-set="pd" t-value="primary_dark or '#3d4a8a'"/>
                <t t-set="bt" t-value="body_text_color or '#1a1a1a'"/>

                <t t-call="ops_matrix_accounting.ops_corporate_pdf_layout">
                    <div style="font-family: Helvetica, Arial, sans-serif; font-size: 9pt; color: #1a1a1a;">

                        <!-- Inline Style Block -->
                        <style>
                            table.ops-tbl { width: 100%; border-collapse: collapse; margin-bottom: 4mm; }
                            table.ops-tbl th { padding: 2.5mm 3mm; font-size: 7.5pt; text-transform: uppercase;
                                letter-spacing: 0.5px; border-bottom: 0.5mm solid #cbd5e1; text-align: left; }
                            table.ops-tbl td { padding: 2mm 3mm; font-size: 8.5pt; border-bottom: 0.3mm solid #e2e8f0; }
                            table.ops-tbl tr:last-child td { border-bottom: none; }
                            .text-right { text-align: right; }
                            .text-center { text-align: center; }
                        </style>

                        <!-- ====== HEADER ====== -->
                        <table style="width: 100%; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 60%; vertical-align: top;">
                                    <div t-attf-style="font-size: 14pt; font-weight: 700; color: {{pc}};">
                                        <t t-esc="company.name"/>
                                    </div>
                                    <div style="font-size: 8pt; color: #64748b; margin-top: 1mm;">
                                        <t t-if="company.street"><t t-esc="company.street"/> &#x2022; </t>
                                        <t t-if="company.city"><t t-esc="company.city"/></t>
                                        <t t-if="company.phone"> &#x2022; <t t-esc="company.phone"/></t>
                                    </div>
                                </td>
                                <td style="width: 40%; text-align: right; vertical-align: top;">
                                    <div t-attf-style="display: inline-block; background: {{pl}}; border: 0.3mm solid {{pc}}; border-radius: 2mm; padding: 2mm 4mm;">
                                        <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Report ID</div>
                                        <div t-attf-style="font-size: 9pt; font-weight: 700; color: {{pc}};"><t t-esc="report_run_id"/></div>
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== TITLE BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-bottom: 5mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 13pt; font-weight: 700;">
                                    Consolidated P&amp;L Report
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 8pt;">
                                    <t t-esc="date_from"/> &#x2014; <t t-esc="date_to"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FILTER SUMMARY ROW ====== -->
                        <table style="width: 100%; margin-bottom: 5mm; font-size: 8pt;">
                            <tr>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                    <strong>Currency:</strong> <t t-esc="currency_name"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Detail Level:</strong> <t t-esc="detail_level"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Branches:</strong> <t t-esc="branch_names"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== KPI SUMMARY ====== -->
                        <table style="width: 100%; border-collapse: separate; border-spacing: 3mm 0; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Total Income</div>
                                                <div style="font-size: 13pt; font-weight: 700; color: #16a34a;">
                                                    <t t-esc="'{:,.2f}'.format(total_income)"/>
                                                </div>
                                                <div style="font-size: 7pt; color: #64748b;"><t t-esc="currency_name"/></div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Total Expenses</div>
                                                <div style="font-size: 13pt; font-weight: 700; color: #dc2626;">
                                                    <t t-esc="'{:,.2f}'.format(total_expense)"/>
                                                </div>
                                                <div style="font-size: 7pt; color: #64748b;"><t t-esc="currency_name"/></div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <table t-attf-style="width: 100%; border: 0.3mm solid {{pc}}; border-radius: 2mm; background: {{pl}};">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Net Profit</div>
                                                <div t-attf-style="font-size: 13pt; font-weight: 700; color: {{pc}};">
                                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                                </div>
                                                <div style="font-size: 7pt; color: #64748b;">
                                                    <t t-if="total_income"><t t-esc="'{:.1f}'.format(net_profit / total_income * 100)"/>% margin</t>
                                                    <t t-else="">&#x2014;</t>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FINANCIAL SUMMARY TABLE ====== -->
                        <table t-attf-style="width: 100%; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                            <tr>
                                <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Financial Summary</td>
                                <td style="padding: 2mm 4mm; text-align: right; font-size: 8pt; font-weight: 600;">
                                    <t t-esc="currency_name"/>
                                </td>
                            </tr>
                        </table>
                        <table class="ops-tbl">
                            <thead>
                                <tr t-attf-style="color: {{pc}};">
                                    <th style="width: 60%;">Item</th>
                                    <th class="text-right" style="width: 40%;">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding-left: 6mm;">Total Income</td>
                                    <td class="text-right" style="color: #16a34a; font-weight: 600;">
                                        <t t-esc="'{:,.2f}'.format(total_income)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 6mm;">Total Expenses</td>
                                    <td class="text-right" style="color: #dc2626;">
                                        (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                    </td>
                                </tr>
                                <t t-if="totals.get('gross_profit') is not None">
                                    <tr style="border-top: 0.5mm solid #cbd5e1;">
                                        <td style="font-weight: 600;">Gross Profit</td>
                                        <td class="text-right" style="font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(totals.get('gross_profit', 0))"/>
                                        </td>
                                    </tr>
                                </t>
                                <tr t-attf-style="background: {{pl}}; border-top: 0.5mm solid {{pc}}; border-bottom: 0.5mm solid {{pc}};">
                                    <td style="font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm;">NET PROFIT / (LOSS)</td>
                                    <td t-attf-style="text-align: right; font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm; color: {{pc}};">
                                        <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- ====== BRANCH BREAKDOWN (if by_branch detail) ====== -->
                        <t t-if="branch_data">
                            <table t-attf-style="width: 100%; margin-top: 4mm; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                <tr>
                                    <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Branch Performance</td>
                                    <td style="padding: 2mm 4mm; text-align: right; font-size: 8pt;">
                                        <t t-esc="len(branch_data)"/> branches
                                    </td>
                                </tr>
                            </table>
                            <table class="ops-tbl">
                                <thead>
                                    <tr t-attf-style="color: {{pc}};">
                                        <th>Branch</th>
                                        <th class="text-right">Income</th>
                                        <th class="text-right">Expense</th>
                                        <th class="text-right">Net Profit</th>
                                        <th class="text-center">BUs</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="branch_data" t-as="br">
                                        <tr>
                                            <td>
                                                <span style="font-weight: 600;"><t t-esc="br.get('branch_name', '')"/></span>
                                                <t t-if="br.get('branch_code')">
                                                    <span style="color: #94a3b8; font-size: 7.5pt; margin-left: 2mm;">
                                                        <t t-esc="br.get('branch_code')"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(br.get('income', 0))"/></td>
                                            <td class="text-right" style="color: #dc2626;">
                                                <t t-esc="'{:,.2f}'.format(br.get('expense', 0))"/>
                                            </td>
                                            <td class="text-right" style="font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(br.get('net_profit', 0))"/>
                                            </td>
                                            <td class="text-center"><t t-esc="br.get('bu_count', 0)"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>

                        <!-- ====== BU BREAKDOWN (if by_bu detail) ====== -->
                        <t t-if="bu_data">
                            <table t-attf-style="width: 100%; margin-top: 4mm; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                <tr>
                                    <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Business Unit Performance</td>
                                    <td style="padding: 2mm 4mm; text-align: right; font-size: 8pt;">
                                        <t t-esc="len(bu_data)"/> units
                                    </td>
                                </tr>
                            </table>
                            <table class="ops-tbl">
                                <thead>
                                    <tr t-attf-style="color: {{pc}};">
                                        <th>Business Unit</th>
                                        <th class="text-right">Income</th>
                                        <th class="text-right">Expense</th>
                                        <th class="text-right">Net Profit</th>
                                        <th class="text-right">Margin %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="bu_data" t-as="bu">
                                        <tr>
                                            <td>
                                                <span style="font-weight: 600;"><t t-esc="bu.get('bu_name', '')"/></span>
                                                <t t-if="bu.get('bu_code')">
                                                    <span style="color: #94a3b8; font-size: 7.5pt; margin-left: 2mm;">
                                                        <t t-esc="bu.get('bu_code')"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(bu.get('income', 0))"/></td>
                                            <td class="text-right" style="color: #dc2626;">
                                                <t t-esc="'{:,.2f}'.format(bu.get('expense', 0))"/>
                                            </td>
                                            <td class="text-right" style="font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(bu.get('net_profit', 0))"/>
                                            </td>
                                            <td class="text-right">
                                                <t t-esc="'{:.1f}'.format(bu.get('profitability_ratio', 0))"/>%
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>

                        <!-- ====== GRAND TOTAL BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-top: 4mm; margin-bottom: 6mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 9pt; font-weight: 700;">
                                    NET PROFIT / (LOSS)
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 12pt; font-weight: 700;">
                                    <t t-esc="currency_name"/>
                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== SIGNATURE BLOCK ====== -->
                        <table style="width: 100%; margin-top: 8mm; margin-bottom: 6mm;">
                            <tr>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Prepared By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Finance Department</div>
                                </td>
                                <td style="width: 10%;"></td>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Approved By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Management</div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FIXED FOOTER ====== -->
                        <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 18mm; padding: 0 12mm;">
                            <table style="width: 100%; border-top: 0.3mm solid #e2e8f0;">
                                <tr>
                                    <td style="padding-top: 2mm; font-size: 7pt; color: #94a3b8;">
                                        <t t-esc="company.name"/> &#x2022; Consolidated P&amp;L
                                        &#x2022; <t t-esc="report_run_id"/>
                                    </td>
                                    <td style="padding-top: 2mm; text-align: right;">
                                        <span t-attf-style="background: {{pc}}; color: {{tc}}; padding: 1mm 3mm; border-radius: 1mm; font-size: 6.5pt; font-weight: 700;">
                                            OPS MATRIX
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ============================================================ -->
    <!-- TEMPLATE 2: BRANCH P&L                                       -->
    <!-- ============================================================ -->

    <template id="report_branch_pl_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="pc" t-value="primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="primary_light or '#e8eaf6'"/>
                <t t-set="pd" t-value="primary_dark or '#3d4a8a'"/>
                <t t-set="bt" t-value="body_text_color or '#1a1a1a'"/>

                <t t-call="ops_matrix_accounting.ops_corporate_pdf_layout">
                    <div style="font-family: Helvetica, Arial, sans-serif; font-size: 9pt; color: #1a1a1a;">

                        <style>
                            table.ops-tbl { width: 100%; border-collapse: collapse; margin-bottom: 4mm; }
                            table.ops-tbl th { padding: 2.5mm 3mm; font-size: 7.5pt; text-transform: uppercase;
                                letter-spacing: 0.5px; border-bottom: 0.5mm solid #cbd5e1; text-align: left; }
                            table.ops-tbl td { padding: 2mm 3mm; font-size: 8.5pt; border-bottom: 0.3mm solid #e2e8f0; }
                            table.ops-tbl tr:last-child td { border-bottom: none; }
                            .text-right { text-align: right; }
                            .text-center { text-align: center; }
                        </style>

                        <!-- ====== HEADER ====== -->
                        <table style="width: 100%; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 60%; vertical-align: top;">
                                    <div t-attf-style="font-size: 14pt; font-weight: 700; color: {{pc}};">
                                        <t t-esc="company.name"/>
                                    </div>
                                    <div style="font-size: 8pt; color: #64748b; margin-top: 1mm;">
                                        <t t-if="company.street"><t t-esc="company.street"/> &#x2022; </t>
                                        <t t-if="company.city"><t t-esc="company.city"/></t>
                                        <t t-if="company.phone"> &#x2022; <t t-esc="company.phone"/></t>
                                    </div>
                                </td>
                                <td style="width: 40%; text-align: right; vertical-align: top;">
                                    <div t-attf-style="display: inline-block; background: {{pl}}; border: 0.3mm solid {{pc}}; border-radius: 2mm; padding: 2mm 4mm;">
                                        <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Report ID</div>
                                        <div t-attf-style="font-size: 9pt; font-weight: 700; color: {{pc}};"><t t-esc="report_run_id"/></div>
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== TITLE BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-bottom: 5mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 13pt; font-weight: 700;">
                                    Branch P&amp;L Report
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 8pt;">
                                    <t t-esc="date_from"/> &#x2014; <t t-esc="date_to"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FILTER SUMMARY ====== -->
                        <table style="width: 100%; margin-bottom: 5mm; font-size: 8pt;">
                            <tr>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                    <strong>Branch:</strong> <t t-esc="branch_name"/>
                                    <t t-if="branch_code"> (<t t-esc="branch_code"/>)</t>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Currency:</strong> <t t-esc="currency_name"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Business Units:</strong> <t t-esc="bu_count"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== KPI SUMMARY ====== -->
                        <table style="width: 100%; border-collapse: separate; border-spacing: 3mm 0; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Total Income</div>
                                                <div style="font-size: 13pt; font-weight: 700; color: #16a34a;">
                                                    <t t-esc="'{:,.2f}'.format(total_income)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Total Expenses</div>
                                                <div style="font-size: 13pt; font-weight: 700; color: #dc2626;">
                                                    <t t-esc="'{:,.2f}'.format(total_expense)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <table t-attf-style="width: 100%; border: 0.3mm solid {{pc}}; border-radius: 2mm; background: {{pl}};">
                                        <tr>
                                            <td style="padding: 3mm; text-align: center;">
                                                <div style="font-size: 7.5pt; color: #64748b; text-transform: uppercase;">Net Profit</div>
                                                <div t-attf-style="font-size: 13pt; font-weight: 700; color: {{pc}};">
                                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== BU PERFORMANCE TABLE ====== -->
                        <t t-if="bu_performance">
                            <table t-attf-style="width: 100%; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                <tr>
                                    <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Business Unit Performance</td>
                                    <td style="padding: 2mm 4mm; text-align: right; font-size: 8pt;">
                                        <t t-esc="len(bu_performance)"/> units
                                    </td>
                                </tr>
                            </table>
                            <table class="ops-tbl">
                                <thead>
                                    <tr t-attf-style="color: {{pc}};">
                                        <th>Business Unit</th>
                                        <th class="text-right">Income</th>
                                        <th class="text-right">Expense</th>
                                        <th class="text-right">Net Profit</th>
                                        <th class="text-right">Margin %</th>
                                        <th class="text-center">Txns</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="bu_performance" t-as="bu">
                                        <tr>
                                            <td>
                                                <span style="font-weight: 600;"><t t-esc="bu.get('bu_name', '')"/></span>
                                                <t t-if="bu.get('bu_code')">
                                                    <span style="color: #94a3b8; font-size: 7.5pt; margin-left: 2mm;">
                                                        <t t-esc="bu.get('bu_code')"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(bu.get('income', 0))"/></td>
                                            <td class="text-right" style="color: #dc2626;">
                                                <t t-esc="'{:,.2f}'.format(bu.get('expense', 0))"/>
                                            </td>
                                            <td class="text-right" style="font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(bu.get('net_profit', 0))"/>
                                            </td>
                                            <td class="text-right">
                                                <t t-esc="'{:.1f}'.format(bu.get('margin', 0))"/>%
                                            </td>
                                            <td class="text-center"><t t-esc="bu.get('transaction_count', 0)"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <table style="width: 100%; margin: 4mm 0;">
                                <tr>
                                    <td style="padding: 4mm; background: #fef3c7; border-left: 1mm solid #d97706; font-size: 8.5pt; color: #92400e;">
                                        No business unit performance data available for the selected period.
                                    </td>
                                </tr>
                            </table>
                        </t>

                        <!-- ====== FINANCIAL SUMMARY ====== -->
                        <table t-attf-style="width: 100%; margin-top: 4mm; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                            <tr>
                                <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Financial Summary</td>
                            </tr>
                        </table>
                        <table class="ops-tbl">
                            <tbody>
                                <tr>
                                    <td style="width: 60%; padding-left: 6mm;">Revenue / Income</td>
                                    <td class="text-right" style="color: #16a34a; font-weight: 600;">
                                        <t t-esc="'{:,.2f}'.format(total_income)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 6mm;">Operating Expenses</td>
                                    <td class="text-right" style="color: #dc2626;">
                                        (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                    </td>
                                </tr>
                                <tr t-attf-style="background: {{pl}}; border-top: 0.5mm solid {{pc}}; border-bottom: 0.5mm solid {{pc}};">
                                    <td style="font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm;">NET PROFIT / (LOSS)</td>
                                    <td t-attf-style="text-align: right; font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm; color: {{pc}};">
                                        <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- ====== GRAND TOTAL BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-top: 4mm; margin-bottom: 6mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 9pt; font-weight: 700;">
                                    NET PROFIT / (LOSS) &#x2014; <t t-esc="branch_name"/>
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 12pt; font-weight: 700;">
                                    <t t-esc="currency_name"/>
                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== SIGNATURE BLOCK ====== -->
                        <table style="width: 100%; margin-top: 8mm; margin-bottom: 6mm;">
                            <tr>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Prepared By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Finance Department</div>
                                </td>
                                <td style="width: 10%;"></td>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Approved By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Management</div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FIXED FOOTER ====== -->
                        <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 18mm; padding: 0 12mm;">
                            <table style="width: 100%; border-top: 0.3mm solid #e2e8f0;">
                                <tr>
                                    <td style="padding-top: 2mm; font-size: 7pt; color: #94a3b8;">
                                        <t t-esc="company.name"/> &#x2022; Branch P&amp;L &#x2022; <t t-esc="branch_name"/>
                                        &#x2022; <t t-esc="report_run_id"/>
                                    </td>
                                    <td style="padding-top: 2mm; text-align: right;">
                                        <span t-attf-style="background: {{pc}}; color: {{tc}}; padding: 1mm 3mm; border-radius: 1mm; font-size: 6.5pt; font-weight: 700;">
                                            OPS MATRIX
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ============================================================ -->
    <!-- TEMPLATE 3: BU PROFITABILITY                                 -->
    <!-- ============================================================ -->

    <template id="report_business_unit_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="pc" t-value="primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="primary_light or '#e8eaf6'"/>
                <t t-set="pd" t-value="primary_dark or '#3d4a8a'"/>
                <t t-set="bt" t-value="body_text_color or '#1a1a1a'"/>

                <t t-call="ops_matrix_accounting.ops_corporate_pdf_layout">
                    <div style="font-family: Helvetica, Arial, sans-serif; font-size: 9pt; color: #1a1a1a;">

                        <style>
                            table.ops-tbl { width: 100%; border-collapse: collapse; margin-bottom: 4mm; }
                            table.ops-tbl th { padding: 2.5mm 3mm; font-size: 7.5pt; text-transform: uppercase;
                                letter-spacing: 0.5px; border-bottom: 0.5mm solid #cbd5e1; text-align: left; }
                            table.ops-tbl td { padding: 2mm 3mm; font-size: 8.5pt; border-bottom: 0.3mm solid #e2e8f0; }
                            table.ops-tbl tr:last-child td { border-bottom: none; }
                            .text-right { text-align: right; }
                            .text-center { text-align: center; }
                        </style>

                        <!-- ====== HEADER ====== -->
                        <table style="width: 100%; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 60%; vertical-align: top;">
                                    <div t-attf-style="font-size: 14pt; font-weight: 700; color: {{pc}};">
                                        <t t-esc="company.name"/>
                                    </div>
                                    <div style="font-size: 8pt; color: #64748b; margin-top: 1mm;">
                                        <t t-if="company.street"><t t-esc="company.street"/> &#x2022; </t>
                                        <t t-if="company.city"><t t-esc="company.city"/></t>
                                        <t t-if="company.phone"> &#x2022; <t t-esc="company.phone"/></t>
                                    </div>
                                </td>
                                <td style="width: 40%; text-align: right; vertical-align: top;">
                                    <div t-attf-style="display: inline-block; background: {{pl}}; border: 0.3mm solid {{pc}}; border-radius: 2mm; padding: 2mm 4mm;">
                                        <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Report ID</div>
                                        <div t-attf-style="font-size: 9pt; font-weight: 700; color: {{pc}};"><t t-esc="report_run_id"/></div>
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== TITLE BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-bottom: 5mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 13pt; font-weight: 700;">
                                    Business Unit Profitability
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 8pt;">
                                    <t t-esc="date_from"/> &#x2014; <t t-esc="date_to"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FILTER SUMMARY ====== -->
                        <table style="width: 100%; margin-bottom: 5mm; font-size: 8pt;">
                            <tr>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                    <strong>Business Unit:</strong> <t t-esc="bu_name"/>
                                    <t t-if="bu_code"> (<t t-esc="bu_code"/>)</t>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Currency:</strong> <t t-esc="currency_name"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Branches:</strong> <t t-esc="branch_count"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== KPI SUMMARY (4-card) ====== -->
                        <table style="width: 100%; border-collapse: separate; border-spacing: 2mm 0; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Income</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #16a34a;">
                                                    <t t-esc="'{:,.0f}'.format(total_income)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Expenses</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #dc2626;">
                                                    <t t-esc="'{:,.0f}'.format(total_expense)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table t-attf-style="width: 100%; border: 0.3mm solid {{pc}}; border-radius: 2mm; background: {{pl}};">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Net Profit</div>
                                                <div t-attf-style="font-size: 11pt; font-weight: 700; color: {{pc}};">
                                                    <t t-esc="'{:,.0f}'.format(net_profit)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Margin</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #1e40af;">
                                                    <t t-esc="'{:.1f}'.format(profit_margin)"/>%
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== BRANCH PERFORMANCE TABLE ====== -->
                        <t t-if="branch_performance">
                            <table t-attf-style="width: 100%; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                <tr>
                                    <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Branch Performance Breakdown</td>
                                    <td style="padding: 2mm 4mm; text-align: right; font-size: 8pt;">
                                        <t t-esc="len(branch_performance)"/> branches
                                    </td>
                                </tr>
                            </table>
                            <table class="ops-tbl">
                                <thead>
                                    <tr t-attf-style="color: {{pc}};">
                                        <th>Branch</th>
                                        <th class="text-right">Income</th>
                                        <th class="text-right">Expense</th>
                                        <th class="text-right">Net Profit</th>
                                        <th class="text-right">Contribution %</th>
                                        <th class="text-center">Txns</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="branch_performance" t-as="br">
                                        <tr>
                                            <td>
                                                <span style="font-weight: 600;"><t t-esc="br.get('branch_name', '')"/></span>
                                                <t t-if="br.get('branch_code')">
                                                    <span style="color: #94a3b8; font-size: 7.5pt; margin-left: 2mm;">
                                                        <t t-esc="br.get('branch_code')"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(br.get('income', 0))"/></td>
                                            <td class="text-right" style="color: #dc2626;">
                                                <t t-esc="'{:,.2f}'.format(br.get('expense', 0))"/>
                                            </td>
                                            <td class="text-right" style="font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(br.get('net_profit', 0))"/>
                                            </td>
                                            <td class="text-right">
                                                <t t-esc="'{:.1f}'.format(br.get('contribution_percentage', 0))"/>%
                                            </td>
                                            <td class="text-center"><t t-esc="br.get('transaction_count', 0)"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <table style="width: 100%; margin: 4mm 0;">
                                <tr>
                                    <td style="padding: 4mm; background: #fef3c7; border-left: 1mm solid #d97706; font-size: 8.5pt; color: #92400e;">
                                        No branch performance data available for the selected period.
                                    </td>
                                </tr>
                            </table>
                        </t>

                        <!-- ====== FINANCIAL SUMMARY ====== -->
                        <table t-attf-style="width: 100%; margin-top: 4mm; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                            <tr>
                                <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Financial Summary</td>
                            </tr>
                        </table>
                        <table class="ops-tbl">
                            <tbody>
                                <tr>
                                    <td style="width: 60%; padding-left: 6mm;">Revenue / Income</td>
                                    <td class="text-right" style="color: #16a34a; font-weight: 600;">
                                        <t t-esc="'{:,.2f}'.format(total_income)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 6mm;">Operating Expenses</td>
                                    <td class="text-right" style="color: #dc2626;">
                                        (<t t-esc="'{:,.2f}'.format(total_expense)"/>)
                                    </td>
                                </tr>
                                <tr t-attf-style="background: {{pl}}; border-top: 0.5mm solid {{pc}}; border-bottom: 0.5mm solid {{pc}};">
                                    <td style="font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm;">NET PROFIT / (LOSS)</td>
                                    <td t-attf-style="text-align: right; font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm; color: {{pc}};">
                                        <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 6mm;">Profit Margin</td>
                                    <td class="text-right" style="font-weight: 600;">
                                        <t t-esc="'{:.1f}'.format(profit_margin)"/>%
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- ====== GRAND TOTAL BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-top: 4mm; margin-bottom: 6mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 9pt; font-weight: 700;">
                                    NET PROFIT / (LOSS) &#x2014; <t t-esc="bu_name"/>
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 12pt; font-weight: 700;">
                                    <t t-esc="currency_name"/>
                                    <t t-esc="'{:,.2f}'.format(net_profit)"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== SIGNATURE BLOCK ====== -->
                        <table style="width: 100%; margin-top: 8mm; margin-bottom: 6mm;">
                            <tr>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Prepared By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Finance Department</div>
                                </td>
                                <td style="width: 10%;"></td>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Approved By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Management</div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FIXED FOOTER ====== -->
                        <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 18mm; padding: 0 12mm;">
                            <table style="width: 100%; border-top: 0.3mm solid #e2e8f0;">
                                <tr>
                                    <td style="padding-top: 2mm; font-size: 7pt; color: #94a3b8;">
                                        <t t-esc="company.name"/> &#x2022; BU Profitability &#x2022; <t t-esc="bu_name"/>
                                        &#x2022; <t t-esc="report_run_id"/>
                                    </td>
                                    <td style="padding-top: 2mm; text-align: right;">
                                        <span t-attf-style="background: {{pc}}; color: {{tc}}; padding: 1mm 3mm; border-radius: 1mm; font-size: 6.5pt; font-weight: 700;">
                                            OPS MATRIX
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- ============================================================ -->
    <!-- TEMPLATE 4: CONSOLIDATED BALANCE SHEET                       -->
    <!-- ============================================================ -->

    <template id="report_consol_balance_sheet">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="pc" t-value="primary_color or '#5B6BBB'"/>
                <t t-set="tc" t-value="text_on_primary or '#FFFFFF'"/>
                <t t-set="pl" t-value="primary_light or '#e8eaf6'"/>
                <t t-set="pd" t-value="primary_dark or '#3d4a8a'"/>
                <t t-set="bt" t-value="body_text_color or '#1a1a1a'"/>
                <t t-set="total_le" t-value="total_liabilities + total_equity"/>
                <t t-set="balance_diff" t-value="total_assets - total_le"/>

                <t t-call="ops_matrix_accounting.ops_corporate_pdf_layout">
                    <div style="font-family: Helvetica, Arial, sans-serif; font-size: 9pt; color: #1a1a1a;">

                        <style>
                            table.ops-tbl { width: 100%; border-collapse: collapse; margin-bottom: 4mm; }
                            table.ops-tbl th { padding: 2.5mm 3mm; font-size: 7.5pt; text-transform: uppercase;
                                letter-spacing: 0.5px; border-bottom: 0.5mm solid #cbd5e1; text-align: left; }
                            table.ops-tbl td { padding: 2mm 3mm; font-size: 8.5pt; border-bottom: 0.3mm solid #e2e8f0; }
                            table.ops-tbl tr:last-child td { border-bottom: none; }
                            .text-right { text-align: right; }
                            .text-center { text-align: center; }
                        </style>

                        <!-- ====== HEADER ====== -->
                        <table style="width: 100%; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 60%; vertical-align: top;">
                                    <div t-attf-style="font-size: 14pt; font-weight: 700; color: {{pc}};">
                                        <t t-esc="company.name"/>
                                    </div>
                                    <div style="font-size: 8pt; color: #64748b; margin-top: 1mm;">
                                        <t t-if="company.street"><t t-esc="company.street"/> &#x2022; </t>
                                        <t t-if="company.city"><t t-esc="company.city"/></t>
                                        <t t-if="company.phone"> &#x2022; <t t-esc="company.phone"/></t>
                                    </div>
                                </td>
                                <td style="width: 40%; text-align: right; vertical-align: top;">
                                    <div t-attf-style="display: inline-block; background: {{pl}}; border: 0.3mm solid {{pc}}; border-radius: 2mm; padding: 2mm 4mm;">
                                        <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Report ID</div>
                                        <div t-attf-style="font-size: 9pt; font-weight: 700; color: {{pc}};"><t t-esc="report_run_id"/></div>
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== TITLE BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-bottom: 5mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 13pt; font-weight: 700;">
                                    Consolidated Balance Sheet
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 8pt;">
                                    As of <t t-esc="as_of_date"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FILTER SUMMARY ====== -->
                        <table style="width: 100%; margin-bottom: 5mm; font-size: 8pt;">
                            <tr>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                                    <strong>Currency:</strong> <t t-esc="currency_name"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Companies:</strong> <t t-esc="company_names"/>
                                </td>
                                <td t-attf-style="padding: 2mm 3mm; background: {{pl}};">
                                    <strong>Entities:</strong> <t t-esc="company_count"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== KPI SUMMARY ====== -->
                        <table style="width: 100%; border-collapse: separate; border-spacing: 2mm 0; margin-bottom: 5mm;">
                            <tr>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Total Assets</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #1e40af;">
                                                    <t t-esc="'{:,.0f}'.format(total_assets)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Liabilities</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #dc2626;">
                                                    <t t-esc="'{:,.0f}'.format(total_liabilities)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table style="width: 100%; border: 0.3mm solid #e2e8f0; border-radius: 2mm;">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Equity</div>
                                                <div style="font-size: 11pt; font-weight: 700; color: #16a34a;">
                                                    <t t-esc="'{:,.0f}'.format(total_equity)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 25%; vertical-align: top;">
                                    <table t-attf-style="width: 100%; border: 0.3mm solid {{pc}}; border-radius: 2mm; background: {{pl}};">
                                        <tr>
                                            <td style="padding: 2.5mm; text-align: center;">
                                                <div style="font-size: 7pt; color: #64748b; text-transform: uppercase;">Balance Check</div>
                                                <div t-attf-style="font-size: 11pt; font-weight: 700; color: {{pc}};">
                                                    <t t-if="abs(balance_diff) &lt; 0.01">&#x2713;</t>
                                                    <t t-else=""><t t-esc="'{:,.0f}'.format(balance_diff)"/></t>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== ASSETS SECTION ====== -->
                        <table t-attf-style="width: 100%; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                            <tr>
                                <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Assets</td>
                                <td style="padding: 2mm 4mm; text-align: right; font-size: 9pt; font-weight: 600;">
                                    <t t-esc="'{:,.2f}'.format(total_assets)"/>
                                </td>
                            </tr>
                        </table>

                        <!-- Per-Company Assets Breakdown -->
                        <t t-if="companies_data">
                            <table class="ops-tbl">
                                <thead>
                                    <tr t-attf-style="color: {{pc}};">
                                        <th>Company</th>
                                        <th class="text-right">Assets</th>
                                        <th class="text-right">Liabilities</th>
                                        <th class="text-right">Equity</th>
                                        <th class="text-right">Net Income</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="companies_data" t-as="co">
                                        <tr>
                                            <td>
                                                <span style="font-weight: 600;"><t t-esc="co.get('company_name', '')"/></span>
                                                <t t-if="co.get('company_code')">
                                                    <span style="color: #94a3b8; font-size: 7.5pt; margin-left: 2mm;">
                                                        <t t-esc="co.get('company_code')"/>
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(co.get('assets', 0))"/></td>
                                            <td class="text-right" style="color: #dc2626;">
                                                <t t-esc="'{:,.2f}'.format(co.get('liabilities', 0))"/>
                                            </td>
                                            <td class="text-right"><t t-esc="'{:,.2f}'.format(co.get('equity', 0))"/></td>
                                            <td class="text-right" style="font-weight: 600;">
                                                <t t-esc="'{:,.2f}'.format(co.get('net_income', 0))"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>

                        <!-- ====== ELIMINATIONS (if applicable) ====== -->
                        <t t-if="eliminations and (eliminations.get('asset_eliminations', 0) != 0 or eliminations.get('liability_eliminations', 0) != 0)">
                            <table style="width: 100%; margin: 3mm 0;">
                                <tr>
                                    <td style="padding: 3mm; background: #fef3c7; border-left: 1mm solid #d97706; font-size: 8.5pt;">
                                        <strong>Intercompany Eliminations:</strong>
                                        Assets: <t t-esc="'{:,.2f}'.format(eliminations.get('asset_eliminations', 0))"/>
                                        &#x2022;
                                        Liabilities: <t t-esc="'{:,.2f}'.format(eliminations.get('liability_eliminations', 0))"/>
                                    </td>
                                </tr>
                            </table>
                        </t>

                        <!-- ====== BALANCE EQUATION ====== -->
                        <table t-attf-style="width: 100%; margin-top: 4mm; margin-bottom: 2mm; background: {{pl}}; border-left: 1mm solid {{pc}};">
                            <tr>
                                <td style="padding: 2mm 4mm; font-size: 9pt; font-weight: 700;">Statement of Financial Position</td>
                            </tr>
                        </table>
                        <table class="ops-tbl">
                            <tbody>
                                <tr>
                                    <td style="width: 60%; font-weight: 600;">Total Assets</td>
                                    <td class="text-right" style="font-weight: 600; color: #1e40af;">
                                        <t t-esc="'{:,.2f}'.format(total_assets)"/>
                                    </td>
                                </tr>
                                <tr style="border-top: 0.5mm solid #cbd5e1;">
                                    <td style="padding-left: 6mm;">Total Liabilities</td>
                                    <td class="text-right" style="color: #dc2626;">
                                        <t t-esc="'{:,.2f}'.format(total_liabilities)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 6mm;">Total Shareholders' Equity</td>
                                    <td class="text-right" style="color: #16a34a;">
                                        <t t-esc="'{:,.2f}'.format(total_equity)"/>
                                    </td>
                                </tr>
                                <tr t-attf-style="background: {{pl}}; border-top: 0.5mm solid {{pc}}; border-bottom: 0.5mm solid {{pc}};">
                                    <td style="font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm;">TOTAL LIABILITIES + EQUITY</td>
                                    <td t-attf-style="text-align: right; font-weight: 700; font-size: 9.5pt; padding: 2.5mm 3mm; color: {{pc}};">
                                        <t t-esc="'{:,.2f}'.format(total_le)"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- ====== GRAND TOTAL BAR ====== -->
                        <table t-attf-style="width: 100%; background: {{pc}}; margin-top: 4mm; margin-bottom: 6mm;">
                            <tr>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; font-size: 9pt; font-weight: 700;">
                                    TOTAL ASSETS
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: center; font-size: 8pt;">
                                    A = L + E &#x2022;
                                    <t t-if="abs(balance_diff) &lt; 0.01">
                                        &#x2713; Balanced
                                    </t>
                                    <t t-else="">
                                        Variance: <t t-esc="'{:,.2f}'.format(balance_diff)"/>
                                    </t>
                                </td>
                                <td t-attf-style="padding: 3mm 5mm; color: {{tc}}; text-align: right; font-size: 12pt; font-weight: 700;">
                                    <t t-esc="currency_name"/>
                                    <t t-esc="'{:,.2f}'.format(total_assets)"/>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== SIGNATURE BLOCK ====== -->
                        <table style="width: 100%; margin-top: 8mm; margin-bottom: 6mm;">
                            <tr>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Prepared By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Finance Department</div>
                                </td>
                                <td style="width: 10%;"></td>
                                <td style="width: 45%; border-top: 0.3mm solid #cbd5e1; padding-top: 2mm; text-align: center;">
                                    <div style="font-size: 8pt; font-weight: 600;">Approved By</div>
                                    <div style="font-size: 7.5pt; color: #64748b;">Management</div>
                                </td>
                            </tr>
                        </table>

                        <!-- ====== FIXED FOOTER ====== -->
                        <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 18mm; padding: 0 12mm;">
                            <table style="width: 100%; border-top: 0.3mm solid #e2e8f0;">
                                <tr>
                                    <td style="padding-top: 2mm; font-size: 7pt; color: #94a3b8;">
                                        <t t-esc="company.name"/> &#x2022; Consolidated Balance Sheet
                                        &#x2022; <t t-esc="report_run_id"/>
                                    </td>
                                    <td style="padding-top: 2mm; text-align: right;">
                                        <span t-attf-style="background: {{pc}}; color: {{tc}}; padding: 1mm 3mm; border-radius: 1mm; font-size: 6.5pt; font-weight: 700;">
                                            OPS MATRIX
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>
