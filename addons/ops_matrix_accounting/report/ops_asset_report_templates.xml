<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        ================================================================
        OPS CORPORATE ASSET REPORTS
        Phase 4B: Corporate Report Template Redesign
        ================================================================

        DESIGN: Corporate branding with shared components
        REPORTS: Asset Register, Depreciation Schedule
        PILLAR: Asset Intelligence

        SHARED COMPONENTS USED:
        - report_corporate_header (logo, company info, meta)
        - report_corporate_title (title, pillar, period)
        - report_filter_bar (scope, filters, status)
        - section_header_asset (green accent for asset sections)
        - report_corporate_footer (OPS badge, page numbers)
    -->

    <!-- ================================================================
         ASSET REGISTER REPORT
         ================================================================ -->

    <template id="report_asset_register_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Fixed Asset Register'"/>
                        <t t-set="report_pillar" t-value="'Asset Intelligence'"/>
                        <t t-set="date_end" t-value="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- KPI Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #2563eb; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Original Value</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #1e293b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('total_original', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #dc2626; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Accum. Depreciation</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('total_depreciation', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #16a34a; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Net Book Value</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #16a34a; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('total_book_value', 0))"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Asset Register Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Code</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Description</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Category</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Acquisition</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Original Value</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Accum. Dep.</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Book Value</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('assets', [])" t-as="asset">
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                        <t t-esc="asset.get('code', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #475569;">
                                        <t t-esc="asset.get('name', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #64748b;">
                                        <t t-esc="asset.get('category', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #64748b;">
                                        <t t-esc="asset.get('acquisition_date', '-')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #1e293b;">
                                        <t t-esc="'{:,.2f}'.format(asset.get('original_value', 0))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #dc2626;">
                                        (<t t-esc="'{:,.2f}'.format(asset.get('accumulated_depreciation', 0))"/>)
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace;">
                                        <t t-set="bv" t-value="asset.get('book_value', 0)"/>
                                        <span t-attf-style="font-weight: 600; color: #{bv > 0 and '#16a34a' or bv &lt; 0 and '#dc2626' or '#94a3b8'};">
                                            <t t-if="bv &lt; 0">
                                                (<t t-esc="'{:,.2f}'.format(abs(bv))"/>)
                                            </t>
                                            <t t-elif="bv == 0">-</t>
                                            <t t-else="">
                                                <t t-esc="'{:,.2f}'.format(bv)"/>
                                            </t>
                                        </span>
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px;">
                                        <t t-set="status" t-value="asset.get('state', 'draft')"/>
                                        <span t-attf-style="display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 8px; font-weight: 600; color: #ffffff; background-color: #{status == 'running' and '#16a34a' or status == 'close' and '#94a3b8' or '#d97706'};">
                                            <t t-esc="status.title()"/>
                                        </span>
                                    </td>
                                </tr>
                            </t>

                            <!-- Empty State -->
                            <t t-if="not data.get('assets')">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 20px; color: #94a3b8; font-style: italic;">
                                        No assets found matching the criteria
                                    </td>
                                </tr>
                            </t>
                        </tbody>

                        <!-- Totals -->
                        <tfoot t-if="data.get('assets')">
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td colspan="4" style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #1e293b;">TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('total_original', 0))"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    (<t t-esc="'{:,.2f}'.format(data.get('total_depreciation', 0))"/>)
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #16a34a; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('total_book_value', 0))"/>
                                </td>
                                <td style="text-align: center; padding: 10px 8px; color: #64748b; font-size: 8px;">
                                    <t t-esc="len(data.get('assets', []))"/> assets
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #16a34a; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Asset Register
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Book value = Original Value - Accumulated Depreciation</li>
                            <li>All values shown in company currency (<t t-esc="company.currency_id.name"/>)</li>
                            <li>Status indicators: Running (active), Close (fully depreciated), Draft (pending)</li>
                            <li>Acquisition date represents the in-service date of the asset</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         DEPRECIATION SCHEDULE REPORT
         ================================================================ -->

    <template id="report_depreciation_schedule_document_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'Depreciation Schedule'"/>
                        <t t-set="report_pillar" t-value="'Asset Intelligence'"/>
                        <t t-set="date_from" t-value="data.get('date_from')"/>
                        <t t-set="date_to" t-value="data.get('date_to')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: separate; border-spacing: 10px 0;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #2563eb; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Opening Value</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #1e293b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('total_opening', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #dc2626; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Period Depreciation</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace;">
                                            (<t t-esc="'{:,.2f}'.format(data.get('total_depreciation', 0))"/>)
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-top: 3px solid #16a34a; border-radius: 4px; padding: 12px; text-align: center;">
                                        <div style="font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Closing Value</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #16a34a; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.2f}'.format(data.get('total_closing', 0))"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Depreciation Schedule Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Asset</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Category</th>
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Period</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Opening Value</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Depreciation</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Closing Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('depreciation_lines', [])" t-as="line">
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                        <t t-esc="line.get('asset_name', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #64748b;">
                                        <t t-esc="line.get('category', '-')"/>
                                    </td>
                                    <td style="padding: 6px 8px; color: #64748b;">
                                        <t t-esc="line.get('period', '-')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #1e293b;">
                                        <t t-esc="'{:,.2f}'.format(line.get('opening_value', 0))"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #dc2626;">
                                        (<t t-esc="'{:,.2f}'.format(line.get('depreciation_amount', 0))"/>)
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: #16a34a;">
                                        <t t-esc="'{:,.2f}'.format(line.get('closing_value', 0))"/>
                                    </td>
                                </tr>
                            </t>

                            <!-- Empty State -->
                            <t t-if="not data.get('depreciation_lines')">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px; color: #94a3b8; font-style: italic;">
                                        No depreciation entries found for the selected period
                                    </td>
                                </tr>
                            </t>
                        </tbody>

                        <!-- Totals -->
                        <tfoot t-if="data.get('depreciation_lines')">
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td colspan="3" style="padding: 10px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #1e293b;">TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('total_opening', 0))"/>
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #dc2626; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    (<t t-esc="'{:,.2f}'.format(data.get('total_depreciation', 0))"/>)
                                </td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; color: #16a34a; font-family: Consolas, Monaco, monospace; font-size: 10px;">
                                    <t t-esc="'{:,.2f}'.format(data.get('total_closing', 0))"/>
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #16a34a; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                            Notes to Depreciation Schedule
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Depreciation amounts shown are for the selected period only</li>
                            <li>Closing value = Opening value - Period depreciation</li>
                            <li>All values in company currency (<t t-esc="company.currency_id.name"/>)</li>
                            <li>Depreciation calculated per asset category method (straight-line, declining balance, etc.)</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <!-- ================================================================
         REPORT ACTIONS
         ================================================================ -->

    <!-- Asset Register Report PDF -->
    <record id="report_asset_register_pdf" model="ir.actions.report">
        <field name="name">Asset Register Report (Corporate)</field>
        <field name="model">ops.asset.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_asset_register_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_asset_register_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_asset_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Depreciation Schedule Report PDF -->
    <record id="report_depreciation_schedule_pdf" model="ir.actions.report">
        <field name="name">Depreciation Schedule Report (Corporate)</field>
        <field name="model">ops.asset.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_depreciation_schedule_document_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_depreciation_schedule_document_corporate</field>
        <field name="binding_model_id" ref="model_ops_asset_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- ================================================================
         EXCEL EXPORTS (Phase 5 - Corporate Design System)
         ================================================================
         NOTE: XLSX report records temporarily disabled
         Excel export now handled inline in wizard action_export_to_excel()
         using xlsxwriter directly (no dependency on report_xlsx module)
         ================================================================ -->

    <!-- Asset Intelligence XLSX Report -->
    <!--
    <record id="report_asset_xlsx" model="ir.actions.report">
        <field name="name">Asset Intelligence Report (Excel)</field>
        <field name="model">ops.asset.report.wizard</field>
        <field name="report_type">xlsx</field>
        <field name="report_name">ops_matrix_accounting.report_asset_xlsx</field>
        <field name="report_file">ops_matrix_accounting.report_asset_xlsx</field>
        <field name="binding_model_id" ref="model_ops_asset_report_wizard"/>
        <field name="binding_type">report</field>
    </record>
    -->

</odoo>
