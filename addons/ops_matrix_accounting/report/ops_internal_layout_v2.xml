<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ================================================================
         OPS INTERNAL REPORT LAYOUT V2

         Key Design Decisions:
         1. Inline styles required for wkhtmltopdf (doesn't load CSS bundles)
         2. Components via t-call for structure reuse
         3. All color references use company.ops_primary_color
         4. Data comes from wizard record: doc._get_report_data()
         5. Tables used for layout (CSS2.1 compatible with wkhtmltopdf)
         ================================================================ -->

    <!--
    ================================================================
    PDF STYLES (inline for wkhtmltopdf compatibility)
    ================================================================
    -->
    <template id="ops_internal_styles_v2">
        <style>
            /* Base Reset */
            @page {
                size: A4;
                margin: 15mm 12mm;
            }

            * {
                box-sizing: border-box;
            }

            body, .ops-report-v2 {
                font-family: 'Inter', 'Segoe UI', -apple-system, Arial, Helvetica, sans-serif;
                font-size: 8.5pt;
                color: #1a1a1a;
                line-height: 1.45;
                margin: 0;
                padding: 0;
            }

            /* Typography */
            .ops-report-v2 h1 { font-size: 16pt; font-weight: 700; margin: 0 0 4px 0; }
            .ops-report-v2 h2 { font-size: 12pt; font-weight: 600; margin: 0; }
            .ops-report-v2 h3 { font-size: 9pt; font-weight: 600; margin: 0; }

            /* Header */
            .ops-header-v2 {
                padding-bottom: 10px;
                margin-bottom: 15px;
                border-bottom: 2px solid #5B6BBB;
            }

            .ops-header-v2 .company-logo {
                width: 45px;
                height: 45px;
                border-radius: 6px;
                object-fit: contain;
            }

            .ops-header-v2 .company-initials {
                width: 45px;
                height: 45px;
                border-radius: 6px;
                display: inline-block;
                text-align: center;
                line-height: 45px;
                font-weight: 700;
                font-size: 16pt;
                color: white;
            }

            .ops-header-v2 .company-name {
                font-size: 14pt;
                font-weight: 700;
                color: #1e293b;
            }

            .ops-header-v2 .company-location {
                font-size: 8pt;
                color: #64748b;
            }

            .ops-header-v2 .print-date {
                font-size: 8pt;
                color: #64748b;
                text-align: right;
            }

            /* Title Block */
            .ops-title-block-v2 {
                text-align: center;
                margin-bottom: 15px;
            }

            .ops-title-block-v2 .report-title {
                font-size: 16pt;
                font-weight: 700;
                color: #1e293b;
            }

            .ops-title-block-v2 .report-subtitle {
                font-size: 9pt;
                color: #64748b;
                margin-top: 2px;
            }

            /* Filter Bar */
            .ops-filter-bar-v2 {
                padding: 8px 12px;
                background: #f8fafc;
                border-radius: 4px;
                margin-bottom: 15px;
                font-size: 7.5pt;
            }

            .ops-filter-bar-v2 .filter-label {
                color: #64748b;
                text-transform: uppercase;
                letter-spacing: 0.3px;
            }

            .ops-filter-bar-v2 .filter-value {
                font-weight: 600;
                color: #1e293b;
            }

            /* KPI Cards (table-based for wkhtmltopdf) */
            .ops-kpi-table-v2 {
                width: 100%;
                border-collapse: separate;
                border-spacing: 10px 0;
                margin-bottom: 20px;
            }

            .ops-kpi-cell-v2 {
                padding: 12px 15px;
                border-radius: 6px;
                text-align: center;
                vertical-align: top;
            }

            .ops-kpi-cell-v2.success { background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; }
            .ops-kpi-cell-v2.warning { background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b; }
            .ops-kpi-cell-v2.info { background: rgba(139, 92, 246, 0.1); border-left: 4px solid #8b5cf6; }
            .ops-kpi-cell-v2.primary { background: rgba(91, 107, 187, 0.1); border-left: 4px solid #5B6BBB; }

            .ops-kpi-cell-v2 .kpi-label {
                font-size: 7pt;
                text-transform: uppercase;
                letter-spacing: 0.3px;
                color: #64748b;
                margin-bottom: 4px;
            }

            .ops-kpi-cell-v2 .kpi-value {
                font-size: 14pt;
                font-weight: 700;
                color: #1e293b;
                font-family: Consolas, Monaco, monospace;
            }

            /* Section Headers */
            .ops-section-header-v2 {
                padding: 8px 12px;
                margin: 15px 0 8px 0;
                border-radius: 4px;
                font-weight: 600;
                font-size: 9pt;
            }

            .ops-section-header-v2.asset { background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; color: #065f46; }
            .ops-section-header-v2.liability { background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b; color: #92400e; }
            .ops-section-header-v2.equity { background: rgba(139, 92, 246, 0.1); border-left: 4px solid #8b5cf6; color: #5b21b6; }
            .ops-section-header-v2.revenue { background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; color: #065f46; }
            .ops-section-header-v2.expense { background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; color: #991b1b; }
            .ops-section-header-v2.default { background: rgba(91, 107, 187, 0.1); border-left: 4px solid #5B6BBB; color: #1e3a5f; }

            /* Tables */
            .ops-table-v2 {
                width: 100%;
                border-collapse: collapse;
                font-size: 8.5pt;
                margin-bottom: 10px;
            }

            .ops-table-v2 thead th {
                padding: 8px 10px;
                text-align: left;
                font-weight: 600;
                font-size: 7.5pt;
                text-transform: uppercase;
                letter-spacing: 0.3px;
                color: #64748b;
                border-bottom: 2px solid #1e293b;
                background-color: #f8fafc;
            }

            .ops-table-v2 thead th.num { text-align: right; }

            .ops-table-v2 tbody td {
                padding: 6px 10px;
                vertical-align: top;
                border-bottom: 1px solid #f1f5f9;
            }

            .ops-table-v2 tbody tr:nth-child(even) { background: #f8fafc; }

            .ops-table-v2 .account-code {
                font-family: Consolas, Monaco, monospace;
                font-size: 8pt;
                color: #64748b;
            }

            .ops-table-v2 .num {
                text-align: right;
                font-family: Consolas, Monaco, monospace;
                font-variant-numeric: tabular-nums;
            }

            .ops-table-v2 .positive { color: #16a34a; }
            .ops-table-v2 .negative { color: #dc2626; }
            .ops-table-v2 .zero { color: #94a3b8; }

            /* Subtotal Row */
            .ops-table-v2 .subtotal-row {
                background: #f1f5f9 !important;
                font-weight: 600;
            }

            .ops-table-v2 .subtotal-row td {
                padding-top: 8px;
                padding-bottom: 8px;
                border-top: 2px solid #1e293b;
            }

            /* Group/Hierarchy rows */
            .ops-table-v2 .group-row { background-color: #fafafa; }
            .ops-table-v2 .group-row td { font-weight: 600; }

            /* Grand Total */
            .ops-grand-total-v2 {
                margin-top: 20px;
                padding: 12px 15px;
                border-radius: 4px;
                border-left: 4px solid #1e293b;
                background-color: #f1f5f9;
            }

            /* Footer */
            .ops-footer-v2 {
                margin-top: 25px;
                padding-top: 12px;
                border-top: 1px solid #e2e8f0;
            }

            .ops-footer-v2 .ops-badge {
                background: linear-gradient(135deg, #3b82f6, #1e40af);
                color: white;
                padding: 3px 8px;
                border-radius: 4px;
                font-weight: 600;
                font-size: 7pt;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            /* Notes Section */
            .ops-notes-v2 {
                margin-top: 15px;
                padding: 10px 12px;
                background: #f8fafc;
                border-left: 3px solid #5B6BBB;
                border-radius: 0 4px 4px 0;
                font-size: 7.5pt;
                color: #64748b;
            }

            .ops-notes-v2 strong {
                color: #1e293b;
            }

            /* Balance Badge */
            .ops-balance-badge-v2 {
                display: inline-block;
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 7pt;
                font-weight: 600;
                text-transform: uppercase;
            }

            .ops-balance-badge-v2.balanced {
                background: rgba(16, 185, 129, 0.1);
                color: #065f46;
            }

            .ops-balance-badge-v2.unbalanced {
                background: rgba(239, 68, 68, 0.1);
                color: #991b1b;
            }
        </style>
    </template>

    <!--
    ================================================================
    MAIN LAYOUT TEMPLATE

    Usage in report template:
        <t t-call="ops_matrix_accounting.ops_internal_layout_v2">
            <t t-set="report_title" t-value="'Balance Sheet'"/>
            <t t-set="report_subtitle" t-value="'As of ...'"/>
            <t t-set="company" t-value="doc.company_id or env.company"/>
            ... report content (passed as body via t-out="0") ...
        </t>

    Note: 'doc' is a wizard record; data comes from doc._get_report_data()
    ================================================================
    -->
    <template id="ops_internal_layout_v2">
        <t t-set="company" t-value="company or env.company"/>
        <t t-set="primary_color" t-value="company.ops_primary_color or '#5B6BBB'"/>

        <div class="ops-report-v2">
            <!-- Inline Styles for wkhtmltopdf -->
            <t t-call="ops_matrix_accounting.ops_internal_styles_v2"/>

            <!-- Top Accent Bar -->
            <div t-attf-style="height: 4px; background-color: #{primary_color}; margin-bottom: 0;"/>

            <!-- Header (table-based for wkhtmltopdf) -->
            <table width="100%" style="border-collapse: collapse; margin-top: 15px; margin-bottom: 10px;">
                <tr>
                    <td style="vertical-align: top; width: 60%;">
                        <table style="border-collapse: collapse;">
                            <tr>
                                <t t-if="company.logo">
                                    <td style="vertical-align: middle; padding-right: 15px;">
                                        <img t-att-src="image_data_uri(company.logo)"
                                             style="max-height: 50px; max-width: 120px;"
                                             alt="Company Logo"/>
                                    </td>
                                </t>
                                <t t-else="">
                                    <td style="vertical-align: middle; padding-right: 15px;">
                                        <div class="company-initials" t-attf-style="background: #{primary_color}; width: 45px; height: 45px; border-radius: 6px; display: inline-block; text-align: center; line-height: 45px; font-weight: 700; font-size: 16pt; color: white;">
                                            <t t-esc="company.name[:2].upper()"/>
                                        </div>
                                    </td>
                                </t>
                                <td style="vertical-align: middle;">
                                    <div style="font-size: 14pt; font-weight: 700; color: #1e293b;">
                                        <t t-esc="company.name"/>
                                    </div>
                                    <div style="font-size: 8pt; color: #64748b;">
                                        <t t-esc="company.city or ''"/>
                                        <t t-if="company.country_id">, <t t-esc="company.country_id.name"/></t>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td style="vertical-align: top; width: 40%; text-align: right;">
                        <div style="font-size: 8pt; color: #64748b;">
                            Printed: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%b %d, %Y %H:%M')"/>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- Title -->
            <div class="ops-title-block-v2">
                <div class="report-title"><t t-esc="report_title or 'Report'"/></div>
                <div class="report-subtitle" t-if="report_subtitle"><t t-esc="report_subtitle"/></div>
            </div>

            <!-- Filter Bar (table-based) -->
            <t t-if="filter_items">
                <table class="ops-filter-bar-v2" width="100%" style="border-collapse: collapse; padding: 8px 12px; background: #f8fafc; border-radius: 4px; margin-bottom: 15px; font-size: 7.5pt;">
                    <tr>
                        <t t-foreach="filter_items" t-as="item">
                            <td style="padding: 4px 12px;">
                                <span class="filter-label"><t t-esc="item[0]"/>: </span>
                                <span class="filter-value"><t t-esc="item[1]"/></span>
                            </td>
                        </t>
                    </tr>
                </table>
            </t>

            <!-- Content Slot -->
            <div class="ops-content">
                <t t-out="0"/>
            </div>

            <!-- Footer (table-based) -->
            <table width="100%" style="border-collapse: collapse; margin-top: 25px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                <tr>
                    <td style="vertical-align: middle;">
                        <span style="font-size: 8pt; color: #64748b;">Powered by </span>
                        <span class="ops-badge" style="background: linear-gradient(135deg, #3b82f6, #1e40af); color: white; padding: 3px 8px; border-radius: 4px; font-weight: 600; font-size: 7pt; text-transform: uppercase; letter-spacing: 0.5px;">OPS Framework</span>
                    </td>
                    <td style="text-align: right; vertical-align: middle;">
                        <span style="font-size: 8pt; color: #64748b;">
                            Page <span class="page"/> of <span class="topage"/>
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <!--
    ================================================================
    HELPER COMPONENTS (called via t-call from report templates)
    ================================================================
    -->

    <!-- Section Header -->
    <template id="ops_section_header_v2">
        <!-- Usage: t-call with t-set: title, section_type (asset/liability/equity/revenue/expense/default) -->
        <div t-attf-class="ops-section-header-v2 #{section_type or 'default'}">
            <t t-esc="title"/>
        </div>
    </template>

    <!-- Grand Total Row -->
    <template id="ops_grand_total_v2">
        <!-- Usage: t-call with t-set: label, amount, total_color -->
        <div class="ops-grand-total-v2">
            <table width="100%" style="border-collapse: collapse;">
                <tr>
                    <td style="width: 70%; vertical-align: middle;">
                        <div style="font-size: 14px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                            <t t-esc="label"/>
                        </div>
                        <div t-if="subtitle" style="font-size: 9px; color: #64748b; margin-top: 3px;">
                            <t t-esc="subtitle"/>
                        </div>
                    </td>
                    <td style="width: 30%; text-align: right; vertical-align: middle;">
                        <div t-attf-style="font-family: Consolas, Monaco, monospace; font-size: 20px; font-weight: 700; color: #{total_color or '#1e293b'};">
                            <t t-esc="'{:,.2f}'.format(amount or 0)"/>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <!-- Balance Badge -->
    <template id="ops_balance_badge_v2">
        <!-- Usage: t-call with t-set: check_diff -->
        <t t-set="is_balanced" t-value="(check_diff or 0) &lt; 0.01"/>
        <div style="text-align: center; margin: 10px 0;">
            <t t-if="is_balanced">
                <span class="ops-balance-badge-v2 balanced" style="background: rgba(16, 185, 129, 0.1); color: #065f46; padding: 4px 10px; border-radius: 4px; font-size: 7pt; font-weight: 600;">
                    &#x2713; BALANCED
                </span>
            </t>
            <t t-else="">
                <span class="ops-balance-badge-v2 unbalanced" style="background: rgba(239, 68, 68, 0.1); color: #991b1b; padding: 4px 10px; border-radius: 4px; font-size: 7pt; font-weight: 600;">
                    &#x26A0; UNBALANCED (Diff: <t t-esc="'{:,.2f}'.format(check_diff or 0)"/>)
                </span>
            </t>
        </div>
    </template>

    <!-- Notes Section -->
    <template id="ops_notes_section_v2">
        <!-- Usage: t-call with t-set: notes_items (list) or notes_text (string) -->
        <div class="ops-notes-v2" style="margin-top: 15px; padding: 10px 12px; background: #f8fafc; border-left: 3px solid #5B6BBB; border-radius: 0 4px 4px 0; font-size: 7.5pt; color: #64748b;">
            <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 4px;">Notes</div>
            <t t-if="notes_items">
                <ul style="margin: 0; padding-left: 20px;">
                    <t t-foreach="notes_items" t-as="note">
                        <li><t t-esc="note"/></li>
                    </t>
                </ul>
            </t>
            <t t-if="notes_text">
                <t t-esc="notes_text"/>
            </t>
        </div>
    </template>

    <!-- Amount Formatter Helper -->
    <template id="ops_format_amount_v2">
        <!-- Usage: t-call with t-set: amount_val -->
        <t t-if="amount_val == 0">
            <span style="color: #94a3b8;">-</span>
        </t>
        <t t-elif="amount_val &lt; 0">
            <span style="color: #dc2626;">(<t t-esc="'{:,.2f}'.format(abs(amount_val))"/>)</span>
        </t>
        <t t-else="">
            <t t-esc="'{:,.2f}'.format(amount_val or 0)"/>
        </t>
    </template>

</odoo>
