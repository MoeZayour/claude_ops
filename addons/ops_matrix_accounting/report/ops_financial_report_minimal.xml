<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        OPS Financial Reports - MINIMAL DESIGN
        ======================================
        Design Philosophy: Invisible Design - Data Speaks

        Reports covered:
        - Balance Sheet (bs)
        - Profit & Loss (pl)
        - Trial Balance (tb)
        - Cash Flow (cf)

        Features:
        - No decorative elements
        - Typography creates hierarchy
        - One dynamic accent: Company's primary color
        - Color = Meaning only: Black for normal, Red for negatives
    -->

    <!-- Main Minimal Financial Report Template -->
    <template id="report_ops_financial_minimal">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="ops_matrix_accounting.ops_minimal_report_styles"/>

                <!-- Safe defaults for data -->
                <t t-set="data" t-value="report_data or {}"/>

                <!-- Extract report data -->
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="company_name" t-value="data.get('company', company.name)"/>
                <t t-set="report_title" t-value="data.get('title', 'Financial Report')"/>
                <t t-set="currency" t-value="data.get('currency_symbol', company.currency_id.symbol)"/>
                <t t-set="date_from" t-value="data.get('date_from', '')"/>
                <t t-set="date_to" t-value="data.get('date_to', '')"/>
                <t t-set="target_move" t-value="data.get('target_move', 'Posted')"/>
                <t t-set="primary_color" t-value="company.primary_color or '#C9A962'"/>

                <div class="ops-report" style="padding: 20px;">

                    <!-- HEADER -->
                    <h1 class="ops-title"><t t-esc="report_title"/></h1>
                    <div class="ops-subtitle"><t t-esc="company_name"/></div>
                    <div class="ops-accent-line" t-attf-style="background-color: #{primary_color};"/>

                    <!-- META INFO -->
                    <div class="ops-meta">
                        <t t-if="date_from and date_to">
                            <span class="ops-meta-item">Period: <strong><t t-esc="date_from"/> to <t t-esc="date_to"/></strong></span>
                        </t>
                        <t t-elif="date_to">
                            <span class="ops-meta-item">As at: <strong><t t-esc="date_to"/></strong></span>
                        </t>
                        <span class="ops-meta-item">Currency: <strong><t t-esc="currency"/></strong></span>
                        <span class="ops-meta-item">Target: <strong><t t-esc="target_move"/></strong></span>
                    </div>

                    <!-- Dispatch to report type specific content -->
                    <t t-if="doc.report_type == 'bs'">
                        <t t-call="ops_matrix_accounting.report_minimal_balance_sheet_content"/>
                    </t>
                    <t t-elif="doc.report_type == 'pl'">
                        <t t-call="ops_matrix_accounting.report_minimal_profit_loss_content"/>
                    </t>
                    <t t-elif="doc.report_type == 'tb'">
                        <t t-call="ops_matrix_accounting.report_minimal_trial_balance_content"/>
                    </t>
                    <t t-elif="doc.report_type == 'cf'">
                        <t t-call="ops_matrix_accounting.report_minimal_cash_flow_content"/>
                    </t>
                    <t t-else="">
                        <!-- Generic line-based report -->
                        <t t-call="ops_matrix_accounting.report_minimal_generic_content"/>
                    </t>

                    <!-- FOOTER -->
                    <div class="ops-footer">
                        <span>Generated: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/></span>
                        <span class="ops-footer-brand" t-attf-style="color: #{primary_color};">OPS Framework</span>
                    </div>

                </div>
            </t>
        </t>
    </template>

    <!-- ============================================
         BALANCE SHEET CONTENT
         ============================================ -->
    <template id="report_minimal_balance_sheet_content">
        <!-- Assets Section -->
        <div class="ops-section">ASSETS</div>
        <table class="ops-table">
            <t t-foreach="data.get('asset_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="line.get('balance', 0)"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="total">
                <td>Total Assets</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('asset_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Liabilities Section -->
        <div class="ops-section">LIABILITIES</div>
        <table class="ops-table">
            <t t-foreach="data.get('liability_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="abs(line.get('balance', 0))"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Total Liabilities</td>
                <td class="num">
                    <t t-set="val" t-value="abs(data.get('liability_total', 0))"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer-sm"/>

        <!-- Equity Section -->
        <div class="ops-section">EQUITY</div>
        <table class="ops-table">
            <t t-foreach="data.get('equity_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="abs(line.get('balance', 0))"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Total Equity</td>
                <td class="num">
                    <t t-set="val" t-value="abs(data.get('equity_total', 0))"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
            <tr class="total">
                <td>Total Liabilities + Equity</td>
                <td class="num">
                    <t t-set="val" t-value="abs(data.get('liability_total', 0)) + abs(data.get('equity_total', 0))"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <!-- Notes -->
        <div class="ops-notes">
            <div class="ops-notes-title">Notes</div>
            <ul>
                <li>Assets = Liabilities + Equity</li>
                <li>Negative values shown in red with parentheses</li>
            </ul>
        </div>
    </template>

    <!-- ============================================
         PROFIT & LOSS CONTENT
         ============================================ -->
    <template id="report_minimal_profit_loss_content">
        <!-- Revenue Section -->
        <div class="ops-section">REVENUE</div>
        <table class="ops-table">
            <t t-foreach="data.get('income_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="abs(line.get('balance', 0))"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Total Revenue</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('income_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(abs(val))"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Expenses Section -->
        <div class="ops-section">EXPENSES</div>
        <table class="ops-table">
            <t t-foreach="data.get('expense_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="abs(line.get('balance', 0))"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Total Expenses</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('expense_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(abs(val))"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Net Profit/Loss -->
        <table class="ops-table">
            <tr class="total">
                <td>NET PROFIT / (LOSS)</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('net_profit', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <!-- Notes -->
        <div class="ops-notes">
            <div class="ops-notes-title">Notes</div>
            <ul>
                <li>Net Profit = Revenue - Expenses</li>
                <li>Loss shown in red with parentheses</li>
            </ul>
        </div>
    </template>

    <!-- ============================================
         TRIAL BALANCE CONTENT
         ============================================ -->
    <template id="report_minimal_trial_balance_content">
        <table class="ops-table">
            <thead>
                <tr>
                    <th style="width: 80px;">Code</th>
                    <th>Account Name</th>
                    <th class="num" style="width: 120px;">Debit</th>
                    <th class="num" style="width: 120px;">Credit</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="data.get('lines', [])" t-as="line">
                    <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                        <td><t t-esc="line.get('code', '')"/></td>
                        <td><t t-esc="line.get('name', '')"/></td>
                        <td class="num">
                            <t t-set="val" t-value="line.get('debit', 0)"/>
                            <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                            <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                        </td>
                        <td class="num">
                            <t t-set="val" t-value="line.get('credit', 0)"/>
                            <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                            <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                        </td>
                    </tr>
                </t>
            </tbody>
            <tfoot>
                <tr class="total">
                    <td colspan="2">TOTAL</td>
                    <td class="num">
                        <span class="ops-positive"><t t-esc="'{:,.2f}'.format(data.get('total_debit', 0))"/></span>
                    </td>
                    <td class="num">
                        <span class="ops-positive"><t t-esc="'{:,.2f}'.format(data.get('total_credit', 0))"/></span>
                    </td>
                </tr>
            </tfoot>
        </table>

        <!-- Balance Check -->
        <t t-set="diff" t-value="abs(data.get('total_debit', 0) - data.get('total_credit', 0))"/>
        <div class="ops-notes">
            <div class="ops-notes-title">Balance Check</div>
            <ul>
                <t t-if="diff &lt; 0.01">
                    <li style="color: #059669;">Books are balanced (Debit = Credit)</li>
                </t>
                <t t-else="">
                    <li style="color: #DA291C;">Difference: <t t-esc="'{:,.2f}'.format(diff)"/> - Manual review required</li>
                </t>
            </ul>
        </div>
    </template>

    <!-- ============================================
         CASH FLOW CONTENT
         ============================================ -->
    <template id="report_minimal_cash_flow_content">
        <!-- Operating Activities -->
        <div class="ops-section">OPERATING ACTIVITIES</div>
        <table class="ops-table">
            <t t-foreach="data.get('operating_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="line.get('balance', 0)"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Net Cash from Operating</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('operating_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Investing Activities -->
        <div class="ops-section">INVESTING ACTIVITIES</div>
        <table class="ops-table">
            <t t-foreach="data.get('investing_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="line.get('balance', 0)"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Net Cash from Investing</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('investing_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Financing Activities -->
        <div class="ops-section">FINANCING ACTIVITIES</div>
        <table class="ops-table">
            <t t-foreach="data.get('financing_lines', [])" t-as="line">
                <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                    <td><t t-esc="line.get('name', '')"/></td>
                    <td class="num">
                        <t t-set="val" t-value="line.get('balance', 0)"/>
                        <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                        <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                        <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                    </td>
                </tr>
            </t>
            <tr class="subtotal">
                <td>Net Cash from Financing</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('financing_total', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <div class="ops-spacer"/>

        <!-- Net Change in Cash -->
        <table class="ops-table">
            <tr class="total">
                <td>NET CHANGE IN CASH</td>
                <td class="num">
                    <t t-set="val" t-value="data.get('net_change', 0)"/>
                    <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                    <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                    <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                </td>
            </tr>
        </table>

        <!-- Notes -->
        <div class="ops-notes">
            <div class="ops-notes-title">Notes</div>
            <ul>
                <li>Net Change = Operating + Investing + Financing</li>
                <li>Cash outflows shown in red with parentheses</li>
            </ul>
        </div>
    </template>

    <!-- ============================================
         GENERIC LINE-BASED CONTENT
         ============================================ -->
    <template id="report_minimal_generic_content">
        <table class="ops-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th class="num" style="width: 150px;">Amount</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="data.get('lines', [])" t-as="line">
                    <tr t-attf-class="#{line.get('is_total') and 'subtotal' or ''} level-#{line.get('level', 0)}">
                        <td><t t-esc="line.get('name', '')"/></td>
                        <td class="num">
                            <t t-set="val" t-value="line.get('balance', 0)"/>
                            <t t-if="val == 0"><span class="ops-zero">0.00</span></t>
                            <t t-elif="val &lt; 0"><span class="ops-negative">(<t t-esc="'{:,.2f}'.format(abs(val))"/>)</span></t>
                            <t t-else=""><span class="ops-positive"><t t-esc="'{:,.2f}'.format(val)"/></span></t>
                        </td>
                    </tr>
                </t>
            </tbody>
        </table>
    </template>

    <!-- Report Action for Minimal Financial Reports (Updated to use enhanced wizard) -->
    <record id="action_report_ops_financial_minimal" model="ir.actions.report">
        <field name="name">Financial Report (Minimal)</field>
        <field name="model">ops.general.ledger.wizard.enhanced</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_ops_financial_minimal</field>
        <field name="report_file">ops_matrix_accounting.report_ops_financial_minimal</field>
        <!-- binding_model_id removed: superseded by corporate templates -->
        <field name="print_report_name">'Financial_Report_Minimal_%s_%s_%s' % (object.report_type, object.date_from, object.date_to)</field>
    </record>

</odoo>
