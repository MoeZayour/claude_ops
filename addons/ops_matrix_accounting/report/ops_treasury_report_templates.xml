<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        ================================================================
        OPS CORPORATE TREASURY REPORTS
        Phase 4: Corporate Report Template Redesign
        ================================================================

        REPORTS:
        1. PDC Registry - Complete listing of post-dated checks
        2. PDC Maturity Analysis - Aging analysis of PDC maturities
        3. PDCs in Hand - Open PDCs by status

        SHARED COMPONENTS USED:
        - report_corporate_header
        - report_corporate_title
        - report_filter_bar
        - report_corporate_footer
    -->

    <!-- ==================== PDC REGISTRY REPORT ==================== -->

    <template id="report_treasury_registry_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'PDC Registry'"/>
                        <t t-set="report_pillar" t-value="'Treasury Intelligence'"/>
                        <t t-set="date_from" t-value="doc.date_from"/>
                        <t t-set="date_to" t-value="doc.date_to"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- KPI Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #155e75; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Receivable PDCs</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #0891b2; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('inbound_total', 0))"/>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">
                                            <t t-esc="data.get('inbound', {}).get('count', 0)"/> checks
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #78350f; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Payable PDCs</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #f59e0b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('outbound_total', 0))"/>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">
                                            <t t-esc="data.get('outbound', {}).get('count', 0)"/> checks
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 36%; vertical-align: top;">
                                    <t t-set="net_pos" t-value="data.get('totals', {}).get('net_position', 0)"/>
                                    <div t-att-style="'background-color: ' + (net_pos >= 0 and '#f0fdf4' or '#fef2f2') + '; border-left: 4px solid ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + '; padding: 12px; border-radius: 3px;'">
                                        <div style="font-size: 9px; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Net Position</div>
                                        <div t-att-style="'font-size: 18px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + ';'">
                                            <t t-if="net_pos &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(net_pos))"/>)</t>
                                            <t t-else=""><t t-esc="'{:,.0f}'.format(net_pos)"/></t>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">Inbound - Outbound</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- INBOUND PDCs Section -->
                    <t t-if="data.get('pdc_type') in ('inbound', 'both') and data.get('inbound', {}).get('data')">
                        <!-- Section Header -->
                        <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 10px 15px; margin: 20px 0 10px 0;">
                            <table width="100%" style="border-collapse: collapse;">
                                <tr>
                                    <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        RECEIVABLE PDCs (From Customers)
                                    </td>
                                    <td style="text-align: right; font-size: 11px; font-weight: 600; font-family: Consolas, Monaco, monospace; color: #0891b2;">
                                        <t t-esc="'{:,.2f}'.format(data.get('inbound', {}).get('total', 0))"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Inbound PDC Table -->
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Reference</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Partner</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Check #</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Bank</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Maturity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Amount</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('inbound', {}).get('data', [])" t-as="pdc">
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="pdc.get('name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #475569;">
                                            <t t-esc="pdc.get('partner_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('check_number', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('bank_name', '-')"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('maturity_date', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #0891b2; font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(pdc.get('amount', 0))"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px;">
                                            <t t-set="state" t-value="pdc.get('state', 'draft')"/>
                                            <!-- Cleared -->
                                            <t t-if="state == 'cleared'">
                                                <span style="background-color: #dcfce7; color: #14532d; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">CLEARED</span>
                                            </t>
                                            <!-- Deposited -->
                                            <t t-elif="state == 'deposited'">
                                                <span style="background-color: #dbeafe; color: #1e40af; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">DEPOSITED</span>
                                            </t>
                                            <!-- Bounced -->
                                            <t t-elif="state == 'bounced'">
                                                <span style="background-color: #fee2e2; color: #7f1d1d; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">BOUNCED</span>
                                            </t>
                                            <!-- Draft/Other -->
                                            <t t-else="">
                                                <span style="background-color: #fef3c7; color: #78350f; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">
                                                    <t t-esc="pdc.get('state_label', state).upper()"/>
                                                </span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                    <td colspan="5" style="padding: 10px 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">SUBTOTAL RECEIVABLE</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #0891b2;">
                                        <t t-esc="'{:,.2f}'.format(data.get('inbound', {}).get('total', 0))"/>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- OUTBOUND PDCs Section -->
                    <t t-if="data.get('pdc_type') in ('outbound', 'both') and data.get('outbound', {}).get('data')">
                        <!-- Section Header -->
                        <div style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 10px 15px; margin: 20px 0 10px 0;">
                            <table width="100%" style="border-collapse: collapse;">
                                <tr>
                                    <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        PAYABLE PDCs (To Vendors)
                                    </td>
                                    <td style="text-align: right; font-size: 11px; font-weight: 600; font-family: Consolas, Monaco, monospace; color: #f59e0b;">
                                        <t t-esc="'{:,.2f}'.format(data.get('outbound', {}).get('total', 0))"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Outbound PDC Table -->
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Reference</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Partner</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Check #</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Bank</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Maturity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Amount</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('outbound', {}).get('data', [])" t-as="pdc">
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="pdc.get('name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #475569;">
                                            <t t-esc="pdc.get('partner_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('check_number', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('bank_name', '-')"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('maturity_date', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #f59e0b; font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(pdc.get('amount', 0))"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px;">
                                            <t t-set="state" t-value="pdc.get('state', 'draft')"/>
                                            <!-- Cleared/Paid -->
                                            <t t-if="state == 'cleared'">
                                                <span style="background-color: #dcfce7; color: #14532d; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">CLEARED</span>
                                            </t>
                                            <!-- Presented -->
                                            <t t-elif="state == 'presented'">
                                                <span style="background-color: #dbeafe; color: #1e40af; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">PRESENTED</span>
                                            </t>
                                            <!-- Issued -->
                                            <t t-elif="state == 'issued'">
                                                <span style="background-color: #fef3c7; color: #78350f; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">ISSUED</span>
                                            </t>
                                            <!-- Draft/Other -->
                                            <t t-else="">
                                                <span style="background-color: #f1f5f9; color: #64748b; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">
                                                    <t t-esc="pdc.get('state_label', state).upper()"/>
                                                </span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                    <td colspan="5" style="padding: 10px 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">SUBTOTAL PAYABLE</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #f59e0b;">
                                        <t t-esc="'{:,.2f}'.format(data.get('outbound', {}).get('total', 0))"/>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px;">
                            Notes to PDC Registry
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>All post-dated checks (inbound and outbound) within the specified date range</li>
                            <li>Net position represents receivable PDCs minus payable PDCs</li>
                            <li>Status colors: Green=Cleared, Blue=Deposited/Presented, Yellow=Issued, Red=Bounced</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <record id="report_treasury_registry_pdf" model="ir.actions.report">
        <field name="name">PDC Registry Report</field>
        <field name="model">ops.treasury.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_treasury_registry_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_treasury_registry_corporate</field>
        <field name="binding_model_id" ref="model_ops_treasury_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- ==================== PDC MATURITY ANALYSIS REPORT ==================== -->

    <template id="report_treasury_maturity_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'PDC Maturity Analysis'"/>
                        <t t-set="report_pillar" t-value="'Treasury Intelligence'"/>
                        <t t-set="date_end" t-value="data.get('as_of_date', '')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- KPI Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #155e75; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Total Inbound</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #0891b2; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('inbound_total', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #78350f; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Total Outbound</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #f59e0b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('outbound_total', 0))"/>
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 36%; vertical-align: top;">
                                    <t t-set="net_pos" t-value="data.get('totals', {}).get('net_position', 0)"/>
                                    <div t-att-style="'background-color: ' + (net_pos >= 0 and '#f0fdf4' or '#fef2f2') + '; border-left: 4px solid ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + '; padding: 12px; border-radius: 3px;'">
                                        <div style="font-size: 9px; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Net Cash Flow</div>
                                        <div t-att-style="'font-size: 18px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + ';'">
                                            <t t-if="net_pos &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(net_pos))"/>)</t>
                                            <t t-else=""><t t-esc="'{:,.0f}'.format(net_pos)"/></t>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Maturity Schedule Section -->
                    <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 10px 15px; margin: 20px 0 10px 0;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                    PDC MATURITY SCHEDULE
                                </td>
                                <td style="text-align: right; font-size: 10px; color: #64748b;">
                                    Period: <t t-esc="data.get('period_length', 30)"/> days
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Maturity Buckets Table -->
                    <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Period</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Inbound</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">#</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Outbound</th>
                                <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">#</th>
                                <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Net Flow</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('aging_buckets', [])" t-as="bucket">
                                <t t-set="net_flow" t-value="bucket.get('inbound', 0) - bucket.get('outbound', 0)"/>
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                        <t t-esc="bucket.get('label', '-')"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #0891b2;">
                                        <t t-if="bucket.get('inbound', 0) == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.0f}'.format(bucket.get('inbound', 0))"/>
                                        </t>
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                        <t t-esc="bucket.get('inbound_count', 0)"/>
                                    </td>
                                    <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #f59e0b;">
                                        <t t-if="bucket.get('outbound', 0) == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.0f}'.format(bucket.get('outbound', 0))"/>
                                        </t>
                                    </td>
                                    <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                        <t t-esc="bucket.get('outbound_count', 0)"/>
                                    </td>
                                    <td t-att-style="'text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; font-weight: 600; color: ' + (net_flow >= 0 and '#16a34a' or '#dc2626') + ';'">
                                        <t t-if="net_flow == 0">
                                            <span style="color: #94a3b8;">-</span>
                                        </t>
                                        <t t-elif="net_flow &lt; 0">
                                            (<t t-esc="'{:,.0f}'.format(abs(net_flow))"/>)
                                        </t>
                                        <t t-else="">
                                            <t t-esc="'{:,.0f}'.format(net_flow)"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                        <tfoot>
                            <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                <td style="padding: 10px 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">TOTAL</td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #0891b2;">
                                    <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('inbound_total', 0))"/>
                                </td>
                                <td></td>
                                <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #f59e0b;">
                                    <t t-esc="'{:,.0f}'.format(data.get('totals', {}).get('outbound_total', 0))"/>
                                </td>
                                <td></td>
                                <t t-set="net_total" t-value="data.get('totals', {}).get('net_position', 0)"/>
                                <td t-att-style="'text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: ' + (net_total >= 0 and '#16a34a' or '#dc2626') + ';'">
                                    <t t-if="net_total &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(net_total))"/>)</t>
                                    <t t-else=""><t t-esc="'{:,.0f}'.format(net_total)"/></t>
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Overdue Alert -->
                    <t t-set="overdue_bucket" t-value="data.get('aging_buckets', [{}])[0] if data.get('aging_buckets') else {}"/>
                    <t t-if="overdue_bucket.get('label', '').lower() == 'overdue' and (overdue_bucket.get('inbound', 0) > 0 or overdue_bucket.get('outbound', 0) > 0)">
                        <div style="background-color: #fef2f2; border-left: 4px solid #dc2626; padding: 10px 15px; margin-bottom: 15px;">
                            <span style="font-weight: 600; color: #7f1d1d; font-size: 10px;">Overdue Alert:</span>
                            <span style="color: #991b1b; font-size: 9px;">
                                <t t-if="overdue_bucket.get('inbound', 0) > 0">
                                    <t t-esc="'{:,.0f}'.format(overdue_bucket.get('inbound', 0))"/> in overdue receivable PDCs.
                                </t>
                                <t t-if="overdue_bucket.get('outbound', 0) > 0">
                                    <t t-esc="'{:,.0f}'.format(overdue_bucket.get('outbound', 0))"/> in overdue payable PDCs.
                                </t>
                            </span>
                        </div>
                    </t>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px;">
                            Notes to PDC Maturity Analysis
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>PDCs grouped by maturity date periods for cash flow forecasting</li>
                            <li>Net flow = Inbound PDCs (cash in) - Outbound PDCs (cash out)</li>
                            <li>Positive net flow indicates net cash inflow, negative indicates net cash outflow</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <record id="report_treasury_maturity_pdf" model="ir.actions.report">
        <field name="name">PDC Maturity Analysis</field>
        <field name="model">ops.treasury.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_treasury_maturity_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_treasury_maturity_corporate</field>
        <field name="binding_model_id" ref="model_ops_treasury_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- ==================== PDCs IN HAND REPORT ==================== -->

    <template id="report_treasury_on_hand_corporate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="company" t-value="doc.company_id or env.company"/>
                <t t-set="data" t-value="doc._get_report_data()"/>

                <div class="page" style="font-family: Arial, Helvetica, sans-serif; color: #1e293b;">

                    <!-- Corporate Header -->
                    <t t-call="ops_matrix_accounting.report_corporate_header"/>

                    <!-- Report Title -->
                    <t t-call="ops_matrix_accounting.report_corporate_title">
                        <t t-set="report_title" t-value="'PDCs in Hand'"/>
                        <t t-set="report_pillar" t-value="'Treasury Intelligence'"/>
                        <t t-set="date_end" t-value="data.get('as_of_date', '')"/>
                    </t>

                    <!-- Filter Info Bar -->
                    <t t-call="ops_matrix_accounting.report_filter_bar">
                        <t t-set="doc" t-value="doc"/>
                    </t>

                    <!-- KPI Summary Cards -->
                    <div style="margin-bottom: 20px;">
                        <table width="100%" style="border-collapse: collapse;">
                            <tr>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #155e75; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Receivable in Hand</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #0891b2; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('inbound', {}).get('total', 0))"/>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">
                                            <t t-esc="data.get('inbound', {}).get('count', 0)"/> checks
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 32%; padding-right: 10px; vertical-align: top;">
                                    <div style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 3px;">
                                        <div style="font-size: 9px; color: #78350f; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Payable in Hand</div>
                                        <div style="font-size: 18px; font-weight: 700; color: #f59e0b; font-family: Consolas, Monaco, monospace;">
                                            <t t-esc="'{:,.0f}'.format(data.get('outbound', {}).get('total', 0))"/>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">
                                            <t t-esc="data.get('outbound', {}).get('count', 0)"/> checks
                                        </div>
                                    </div>
                                </td>
                                <td style="width: 36%; vertical-align: top;">
                                    <t t-set="net_pos" t-value="data.get('totals', {}).get('net_position', 0)"/>
                                    <div t-att-style="'background-color: ' + (net_pos >= 0 and '#f0fdf4' or '#fef2f2') + '; border-left: 4px solid ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + '; padding: 12px; border-radius: 3px;'">
                                        <div style="font-size: 9px; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Net Position</div>
                                        <div t-att-style="'font-size: 18px; font-weight: 700; font-family: Consolas, Monaco, monospace; color: ' + (net_pos >= 0 and '#16a34a' or '#dc2626') + ';'">
                                            <t t-if="net_pos &lt; 0">(<t t-esc="'{:,.0f}'.format(abs(net_pos))"/>)</t>
                                            <t t-else=""><t t-esc="'{:,.0f}'.format(net_pos)"/></t>
                                        </div>
                                        <div style="font-size: 8px; color: #64748b; margin-top: 3px;">Receivable - Payable</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- INBOUND PDCs in Hand -->
                    <t t-if="data.get('pdc_type') in ('inbound', 'both') and data.get('inbound', {}).get('data')">
                        <!-- Section Header -->
                        <div style="background-color: #ecfeff; border-left: 4px solid #0891b2; padding: 10px 15px; margin: 20px 0 10px 0;">
                            <table width="100%" style="border-collapse: collapse;">
                                <tr>
                                    <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        RECEIVABLE PDCs IN HAND
                                    </td>
                                    <td style="text-align: right; font-size: 10px; color: #64748b;">
                                        <t t-esc="data.get('inbound', {}).get('count', 0)"/> checks |
                                        <span style="font-weight: 600; font-family: Consolas, Monaco, monospace; color: #0891b2;">
                                            <t t-esc="'{:,.0f}'.format(data.get('inbound', {}).get('total', 0))"/>
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Inbound PDC Table -->
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Reference</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Customer</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Check #</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Bank</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Maturity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Amount</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('inbound', {}).get('data', [])" t-as="pdc">
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="pdc.get('name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #475569;">
                                            <t t-esc="pdc.get('partner_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('check_number', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('bank_name', '-')"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('maturity_date', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #0891b2; font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(pdc.get('amount', 0))"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px;">
                                            <t t-set="state" t-value="pdc.get('state', 'draft')"/>
                                            <t t-if="state == 'deposited'">
                                                <span style="background-color: #dbeafe; color: #1e40af; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">DEPOSITED</span>
                                            </t>
                                            <t t-else="">
                                                <span style="background-color: #dcfce7; color: #14532d; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">
                                                    <t t-esc="pdc.get('state_label', state).upper()"/>
                                                </span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                    <td colspan="5" style="padding: 10px 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">SUBTOTAL</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #0891b2;">
                                        <t t-esc="'{:,.2f}'.format(data.get('inbound', {}).get('total', 0))"/>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- OUTBOUND PDCs in Hand -->
                    <t t-if="data.get('pdc_type') in ('outbound', 'both') and data.get('outbound', {}).get('data')">
                        <!-- Section Header -->
                        <div style="background-color: #fff7ed; border-left: 4px solid #f59e0b; padding: 10px 15px; margin: 20px 0 10px 0;">
                            <table width="100%" style="border-collapse: collapse;">
                                <tr>
                                    <td style="font-size: 12px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                        PAYABLE PDCs IN HAND
                                    </td>
                                    <td style="text-align: right; font-size: 10px; color: #64748b;">
                                        <t t-esc="data.get('outbound', {}).get('count', 0)"/> checks |
                                        <span style="font-weight: 600; font-family: Consolas, Monaco, monospace; color: #f59e0b;">
                                            <t t-esc="'{:,.0f}'.format(data.get('outbound', {}).get('total', 0))"/>
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Outbound PDC Table -->
                        <table width="100%" style="border-collapse: collapse; font-size: 9px; margin-bottom: 15px;">
                            <thead>
                                <tr style="border-bottom: 2px solid #1e293b; background-color: #f8fafc;">
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Reference</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Vendor</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Check #</th>
                                    <th style="text-align: left; padding: 6px 8px; font-weight: 600; color: #475569;">Bank</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Maturity</th>
                                    <th style="text-align: right; padding: 6px 8px; font-weight: 600; color: #475569;">Amount</th>
                                    <th style="text-align: center; padding: 6px 8px; font-weight: 600; color: #475569;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="data.get('outbound', {}).get('data', [])" t-as="pdc">
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 6px 8px; color: #1e293b; font-weight: 500;">
                                            <t t-esc="pdc.get('name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #475569;">
                                            <t t-esc="pdc.get('partner_name', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('check_number', '-')"/>
                                        </td>
                                        <td style="padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('bank_name', '-')"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px; color: #64748b;">
                                            <t t-esc="pdc.get('maturity_date', '-')"/>
                                        </td>
                                        <td style="text-align: right; padding: 6px 8px; font-family: Consolas, Monaco, monospace; color: #f59e0b; font-weight: 600;">
                                            <t t-esc="'{:,.2f}'.format(pdc.get('amount', 0))"/>
                                        </td>
                                        <td style="text-align: center; padding: 6px 8px;">
                                            <t t-set="state" t-value="pdc.get('state', 'draft')"/>
                                            <t t-if="state == 'issued'">
                                                <span style="background-color: #fef3c7; color: #78350f; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">ISSUED</span>
                                            </t>
                                            <t t-else="">
                                                <span style="background-color: #f1f5f9; color: #64748b; padding: 3px 8px; border-radius: 3px; font-size: 8px; font-weight: 600;">
                                                    <t t-esc="pdc.get('state_label', state).upper()"/>
                                                </span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1e293b; border-bottom: 3px double #1e293b; background-color: #f1f5f9;">
                                    <td colspan="5" style="padding: 10px 8px; font-weight: 700; text-transform: uppercase; font-size: 10px;">SUBTOTAL</td>
                                    <td style="text-align: right; padding: 10px 8px; font-weight: 700; font-family: Consolas, Monaco, monospace; font-size: 10px; color: #f59e0b;">
                                        <t t-esc="'{:,.2f}'.format(data.get('outbound', {}).get('total', 0))"/>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <!-- Empty State -->
                    <t t-if="not data.get('inbound', {}).get('data') and not data.get('outbound', {}).get('data')">
                        <div style="padding: 40px; text-align: center; color: #94a3b8; font-style: italic; border: 1px dashed #e2e8f0; border-radius: 4px;">
                            No open PDCs found matching the criteria
                        </div>
                    </t>

                    <!-- Notes Section -->
                    <div style="margin-top: 25px; background-color: #f8fafc; border-left: 3px solid #5B6BBB; padding: 12px 15px;">
                        <div style="font-size: 10px; font-weight: 600; color: #1e293b; margin-bottom: 8px;">
                            Notes to PDCs in Hand
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 9px; color: #475569; line-height: 1.6;">
                            <li>Shows only open/active PDCs currently in hand (not yet cleared or presented)</li>
                            <li>Receivable PDCs are awaiting deposit or clearance from customers</li>
                            <li>Payable PDCs are issued but not yet presented to vendors</li>
                        </ul>
                    </div>

                    <!-- Corporate Footer -->
                    <t t-call="ops_matrix_accounting.report_corporate_footer"/>

                </div>
            </t>
        </t>
    </template>

    <record id="report_treasury_on_hand_pdf" model="ir.actions.report">
        <field name="name">PDCs in Hand</field>
        <field name="model">ops.treasury.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ops_matrix_accounting.report_treasury_on_hand_corporate</field>
        <field name="report_file">ops_matrix_accounting.report_treasury_on_hand_corporate</field>
        <field name="binding_model_id" ref="model_ops_treasury_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- ============================================ -->
    <!-- XLSX EXPORT REPORT (Phase 5)                -->
    <!-- ============================================
         NOTE: XLSX report record temporarily disabled
         Excel export now handled inline in wizard
         using xlsxwriter directly (no report_xlsx)
         ============================================ -->

    <!--
    <record id="report_treasury_xlsx" model="ir.actions.report">
        <field name="name">Treasury Report (Excel)</field>
        <field name="model">ops.treasury.report.wizard</field>
        <field name="report_type">xlsx</field>
        <field name="report_name">ops_matrix_accounting.report_treasury_xlsx</field>
        <field name="report_file">ops_matrix_accounting.report_treasury_xlsx</field>
        <field name="binding_model_id" ref="model_ops_treasury_report_wizard"/>
        <field name="binding_type">report</field>
    </record>
    -->

</odoo>
