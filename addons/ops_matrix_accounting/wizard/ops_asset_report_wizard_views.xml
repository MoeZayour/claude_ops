<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================
         ASSET INTELLIGENCE ENGINE - CAPEX & DEPRECIATION

         Comprehensive Fixed Asset reporting wizard with:
         - Asset Register: Complete asset listing with NBV
         - Depreciation Forecast: Future depreciation schedule
         - Disposal Analysis: Asset movements (sold/disposed)
         - Movement Report: Additions in period
         ================================================================ -->

    <record id="view_ops_asset_report_wizard_form" model="ir.ui.view">
        <field name="name">ops.asset.report.wizard.form</field>
        <field name="model">ops.asset.report.wizard</field>
        <field name="arch" type="xml">
            <form string="Asset Intelligence">
                <sheet>
                    <!-- ==================== SMART TEMPLATE SELECTOR ==================== -->
                    <div class="alert alert-secondary mb-3" role="alert">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <label for="report_template_id" class="fw-bold me-2">Quick Load:</label>
                                <field name="report_template_id" placeholder="Select a saved template or configure manually..."
                                       options="{'no_create': True, 'no_open': True}" class="d-inline-block" style="width: 400px;"/>
                            </div>
                            <div class="col-4 text-end">
                                <button name="action_save_template" type="object" class="btn btn-sm btn-outline-primary"
                                        string="Save as Template" icon="fa-save"/>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== HEADER ==================== -->
                    <div class="oe_title">
                        <h1>
                            <field name="report_title" readonly="1"/>
                        </h1>
                        <h3 class="text-muted">Asset Intelligence - CAPEX Analysis</h3>
                        <div class="text-muted mt-2">
                            <field name="filter_summary" widget="text" readonly="1"/>
                        </div>
                    </div>

                    <!-- ==================== REPORT TYPE SELECTOR ==================== -->
                    <div class="alert alert-primary mb-4" role="alert">
                        <div class="row">
                            <div class="col-12">
                                <label for="report_type" class="fw-bold mb-2">Report Type:</label>
                                <field name="report_type" widget="radio" options="{'horizontal': true}"/>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="alert alert-info" role="alert">
                        <div class="row">
                            <div class="col-4">
                                <strong>Matching Assets:</strong>
                                <field name="asset_count" readonly="1"/>
                            </div>
                            <div class="col-4">
                                <strong>Total Gross Value:</strong>
                                <field name="total_gross_value" readonly="1" widget="monetary"
                                       options="{'currency_field': 'currency_id'}"/>
                            </div>
                            <div class="col-4">
                                <strong>Total NBV:</strong>
                                <field name="total_nbv" readonly="1" widget="monetary"
                                       options="{'currency_field': 'currency_id'}"/>
                                <field name="currency_id" invisible="1"/>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== TABBED FILTERS ==================== -->
                    <notebook>

                        <!-- Tab 1: Date & Status Filters -->
                        <page string="Date &amp; Status" name="page_dates">
                            <group>
                                <group string="Date Range">
                                    <!-- Register uses as_of_date -->
                                    <field name="as_of_date"
                                           invisible="report_type != 'register'"
                                           string="As of Date"
                                           required="report_type == 'register'"/>

                                    <!-- Other reports use date range -->
                                    <field name="date_from"
                                           invisible="report_type == 'register'"/>
                                    <field name="date_to"
                                           invisible="report_type == 'register'"/>
                                </group>

                                <group string="Status Filter">
                                    <field name="company_id" options="{'no_create': True}"/>
                                    <field name="asset_state" widget="radio"/>
                                    <field name="include_fully_depreciated"
                                           invisible="report_type not in ('register', 'forecast')"/>
                                </group>
                            </group>

                            <!-- Depreciation Status (for forecast) -->
                            <group invisible="report_type != 'forecast'">
                                <group string="Depreciation Status">
                                    <field name="depreciation_state" widget="radio"/>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 2: Dimension Filters -->
                        <page string="Matrix Filters" name="page_matrix">
                            <div class="alert alert-primary" role="alert">
                                <h4><i class="fa fa-filter"/> Matrix Filtering</h4>
                                <p>Filter assets by Branch and/or Business Unit for organizational analysis.</p>
                            </div>

                            <group>
                                <group string="Branch Filter">
                                    <field name="branch_ids" widget="many2many_tags"
                                           options="{'no_create': True, 'color_field': 'color'}"/>
                                </group>

                                <group string="Business Unit Filter">
                                    <field name="business_unit_ids" widget="many2many_tags"
                                           options="{'no_create': True, 'color_field': 'color'}"/>
                                </group>
                            </group>

                            <group>
                                <group string="Category Filter">
                                    <field name="asset_category_ids" widget="many2many_tags"
                                           options="{'no_create': True}"/>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 3: Output Options -->
                        <page string="Output Options" name="page_output">
                            <group>
                                <group string="Grouping">
                                    <field name="group_by" widget="radio"/>
                                </group>

                                <group string="Detail Options" invisible="report_type != 'register'">
                                    <field name="show_depreciation_details"/>
                                </group>
                            </group>

                            <div class="alert alert-info mt-3" role="alert">
                                <h5>Report Descriptions:</h5>
                                <ul class="mb-0">
                                    <li invisible="report_type != 'register'">
                                        <strong>Asset Register:</strong> Complete listing with Gross Value, Accumulated Depreciation, and Net Book Value
                                    </li>
                                    <li invisible="report_type != 'forecast'">
                                        <strong>Depreciation Forecast:</strong> Future depreciation schedule by month
                                    </li>
                                    <li invisible="report_type != 'disposal'">
                                        <strong>Disposal Analysis:</strong> Assets sold or disposed with gain/loss potential
                                    </li>
                                    <li invisible="report_type != 'movement'">
                                        <strong>Asset Movement:</strong> Capital additions during the period
                                    </li>
                                </ul>
                            </div>
                        </page>

                    </notebook>

                    <!-- ==================== ACTION BUTTONS ==================== -->
                    <footer>
                        <button name="action_generate_report"
                                string="Generate Report"
                                type="object"
                                class="btn-primary"
                                icon="fa-file-pdf-o"/>
                        <button name="action_export_excel"
                                string="Export to Excel"
                                type="object"
                                class="btn-secondary"
                                icon="fa-file-excel-o"/>
                        <button name="action_view_assets"
                                string="View Assets"
                                type="object"
                                class="btn-secondary"
                                icon="fa-list"/>
                        <button name="action_view_depreciation"
                                string="View Depreciation"
                                type="object"
                                class="btn-secondary"
                                icon="fa-calendar"
                                invisible="report_type != 'forecast'"/>
                        <button string="Cancel"
                                class="btn-secondary"
                                icon="fa-times"
                                special="cancel"/>
                    </footer>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ==================== ACTION ==================== -->
    <record id="action_ops_asset_report_wizard" model="ir.actions.act_window">
        <field name="name">Asset Intelligence</field>
        <field name="res_model">ops.asset.report.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- ==================== MENU ITEM ==================== -->
    <menuitem id="menu_ops_asset_reports"
              name="Asset Intelligence"
              parent="account.menu_finance_reports"
              action="action_ops_asset_report_wizard"
              sequence="4"
              groups="account.group_account_user"/>

</odoo>
