<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================
         ASSET INTELLIGENCE ENGINE - CAPEX & DEPRECIATION

         Phase 3: Corporate UI with Card-Based Layout
         Reports: Asset Register, Depreciation Forecast, Disposal, Movement
         ================================================================ -->

    <record id="view_ops_asset_report_wizard_form" model="ir.ui.view">
        <field name="name">ops.asset.report.wizard.form</field>
        <field name="model">ops.asset.report.wizard</field>
        <field name="arch" type="xml">
            <form string="Asset Intelligence">

                <!-- ==================== TEMPLATE QUICK START ==================== -->
                <group name="template_section" string="Quick Start" class="ops_wizard_section">
                    <field name="report_template_id"
                           placeholder="Load a saved template or configure manually..."
                           options="{'no_create': True, 'no_open': True}"
                           help="Load previously saved filter configuration for quick access"/>
                    <button name="action_save_template"
                            string="Save as Template"
                            type="object"
                            class="btn-link"
                            icon="fa-save"
                            help="Save current configuration as reusable template"/>
                </group>

                <!-- ==================== REPORT TYPE SELECTION ==================== -->
                <group name="report_type_section" string="Report Selection" class="ops_wizard_section">
                    <field name="report_type"
                           widget="radio"
                           options="{'horizontal': false}"
                           help="Select the asset report type to generate"/>
                    <field name="report_title" invisible="1"/>
                </group>

                <!-- ==================== DATE & PERIOD ==================== -->
                <group name="period_section" string="Reporting Period" class="ops_wizard_section">
                    <group>
                        <!-- Register uses as_of_date -->
                        <field name="as_of_date"
                               invisible="report_type != 'register'"
                               required="report_type == 'register'"
                               string="As of Date"
                               help="Snapshot date for asset register valuation"/>

                        <!-- Other reports use date range -->
                        <field name="date_from"
                               invisible="report_type == 'register'"
                               required="report_type != 'register'"
                               help="Start date of reporting period"/>
                        <field name="date_to"
                               invisible="report_type == 'register'"
                               required="report_type != 'register'"
                               help="End date of reporting period"/>
                    </group>
                    <group>
                        <field name="asset_state"
                               widget="radio"
                               help="Filter by asset status (active, sold, disposed, or all)"/>
                        <field name="include_fully_depreciated"
                               invisible="report_type not in ['register', 'forecast']"
                               help="Include assets with zero remaining depreciation"/>
                    </group>
                </group>

                <!-- ==================== SCOPE & FILTERS ==================== -->
                <group name="scope_section" string="Scope &amp; Filters" class="ops_wizard_section">
                    <group>
                        <field name="company_id"
                               options="{'no_create': True}"
                               help="Company to report on"/>
                        <field name="branch_ids"
                               widget="many2many_tags"
                               options="{'no_create': True, 'color_field': 'color'}"
                               help="Filter by specific branches (leave empty for all authorized branches)"/>
                        <field name="business_unit_ids"
                               widget="many2many_tags"
                               options="{'no_create': True, 'color_field': 'color'}"
                               help="Filter by business units"/>
                    </group>
                    <group>
                        <field name="asset_category_ids"
                               widget="many2many_tags"
                               options="{'no_create': True}"
                               help="Filter by asset categories (leave empty for all)"/>
                        <field name="depreciation_state"
                               widget="radio"
                               invisible="report_type != 'forecast'"
                               help="Filter by depreciation status"/>
                    </group>
                </group>

                <!-- ==================== ADVANCED OPTIONS ==================== -->
                <notebook class="ops_wizard_notebook">

                    <!-- Display Options -->
                    <page string="Display Options" name="display_options">
                        <group>
                            <group>
                                <field name="group_by"
                                       widget="radio"
                                       help="Group assets by category, branch, or business unit"/>
                                <field name="show_depreciation_details"
                                       invisible="report_type != 'register'"
                                       help="Include detailed depreciation schedule for each asset"/>
                            </group>
                        </group>

                        <div class="alert alert-info mt-3" role="alert">
                            <h5>Report Descriptions:</h5>
                            <ul class="mb-0">
                                <li invisible="report_type != 'register'">
                                    <strong>Asset Register:</strong> Complete listing of all fixed assets with Gross Value, Accumulated Depreciation, and Net Book Value at a specific date
                                </li>
                                <li invisible="report_type != 'forecast'">
                                    <strong>Depreciation Forecast:</strong> Projected future depreciation expense by month for budget planning and cash flow analysis
                                </li>
                                <li invisible="report_type != 'disposal'">
                                    <strong>Disposal Analysis:</strong> Assets sold or disposed during the period with calculated gain or loss on disposal
                                </li>
                                <li invisible="report_type != 'movement'">
                                    <strong>Asset Movement:</strong> Capital additions (purchases, construction) during the reporting period
                                </li>
                            </ul>
                        </div>
                    </page>

                </notebook>

                <!-- ==================== PREVIEW SECTION ==================== -->
                <group name="preview_section" string="Report Preview" class="ops_wizard_section">
                    <group>
                        <field name="asset_count"
                               readonly="1"
                               string="Matching Assets"
                               help="Number of asset records matching the current filters"/>
                        <field name="total_gross_value"
                               readonly="1"
                               widget="monetary"
                               string="Total Gross Value"
                               options="{'currency_field': 'currency_id'}"
                               help="Sum of original acquisition costs"/>
                    </group>
                    <group>
                        <field name="total_nbv"
                               readonly="1"
                               widget="monetary"
                               string="Total Net Book Value"
                               options="{'currency_field': 'currency_id'}"
                               help="Sum of current book values (Gross - Accumulated Depreciation)"/>
                        <field name="currency_id" invisible="1"/>
                    </group>
                    <field name="filter_summary"
                           readonly="1"
                           widget="text"
                           string="Active Filters"
                           colspan="2"
                           help="Summary of filters and criteria applied to this report"/>

                    <div class="alert alert-success mt-2"
                         role="alert"
                         invisible="asset_count &gt; 1000">
                        <i class="fa fa-check-circle"/> Good dataset size for quick processing
                    </div>
                    <div class="alert alert-warning mt-2"
                         role="alert"
                         invisible="asset_count &lt;= 1000 or asset_count &gt; 2000">
                        <i class="fa fa-exclamation-triangle"/> Large dataset - may take longer to process
                    </div>
                    <div class="alert alert-danger mt-2"
                         role="alert"
                         invisible="asset_count &lt;= 2000">
                        <i class="fa fa-warning"/> Very large dataset - consider adding filters to narrow scope
                    </div>
                </group>

                <!-- ==================== ACTION BUTTONS ==================== -->
                <footer>
                    <button name="action_view_report"
                            string="View Report"
                            type="object"
                            class="btn-primary"
                            icon="fa-eye"
                            help="Open report in browser for preview"/>
                    <button name="action_generate_report"
                            string="Print PDF"
                            type="object"
                            class="btn-secondary"
                            icon="fa-file-pdf-o"
                            help="Generate PDF for printing or download"/>
                    <button name="action_export_excel"
                            string="Export Excel"
                            type="object"
                            class="btn-success"
                            icon="fa-file-excel-o"
                            help="Export data to Excel spreadsheet"/>
                    <button name="action_view_assets"
                            string="View Assets"
                            type="object"
                            class="btn-info"
                            icon="fa-list"
                            help="View detailed asset list in tree view"/>
                    <button name="action_view_depreciation"
                            string="View Depreciation"
                            type="object"
                            class="btn-info"
                            icon="fa-calendar"
                            invisible="report_type != 'forecast'"
                            help="View depreciation schedule details"/>
                    <button string="Cancel"
                            class="btn-default"
                            icon="fa-times"
                            special="cancel"/>
                </footer>

            </form>
        </field>
    </record>

    <!-- ==================== ACTION ==================== -->
    <record id="action_ops_asset_report_wizard" model="ir.actions.act_window">
        <field name="name">Asset Intelligence</field>
        <field name="res_model">ops.asset.report.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- ==================== MENU ITEM ==================== -->
    <menuitem id="menu_reporting_asset_intelligence"
              name="Asset Intelligence"
              parent="account.menu_finance_reports"
              action="action_ops_asset_report_wizard"
              sequence="30"/>

</odoo>
