<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================
         TREASURY INTELLIGENCE ENGINE - PDC ANALYSIS

         Phase 3: Corporate UI with Card-Based Layout
         Reports: PDC Registry, Maturity Analysis, PDCs in Hand
         ================================================================ -->

    <record id="view_ops_treasury_report_wizard_form" model="ir.ui.view">
        <field name="name">ops.treasury.report.wizard.form</field>
        <field name="model">ops.treasury.report.wizard</field>
        <field name="arch" type="xml">
            <form string="Treasury Intelligence">

                <!-- ==================== TEMPLATE QUICK START ==================== -->
                <group name="template_section" string="Quick Start" class="ops_wizard_section">
                    <field name="report_template_id"
                           placeholder="Load a saved template or configure manually..."
                           options="{'no_create': True, 'no_open': True}"
                           help="Load previously saved filter configuration for quick access"/>
                    <button name="action_save_template"
                            string="Save as Template"
                            type="object"
                            class="btn-link"
                            icon="fa-save"
                            help="Save current configuration as reusable template"/>
                </group>

                <!-- ==================== REPORT TYPE SELECTION ==================== -->
                <group name="report_type_section" string="Report Selection" class="ops_wizard_section">
                    <group>
                        <field name="report_type"
                               widget="radio"
                               string="Report Type"
                               help="Select the treasury report to generate"/>
                        <field name="report_title" invisible="1"/>
                    </group>
                    <group>
                        <field name="pdc_type"
                               widget="radio"
                               string="PDC Direction"
                               help="Receivable checks (from customers) or Payable checks (to suppliers)"/>
                    </group>
                </group>

                <!-- ==================== DATE & PERIOD ==================== -->
                <group name="period_section" string="Date Range &amp; Status" class="ops_wizard_section">
                    <group>
                        <field name="date_from"
                               help="Start of maturity date range"/>
                        <field name="date_to"
                               help="End of maturity date range"/>
                        <field name="as_of_date"
                               invisible="report_type != 'maturity'"
                               string="Analysis Date"
                               help="Date to calculate maturity aging from"/>
                    </group>
                    <group>
                        <field name="state_filter"
                               widget="radio"
                               invisible="report_type == 'on_hand'"
                               help="Filter by PDC status"/>
                        <field name="period_length"
                               invisible="report_type != 'maturity'"
                               help="Days per aging bucket for maturity analysis"/>
                    </group>
                </group>

                <!-- ==================== SCOPE & FILTERS ==================== -->
                <group name="scope_section" string="Scope &amp; Filters" class="ops_wizard_section">
                    <group>
                        <field name="company_id"
                               options="{'no_create': True}"
                               help="Company to report on"/>
                        <field name="branch_ids"
                               widget="many2many_tags"
                               options="{'no_create': True, 'color_field': 'color'}"
                               help="Filter by specific branches (leave empty for all authorized branches)"/>
                    </group>
                    <group>
                        <field name="bank_ids"
                               widget="many2many_tags"
                               options="{'no_create': True}"
                               help="Filter by specific banks (leave empty for all)"/>
                        <field name="partner_ids"
                               widget="many2many_tags"
                               options="{'no_create': True}"
                               domain="[('is_company', '=', True)]"
                               help="Filter by specific partners (leave empty for all)"/>
                    </group>
                </group>

                <!-- ==================== ADVANCED OPTIONS ==================== -->
                <notebook class="ops_wizard_notebook">

                    <!-- Output Options -->
                    <page string="Display Options"
                          name="display_options"
                          invisible="report_type == 'maturity'">
                        <group>
                            <group>
                                <field name="group_by"
                                       widget="radio"
                                       help="Group PDCs by partner, bank, or branch"/>
                            </group>
                        </group>

                        <div class="alert alert-info mt-3" role="alert">
                            <h5>Report Descriptions:</h5>
                            <ul class="mb-0">
                                <li invisible="report_type != 'registry'">
                                    <strong>PDC Registry:</strong> Complete chronological list of all PDCs with full details including check number, amount, maturity date, and current status
                                </li>
                                <li invisible="report_type != 'maturity'">
                                    <strong>Maturity Analysis:</strong> PDCs grouped by aging buckets (Current, 0-30 days, 31-60 days, etc.) to analyze payment/collection timing
                                </li>
                                <li invisible="report_type != 'on_hand'">
                                    <strong>PDCs in Hand:</strong> Open checks that are ready for deposit (receivables) or payment (payables) - excludes cleared, bounced, or cancelled checks
                                </li>
                            </ul>
                        </div>
                    </page>

                </notebook>

                <!-- ==================== PREVIEW SECTION ==================== -->
                <group name="preview_section" string="Report Preview" class="ops_wizard_section">
                    <group>
                        <field name="record_count"
                               readonly="1"
                               string="Matching PDCs"
                               help="Number of PDC records matching the current filters"/>
                        <field name="total_amount"
                               readonly="1"
                               widget="monetary"
                               string="Total Amount"
                               options="{'currency_field': 'currency_id'}"
                               help="Sum of all PDC amounts in the result set"/>
                        <field name="currency_id" invisible="1"/>
                    </group>
                    <field name="filter_summary"
                           readonly="1"
                           widget="text"
                           string="Active Filters"
                           colspan="2"
                           help="Summary of filters and criteria applied to this report"/>

                    <div class="alert alert-success mt-2"
                         role="alert"
                         invisible="record_count &gt; 100">
                        <i class="fa fa-check-circle"/> Good dataset size for quick processing
                    </div>
                    <div class="alert alert-warning mt-2"
                         role="alert"
                         invisible="record_count &lt;= 100 or record_count &gt; 500">
                        <i class="fa fa-exclamation-triangle"/> Large dataset - may take longer to process
                    </div>
                    <div class="alert alert-danger mt-2"
                         role="alert"
                         invisible="record_count &lt;= 500">
                        <i class="fa fa-warning"/> Very large dataset - consider adding filters to narrow scope
                    </div>
                </group>

                <!-- ==================== ACTION BUTTONS ==================== -->
                <footer>
                    <button name="action_view_report"
                            string="View Report"
                            type="object"
                            class="btn-primary"
                            icon="fa-eye"
                            help="Open report in browser for preview"/>
                    <button name="action_generate_report"
                            string="Print PDF"
                            type="object"
                            class="btn-secondary"
                            icon="fa-print"
                            help="Generate PDF for printing or download"/>
                    <button name="action_export_excel"
                            string="Export Excel"
                            type="object"
                            class="btn-success"
                            icon="fa-file-excel-o"
                            help="Export data to Excel spreadsheet"/>
                    <button name="action_view_pdcs"
                            string="View PDCs"
                            type="object"
                            class="btn-info"
                            icon="fa-list"
                            help="View detailed PDC list in tree view"/>
                    <button string="Cancel"
                            class="btn-default"
                            icon="fa-times"
                            special="cancel"/>
                </footer>

            </form>
        </field>
    </record>

    <!-- ==================== ACTION ==================== -->
    <record id="action_ops_treasury_report_wizard" model="ir.actions.act_window">
        <field name="name">Treasury Intelligence</field>
        <field name="res_model">ops.treasury.report.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- ==================== MENU ITEM ==================== -->
    <menuitem id="menu_reporting_treasury_intelligence"
              name="Treasury Intelligence"
              parent="account.menu_finance_reports"
              action="action_ops_treasury_report_wizard"
              sequence="20"/>

</odoo>
