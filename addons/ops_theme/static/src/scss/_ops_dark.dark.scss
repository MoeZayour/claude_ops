///
/// OPS Dark Mode — Essential Overrides
/// ====================================
/// Design tokens derived from --ops-* preset vars + Bootstrap variable fixes.
/// Odoo's 62+ native .dark.scss files handle mail, editor, spreadsheet etc.
/// BS5 auto-inverts most standard components via [data-bs-theme="dark"].
///
/// This file fills gaps: bg-view hatching, form sheet surfaces, settings page,
/// and the #1e293b primary color derivation issue (muted link colors).
///

// =============================================================================
// 0. DESIGN TOKENS — Derived from preset --ops-* runtime vars
// =============================================================================

html[data-bs-theme="dark"] {
    // Surface layers — derived from preset
    --ops-dm-bg-deep:      var(--ops-bg, #0f172a);
    --ops-dm-bg-surface:   var(--ops-surface, #1e293b);
    --ops-dm-bg-elevated:  color-mix(in srgb, var(--ops-surface, #1e293b), white 8%);
    --ops-dm-bg-hover:     color-mix(in srgb, var(--ops-surface, #1e293b), white 15%);

    // Borders — derived from preset
    --ops-dm-border:       var(--ops-border, #475569);
    --ops-dm-border-subtle: color-mix(in srgb, var(--ops-border, #475569), black 20%);

    // Text — derived from preset
    --ops-dm-text:         var(--ops-text, #f1f5f9);
    --ops-dm-text-body:    color-mix(in srgb, var(--ops-text, #f1f5f9), transparent 10%);
    --ops-dm-text-muted:   color-mix(in srgb, var(--ops-text, #f1f5f9), transparent 35%);

    // Accent — from secondary
    --ops-dm-accent:       var(--ops-secondary, #3b82f6);
    --ops-dm-accent-hover: var(--ops-accent2, #60a5fa);
    --ops-dm-accent-subtle: color-mix(in srgb, var(--ops-secondary, #3b82f6), transparent 85%);

    // Override Bootstrap dark vars
    --body-bg:           var(--ops-dm-bg-deep);
    --body-color:        var(--ops-dm-text-body);
    --secondary-bg:      var(--ops-dm-bg-surface);
    --tertiary-bg:       var(--ops-dm-bg-elevated);
    --border-color:      var(--ops-dm-border);
    --link-color:        var(--ops-dm-accent);
    --link-hover-color:  var(--ops-dm-accent-hover);
    --emphasis-color:    var(--ops-dm-text);

    // Primary color emphasis
    --primary-text-emphasis: var(--ops-dm-accent-hover);
    --primary-bg-subtle: var(--ops-dm-accent-subtle);
}

// =============================================================================
// CORE LAYOUT — Fix bg-view hatched pattern + form surfaces
// =============================================================================

html[data-bs-theme="dark"] {
    .o_web_client {
        background-color: var(--ops-dm-bg-deep) !important;
        color-scheme: dark;
    }
    .o_action_manager, .o_content, .o_view_controller, .o_form_sheet_bg, .o_form_nosheet, .bg-view {
        background-color: var(--ops-dm-bg-deep) !important;
        background-image: none !important;
    }
    .o_form_sheet {
        background-color: var(--ops-dm-bg-surface) !important;
        border-color: var(--ops-dm-border) !important;
    }
}

// =============================================================================
// SETTINGS — OPS compile-time variable overrides
// =============================================================================

html[data-bs-theme="dark"] {
    .o_base_settings_view .o_form_renderer {
        --settings__tab-bg: var(--ops-dm-bg-surface);
        --settings__tab-bg--active: var(--ops-dm-accent-subtle);
        --settings__tab-color: var(--ops-dm-text-body);
        --settings__title-bg: var(--ops-dm-bg-surface);
    }
    .o_setting_container .settings,
    .o_settings_container, .o_base_settings,
    .app_settings_block {
        background-color: var(--ops-dm-bg-deep) !important;
        background-image: none !important;
    }
    .app_settings_block h2 {
        background-color: var(--ops-dm-bg-surface) !important;
        color: var(--ops-dm-text) !important;
    }
}

// =============================================================================
// NAVBAR — Branded bar border in dark mode
// =============================================================================

html[data-bs-theme="dark"] .o_main_navbar {
    border-bottom: 1px solid var(--ops-dm-border) !important;
}
