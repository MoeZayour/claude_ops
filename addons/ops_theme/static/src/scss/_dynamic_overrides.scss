// =============================================================================
// OPS THEME - DYNAMIC OVERRIDES
// =============================================================================
// These rules ensure CSS variables from /ops_theme/variables.css take effect
// by using the same selectors as the base theme but with dynamic var() values.
// =============================================================================

// =============================================================================
// NAVBAR - RESPECTS data-ops-navbar ATTRIBUTE
// =============================================================================

// Dark navbar (default)
html[data-ops-navbar="dark"] {
    .o_main_navbar,
    nav.o_main_navbar {
        background: var(--ops-navbar-bg, var(--ops-primary)) !important;

        // Ensure nav entries match navbar bg (prevents two-tone bar)
        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: var(--ops-navbar-bg, var(--ops-primary)) !important;
        }

        .o_menu_toggle,
        .o_menu_sections button,
        .o_menu_sections a,
        .o_menu_systray .dropdown-toggle {
            color: var(--ops-navbar-text, #ffffff) !important;
        }
    }

    // Override discuss module navbar color override (dark mode leak)
    .o_web_client:where(:has(.o-mail-Discuss)) {
        .o_main_navbar {
            background-color: var(--ops-navbar-bg, var(--ops-primary)) !important;
        }
    }
}

// Light navbar
html[data-ops-navbar="light"] {
    .o_main_navbar,
    nav.o_main_navbar {
        background: #f8fafc !important;
        border-bottom: 1px solid #e2e8f0 !important;

        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: #f8fafc !important;
        }

        .o_menu_toggle,
        .o_menu_sections button,
        .o_menu_sections a,
        .o_menu_systray .dropdown-toggle {
            color: #1e293b !important;
        }

        .o_menu_sections button:hover,
        .o_menu_sections a:hover {
            background: rgba(0, 0, 0, 0.05) !important;
        }
    }

    .o_web_client:where(:has(.o-mail-Discuss)) {
        .o_main_navbar {
            background-color: #f8fafc !important;
        }
    }
}

// Primary color navbar — uses company's primary color (NOT secondary)
html[data-ops-navbar="primary"] {
    .o_main_navbar,
    nav.o_main_navbar {
        background: var(--ops-navbar-bg, var(--ops-primary)) !important;

        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: var(--ops-navbar-bg, var(--ops-primary)) !important;
        }

        .o_menu_toggle,
        .o_menu_sections button,
        .o_menu_sections a,
        .o_menu_systray .dropdown-toggle {
            color: var(--ops-navbar-text, #ffffff) !important;
        }
    }

    .o_web_client:where(:has(.o-mail-Discuss)) {
        .o_main_navbar {
            background-color: var(--ops-navbar-bg, var(--ops-primary)) !important;
        }
    }
}

// =============================================================================
// BORDER RADIUS - RESPECTS data-ops-radius ATTRIBUTE
// =============================================================================

html[data-ops-radius="sharp"] {
    --ops-radius-md: 0px;
    --ops-border-radius: 0px;

    .btn,
    .form-control,
    .form-select,
    .card,
    .o_kanban_record,
    .modal-content,
    .dropdown-menu {
        border-radius: 0px !important;
    }
}

html[data-ops-radius="rounded"] {
    --ops-radius-md: 8px;
    --ops-border-radius: 8px;

    .btn,
    .form-control,
    .form-select,
    .card,
    .o_kanban_record,
    .modal-content,
    .dropdown-menu {
        border-radius: 8px !important;
    }
}

html[data-ops-radius="pill"] {
    --ops-radius-md: 16px;
    --ops-border-radius: 16px;

    .btn {
        border-radius: 9999px !important;
    }

    .form-control,
    .form-select {
        border-radius: 16px !important;
    }

    .card,
    .o_kanban_record,
    .modal-content,
    .dropdown-menu {
        border-radius: 16px !important;
    }
}

// =============================================================================
// CARD SHADOW - RESPECTS data-ops-shadow ATTRIBUTE
// =============================================================================

html[data-ops-shadow="none"] {
    .o_form_sheet,
    .o_kanban_record,
    .card {
        box-shadow: none !important;
    }
}

html[data-ops-shadow="light"] {
    .o_form_sheet,
    .o_kanban_record,
    .card {
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
    }
}

html[data-ops-shadow="medium"] {
    .o_form_sheet,
    .o_kanban_record,
    .card {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
    }
}

html[data-ops-shadow="heavy"] {
    .o_form_sheet,
    .o_kanban_record,
    .card {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    }
}

// =============================================================================
// BUTTON COLORS — LIGHT MODE ONLY
// =============================================================================
// In dark mode, Odoo's dark CSS bundle handles all component colors natively.
// OPS only brands buttons/badges/links in light mode.

html:not([data-bs-theme="dark"]) {
    .btn-primary {
        background-color: var(--ops-secondary) !important;
        border-color: var(--ops-secondary) !important;
        color: #ffffff !important;

        &:hover,
        &:focus {
            background-color: var(--ops-secondary-hover, #2563eb) !important;
            border-color: var(--ops-secondary-hover, #2563eb) !important;
        }
    }

    .btn-success {
        background-color: var(--ops-success) !important;
        border-color: var(--ops-success) !important;
    }

    .btn-warning {
        background-color: var(--ops-warning) !important;
        border-color: var(--ops-warning) !important;
    }

    .btn-danger {
        background-color: var(--ops-danger) !important;
        border-color: var(--ops-danger) !important;
    }

    // Links
    a:not(.btn):not(.nav-link):not(.dropdown-item) {
        color: var(--ops-secondary);

        &:hover {
            color: var(--ops-secondary-hover, #2563eb);
        }
    }

    // Badges
    .badge.text-bg-primary,
    .badge.bg-primary {
        background-color: var(--ops-secondary) !important;
    }

    .badge.text-bg-success,
    .badge.bg-success {
        background-color: var(--ops-success) !important;
    }

    .badge.text-bg-warning,
    .badge.bg-warning {
        background-color: var(--ops-warning) !important;
    }

    .badge.text-bg-danger,
    .badge.bg-danger {
        background-color: var(--ops-danger) !important;
    }

    // Form focus states
    .form-control:focus,
    .form-select:focus {
        border-color: var(--ops-secondary) !important;
        box-shadow: 0 0 0 3px rgba(var(--ops-secondary-rgb), 0.15) !important;
    }

    // Statusbar
    .o_statusbar_status .o_arrow_button.btn-primary,
    .o_statusbar_status .o_arrow_button.o_active {
        background-color: var(--ops-secondary) !important;
        color: #ffffff !important;
    }
}

// =============================================================================
// SETTINGS PAGE — Visual Enhancement
// =============================================================================
// Approved: 2026-02-06 | Risk: LOW | Layout impact: ZERO
// All enhancements use rgba + CSS vars → auto-adapt to light/dark mode.
// RULES: Never touch display, flex, grid, width, height, padding, margin,
//        position on any .o_setting*, .settings*, .tab, .app_settings* selector.
//        Odoo 19 owns the layout. OPS owns the colors.
// =============================================================================

// --- 1.1 Sidebar Tab Hover & Active Enhancement ---
.o_base_settings_view .o_setting_container .settings_tab {
    .tab {
        transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;

        &:hover:not(.selected) {
            background-color: rgba(var(--ops-secondary-rgb), 0.06);
        }

        &.selected {
            box-shadow: inset 3px 0 0 var(--ops-secondary, #3b82f6);
            font-weight: 600;
        }
    }
}

// --- 1.2 Section Header Left Accent Bar ---
.o_base_settings_view .settings > .app_settings_block h2 {
    border-left: 3px solid var(--ops-secondary, #3b82f6);
    font-weight: 600;
    letter-spacing: 0.01em;
}

// --- 1.3 Search Bar Branded Focus Ring ---
.o-settings-form-view .o_searchview {
    transition: border-color 0.2s ease, box-shadow 0.2s ease;

    &:focus-within {
        border-color: var(--ops-secondary, #3b82f6) !important;
        box-shadow: 0 0 0 3px rgba(var(--ops-secondary-rgb), 0.12) !important;
    }
}

// --- 2.1 Setting Box Hover & Search Highlight ---
.o_settings_container .o_searchable_setting {
    transition: background-color 0.15s ease;
    border-radius: var(--ops-border-radius, 8px);

    &:hover {
        background-color: rgba(var(--ops-secondary-rgb), 0.03);
    }

    // Branded search highlight (overrides Odoo's tint-color default)
    &.o_setting_highlight {
        --SearchableSetting__highlight-border: var(--ops-secondary, #3b82f6);
        --SearchableSetting__highlight-background: rgba(var(--ops-secondary-rgb), 0.08);
    }
}

// --- 2.2 Label Typography in Settings ---
.o_settings_container .o_setting_right_pane {
    .o_form_label {
        font-weight: 600;
    }
}

// --- 3.1 Smooth Scroll Between Sections ---
.o_base_settings_view .o_setting_container .settings {
    scroll-behavior: smooth;
}

// =============================================================================
// MICRO-INTERACTIONS — Gilded-Inspired Enhancements
// =============================================================================

// --- 4.1 Card Hover Elevation ---
// Smooth lift on hover for kanban records, form sheets, and generic cards
.o_kanban_record,
.o_form_sheet,
.card:not(.o_kanban_record) {
    transition: box-shadow 0.25s ease, transform 0.25s ease;

    &:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08),
                    0 2px 6px rgba(0, 0, 0, 0.04) !important;
        transform: translateY(-2px);
    }
}

// --- 4.2 Table Row Left-Border Hover ---
// Active-indicator accent on list rows
.o_list_table:not(.o_section_and_note_list) tbody tr {
    position: relative;
    transition: background-color 0.15s ease;

    &::after {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--ops-secondary, #3b82f6);
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    &:hover::after {
        opacity: 1;
    }
}

// --- 4.3 Notification Left-Border Accents ---
// Severity-coded side stripe on toast notifications
.o_notification {
    border-left: 4px solid transparent !important;
    transition: transform 0.2s ease;

    &.border-success,
    &.o_notification_success {
        border-left-color: var(--ops-success, #10b981) !important;
    }

    &.border-warning,
    &.o_notification_warning {
        border-left-color: var(--ops-warning, #f59e0b) !important;
    }

    &.border-danger,
    &.o_notification_danger {
        border-left-color: var(--ops-danger, #ef4444) !important;
    }

    &.border-info,
    &.o_notification_info {
        border-left-color: var(--ops-secondary, #3b82f6) !important;
    }
}

// --- 4.4 Soft Badge Variants ---
// Translucent background badges that pair with OPS color tokens
.badge-soft-primary {
    background: rgba(var(--ops-secondary-rgb, 59, 130, 246), 0.12) !important;
    color: var(--ops-secondary, #3b82f6) !important;
}
.badge-soft-success {
    background: rgba(16, 185, 129, 0.12) !important;
    color: var(--ops-success, #10b981) !important;
}
.badge-soft-warning {
    background: rgba(245, 158, 11, 0.12) !important;
    color: var(--ops-warning, #f59e0b) !important;
}
.badge-soft-danger {
    background: rgba(239, 68, 68, 0.12) !important;
    color: var(--ops-danger, #ef4444) !important;
}
.badge-soft-info {
    background: rgba(6, 182, 212, 0.12) !important;
    color: #06b6d4 !important;
}

// =============================================================================
// GILDED UTILITY COMPONENTS — Foundation for Future Features
// =============================================================================
// These reusable component classes are extracted from the Gilded Admin template
// and adapted to the OPS color system. They serve as building blocks for
// future OWL widgets, dashboards, and custom views.
// =============================================================================

// --- 5.1 Thin Progress Bars ---
// Gilded-style slim progress indicators for budgets, SLAs, utilization
.ops-progress-xxs {
    height: 3px;
    border-radius: 2px;
    background: var(--ops-border, #e2e8f0);
    overflow: hidden;

    .progress-bar {
        border-radius: 2px;
        transition: width 0.6s ease;
    }
}

.ops-progress-xs {
    height: 5px;
    border-radius: 3px;
    background: var(--ops-border, #e2e8f0);
    overflow: hidden;

    .progress-bar {
        border-radius: 3px;
        transition: width 0.6s ease;
    }
}

.ops-progress-sm {
    height: 8px;
    border-radius: 4px;
    background: var(--ops-border, #e2e8f0);
    overflow: hidden;

    .progress-bar {
        border-radius: 4px;
        transition: width 0.6s ease;
    }
}

// Animated striped variant (add .ops-progress-animated to container)
.ops-progress-animated .progress-bar {
    background-image: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.15) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0.15) 75%,
        transparent 75%,
        transparent
    );
    background-size: 1rem 1rem;
    animation: ops-progress-stripes 1s linear infinite;
}

@keyframes ops-progress-stripes {
    0% { background-position: 1rem 0; }
    100% { background-position: 0 0; }
}

// Progress color helpers
.ops-progress-primary .progress-bar { background-color: var(--ops-secondary, #3b82f6); }
.ops-progress-success .progress-bar { background-color: var(--ops-success, #10b981); }
.ops-progress-warning .progress-bar { background-color: var(--ops-warning, #f59e0b); }
.ops-progress-danger .progress-bar  { background-color: var(--ops-danger, #ef4444); }
.ops-progress-info .progress-bar    { background-color: #06b6d4; }

// Gradient progress (premium feel)
.ops-progress-gradient .progress-bar {
    background: linear-gradient(90deg, var(--ops-secondary, #3b82f6), #06b6d4);
}

// Dark mode
html[data-bs-theme="dark"] {
    .ops-progress-xxs,
    .ops-progress-xs,
    .ops-progress-sm {
        background: #334155;
    }
}


// --- 5.2 Box/Panel Container System ---
// Modular container with header/body/footer — for dashboards, settings panels,
// and any future widget that needs structured layout
.ops-box {
    background: var(--ops-bg-card, #ffffff);
    border: 1px solid var(--ops-border, #e2e8f0);
    border-radius: var(--ops-radius-md, 8px);
    overflow: hidden;
    transition: box-shadow 0.25s ease;

    &:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    // Accent variants — colored top border
    &.ops-box-primary  { border-top: 3px solid var(--ops-secondary, #3b82f6); }
    &.ops-box-success  { border-top: 3px solid var(--ops-success, #10b981); }
    &.ops-box-warning  { border-top: 3px solid var(--ops-warning, #f59e0b); }
    &.ops-box-danger   { border-top: 3px solid var(--ops-danger, #ef4444); }
    &.ops-box-info     { border-top: 3px solid #06b6d4; }

    // Flat variant — no border, shadow only
    &.ops-box-flat {
        border: none;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);

        &:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
    }
}

.ops-box-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--ops-border, #e2e8f0);
    display: flex;
    align-items: center;
    justify-content: space-between;

    .ops-box-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--ops-text-primary, #1e293b);
        margin: 0;
    }

    .ops-box-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }
}

.ops-box-body {
    padding: 20px;
}

.ops-box-footer {
    padding: 12px 20px;
    border-top: 1px solid var(--ops-border, #e2e8f0);
    background: rgba(var(--ops-secondary-rgb, 59, 130, 246), 0.02);
}

// Compact variant
.ops-box.ops-box-compact {
    .ops-box-header { padding: 10px 16px; }
    .ops-box-body { padding: 14px 16px; }
    .ops-box-footer { padding: 10px 16px; }
}

// Dark mode
html[data-bs-theme="dark"] {
    .ops-box {
        background: #1e293b;
        border-color: #334155;

        &:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        &.ops-box-flat {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            &:hover { box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3); }
        }
    }

    .ops-box-header {
        border-bottom-color: #334155;

        .ops-box-title {
            color: #f1f5f9;
        }
    }

    .ops-box-footer {
        border-top-color: #334155;
        background: rgba(59, 130, 246, 0.04);
    }
}


// --- 5.3 Compact Metric Cards ---
// Small footprint stat displays — for dashboard grids, sidebar widgets, summaries

// Deal card (centered, minimal)
.ops-deal-card {
    background: var(--ops-bg-card, #ffffff);
    border: 1px solid var(--ops-border, #e2e8f0);
    border-radius: var(--ops-radius-md, 8px);
    padding: 16px;
    text-align: center;
    transition: box-shadow 0.25s ease, transform 0.25s ease;

    &:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
        transform: translateY(-2px);
    }

    .ops-deal-label {
        font-size: 12px;
        font-weight: 500;
        color: var(--ops-text-muted, #94a3b8);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }

    .ops-deal-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--ops-text-primary, #1e293b);
        font-variant-numeric: tabular-nums;
        line-height: 1.2;
    }

    .ops-deal-trend {
        font-size: 12px;
        font-weight: 600;
        margin-top: 4px;

        &.up   { color: var(--ops-success, #10b981); }
        &.down { color: var(--ops-danger, #ef4444); }
        &.flat { color: var(--ops-text-muted, #94a3b8); }

        i { margin-right: 2px; }
    }

    // Color accent variants — subtle background tint
    &.ops-deal-primary  { background: rgba(var(--ops-secondary-rgb, 59, 130, 246), 0.04); }
    &.ops-deal-success  { background: rgba(16, 185, 129, 0.04); }
    &.ops-deal-warning  { background: rgba(245, 158, 11, 0.04); }
    &.ops-deal-danger   { background: rgba(239, 68, 68, 0.04); }
}

// Metric card (icon left, stat right — horizontal)
.ops-metric-card {
    background: var(--ops-bg-card, #ffffff);
    border: 1px solid var(--ops-border, #e2e8f0);
    border-radius: var(--ops-radius-md, 8px);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: box-shadow 0.25s ease;

    &:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    .ops-metric-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;

        // Color backgrounds
        &.bg-primary-light  { background: rgba(var(--ops-secondary-rgb, 59, 130, 246), 0.12); color: var(--ops-secondary, #3b82f6); }
        &.bg-success-light  { background: rgba(16, 185, 129, 0.12); color: var(--ops-success, #10b981); }
        &.bg-warning-light  { background: rgba(245, 158, 11, 0.12); color: var(--ops-warning, #f59e0b); }
        &.bg-danger-light   { background: rgba(239, 68, 68, 0.12); color: var(--ops-danger, #ef4444); }
        &.bg-info-light     { background: rgba(6, 182, 212, 0.12); color: #06b6d4; }
    }

    .ops-metric-content {
        flex: 1;
        min-width: 0; // prevent text overflow

        .ops-metric-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--ops-text-muted, #94a3b8);
            margin-bottom: 2px;
        }

        .ops-metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--ops-text-primary, #1e293b);
            font-variant-numeric: tabular-nums;
            line-height: 1.2;
        }

        .ops-metric-sub {
            font-size: 12px;
            color: var(--ops-text-secondary, #64748b);
            margin-top: 2px;

            .trend-up   { color: var(--ops-success, #10b981); font-weight: 600; }
            .trend-down { color: var(--ops-danger, #ef4444); font-weight: 600; }
        }
    }
}

// Dark mode for metric/deal cards
html[data-bs-theme="dark"] {
    .ops-deal-card {
        background: #1e293b;
        border-color: #334155;

        .ops-deal-value { color: #f1f5f9; }

        &.ops-deal-primary  { background: rgba(59, 130, 246, 0.08); }
        &.ops-deal-success  { background: rgba(16, 185, 129, 0.08); }
        &.ops-deal-warning  { background: rgba(245, 158, 11, 0.08); }
        &.ops-deal-danger   { background: rgba(239, 68, 68, 0.08); }
    }

    .ops-metric-card {
        background: #1e293b;
        border-color: #334155;

        .ops-metric-content .ops-metric-value { color: #f1f5f9; }
    }
}


// --- 5.4 Status Indicator Dots ---
// Tiny colored circles for inline status, live indicators, health checks
.ops-status-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    vertical-align: middle;
    flex-shrink: 0;

    &.ops-dot-success  { background-color: var(--ops-success, #10b981); }
    &.ops-dot-warning  { background-color: var(--ops-warning, #f59e0b); }
    &.ops-dot-danger   { background-color: var(--ops-danger, #ef4444); }
    &.ops-dot-primary  { background-color: var(--ops-secondary, #3b82f6); }
    &.ops-dot-info     { background-color: #06b6d4; }
    &.ops-dot-muted    { background-color: var(--ops-text-muted, #94a3b8); }

    // Size variants
    &.ops-dot-sm { width: 6px; height: 6px; }
    &.ops-dot-lg { width: 10px; height: 10px; }
    &.ops-dot-xl { width: 14px; height: 14px; }

    // Pulsing animation for live/active states
    &.ops-dot-pulse {
        position: relative;

        &::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: ops-dot-pulse 2s ease-in-out infinite;
        }
    }
}

@keyframes ops-dot-pulse {
    0%   { transform: scale(1);   opacity: 1; }
    50%  { transform: scale(2.2); opacity: 0; }
    100% { transform: scale(1);   opacity: 0; }
}

// Status dot with label (inline pair)
.ops-status-label {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--ops-text-secondary, #64748b);

    .ops-status-dot { margin: 0; } // reset any inherited margin
}
