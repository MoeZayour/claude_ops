// =============================================================================
// OPS THEME — STRUCTURAL OVERRIDES (Light Mode)
// =============================================================================
// Loaded in web.assets_backend. Compiled with light mode SCSS values.
// In the dark bundle, this same file is recompiled with dark values.
//
// DESIGN RULES:
//   - COLORS: Use compiled SCSS only ($o-*, $ops_*). No var(--ops-*) for color.
//   - STRUCTURAL: var(--ops-*) OK for radius, shadow (instant preview in Settings).
//   - Navbar style: HTML attribute selectors + compiled values.
// =============================================================================

// =============================================================================
// NAVBAR — data-ops-navbar ATTRIBUTE (server-set on <html>)
// =============================================================================
// Default navbar styling is handled by Odoo native ($o-navbar-background).
// We only override for specific style choices.

// Dark and Primary: brand-colored bar (this IS the default, but explicit for clarity)
html[data-ops-navbar="dark"],
html[data-ops-navbar="primary"] {

    .o_main_navbar,
    nav.o_main_navbar {
        background: $o-navbar-background;

        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: $o-navbar-background;
        }
    }
}

// Light navbar: inverted colors (light bg, dark text)
// In dark mode, the dark override file reverses these.
html[data-ops-navbar="light"] {

    .o_main_navbar,
    nav.o_main_navbar {
        background: $ops_color_surface;
        border-bottom: 1px solid $ops_color_border;

        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: $ops_color_surface;
        }

        .o_menu_toggle,
        .o_menu_sections button,
        .o_menu_sections a,
        .o_menu_systray .dropdown-toggle {
            color: $ops_color_text;
        }

        .o_menu_sections button:hover,
        .o_menu_sections a:hover {
            background: $ops_surface_hover;
        }
    }
}

// =============================================================================
// BORDER RADIUS — data-ops-radius ATTRIBUTE (CSS var for instant preview)
// =============================================================================

html[data-ops-radius="sharp"] {
    --ops-border-radius: 0px;
}

html[data-ops-radius="rounded"] {
    --ops-border-radius: 8px;
}

html[data-ops-radius="pill"] {
    --ops-border-radius: 16px;
}

// =============================================================================
// CARD SHADOW — data-ops-shadow ATTRIBUTE (CSS var for instant preview)
// =============================================================================

html[data-ops-shadow="none"] {
    --ops-card-shadow: none;
}

html[data-ops-shadow="light"] {
    --ops-card-shadow: #{$ops_box_shadow_sm};
}

html[data-ops-shadow="medium"] {
    --ops-card-shadow: #{$ops_box_shadow_md};
}

html[data-ops-shadow="heavy"] {
    --ops-card-shadow: #{$ops_box_shadow_lg};
}

// Apply shadow var to standard containers
.o_form_sheet,
.o_kanban_record,
.card {
    box-shadow: var(--ops-card-shadow);
}

// =============================================================================
// SETTINGS — Accent colors for sidebar and section headers
// =============================================================================

.o_base_settings_view .o_setting_container .settings_tab .tab {
    transition: background-color 0.2s ease, color 0.2s ease;

    &:hover:not(.selected) {
        background-color: rgba($o-action, 0.06);
    }

    &.selected {
        box-shadow: inset 3px 0 0 $o-action;
        font-weight: 600;
    }
}

.o_base_settings_view .settings > .app_settings_block h2 {
    border-left: 3px solid $o-action;
    font-weight: 600;
}

.o-settings-form-view .o_searchview:focus-within {
    border-color: $o-action;
    box-shadow: 0 0 0 3px rgba($o-action, 0.12);
}

.o_settings_container .o_searchable_setting {
    border-radius: var(--ops-border-radius, 8px);

    &.o_setting_highlight {
        --SearchableSetting__highlight-border: #{$o-action};
        --SearchableSetting__highlight-background: #{rgba($o-action, 0.08)};
    }
}

// =============================================================================
// NOTIFICATION ACCENTS — Severity-coded side stripe
// =============================================================================

.o_notification {
    border-left: 4px solid transparent;

    &.border-success,
    &.o_notification_success {
        border-left-color: $o-success;
    }

    &.border-warning,
    &.o_notification_warning {
        border-left-color: $o-warning;
    }

    &.border-danger,
    &.o_notification_danger {
        border-left-color: $o-danger;
    }

    &.border-info,
    &.o_notification_info {
        border-left-color: $o-action;
    }
}

// =============================================================================
// SMART SKINS — .ops-is-dark overrides (auto-applied when bg luminance < 128)
// =============================================================================
// When a dark-background skin is active, the server adds class="ops-is-dark"
// to <html>. These rules ensure dark skins remain usable regardless of the
// navbar_style setting.

// =============================================================================
// SEAMLESS SKINS — When bg == surface == border (no visual boundary)
// =============================================================================
// When all three canvas colors match, borders become invisible. We replace
// border-based separation with subtle shadow depth for cards and kanban.
// This is detected at compile time: if the skin's colors match, the rules apply.

@if $ops_color_bg == $ops_color_surface and $ops_color_bg == $ops_color_border {
    .o_kanban_record {
        border: none !important;
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.04), 0 1px 3px rgba(255, 255, 255, 0.06);
    }

    .o_setting_box,
    .o_settings_container .o_setting_box {
        border: none !important;
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.04), 0 1px 3px rgba(255, 255, 255, 0.06);
    }

    .o_form_sheet {
        border: none !important;
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.03);
    }

    .card {
        border: none !important;
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.04);
    }

    // List view row separation via subtle shadow instead of border
    .o_list_view .o_data_row {
        border-color: rgba(255, 255, 255, 0.04);
    }
}

html.ops-is-dark {

    // -- Navbar: Force surface color to prevent navy-on-navy invisibility --
    .o_main_navbar,
    nav.o_main_navbar {
        background: var(--ops-surface) !important;
        border-bottom: 1px solid var(--ops-border);

        .o_menu_sections .o_nav_entry,
        .o_menu_sections .dropdown-toggle {
            background: var(--ops-surface) !important;
        }

        .o_menu_toggle,
        .o_menu_sections button,
        .o_menu_sections a,
        .o_menu_systray .dropdown-toggle {
            color: var(--ops-text);
        }
    }

    // -- Headings: Force text color instead of brand (prevents dark-on-dark) --
    h1, h2, h3, h4, h5, h6 {
        color: var(--ops-text) !important;
    }

    // -- Semantic colors: Brighten for dark backgrounds via color-mix --
    --ops-success: color-mix(in srgb, #{$ops_color_success}, white 20%);
    --ops-warning: color-mix(in srgb, #{$ops_color_warning}, white 20%);
    --ops-danger: color-mix(in srgb, #{$ops_color_danger}, white 20%);
    --ops-info: color-mix(in srgb, #{$ops_color_info}, white 20%);

    // -- Links: Ensure visibility on dark backgrounds --
    a:not(.btn) {
        color: var(--ops-action);
    }

    // -- Form inputs: Dark surface for readability --
    .o_field_widget input,
    .o_field_widget textarea,
    .o_field_widget select {
        background-color: var(--ops-surface);
        color: var(--ops-text);
        border-color: var(--ops-border);
    }

    // -- Cards and sheets: Use skin surface --
    .o_form_sheet,
    .o_kanban_record,
    .card {
        background-color: var(--ops-surface);
        color: var(--ops-text);
    }

    // -- Sidebar: Already dark, just ensure contrast --
    .ops-sidebar {
        background: var(--ops-brand);
    }
}
