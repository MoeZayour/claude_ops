///
/// OPS Dark Mode — Core Layout + OPS Component Overrides
/// =====================================================
///
/// BUNDLE: web.assets_web_dark (only loaded when dark mode active)
///
/// WHY THIS FILE EXISTS:
/// Odoo 19 CE compiles SCSS variables ($o-webclient-background-color,
/// $o-view-background-color) into hardcoded light-mode values in the CSS.
/// Even with $enable-dark-mode: true, these fixed values override
/// Bootstrap 5.3's dark CSS variables.
///
/// This file provides runtime CSS overrides under html[data-bs-theme="dark"]
/// for elements that cannot be fixed at SCSS compile time.
///
/// IMPORTANT: Odoo 19 sets $variable-prefix: '' so CSS custom properties
/// are --body-bg (NOT --bs-body-bg), --body-color (NOT --bs-body-color), etc.
///

// =============================================================================
// 0. FIX BS5 DARK COLOR VARIABLES
// =============================================================================
// BS5 derives dark-mode --link-color from --primary (#1e293b → #787f89 muted gray).
// Our primary is dark navy which becomes invisible. Override with OPS branded blue.

html[data-bs-theme="dark"] {
    // Fix link colors — use OPS secondary (blue) instead of BS5 auto-derived gray
    --link-color: var(--ops-secondary, #3b82f6);
    --link-hover-color: #60a5fa;
    --link-color-rgb: 59, 130, 246;
    --link-hover-color-rgb: 96, 165, 250;

    // Fix primary text emphasis — BS5 auto-derives #0c1018 (nearly black)
    --primary-text-emphasis: #60a5fa;
    --primary-bg-subtle: #1a2744;
    --primary-border-subtle: #2d4a7a;
}

// =============================================================================
// 1. CORE LAYOUT — Fix hardcoded SCSS compile-time backgrounds
// =============================================================================

html[data-bs-theme="dark"] {

    // ---- Page wrapper (on <body>) ----
    .o_web_client {
        background-color: var(--body-bg, #212529) !important;
        color-scheme: dark;
        color: var(--body-color, #dee2e6);
    }

    // ---- Content areas ----
    .o_action_manager {
        background-color: var(--body-bg, #212529);
    }

    .o_content {
        background-color: var(--body-bg, #212529);
    }

    .o_view_controller {
        background-color: var(--body-bg, #212529);
    }

    // ---- Form view ----
    .o_form_sheet_bg {
        background-color: var(--body-bg, #212529) !important;
    }

    .o_form_sheet {
        background-color: var(--tertiary-bg, #2b3035) !important;
        border-color: var(--border-color, #495057) !important;
        color: var(--body-color, #dee2e6);
    }

    // Form nosheet (no card wrapper, e.g. settings)
    .o_form_nosheet {
        background-color: var(--body-bg, #212529) !important;
    }

    // ---- Control panel (breadcrumb / search bar area) ----
    .o_control_panel,
    .o_control_panel_main {
        background-color: var(--body-bg, #212529);
        color: var(--body-color, #dee2e6);
    }

    .o_searchview {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);

        .o_searchview_input {
            color: var(--body-color, #dee2e6);
        }
    }

    // ---- List view ----
    .o_list_view {
        --ListRenderer-thead-bg-color: var(--tertiary-bg, #2b3035);
        --ListRenderer-tfoot-bg-color: var(--tertiary-bg, #2b3035);

        .o_list_table {
            --table-bg: var(--body-bg, #212529);
            --table-color: var(--body-color, #dee2e6);
            --table-border-color: var(--border-color, #495057);
            --table-striped-bg: var(--tertiary-bg, #2b3035);
            --table-hover-bg: rgba(255, 255, 255, 0.05);
            color: var(--body-color, #dee2e6);

            th {
                color: var(--body-color, #dee2e6);
            }
        }
    }

    // ---- Kanban view ----
    .o_kanban_view {
        background-color: var(--body-bg, #212529);
    }

    .o_kanban_record {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);
    }

    .o_kanban_group_header {
        background-color: var(--body-bg, #212529);
    }

    // ---- Calendar view ----
    .o_calendar_renderer {
        background-color: var(--body-bg, #212529);
    }

    .fc {
        .fc-scrollgrid {
            border-color: var(--border-color, #495057);
        }

        .fc-col-header-cell,
        .fc-daygrid-day,
        .fc-timegrid-slot {
            background-color: var(--body-bg, #212529);
            border-color: var(--border-color, #495057);
        }

        .fc-day-today {
            background-color: rgba(var(--ops-secondary-rgb, 59, 130, 246), 0.1) !important;
        }
    }

    // ---- Pivot view ----
    .o_pivot {
        background-color: var(--body-bg, #212529);
        color: var(--body-color, #dee2e6);

        table {
            --table-bg: var(--body-bg, #212529);
            --table-color: var(--body-color, #dee2e6);
            --table-border-color: var(--border-color, #495057);
            color: var(--body-color, #dee2e6);
        }

        .o_pivot_header_cell_closed,
        .o_pivot_header_cell_opened {
            background-color: var(--tertiary-bg, #2b3035);
            color: var(--body-color, #dee2e6);
        }
    }

    // ---- Graph view ----
    .o_graph_renderer {
        background-color: var(--body-bg, #212529);
    }

    // ---- Cards (Odoo overrides $card-bg with $o-view-background-color) ----
    .card {
        --card-bg: var(--tertiary-bg, #2b3035);
        --card-border-color: var(--border-color, #495057);
        --card-color: var(--body-color, #dee2e6);
        --card-cap-bg: var(--secondary-bg, #343a40);
    }

    // ---- Modals (Odoo overrides $modal-content-bg) ----
    .modal-content {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);
    }

    .modal-header,
    .modal-footer {
        border-color: var(--border-color, #495057);
    }

    // ---- Form controls ----
    .form-control,
    .form-select {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);

        &:focus {
            background-color: var(--tertiary-bg, #2b3035);
            border-color: var(--ops-secondary, #3b82f6);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        &:disabled,
        &[readonly] {
            background-color: var(--secondary-bg, #343a40);
        }
    }

    // ---- Notebook tabs (form view) ----
    .o_notebook .nav-link {
        color: var(--body-color, #dee2e6);

        &.active {
            background-color: var(--tertiary-bg, #2b3035);
            border-color: var(--border-color, #495057);
            border-bottom-color: var(--tertiary-bg, #2b3035);
        }
    }

    // ---- Dropdown menus (global) ----
    .dropdown-menu {
        --dropdown-bg: var(--tertiary-bg, #2b3035);
        --dropdown-color: var(--body-color, #dee2e6);
        --dropdown-border-color: var(--border-color, #495057);
        --dropdown-link-color: var(--body-color, #dee2e6);
        --dropdown-link-hover-bg: rgba(255, 255, 255, 0.08);
        --dropdown-link-hover-color: #fff;
        --dropdown-divider-bg: var(--border-color, #495057);
    }

    // ---- List group (Odoo overrides $list-group-bg) ----
    .list-group-item {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);
    }

    // ==========================================================================
    // FIX 1: SETTINGS PAGE — Correct selectors matching Odoo 19 DOM
    // ==========================================================================
    // Odoo selectors: .o_base_settings_view .o_form_renderer
    //   .o_setting_container > .settings_tab (sidebar)
    //   .o_setting_container > .settings (main content, bg: $o-view-background-color)
    //   .settings h2 (section headers, bg: --settings__title-bg)
    //   .settingSearchHeader (bg: grays-200)

    .o_base_settings_view .o_form_renderer {
        // Override the CSS custom properties for dark mode
        --settings__tab-bg: var(--tertiary-bg, #2b3035);
        --settings__tab-bg--active: rgba(255, 255, 255, 0.08);
        --settings__tab-color: var(--body-color, #dee2e6);
        --settings__title-bg: var(--secondary-bg, #343a40);
    }

    .o_setting_container {
        .settings_tab {
            background: var(--tertiary-bg, #2b3035) !important;
            border-color: var(--border-color, #495057);

            .tab {
                color: var(--body-color, #dee2e6);

                &:hover,
                &.selected {
                    color: #fff;
                }
            }

            .selected {
                background-color: rgba(255, 255, 255, 0.08) !important;
            }
        }

        .settings {
            background-color: var(--body-bg, #212529) !important;
            color: var(--body-color, #dee2e6);

            > .app_settings_block {
                h2 {
                    background-color: var(--secondary-bg, #343a40) !important;
                    color: var(--body-color, #dee2e6);
                }
            }

            .settingSearchHeader {
                background-color: var(--secondary-bg, #343a40) !important;
                color: var(--body-color, #dee2e6);
            }

            .o_form_label,
            label {
                color: var(--body-color, #dee2e6);
            }

            .highlighter {
                background: #854d0e;
                color: #fef3c7;
            }
        }
    }

    // ==========================================================================
    // FIX 2: DISCUSS / MESSAGING — Full page dark background
    // ==========================================================================
    // Odoo's mail .dark.scss files handle sidebar/content via CSS custom properties
    // but the surface color computation uses mix() with light $o-webclient-bg-color.
    // Override the CSS variable directly for proper dark surface.

    .o_web_client:where(:has(.o-mail-Discuss)) {
        --mail-Discuss-surface-dark: var(--tertiary-bg, #2b3035);
    }

    .o-mail-Discuss {
        background-color: var(--body-bg, #212529) !important;
        color: var(--body-color, #dee2e6);
    }

    .o-mail-DiscussSidebar {
        background-color: var(--tertiary-bg, #2b3035) !important;
        border-right-color: var(--border-color, #495057) !important;

        .o-mail-DiscussSidebarCategory-header {
            color: var(--body-color, #dee2e6);
        }
    }

    .o-mail-DiscussContent-header {
        background-color: var(--tertiary-bg, #2b3035) !important;
        border-bottom-color: var(--border-color, #495057) !important;
    }

    .o-mail-Thread {
        background-color: var(--body-bg, #212529);
    }

    // Chatter (right side panel on forms)
    .o-mail-Form-chatter,
    .o-mail-Chatter {
        background-color: var(--body-bg, #212529);
    }

    .o-mail-Message {
        background-color: var(--body-bg, #212529);
        color: var(--body-color, #dee2e6);
    }

    // Composer (message input area)
    .o-mail-Composer {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
    }

    // ==========================================================================
    // FIX 3: SPREADSHEET DASHBOARD — Override hardcoded white
    // ==========================================================================
    // Odoo's dashboard_action.scss has: background-color: white (hardcoded).
    // Odoo intentionally forces o-spreadsheet to light mode (no dark support yet).
    // We darken the dashboard wrapper; the spreadsheet canvas stays light.

    .o_spreadsheet_dashboard_action {
        background-color: var(--body-bg, #212529) !important;
    }

    // Dashboard sidebar (search panel)
    .o_spreadsheet_dashboard_search_panel {
        background-color: var(--tertiary-bg, #2b3035) !important;
        border-right-color: var(--border-color, #495057) !important;

        li:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        .active {
            background-color: rgba(255, 255, 255, 0.12);
        }
    }

    // The spreadsheet itself stays light (Odoo forces color-scheme: light)
    // but we ensure the control panel above it is dark
    .o_spreadsheet_dashboard_action .o_control_panel {
        background-color: var(--body-bg, #212529) !important;
    }

    // ---- Generic spreadsheet wrapper ----
    .o_spreadsheet:not(.o_spreadsheet_dashboard_action .o-spreadsheet) {
        background-color: var(--body-bg, #212529);
    }

    // ---- Statusbar ----
    .o_statusbar_status .o_arrow_button {
        background-color: var(--secondary-bg, #343a40);
        color: var(--body-color, #dee2e6);
        border-color: var(--border-color, #495057);
    }

    // ---- Breadcrumb ----
    .o_breadcrumb .active {
        color: var(--body-color, #dee2e6);
    }

    // ---- Stat buttons (form view KPI blocks) ----
    .oe_stat_button {
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);

        .o_stat_value {
            color: var(--body-color, #dee2e6);
        }
    }

    // ---- Home menu (app switcher grid) ----
    .o_home_menu {
        background-color: var(--body-bg, #212529);
    }

    .o_app {
        color: var(--body-color, #dee2e6);
    }

    // ---- Scrollbar theming ----
    * {
        scrollbar-color: var(--secondary-bg, #343a40) var(--body-bg, #212529);
    }
}

// =============================================================================
// 2. DARK MODE CSS VARIABLE ADAPTATIONS
// =============================================================================

html[data-bs-theme="dark"] {
    --ops-card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
}

// =============================================================================
// 3. BRANDED NAVBAR — DROPDOWN MENUS IN DARK MODE
// =============================================================================

html[data-bs-theme="dark"] {
    .o_main_navbar {
        .dropdown-menu,
        .o-dropdown--menu {
            background-color: var(--body-bg, #212529);
            border-color: var(--border-color, #495057);
            color: var(--body-color, #dee2e6);

            .dropdown-item {
                color: var(--body-color, #dee2e6);

                &:hover,
                &:focus {
                    background-color: rgba(255, 255, 255, 0.08);
                    color: #ffffff;
                }

                &.active,
                &:active {
                    background-color: rgba(255, 255, 255, 0.12);
                }
            }

            .dropdown-divider {
                border-color: var(--border-color, #495057);
            }
        }

        .o_navbar_apps_menu .dropdown-menu {
            background-color: var(--body-bg, #212529);
        }
    }

    .o_menu_sections {
        .dropdown-menu,
        .o-dropdown--menu {
            background-color: var(--body-bg, #212529);
            border-color: var(--border-color, #495057);

            .dropdown-item,
            a,
            button {
                color: var(--body-color, #dee2e6);

                &:hover,
                &:focus {
                    background-color: rgba(255, 255, 255, 0.08);
                    color: #ffffff;
                }
            }
        }
    }
}

// =============================================================================
// 4. POPUPS / TOASTS / AUTOCOMPLETE IN DARK MODE
// =============================================================================

html[data-bs-theme="dark"] {
    .o_notification {
        &.border-info,
        &.border-success,
        &.border-warning,
        &.border-danger {
            background-color: var(--body-bg, #212529);
            color: var(--body-color, #dee2e6);
        }
    }

    .o-autocomplete--dropdown-menu {
        background-color: var(--body-bg, #212529);
        border-color: var(--border-color, #495057);

        .o-autocomplete--dropdown-item {
            color: var(--body-color, #dee2e6);

            &:hover,
            &.focus {
                background-color: rgba(255, 255, 255, 0.08);
            }
        }
    }

    .o_command_palette {
        .o_command_palette_search input {
            background-color: var(--body-bg, #212529);
            color: var(--body-color, #dee2e6);
            border-color: var(--border-color, #495057);
        }

        .o_command {
            color: var(--body-color, #dee2e6);

            &:hover,
            &.focused {
                background-color: rgba(255, 255, 255, 0.08);
            }
        }
    }

    .o_popover,
    .popover {
        --popover-bg: var(--tertiary-bg, #2b3035);
        --popover-border-color: var(--border-color, #495057);
        --popover-body-color: var(--body-color, #dee2e6);
        --popover-header-bg: var(--secondary-bg, #343a40);
    }
}

// =============================================================================
// 5. LOGIN PAGE (OPS CUSTOM COMPONENT)
// =============================================================================

html[data-bs-theme="dark"] {
    .ops-login-container {
        background: linear-gradient(135deg, var(--body-bg, #212529) 0%, var(--ops-primary, #1e293b) 100%);
    }

    .ops-login-panel {
        background: var(--ops-primary, #1e293b);
        border-color: var(--border-color, #495057);
    }

    .ops-login-brand {
        color: var(--body-color, #dee2e6);
    }

    .ops-login-form-panel {
        background-color: var(--body-bg, #212529) !important;
        color: var(--body-color, #dee2e6);
    }

    .ops-login-header h2,
    .ops-login-header p {
        color: var(--body-color, #dee2e6);
    }

    .ops-login-form-panel input[type="text"],
    .ops-login-form-panel input[type="password"],
    .ops-login-form-panel input[type="email"] {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        color: var(--body-color, #dee2e6);

        &:focus {
            background-color: var(--tertiary-bg, #2b3035);
            border-color: var(--ops-secondary, #3b82f6);
        }
    }
}

// =============================================================================
// 6. BUTTONS & BADGES — Branded colors in dark mode
// =============================================================================

html[data-bs-theme="dark"] {
    .btn-primary {
        --btn-bg: var(--ops-secondary, #3b82f6);
        --btn-border-color: var(--ops-secondary, #3b82f6);
        --btn-hover-bg: #2563eb;
        --btn-hover-border-color: #2563eb;
        --btn-active-bg: #1d4ed8;
        --btn-active-border-color: #1d4ed8;
        --btn-color: #fff;
    }

    .btn-success {
        --btn-bg: var(--ops-success, #10b981);
        --btn-border-color: var(--ops-success, #10b981);
    }

    .btn-warning {
        --btn-bg: var(--ops-warning, #f59e0b);
        --btn-border-color: var(--ops-warning, #f59e0b);
    }

    .btn-danger {
        --btn-bg: var(--ops-danger, #ef4444);
        --btn-border-color: var(--ops-danger, #ef4444);
    }

    .badge.text-bg-primary,
    .badge.bg-primary {
        background-color: var(--ops-secondary, #3b82f6) !important;
        color: #fff !important;
    }
}

// =============================================================================
// 7. APP GRID (OPS CUSTOM)
// =============================================================================

html[data-bs-theme="dark"] {
    .ops-app-grid {
        background: var(--body-bg, #212529);
    }

    .ops-app-tile {
        background: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);

        &:hover {
            background: var(--secondary-bg, #343a40);
        }
    }
}

// =============================================================================
// 8. STATUS BAR — Fix invisible arrow stages in dark mode
// =============================================================================

html[data-bs-theme="dark"] {
    .o_field_statusbar > .o_statusbar_status {
        --o-statusbar-border: var(--tertiary-bg, #2b3035);
        --o-statusbar-background-active: var(--ops-secondary, #3b82f6);
        --o-statusbar-border-active: var(--ops-secondary, #3b82f6);
        --o-statusbar-background-hover: rgba(255, 255, 255, 0.1);

        > .o_arrow_button:not(.d-none) {
            color: var(--body-color, #dee2e6);
            &.o_arrow_button_current:disabled, &:active:not(.o_last) { color: #fff; }
            &:disabled:not(.o_arrow_button_current) {
                &, &:hover, &:focus { color: var(--body-color, #adb5bd) !important; }
            }
        }
    }
    .o_form_statusbar { background-color: var(--body-bg, #212529) !important; }
}

// =============================================================================
// 9. FORM LABELS — Fix faint/invisible field labels
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_label, .o_form_view .o_form_label,
    .o_inner_group .o_form_label, label.o_form_label {
        color: var(--body-color, #dee2e6) !important;
        opacity: 0.85;
    }
    .o_field_widget .o_field_label_help .fa-question-circle,
    .o_form_label .o_field_label_help {
        color: var(--body-color, #94a3b8) !important;
    }
}

// =============================================================================
// 10. NOTEBOOK TABS — Fix invisible inactive tab labels
// =============================================================================

html[data-bs-theme="dark"] {
    .o_notebook .nav-tabs {
        border-bottom-color: var(--border-color, #495057);
        .nav-link {
            color: var(--body-color, #adb5bd);
            &:hover, &:focus {
                color: #ffffff;
                border-color: var(--border-color, #495057) var(--border-color, #495057) transparent;
            }
            &.active {
                color: #ffffff;
                background-color: var(--tertiary-bg, #2b3035);
                border-color: var(--border-color, #495057) var(--border-color, #495057) var(--tertiary-bg, #2b3035);
            }
        }
    }
    .o_notebook .tab-content { border-bottom-color: var(--border-color, #495057); }
}

// =============================================================================
// 11. INLINE TABLE HEADERS — Fix faint One2many list headers
// =============================================================================

html[data-bs-theme="dark"] {
    .o_field_one2many, .o_field_many2many, .o_list_renderer {
        .o_list_table {
            thead th {
                color: var(--body-color, #dee2e6) !important;
                background-color: var(--tertiary-bg, #2b3035) !important;
                border-bottom-color: var(--border-color, #495057) !important;
            }
            tfoot td {
                color: var(--body-color, #dee2e6);
                background-color: var(--tertiary-bg, #2b3035);
            }
            tbody td {
                color: var(--body-color, #dee2e6);
                border-bottom-color: var(--border-color, #495057);
            }
            tbody tr.o_selected_row td { background-color: var(--secondary-bg, #343a40); }
        }
    }
}

// =============================================================================
// 12. HEADER BUTTONS — Fix form header button area
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_view .o_form_statusbar {
        border-bottom-color: var(--border-color, #495057);
        .o_statusbar_buttons .btn {
            &.btn-secondary, &.btn-outline-secondary {
                color: var(--body-color, #dee2e6);
                border-color: var(--border-color, #495057);
                background-color: var(--tertiary-bg, #2b3035);
                &:hover { background-color: var(--secondary-bg, #343a40); color: #fff; }
            }
        }
    }
}

// =============================================================================
// 13. BREADCRUMB — Fix invisible text/badges
// =============================================================================

html[data-bs-theme="dark"] {
    .o_control_panel .breadcrumb .breadcrumb-item {
        color: var(--body-color, #dee2e6);
        a { color: var(--link-color, #3b82f6); }
        &.active { color: var(--body-color, #dee2e6); }
        + .breadcrumb-item::before { color: var(--body-color, #6c757d); }
    }
    .o_control_panel .o_searchview .o_searchview_facet .o_searchview_facet_label {
        background-color: var(--ops-secondary, #3b82f6);
        color: #ffffff;
    }
    .o_control_panel_main .o_cp_action_menus .dropdown-toggle,
    .o_control_panel_main .btn-secondary {
        color: var(--body-color, #dee2e6);
    }
}

// =============================================================================
// 14. CHATTER — Fix button bar, dividers, messages
// =============================================================================

html[data-bs-theme="dark"] {
    .o-mail-Chatter, .o-mail-Thread { color: var(--body-color, #dee2e6); }

    .o-mail-Chatter-topbar .btn {
        color: var(--body-color, #dee2e6);
        &:hover { background-color: rgba(255, 255, 255, 0.08); }
        &.btn-primary, &.text-bg-primary { color: #fff; }
    }

    .o-mail-DateSection {
        color: var(--body-color, #94a3b8) !important;
        .o-mail-DateSection-date { color: var(--body-color, #94a3b8); }
        &::before, &::after { border-color: var(--border-color, #495057) !important; }
    }

    .o-mail-Message {
        color: var(--body-color, #dee2e6);
        .o-mail-Message-header { color: var(--body-color, #adb5bd); }
        .o-mail-Message-body { color: var(--body-color, #dee2e6); }
    }

    .o-mail-Composer {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        .o-mail-Composer-input {
            color: var(--body-color, #dee2e6);
            background-color: var(--tertiary-bg, #2b3035);
        }
    }

    .o-mail-Followers-counter { color: var(--body-color, #dee2e6); }
}

// =============================================================================
// 15. FORM INPUTS — Fix readability of field values
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_view .o_field_widget {
        input.o_input, textarea.o_input, .o_input {
            color: var(--body-color, #dee2e6);
            background-color: var(--tertiary-bg, #2b3035);
            border-color: var(--border-color, #495057);
            &:focus {
                border-color: var(--ops-secondary, #3b82f6);
                background-color: var(--tertiary-bg, #2b3035);
            }
        }
    }

    .o_form_view .o_field_many2one .o_input,
    .o_form_view .o_field_many2one_selection .o_input {
        color: var(--body-color, #dee2e6) !important;
    }

    .o_form_view select.o_input {
        color: var(--body-color, #dee2e6);
        background-color: var(--tertiary-bg, #2b3035);
    }

    .oe_title {
        color: var(--body-color, #dee2e6);
        input { color: var(--body-color, #dee2e6) !important; }
    }
}

// =============================================================================
// 8. STATUS BAR — Fix invisible arrow stages in dark mode
// =============================================================================

html[data-bs-theme="dark"] {
    .o_field_statusbar > .o_statusbar_status {
        --o-statusbar-border: var(--tertiary-bg, #2b3035);
        --o-statusbar-background-active: var(--ops-secondary, #3b82f6);
        --o-statusbar-border-active: var(--ops-secondary, #3b82f6);
        --o-statusbar-background-hover: rgba(255, 255, 255, 0.1);

        > .o_arrow_button:not(.d-none) {
            color: var(--body-color, #dee2e6);
            &.o_arrow_button_current:disabled, &:active:not(.o_last) { color: #fff; }
            &:disabled:not(.o_arrow_button_current) {
                &, &:hover, &:focus { color: var(--body-color, #adb5bd) !important; }
            }
        }
    }
    .o_form_statusbar { background-color: var(--body-bg, #212529) !important; }
}

// =============================================================================
// 9. FORM LABELS — Fix faint/invisible field labels
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_label, .o_form_view .o_form_label,
    .o_inner_group .o_form_label, label.o_form_label {
        color: var(--body-color, #dee2e6) !important;
        opacity: 0.85;
    }
    .o_field_widget .o_field_label_help .fa-question-circle,
    .o_form_label .o_field_label_help {
        color: var(--body-color, #94a3b8) !important;
    }
}

// =============================================================================
// 10. NOTEBOOK TABS — Fix invisible inactive tab labels
// =============================================================================

html[data-bs-theme="dark"] {
    .o_notebook .nav-tabs {
        border-bottom-color: var(--border-color, #495057);
        .nav-link {
            color: var(--body-color, #adb5bd);
            &:hover, &:focus {
                color: #ffffff;
                border-color: var(--border-color, #495057) var(--border-color, #495057) transparent;
            }
            &.active {
                color: #ffffff;
                background-color: var(--tertiary-bg, #2b3035);
                border-color: var(--border-color, #495057) var(--border-color, #495057) var(--tertiary-bg, #2b3035);
            }
        }
    }
    .o_notebook .tab-content { border-bottom-color: var(--border-color, #495057); }
}

// =============================================================================
// 11. INLINE TABLE HEADERS — Fix faint One2many list headers
// =============================================================================

html[data-bs-theme="dark"] {
    .o_field_one2many, .o_field_many2many, .o_list_renderer {
        .o_list_table {
            thead th {
                color: var(--body-color, #dee2e6) !important;
                background-color: var(--tertiary-bg, #2b3035) !important;
                border-bottom-color: var(--border-color, #495057) !important;
            }
            tfoot td {
                color: var(--body-color, #dee2e6);
                background-color: var(--tertiary-bg, #2b3035);
            }
            tbody td {
                color: var(--body-color, #dee2e6);
                border-bottom-color: var(--border-color, #495057);
            }
            tbody tr.o_selected_row td { background-color: var(--secondary-bg, #343a40); }
        }
    }
}

// =============================================================================
// 12. HEADER BUTTONS — Fix form header button area
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_view .o_form_statusbar {
        border-bottom-color: var(--border-color, #495057);
        .o_statusbar_buttons .btn {
            &.btn-secondary, &.btn-outline-secondary {
                color: var(--body-color, #dee2e6);
                border-color: var(--border-color, #495057);
                background-color: var(--tertiary-bg, #2b3035);
                &:hover { background-color: var(--secondary-bg, #343a40); color: #fff; }
            }
        }
    }
}

// =============================================================================
// 13. BREADCRUMB — Fix invisible text/badges
// =============================================================================

html[data-bs-theme="dark"] {
    .o_control_panel .breadcrumb .breadcrumb-item {
        color: var(--body-color, #dee2e6);
        a { color: var(--link-color, #3b82f6); }
        &.active { color: var(--body-color, #dee2e6); }
        + .breadcrumb-item::before { color: var(--body-color, #6c757d); }
    }
    .o_control_panel .o_searchview .o_searchview_facet .o_searchview_facet_label {
        background-color: var(--ops-secondary, #3b82f6);
        color: #ffffff;
    }
    .o_control_panel_main .o_cp_action_menus .dropdown-toggle,
    .o_control_panel_main .btn-secondary {
        color: var(--body-color, #dee2e6);
    }
}

// =============================================================================
// 14. CHATTER — Fix button bar, dividers, messages
// =============================================================================

html[data-bs-theme="dark"] {
    .o-mail-Chatter, .o-mail-Thread { color: var(--body-color, #dee2e6); }

    .o-mail-Chatter-topbar .btn {
        color: var(--body-color, #dee2e6);
        &:hover { background-color: rgba(255, 255, 255, 0.08); }
        &.btn-primary, &.text-bg-primary { color: #fff; }
    }

    .o-mail-DateSection {
        color: var(--body-color, #94a3b8) !important;
        .o-mail-DateSection-date { color: var(--body-color, #94a3b8); }
        &::before, &::after { border-color: var(--border-color, #495057) !important; }
    }

    .o-mail-Message {
        color: var(--body-color, #dee2e6);
        .o-mail-Message-header { color: var(--body-color, #adb5bd); }
        .o-mail-Message-body { color: var(--body-color, #dee2e6); }
    }

    .o-mail-Composer {
        background-color: var(--tertiary-bg, #2b3035);
        border-color: var(--border-color, #495057);
        .o-mail-Composer-input {
            color: var(--body-color, #dee2e6);
            background-color: var(--tertiary-bg, #2b3035);
        }
    }

    .o-mail-Followers-counter { color: var(--body-color, #dee2e6); }
}

// =============================================================================
// 15. FORM INPUTS — Fix readability of field values
// =============================================================================

html[data-bs-theme="dark"] {
    .o_form_view .o_field_widget {
        input.o_input, textarea.o_input, .o_input {
            color: var(--body-color, #dee2e6);
            background-color: var(--tertiary-bg, #2b3035);
            border-color: var(--border-color, #495057);
            &:focus {
                border-color: var(--ops-secondary, #3b82f6);
                background-color: var(--tertiary-bg, #2b3035);
            }
        }
    }

    .o_form_view .o_field_many2one .o_input,
    .o_form_view .o_field_many2one_selection .o_input {
        color: var(--body-color, #dee2e6) !important;
    }

    .o_form_view select.o_input {
        color: var(--body-color, #dee2e6);
        background-color: var(--tertiary-bg, #2b3035);
    }

    .oe_title {
        color: var(--body-color, #dee2e6);
        input { color: var(--body-color, #dee2e6) !important; }
    }
}

// =============================================================================
// 16. ROUND 2 — Remaining dark mode contrast fixes
// =============================================================================

// --- 16a. Breadcrumb badge ---
html[data-bs-theme="dark"] {
    .breadcrumb .breadcrumb-item {
        color: #e2e8f0 !important;
        a { color: #93c5fd !important; }
        &.active { color: #f1f5f9 !important; }
        + .breadcrumb-item::before { color: #94a3b8 !important; }
    }
    .o_breadcrumb .o_back_button,
    .o_breadcrumb .btn-link {
        color: #93c5fd !important;
    }
    .breadcrumb .badge, .breadcrumb .o_back_button .badge {
        background-color: rgba(59, 130, 246, 0.2) !important;
        color: #93c5fd !important;
        border: 1px solid rgba(59, 130, 246, 0.4) !important;
    }
}

// --- 16b. Tooltip / Popover ---
html[data-bs-theme="dark"] {
    .tooltip, .tooltip-inner {
        background-color: #1e293b !important;
        color: #e2e8f0 !important;
        border: 1px solid #475569;
    }
    .popover {
        background-color: #1e293b !important;
        color: #e2e8f0 !important;
        border-color: #475569 !important;
        .popover-header {
            background-color: #334155 !important;
            color: #f1f5f9 !important;
            border-color: #475569 !important;
        }
        .popover-body { color: #e2e8f0 !important; }
    }
    .o_popover, .o-popover {
        background-color: #1e293b !important;
        color: #e2e8f0 !important;
        border-color: #475569 !important;
        * { color: #e2e8f0 !important; }
        .list-group-item {
            background-color: #1e293b !important;
            color: #cbd5e1 !important;
            border-color: #334155 !important;
        }
    }
}

// --- 16c. Notebook tabs (inactive + bar) ---
html[data-bs-theme="dark"] {
    .o_notebook .nav-tabs {
        border-bottom-color: #475569 !important;
        .nav-item .nav-link {
            color: #94a3b8 !important;
            &:hover {
                color: #e2e8f0 !important;
                border-color: #475569 #475569 transparent !important;
                background-color: rgba(255,255,255,0.04) !important;
            }
            &.active {
                color: #f1f5f9 !important;
                background-color: var(--body-bg, #212529) !important;
                border-color: #475569 #475569 var(--body-bg, #212529) !important;
            }
        }
    }
}

// --- 16d. Chatter bottom bar ---
html[data-bs-theme="dark"] {
    .o-mail-Chatter {
        .o-mail-Chatter-topbar {
            background-color: var(--secondary-bg, #343a40) !important;
            border-color: #475569 !important;
            .btn, button {
                color: #e2e8f0 !important;
                &:hover { background-color: rgba(255,255,255,0.08) !important; }
            }
            .btn-primary, .btn.text-bg-primary {
                color: #fff !important;
            }
        }
    }
    .o-mail-Form-chatter .btn,
    .o_FormRenderer_chatterContainer .btn,
    .o-mail-ActionPanel .btn {
        color: #e2e8f0 !important;
        &.btn-primary { color: #fff !important; }
    }
    .o-mail-Chatter .o-mail-Chatter-bottom,
    .o-mail-Chatter footer,
    .o_chatter_topbar {
        background-color: var(--secondary-bg, #343a40) !important;
        .btn { color: #e2e8f0 !important; }
    }
}

// --- 16e. Header buttons (Request Approval etc) ---
html[data-bs-theme="dark"] {
    .o_form_statusbar .o_statusbar_buttons {
        .btn:not(.btn-primary):not(.btn-secondary):not(.btn-success):not(.btn-danger):not(.btn-warning) {
            color: #e2e8f0 !important;
            border-color: #475569 !important;
            background-color: rgba(255,255,255,0.06) !important;
            &:hover { background-color: rgba(255,255,255,0.12) !important; }
        }
        .btn i, .btn .fa, .btn .oi { color: inherit !important; }
    }
}

// --- 16f. Today divider in chatter ---
html[data-bs-theme="dark"] {
    .o-mail-DateSection {
        color: #94a3b8 !important;
        span { color: #94a3b8 !important; }
        &::before, &::after {
            border-color: #475569 !important;
            background-color: #475569 !important;
        }
        hr { border-color: #475569 !important; }
    }
}

// =============================================================================
// 17. ROUND 3 — Chatter bar buttons + Request Approval
// =============================================================================

// --- 17a. Chatter bottom action buttons (Log note, Activity) ---
html[data-bs-theme="dark"] {
    // The button group next to Send message
    .o-mail-Chatter-sendMessage,
    .o-mail-Chatter-logNote,
    .o-mail-Chatter-activity,
    .o-mail-Chatter-topbar .btn-odoo,
    .o-mail-Chatter-topbar .btn-outline-secondary,
    .o-mail-Chatter .o-mail-Chatter-topbar > button,
    .o-mail-Chatter .o-mail-Chatter-topbar > .btn {
        color: #f1f5f9 !important;
        opacity: 1 !important;
    }
    // Specific colored buttons in chatter bar
    .o-mail-Chatter-topbar .text-bg-warning,
    .o-mail-Chatter-topbar .text-bg-success,
    .o-mail-Chatter-topbar .text-bg-info,
    .o-mail-Chatter-topbar .text-bg-secondary {
        color: #fff !important;
        opacity: 1 !important;
    }
}

// --- 17b. Request Approval button in header ---
html[data-bs-theme="dark"] {
    .o_form_statusbar .o_statusbar_buttons {
        // All non-colored buttons in the status bar
        > .btn, > button, > .dropdown > .btn {
            color: #e2e8f0 !important;
            &:not(.btn-primary):not(.btn-success):not(.btn-danger) {
                border-color: #64748b !important;
                background-color: rgba(255,255,255,0.08) !important;
                &:hover {
                    background-color: rgba(255,255,255,0.15) !important;
                    color: #fff !important;
                }
            }
        }
        // Ensure icons inherit color
        .fa, .oi, i { color: inherit !important; }
    }
    // The specific "Request Approval" style button
    .o_form_statusbar button[name="action_request_approval"],
    .o_form_statusbar .btn-light,
    .o_form_statusbar .btn-outline-dark {
        color: #e2e8f0 !important;
        border-color: #64748b !important;
        background-color: rgba(255,255,255,0.08) !important;
    }
}

// =============================================================================
// 18. ROUND 4 — Targeted class fixes from DevTools
// =============================================================================

// --- 18a. Chatter top bar (div.o-mail-Chatter-top) ---
html[data-bs-theme="dark"] {
    .o-mail-Chatter-top {
        background-color: var(--secondary-bg, #343a40) !important;
        border-color: #475569 !important;
        * { color: #f1f5f9 !important; }
        .btn-primary { color: #fff !important; }
    }
}

// --- 18b. Notebook headers bar (div.o_notebook_headers) ---
html[data-bs-theme="dark"] {
    .o_notebook_headers {
        background-color: transparent !important;
        border-bottom: 1px solid #475569;
    }
    .o_notebook_headers .nav-tabs {
        background-color: transparent !important;
    }
    .o_notebook_headers .nav-link {
        color: #94a3b8 !important;
        &.active {
            color: #f1f5f9 !important;
            background-color: var(--body-bg, #212529) !important;
        }
    }
}

// --- 18c. Breadcrumb "Quotations" label background ---
html[data-bs-theme="dark"] {
    .o_breadcrumb .active .o_back_button,
    .o_breadcrumb .o_back_button {
        background-color: rgba(59,130,246,0.15) !important;
        color: #93c5fd !important;
        border-color: rgba(59,130,246,0.3) !important;
    }
    // The "New" button / control panel main buttons
    .o_control_panel_main_buttons .btn,
    .o_control_panel_main_buttons button {
        color: #e2e8f0 !important;
        &.btn-primary { color: #fff !important; }
        &:not(.btn-primary) {
            border-color: #64748b !important;
            background-color: rgba(255,255,255,0.08) !important;
        }
    }
}

// --- 18d. Pager arrows (top-right 1/1 navigation) ---
html[data-bs-theme="dark"] {
    .o_pager .o_pager_previous,
    .o_pager .o_pager_next,
    .o_cp_pager .btn {
        color: #e2e8f0 !important;
        background-color: rgba(255,255,255,0.06) !important;
        border-color: #475569 !important;
        &:hover {
            background-color: rgba(255,255,255,0.12) !important;
            color: #fff !important;
        }
        &:disabled, &.disabled {
            color: #64748b !important;
            opacity: 0.5 !important;
        }
    }
}

// --- 18e. Request Approval button hover ---
html[data-bs-theme="dark"] {
    .o_form_statusbar .o_statusbar_buttons_after {
        .btn {
            color: #e2e8f0 !important;
            border-color: #64748b !important;
            background-color: rgba(255,255,255,0.08) !important;
            .fa, .oi, i { color: inherit !important; }
            &:hover {
                background-color: rgba(59,130,246,0.25) !important;
                border-color: #3b82f6 !important;
                color: #fff !important;
            }
        }
    }
}

// =============================================================================
// 19. ROUND 5 — Exact class targets from DevTools
// =============================================================================

// --- 19a. btn-secondary in dark mode (Log note, Activity) ---
html[data-bs-theme="dark"] {
    .btn-secondary {
        background-color: #475569 !important;
        border-color: #64748b !important;
        color: #f1f5f9 !important;
        &:hover {
            background-color: #64748b !important;
            color: #fff !important;
        }
    }
    .btn-outline-secondary {
        border-color: #64748b !important;
        color: #e2e8f0 !important;
        background-color: transparent !important;
        &:hover {
            background-color: #475569 !important;
            color: #fff !important;
        }
    }
}

// --- 19b. Breadcrumb "Quotations" ---
html[data-bs-theme="dark"] {
    ol.breadcrumb {
        .breadcrumb-item {
            a {
                color: #93c5fd !important;
                background-color: transparent !important;
            }
            &.active {
                color: #f1f5f9 !important;
            }
        }
    }
    // The back button wrapper that has the light bg
    .o_breadcrumb .o_back_button {
        background: none !important;
        a, .btn { 
            color: #93c5fd !important;
            background: none !important;
        }
    }
}

// --- 19c. Chatter-specific btn-secondary ---
html[data-bs-theme="dark"] {
    .o-mail-Chatter-logNote.btn-secondary,
    .o-mail-Chatter-activity.btn-secondary {
        background-color: #475569 !important;
        border-color: #64748b !important;
        color: #f1f5f9 !important;
        &:hover {
            background-color: #64748b !important;
            color: #fff !important;
        }
    }
}

// --- 19d. oe_stat_button.btn-outline-secondary ---
html[data-bs-theme="dark"] {
    .oe_stat_button.btn-outline-secondary {
        border-color: #64748b !important;
        color: #e2e8f0 !important;
        background-color: rgba(255,255,255,0.05) !important;
        &:hover {
            background-color: rgba(59,130,246,0.2) !important;
            border-color: #3b82f6 !important;
            color: #fff !important;
        }
    }
}

// =============================================================================
// 20. ROUND 6 — Dropdown highlight, breadcrumb, accounting dashboard
// =============================================================================

// --- 20a. Dropdown/select option highlight ---
html[data-bs-theme="dark"] {
    .o-autocomplete--dropdown-menu .o-autocomplete--dropdown-item.focus,
    .o-autocomplete--dropdown-menu .o-autocomplete--dropdown-item:hover,
    .o-autocomplete--dropdown-menu .o-autocomplete--dropdown-item.ui-state-active,
    .dropdown-menu .dropdown-item:hover,
    .dropdown-menu .dropdown-item.focus,
    .dropdown-menu .dropdown-item:focus,
    .dropdown-menu .dropdown-item.active,
    .o_select_menu_item:hover,
    .o_select_menu_item.o_selected,
    .ui-autocomplete .ui-menu-item-wrapper.ui-state-active,
    .o-autocomplete--dropdown-item.focus,
    .o-autocomplete--dropdown-item:hover {
        background-color: rgba(59,130,246,0.35) !important;
        color: #fff !important;
    }
}

// --- 20b. Breadcrumb wrapper light bg kill ---
html[data-bs-theme="dark"] {
    .o_breadcrumb {
        background: none !important;
        background-color: transparent !important;
        * {
            background-color: transparent !important;
        }
        a { color: #93c5fd !important; }
        .active { color: #e2e8f0 !important; }
    }
    // "New" button in control panel
    .o_control_panel_main_buttons .o_list_button_add,
    .o_control_panel_main_buttons .btn-secondary {
        background-color: #475569 !important;
        border-color: #64748b !important;
        color: #f1f5f9 !important;
    }
}

// --- 20c. Accounting dashboard kanban cards ---
html[data-bs-theme="dark"] {
    .o_kanban_renderer .o_kanban_record,
    .o_kanban_record {
        background-color: #1e293b !important;
        border-color: #334155 !important;
        color: #e2e8f0 !important;
    }
    // Kill purple hatched pattern on PDC card
    .o_kanban_record .oe_kanban_card,
    .o_account_dashboard,
    .o_kanban_view .o_kanban_record {
        background-color: #1e293b !important;
        background-image: none !important;
    }
}

// =============================================================================
// 21. ROUND 7 — Kill bg-view purple pattern globally
// =============================================================================

// --- 21a. bg-view is the root cause of ALL purple hatched backgrounds ---
html[data-bs-theme="dark"] {
    .bg-view {
        background-color: #0f172a !important;
        background-image: none !important;
    }
    .o_search_panel {
        background-color: #1e293b !important;
        background-image: none !important;
    }
    .o_kanban_renderer {
        background-color: #0f172a !important;
        background-image: none !important;
    }
    .o_kanban_record {
        background-color: #1e293b !important;
        background-image: none !important;
        border-color: #334155 !important;
    }
    .o_view_controller,
    .o_action_manager,
    .o_content {
        background-color: #0f172a !important;
        background-image: none !important;
    }
}

// =============================================================================
// 22. ROUND 8 — Settings page boxes global fix
// =============================================================================

html[data-bs-theme="dark"] {
    .o_setting_box {
        background-color: #1e293b !important;
        background-image: none !important;
        border-color: #334155 !important;
        color: #e2e8f0 !important;
        * { color: #e2e8f0 !important; }
        a { color: #93c5fd !important; }
        .text-muted { color: #94a3b8 !important; }
        .btn-primary { color: #fff !important; }
    }
    .o_settings_container,
    .o_base_settings {
        background-color: #0f172a !important;
        background-image: none !important;
    }
    .app_settings_block {
        background-color: transparent !important;
        background-image: none !important;
    }
    .o_setting_left_pane,
    .o_setting_right_pane {
        color: #e2e8f0 !important;
    }
    .o_setting_right_pane .text-muted,
    .o_setting_right_pane span {
        color: #94a3b8 !important;
    }
    .o_settings_container .o_form_label {
        color: #e2e8f0 !important;
    }
}
