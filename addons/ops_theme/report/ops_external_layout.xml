<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================
         OPS EXTERNAL LAYOUT — Single Source of Truth

         Registered as a layout option in Odoo's Document Layout picker.
         When selected, all reports using t-call="web.external_layout"
         will use this layout.

         Structure: div.header → div.article → div.footer
         wkhtmltopdf extracts header/footer for page repetition.

         All CSS is inline — no external stylesheet dependencies.
         ================================================================ -->

    <!-- ======================== PAPER FORMAT ========================= -->
    <record id="paperformat_ops_external" model="report.paperformat">
        <field name="name">OPS External Document A4</field>
        <field name="default">False</field>
        <field name="format">A4</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">35</field>
        <field name="margin_bottom">25</field>
        <field name="margin_left">12</field>
        <field name="margin_right">12</field>
        <field name="header_line">False</field>
        <field name="header_spacing">30</field>
        <field name="dpi">96</field>
    </record>

    <!-- ======================== MAIN LAYOUT ========================== -->
    <template id="external_layout_ops" name="OPS Corporate">
        <!-- Resolve company with safe fallback chain -->
        <t t-if="not o" t-set="o" t-value="doc"/>
        <t t-if="not company">
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="">
                <t t-set="company" t-value="res_company"/>
            </t>
        </t>

        <!-- Dynamic colors — ops_report_primary_color from accounting, ops_primary_color from theme -->
        <t t-set="ops_primary" t-value="company.ops_report_primary_color or '#3d58a3'"/>
        <t t-set="ops_text_on_primary" t-value="company.ops_report_text_on_primary or '#FFFFFF'"/>
        <t t-set="ops_body_text" t-value="company.ops_report_body_text_color or '#1a1a1a'"/>
        <t t-set="ops_rgb" t-value="'%s,%s,%s' % (int(ops_primary[1:3], 16), int(ops_primary[3:5], 16), int(ops_primary[5:7], 16)) if ops_primary.startswith('#') and len(ops_primary) == 7 else '61,88,163'"/>

        <!-- =================== HEADER =================== -->
        <div t-attf-class="header o_company_#{company.id}_layout" style="border-bottom: none; padding-bottom: 0;">
            <table style="width: 100%; border-collapse: collapse; font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                <tr>
                    <!-- Logo or initials -->
                    <td style="width: 60px; vertical-align: top; padding-right: 10px;">
                        <t t-if="company.logo">
                            <img t-att-src="image_data_uri(company.logo)"
                                 style="max-width: 55px; max-height: 55px; border-radius: 5px;"
                                 alt="Company Logo"/>
                        </t>
                        <t t-else="">
                            <div t-attf-style="width: 55px; height: 55px; border-radius: 5px; background: #{ops_primary}; color: #{ops_text_on_primary}; text-align: center; line-height: 55px; font-size: 16px; font-weight: 700;">
                                <t t-esc="(company.name or 'CO')[:2].upper()"/>
                            </div>
                        </t>
                    </td>
                    <!-- Company info -->
                    <td style="vertical-align: top;">
                        <div t-attf-style="font-size: 14pt; font-weight: 700; color: #{ops_primary}; margin-bottom: 1px;">
                            <t t-esc="company.name"/>
                        </div>
                        <div style="font-size: 7.5pt; color: #64748b; line-height: 1.55;">
                            <t t-if="company.is_company_details_empty">
                                <t t-if="company.street"><t t-esc="company.street"/>
                                    <t t-if="company.street2">, <t t-esc="company.street2"/></t>
                                    <br/>
                                </t>
                                <t t-if="company.city"><t t-esc="company.city"/></t>
                                <t t-if="company.state_id">, <t t-esc="company.state_id.name"/></t>
                                <t t-if="company.zip"> <t t-esc="company.zip"/></t>
                                <t t-if="company.country_id">, <t t-esc="company.country_id.name"/></t>
                                <t t-if="company.city or company.state_id or company.zip or company.country_id"><br/></t>
                                <t t-if="company.phone">Tel: <t t-esc="company.phone"/></t>
                                <t t-if="company.phone and company.email"> &#160;|&#160; </t>
                                <t t-if="company.email"><t t-esc="company.email"/></t>
                                <t t-if="company.phone or company.email"><br/></t>
                                <t t-if="company.company_registry">CR: <t t-esc="company.company_registry"/></t>
                                <t t-if="company.company_registry and company.vat"> &#160;|&#160; </t>
                                <t t-if="company.vat">VAT: <t t-esc="company.vat"/></t>
                            </t>
                            <t t-else="">
                                <span t-field="company.company_details"/>
                            </t>
                        </div>
                    </td>
                    <!-- Print date -->
                    <td style="vertical-align: top; text-align: right; white-space: nowrap;">
                        <div style="font-size: 7pt; color: #94a3b8; font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                            Printed: <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d %b %Y')"/>
                        </div>
                    </td>
                </tr>
            </table>
            <hr t-attf-style="background: #{ops_primary}; height: 2.5px; margin: 6px 0 0 0; border: none;"/>
        </div>

        <!-- =================== ARTICLE =================== -->
        <div t-attf-class="article o_report_layout_ops o_company_#{company.id}_layout"
             t-attf-style="font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #{ops_body_text}; font-size: 9pt; line-height: 1.5;">
            <t t-out="0"/>
        </div>

        <!-- =================== FOOTER =================== -->
        <div t-attf-class="footer o_company_#{company.id}_layout" style="font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
            <table style="width: 100%; border-collapse: collapse; border-top: 1px solid #e2e8f0; padding-top: 6px; font-size: 7pt;">
                <tr>
                    <td style="vertical-align: middle; color: #94a3b8;">
                        <strong style="color: #64748b;"><t t-esc="company.name"/></strong>
                        <t t-if="company.company_registry">
                            &#160;|&#160; CR: <t t-esc="company.company_registry"/>
                        </t>
                        <t t-if="company.vat">
                            &#160;|&#160; VAT: <t t-esc="company.vat"/>
                        </t>
                        <t t-if="company.website">
                            &#160;|&#160; <t t-esc="company.website"/>
                        </t>
                    </td>
                    <td style="text-align: right; vertical-align: middle; white-space: nowrap;">
                        <t t-if="company.ops_show_external_badge">
                            <span style="font-size: 6.5pt; color: #94a3b8; margin-right: 3px;">Powered by</span>
                            <img src="data:image/png;base64,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" style="height: 18px; vertical-align: middle; margin-left: 4px;" alt="OPS Framework"/>
                            <span style="margin-left: 8px;"/>
                        </t>
                        <t t-if="report_type == 'pdf'">
                            <span style="font-size: 7pt; color: #94a3b8;">
                                Page <span class="page"/> / <span class="topage"/>
                            </span>
                        </t>
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <!-- ===================== HELPER TEMPLATES ======================== -->

    <!-- Address block: renders partner address with fail-safe -->
    <template id="ops_address_block" name="OPS Address Block">
        <!--
            Usage: <t t-call="ops_theme.ops_address_block">
                       <t t-set="partner" t-value="doc.partner_id"/>
                       <t t-set="addr_label" t-value="'Invoice To'"/>
                   </t>
        -->
        <t t-if="partner">
            <div style="font-size: 8.5pt; margin-bottom: 12px;">
                <div t-if="addr_label" t-attf-style="font-size: 7pt; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: #{company.ops_report_primary_color or '#3d58a3'}; margin-bottom: 4px;">
                    <t t-esc="addr_label"/>
                </div>
                <div style="font-weight: 600; font-size: 9.5pt;">
                    <t t-esc="partner.name"/>
                </div>
                <div style="color: #475569; line-height: 1.6; margin-top: 2px; font-size: 8pt;">
                    <t t-if="partner.street"><t t-esc="partner.street"/><br/></t>
                    <t t-if="partner.street2"><t t-esc="partner.street2"/><br/></t>
                    <t t-if="partner.city"><t t-esc="partner.city"/></t>
                    <t t-if="partner.state_id">, <t t-esc="partner.state_id.name"/></t>
                    <t t-if="partner.zip"> <t t-esc="partner.zip"/></t>
                    <t t-if="partner.city or partner.state_id or partner.zip"><br/></t>
                    <t t-if="partner.country_id"><t t-esc="partner.country_id.name"/><br/></t>
                    <t t-if="partner.vat">Tax ID: <t t-esc="partner.vat"/><br/></t>
                    <t t-if="partner.phone">Tel: <t t-esc="partner.phone"/></t>
                    <t t-if="partner.phone and partner.email"> | </t>
                    <t t-if="partner.email"><t t-esc="partner.email"/></t>
                </div>
            </div>
        </t>
    </template>

    <!-- Signature block -->
    <template id="ops_signature_block" name="OPS Signature Block">
        <!--
            Usage: <t t-call="ops_theme.ops_signature_block"/>
            Requires: company in context
        -->
        <t t-if="company.ops_show_signature_block">
            <t t-set="sig1" t-value="company.ops_signature_label_1 or 'Prepared By'"/>
            <t t-set="sig2" t-value="company.ops_signature_label_2 or 'Authorized Signatory'"/>
            <t t-set="sig3" t-value="company.ops_signature_label_3 or 'Customer Acceptance'"/>
            <div style="margin-top: 30px; page-break-inside: avoid;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td style="width: 33%; padding: 0 10px 0 0; vertical-align: top;">
                            <div style="border-top: 1px solid #cbd5e1; padding-top: 6px; text-align: center;">
                                <div style="font-size: 7pt; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.3px;">
                                    <t t-esc="sig1"/>
                                </div>
                            </div>
                        </td>
                        <td style="width: 33%; padding: 0 5px; vertical-align: top;">
                            <div style="border-top: 1px solid #cbd5e1; padding-top: 6px; text-align: center;">
                                <div style="font-size: 7pt; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.3px;">
                                    <t t-esc="sig2"/>
                                </div>
                            </div>
                        </td>
                        <td style="width: 33%; padding: 0 0 0 10px; vertical-align: top;">
                            <div style="border-top: 1px solid #cbd5e1; padding-top: 6px; text-align: center;">
                                <div style="font-size: 7pt; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.3px;">
                                    <t t-esc="sig3"/>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </t>
    </template>

    <!-- Terms & Conditions -->
    <template id="ops_terms_block" name="OPS Terms Block">
        <!--
            Usage: <t t-call="ops_theme.ops_terms_block">
                       <t t-set="doc_note" t-value="doc.note"/>
                   </t>
            Falls back to company.ops_report_terms if no doc_note
        -->
        <t t-set="terms" t-value="doc_note or company.ops_report_terms or False"/>
        <t t-if="terms">
            <div style="margin-top: 16px; padding: 8px 10px; border-left: 3px solid #e2e8f0; font-size: 7.5pt; color: #64748b; page-break-inside: avoid;">
                <div style="font-weight: 600; margin-bottom: 4px; font-size: 7pt; text-transform: uppercase; letter-spacing: 0.3px;">Terms &amp; Conditions</div>
                <t t-out="terms"/>
            </div>
        </t>
    </template>

    <!-- Amount in words -->
    <template id="ops_amount_words_block" name="OPS Amount in Words">
        <!--
            Usage: <t t-call="ops_theme.ops_amount_words_block">
                       <t t-set="amount_words_en" t-value="'...'"/>
                       <t t-set="amount_words_ar" t-value="'...'"/>
                   </t>
        -->
        <t t-if="amount_words_en or amount_words_ar">
            <div t-attf-style="margin-top: 10px; padding: 6px 10px; background: rgba(#{company.ops_report_primary_color and ('%s,%s,%s' % (int(company.ops_report_primary_color[1:3], 16), int(company.ops_report_primary_color[3:5], 16), int(company.ops_report_primary_color[5:7], 16))) or '61,88,163'}, 0.07); border-radius: 3px; font-size: 8.5pt; page-break-inside: avoid;">
                <span style="font-weight: 600; color: #475569;">Amount in Words:</span>
                <t t-if="amount_words_en">
                    <span style="color: #1e293b;"> <t t-esc="amount_words_en"/></span>
                </t>
                <t t-if="amount_words_ar">
                    <br/><span dir="rtl" style="color: #1e293b; font-family: 'Arial', 'Tahoma', sans-serif;"><t t-esc="amount_words_ar"/></span>
                </t>
            </div>
        </t>
    </template>

    <!-- =================== REGISTER AS LAYOUT OPTION ================ -->
    <record id="report_layout_ops" model="report.layout">
        <field name="name">OPS Professional</field>
        <field name="sequence">100</field>
        <field name="view_id" ref="external_layout_ops"/>
        <field name="image">/ops_theme/static/description/layout_ops.png</field>
    </record>

</odoo>
