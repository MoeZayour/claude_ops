<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Email template for escalation reminder to original approver -->
        <record id="email_template_escalation_reminder" model="mail.template">
            <field name="name">Approval Escalation Reminder</field>
            <field name="model_id" ref="model_ops_approval_request"/>
            <field name="subject">Approval Escalated: {{ object.res_name }}</field>
            <field name="email_to">{{ object.create_uid.email }}</field>
            <field name="body_html"><![CDATA[
<p>Dear {{ object.create_uid.name }},</p>
<p>
    This is a notification that the approval request for <strong>{{ object.res_name }}</strong> has been escalated due to a timeout.
</p>
<p>
    The request has been reassigned to a new approver. Your timely action on future requests is appreciated.
</p>
<p>
    <a href="{{ object.get_portal_url() }}" style="background-color: #875A7B; padding: 10px; text-decoration: none; color: #fff; border-radius: 5px;">View Request</a>
</p>
<p>
    Thank you,
</p>
<p>
    <em>The Odoo System</em>
</p>
            ]]></field>
        </record>

        <!-- Email template for new approver -->
        <record id="email_template_escalation_new_approver" model="mail.template">
            <field name="name">Escalated Approval Request</field>
            <field name="model_id" ref="model_ops_approval_request"/>
            <field name="subject">Escalated Approval Required: {{ object.res_name }}</field>
            <field name="email_to">{{ user.email }}</field>
            <field name="body_html"><![CDATA[
<p>Dear {{ user.name }},</p>
<p>
    An approval request for <strong>{{ object.res_name }}</strong> has been escalated to you for your review and action.
</p>
<p>
    <strong>Reason for Escalation:</strong> The request exceeded the defined response time for the previous approver.
</p>
<p>
    Please review the request at your earliest convenience.
</p>
<p>
    <a href="{{ object.get_portal_url() }}" style="background-color: #875A7B; padding: 10px; text-decoration: none; color: #fff; border-radius: 5px;">View Request</a>
</p>
<p>
    Thank you,
</p>
<p>
    <em>The Odoo System</em>
</p>
            ]]></field>
        </record>

        <!-- SLA Warning Email -->
        <record id="email_template_sla_warning" model="mail.template">
            <field name="name">OPS: SLA Deadline Approaching</field>
            <field name="model_id" ref="model_ops_sla_instance"/>
            <field name="subject">‚ö†Ô∏è SLA Deadline Approaching: {{ object.name }}</field>
            <field name="email_to">{{ object.current_approver_id.email }}</field>
            <field name="body_html"><![CDATA[
<div style="font-family: Arial, sans-serif; padding: 20px;">
    <h2 style="color: #f0ad4e;">‚ö†Ô∏è SLA Deadline Approaching</h2>
    <p>Dear {{ object.current_approver_id.name }},</p>
    <p>The following SLA is approaching its deadline:</p>
    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Reference:</strong></td>
            <td style="padding: 10px;">{{ object.name }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Deadline:</strong></td>
            <td style="padding: 10px;">{{ object.deadline }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Remaining:</strong></td>
            <td style="padding: 10px;">{{ '%.1f' % object.remaining_hours }} hours</td>
        </tr>
    </table>
    <p>Please complete this approval as soon as possible to avoid escalation.</p>
</div>
            ]]></field>
        </record>

        <!-- SLA Escalation Email -->
        <record id="email_template_sla_escalation" model="mail.template">
            <field name="name">OPS: SLA Escalated</field>
            <field name="model_id" ref="model_ops_sla_instance"/>
            <field name="subject">üî• ESCALATED (Level {{ ctx.get('escalation_level') }}): {{ object.name }}</field>
            <field name="email_to">{{ ctx.get('approver_name', 'Approver') }}</field>
            <field name="body_html"><![CDATA[
<div style="font-family: Arial, sans-serif; padding: 20px;">
    <h2 style="color: #dc3545;">üî• SLA Escalated to Level {{ ctx.get('escalation_level') }}</h2>
    <p>Dear {{ ctx.get('approver_name') }},</p>
    <p>The following approval has been escalated to you due to timeout:</p>
    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Reference:</strong></td>
            <td style="padding: 10px;">{{ object.name }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Original Deadline:</strong></td>
            <td style="padding: 10px;">{{ object.deadline }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Escalation Level:</strong></td>
            <td style="padding: 10px;">{{ ctx.get('escalation_level') }}</td>
        </tr>
    </table>
    <p style="color: #dc3545; font-weight: bold;">URGENT: This requires immediate attention.</p>
</div>
            ]]></field>
        </record>

        <!-- SLA Failed Email -->
        <record id="email_template_sla_failed" model="mail.template">
            <field name="name">OPS: SLA Failed</field>
            <field name="model_id" ref="model_ops_sla_instance"/>
            <field name="subject">‚ùå SLA FAILED: {{ object.name }}</field>
            <field name="email_to">admin@example.com</field>
            <field name="body_html"><![CDATA[
<div style="font-family: Arial, sans-serif; padding: 20px;">
    <h2 style="color: #dc3545;">‚ùå SLA Failed - Maximum Escalation Reached</h2>
    <p>The following SLA has failed after reaching maximum escalation level:</p>
    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Reference:</strong></td>
            <td style="padding: 10px;">{{ object.name }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Deadline:</strong></td>
            <td style="padding: 10px;">{{ object.deadline }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; background: #f8f9fa;"><strong>Elapsed:</strong></td>
            <td style="padding: 10px;">{{ '%.1f' % object.elapsed_hours }} hours</td>
        </tr>
    </table>
    <p>This requires manual intervention and investigation.</p>
</div>
            ]]></field>
        </record>

    </data>
</odoo>
