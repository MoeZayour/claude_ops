<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="group_ops_user" model="res.groups">
        <field name="name">OPS User</field>
        <field name="comment">Basic OPS Matrix access. Can view branch/BU information and create requests.</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>
    
    <record id="group_ops_manager" model="res.groups">
        <field name="name">OPS Manager</field>
        <field name="comment">Can manage operations within assigned branches and business units.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user'))]"/>
    </record>
    
    <!-- OPS Administrator: highest OPS-level group but does NOT imply group_system.
         group_system is reserved for SYS_ADMIN persona only (framework owner).
         Previous version implied group_system which made any Matrix Administrator
         bypass ALL record rules (branch isolation, IT Admin blindness, etc.) -->
    <record id="group_ops_admin_power" model="res.groups">
        <field name="name">OPS Administrator</field>
        <field name="implied_ids" eval="[(6, 0, [ref('ops_matrix_core.group_ops_manager')])]"/>
        <field name="comment">Top-level OPS authority. Full access to all OPS features, governance rules, and approval configuration. Does NOT bypass security rules â€” only SYS_ADMIN (group_system) does.</field>
    </record>

    <record id="group_ops_product_approver" model="res.groups">
        <field name="name">Product Approver</field>
        <field name="comment">Can approve product requests from other users/branches.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user'))]"/>
    </record>
    
    <record id="group_ops_matrix_administrator" model="res.groups">
        <field name="name">Matrix Administrator</field>
        <field name="comment">Full access to matrix configuration including dashboard widgets. Inherits OPS Administrator.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_admin_power'))]"/>
    </record>

    <!-- IT Admin Group - BLIND to business data -->
    <record id="group_ops_it_admin" model="res.groups">
        <field name="name">IT Administrator</field>
        <field name="comment">System administration with NO access to business transactions (orders, invoices, payments, etc.). Can manage users, system configuration, and technical settings only.</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Data Visibility Groups - Control access to sensitive financial data -->
    <record id="group_ops_see_cost" model="res.groups">
        <field name="name">Can See Product Costs</field>
        <field name="comment">Grants visibility to product cost prices. Required for margin calculations and purchase planning.</field>
    </record>

    <record id="group_ops_see_margin" model="res.groups">
        <field name="name">Can See Profit Margins</field>
        <field name="comment">Grants visibility to profit margin data in sales orders and reports. Typically assigned to sales managers and executives.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_see_cost'))]"/>
    </record>

    <record id="group_ops_see_valuation" model="res.groups">
        <field name="name">Can See Stock Valuation</field>
        <field name="comment">Grants visibility to inventory valuation amounts. Required for financial reporting and stock analysis.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_see_cost'))]"/>
    </record>

    <!-- Pricing Authority Group - Controls who can modify selling prices -->
    <record id="group_ops_price_manager" model="res.groups">
        <field name="name">Price Manager</field>
        <field name="comment">Can modify unit prices on sale order lines. Assigned to commercial and finance leadership (CFO, Financial Controller, Sales Leader, Chief Accountant). Operational managers must request price changes via approval workflow.</field>
    </record>

    <!-- Executive Groups -->
    <record id="group_ops_executive" model="res.groups">
        <field name="name">Executive / CEO</field>
        <field name="comment">Executive-level access with read-only oversight across all branches and business units. Cannot modify transactions.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user')), (4, ref('ops_matrix_core.group_ops_see_cost')), (4, ref('ops_matrix_core.group_ops_see_margin')), (4, ref('ops_matrix_core.group_ops_see_valuation'))]"/>
    </record>

    <record id="group_ops_cfo" model="res.groups">
        <field name="name">CFO / Owner</field>
        <field name="comment">Full financial access across all entities. Can view and modify all financial data, approve high-value transactions.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_cost')), (4, ref('ops_matrix_core.group_ops_see_margin')), (4, ref('ops_matrix_core.group_ops_see_valuation'))]"/>
    </record>

    <!-- Branch Manager (P05) - Single Branch Operations -->
    <record id="group_ops_branch_manager" model="res.groups">
        <field name="name">OPS Branch Manager</field>
        <field name="comment">Branch Manager - Manages single branch operations, sees only own branch data. Cannot see cross-branch information.</field>
        <field name="implied_ids" eval="[(4, ref('group_ops_user'))]"/>
    </record>

    <!-- BU Leader (P04) - Multi-Branch within BU -->
    <record id="group_ops_bu_leader" model="res.groups">
        <field name="name">Business Unit Leader</field>
        <field name="comment">Business Unit Leader - Manages multiple branches within BU, sees all BU data. Cross-branch visibility within their business unit.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_branch_manager')), (4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_margin'))]"/>
    </record>

    <record id="group_ops_cross_branch_bu_leader" model="res.groups">
        <field name="name">Cross-Branch BU Leader</field>
        <field name="comment">Business unit leaders with visibility across all branches for their BU.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_bu_leader'))]"/>
    </record>

    <!-- Functional Manager Groups -->
    <record id="group_ops_sales_manager" model="res.groups">
        <field name="name">Sales Manager</field>
        <field name="comment">Manage sales operations, approve discounts, view costs and margins for their branch.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_branch_manager')), (4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_cost')), (4, ref('ops_matrix_core.group_ops_see_margin'))]"/>
    </record>

    <record id="group_ops_purchase_manager" model="res.groups">
        <field name="name">Purchase Manager</field>
        <field name="comment">Manage purchase operations, approve purchase orders, view product costs.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_branch_manager')), (4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_cost'))]"/>
    </record>

    <record id="group_ops_inventory_manager" model="res.groups">
        <field name="name">Inventory Manager</field>
        <field name="comment">Manage inventory operations, approve adjustments, view stock valuation.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_branch_manager')), (4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_valuation'))]"/>
    </record>

    <record id="group_ops_finance_manager" model="res.groups">
        <field name="name">Finance Manager</field>
        <field name="comment">Manage financial operations, approve payments and invoices, full financial visibility.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_manager')), (4, ref('ops_matrix_core.group_ops_see_cost')), (4, ref('ops_matrix_core.group_ops_see_margin')), (4, ref('ops_matrix_core.group_ops_see_valuation'))]"/>
    </record>

    <record id="group_ops_cost_controller" model="res.groups">
        <field name="name">OPS Cost Controller</field>
        <field name="comment">Access to cost and margin controls for financial analysis.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_finance_manager'))]"/>
    </record>

    <record id="group_ops_accountant" model="res.groups">
        <field name="name">Accountant / Controller</field>
        <field name="comment">Full accounting access including cost, margin, and valuation data. Can create journal entries and reconcile accounts.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user')), (4, ref('ops_matrix_core.group_ops_see_cost')), (4, ref('ops_matrix_core.group_ops_see_margin')), (4, ref('ops_matrix_core.group_ops_see_valuation'))]"/>
    </record>

    <record id="group_ops_treasury" model="res.groups">
        <field name="name">Treasury Officer</field>
        <field name="comment">Manage cash flow, payments, and banking operations. View financial data for cash management.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user'))]"/>
    </record>

    <!-- Compliance Officer - Oversight role for governance and audit -->
    <record id="group_ops_compliance_officer" model="res.groups">
        <field name="name">Compliance Officer</field>
        <field name="comment">Compliance oversight role. Read access to governance rules, audit logs, and SoD violations. Cannot modify business transactions.</field>
        <field name="implied_ids" eval="[(4, ref('ops_matrix_core.group_ops_user'))]"/>
    </record>

    <!-- Data Export Permission -->
    <record id="group_ops_can_export" model="res.groups">
        <field name="name">Can Export Data</field>
        <field name="comment">Users who can use the Secure Export Wizard to export data. Exports are logged and filtered by matrix permissions.</field>
        <field name="implied_ids" eval="[(6, 0, [ref('ops_matrix_core.group_ops_manager')])]"/>
    </record>
</odoo>
