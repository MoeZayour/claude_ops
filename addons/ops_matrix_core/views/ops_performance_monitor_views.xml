<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Performance Monitor Tree View -->
    <record id="view_ops_performance_monitor_tree" model="ir.ui.view">
        <field name="name">ops.performance.monitor.tree</field>
        <field name="model">ops.performance.monitor</field>
        <field name="arch" type="xml">
            <tree string="Performance Monitor" decoration-warning="severity=='warning'" decoration-danger="severity=='critical'">
                <field name="timestamp"/>
                <field name="operation_type"/>
                <field name="operation_name"/>
                <field name="duration_ms" widget="integer"/>
                <field name="user_id"/>
                <field name="model_name"/>
                <field name="record_count"/>
                <field name="severity" widget="badge" decoration-success="severity=='info'" decoration-warning="severity=='warning'" decoration-danger="severity=='critical'"/>
                <field name="is_slow" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Performance Monitor Form View -->
    <record id="view_ops_performance_monitor_form" model="ir.ui.view">
        <field name="name">ops.performance.monitor.form</field>
        <field name="model">ops.performance.monitor</field>
        <field name="arch" type="xml">
            <form string="Performance Record" create="false">
                <sheet>
                    <group>
                        <group name="operation">
                            <field name="operation_type"/>
                            <field name="operation_name"/>
                            <field name="duration_ms" widget="integer"/>
                        </group>
                        <group name="context">
                            <field name="timestamp"/>
                            <field name="user_id"/>
                            <field name="model_name"/>
                            <field name="record_count"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="is_slow" widget="boolean_toggle"/>
                            <field name="severity"/>
                        </group>
                        <group>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="SQL Query" attrs="{'invisible': [('sql_query', '=', False)]}">
                            <field name="sql_query" nolabel="1" widget="text" readonly="1"/>
                        </page>
                        <page string="Context Data" attrs="{'invisible': [('context_data', '=', False)]}">
                            <field name="context_data" nolabel="1" widget="text" readonly="1"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Performance Monitor Search View -->
    <record id="view_ops_performance_monitor_search" model="ir.ui.view">
        <field name="name">ops.performance.monitor.search</field>
        <field name="model">ops.performance.monitor</field>
        <field name="arch" type="xml">
            <search string="Performance">
                <field name="operation_name"/>
                <field name="model_name"/>
                <field name="user_id"/>
                <filter name="slow" string="Slow Operations" domain="[('is_slow', '=', True)]"/>
                <filter name="critical" string="Critical" domain="[('severity', '=', 'critical')]"/>
                <filter name="warning" string="Warning" domain="[('severity', '=', 'warning')]"/>
                <filter name="today" string="Today" domain="[('timestamp', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                <filter name="this_week" string="This Week" domain="[('timestamp', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_operation_type" string="Operation Type" context="{'group_by': 'operation_type'}"/>
                    <filter name="group_model" string="Model" context="{'group_by': 'model_name'}"/>
                    <filter name="group_user" string="User" context="{'group_by': 'user_id'}"/>
                    <filter name="group_severity" string="Severity" context="{'group_by': 'severity'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Performance Monitor Action -->
    <record id="action_ops_performance_monitor" model="ir.actions.act_window">
        <field name="name">Performance Monitor</field>
        <field name="res_model">ops.performance.monitor</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_today': 1, 'search_default_slow': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No performance data yet
            </p>
            <p>
                Performance metrics are automatically collected for slow operations.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_ops_performance_monitor"
              name="Performance Monitor"
              parent="ops_settings_menu"
              action="action_ops_performance_monitor"
              sequence="48"
              groups="base.group_system"/>
</odoo>
