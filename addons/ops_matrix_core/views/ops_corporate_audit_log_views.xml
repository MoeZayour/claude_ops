<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ============================================================ -->
        <!-- CORPORATE AUDIT LOG VIEWS                                    -->
        <!-- SOX/ISO 27001/GDPR Compliance Audit Trail                    -->
        <!-- ============================================================ -->

        <!-- List View: Corporate Audit Log -->
        <record id="view_ops_corporate_audit_log_tree" model="ir.ui.view">
            <field name="name">ops.corporate.audit.log.list</field>
            <field name="model">ops.corporate.audit.log</field>
            <field name="arch" type="xml">
                <list string="Corporate Audit Log"
                      create="false"
                      edit="false"
                      delete="false"
                      default_order="create_date desc"
                      decoration-info="severity == 'info'"
                      decoration-warning="severity == 'warning'"
                      decoration-danger="severity in ('error', 'critical')"
                      decoration-muted="severity == 'debug'">
                    <field name="name" string="Ref#"/>
                    <field name="create_date" string="Date/Time"/>
                    <field name="event_type" string="Event"/>
                    <field name="event_category" string="Category"/>
                    <field name="severity" string="Severity" widget="badge"/>
                    <field name="user_login" string="User"/>
                    <field name="res_model" string="Model"/>
                    <field name="res_name" string="Record"/>
                    <field name="branch_id" string="Branch"/>
                    <field name="compliance_category" string="Compliance" widget="badge"/>
                    <field name="ip_address" string="IP Address"/>
                    <field name="requires_review" string="Review?" widget="boolean_toggle" readonly="1"/>
                    <field name="reviewed" string="Reviewed?" widget="boolean_toggle" readonly="1"/>
                </list>
            </field>
        </record>

        <!-- Form View: Corporate Audit Log Details -->
        <record id="view_ops_corporate_audit_log_form" model="ir.ui.view">
            <field name="name">ops.corporate.audit.log.form</field>
            <field name="model">ops.corporate.audit.log</field>
            <field name="arch" type="xml">
                <form string="Audit Log Entry" create="false" edit="false" delete="false">
                    <header>
                        <button name="action_mark_reviewed"
                                string="Mark as Reviewed"
                                type="object"
                                class="btn-primary"
                                invisible="reviewed or not requires_review"
                                groups="ops_matrix_core.group_ops_compliance_officer"/>
                        <field name="reviewed" widget="badge"
                               decoration-success="reviewed == True"
                               decoration-warning="reviewed == False and requires_review"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                            <h2>
                                <field name="event_type" readonly="1" widget="badge"/>
                            </h2>
                        </div>

                        <group name="outer_group_1">
                            <group name="event_information" string="Event Information">
                                <field name="create_date" string="Timestamp" readonly="1"/>
                                <field name="event_category" readonly="1" widget="badge"/>
                                <field name="severity" readonly="1" widget="badge"/>
                                <field name="compliance_category" readonly="1" widget="badge"/>
                                <field name="description" readonly="1"/>
                            </group>
                            <group name="user_and_session" string="User and Session">
                                <field name="user_id" readonly="1"/>
                                <field name="user_login" readonly="1"/>
                                <field name="persona_id" readonly="1"/>
                                <field name="ip_address" readonly="1"/>
                                <field name="user_agent" readonly="1"/>
                                <field name="session_id" readonly="1"/>
                            </group>
                        </group>

                        <group name="outer_group_4">
                            <group name="record_context" string="Record Context">
                                <field name="res_model" string="Model" readonly="1"/>
                                <field name="res_id" string="Record ID" readonly="1"/>
                                <field name="res_name" string="Record Name" readonly="1"/>
                                <field name="changed_fields" readonly="1"/>
                            </group>
                            <group name="matrix_context" string="Matrix Context">
                                <field name="company_id" readonly="1"/>
                                <field name="branch_id" readonly="1"/>
                                <field name="persona_id" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page name="change_details" string="Change Details" invisible="not old_values and not new_values">
                                <group name="outer_group_7">
                                    <group name="old_values_1" string="Old Values">
                                        <field name="old_values" readonly="1" widget="text" nolabel="1"/>
                                    </group>
                                    <group name="new_values_1" string="New Values">
                                        <field name="new_values" readonly="1" widget="text" nolabel="1"/>
                                    </group>
                                </group>
                                <group name="change_summary_1" string="Change Summary">
                                    <field name="change_summary" readonly="1" widget="text" nolabel="1"/>
                                </group>
                            </page>

                            <page name="additional_context" string="Additional Context">
                                <group name="outer_group_11">
                                    <field name="action" readonly="1"/>
                                    <field name="res_model_name" string="Model Description" readonly="1"/>
                                    <field name="res_reference" readonly="1"/>
                                </group>
                            </page>

                            <page name="review_information" string="Review Information" invisible="not requires_review">
                                <group name="outer_group_12">
                                    <group name="outer_group_13">
                                        <field name="requires_review" readonly="1" widget="boolean"/>
                                        <field name="reviewed" readonly="1" widget="boolean"/>
                                    </group>
                                    <group name="outer_group_14">
                                        <field name="reviewed_by" readonly="1"/>
                                        <field name="reviewed_date" readonly="1"/>
                                    </group>
                                    <group name="outer_group_15" colspan="2">
                                        <field name="review_notes" readonly="1" widget="text"/>
                                    </group>
                                </group>
                            </page>

                            <page name="related_logs" string="Related Logs">
                                <group name="outer_group_16">
                                    <field name="api_audit_id" readonly="1"/>
                                    <field name="security_audit_id" readonly="1"/>
                                </group>
                            </page>

                            <page name="technical_details" string="Technical Details">
                                <group name="outer_group_17">
                                    <group name="outer_group_18">
                                        <field name="id" readonly="1"/>
                                        <field name="create_date" readonly="1"/>
                                        <field name="create_uid" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Search View: Comprehensive Filters -->
        <record id="view_ops_corporate_audit_log_search" model="ir.ui.view">
            <field name="name">ops.corporate.audit.log.search</field>
            <field name="model">ops.corporate.audit.log</field>
            <field name="arch" type="xml">
                <search string="Search Audit Logs">
                    <field name="name"/>
                    <field name="user_login"/>
                    <field name="res_model"/>
                    <field name="res_name"/>
                    <field name="ip_address"/>
                    <field name="description"/>
                    <filter string="Today" name="filter_today" domain="[('create_date', '&gt;=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="This Week" name="filter_this_week" domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter string="Authentication" name="filter_authentication" domain="[('event_category', '=', 'authentication')]"/>
                    <filter string="Data Changes" name="filter_data" domain="[('event_category', '=', 'data')]"/>
                    <filter string="Financial" name="filter_financial" domain="[('event_category', '=', 'financial')]"/>
                    <filter string="Critical" name="filter_critical" domain="[('severity', '=', 'critical')]"/>
                    <filter string="Error" name="filter_error" domain="[('severity', '=', 'error')]"/>
                    <filter string="Warning" name="filter_warning" domain="[('severity', '=', 'warning')]"/>
                    <filter string="SOX" name="filter_sox" domain="[('compliance_category', '=', 'sox')]"/>
                    <filter string="GDPR" name="filter_gdpr" domain="[('compliance_category', '=', 'gdpr')]"/>
                    <filter string="Requires Review" name="filter_requires_review" domain="[('requires_review', '=', True), ('reviewed', '=', False)]"/>
                    <filter string="Reviewed" name="filter_reviewed" domain="[('reviewed', '=', True)]"/>
                    <group name="outer_group_19">
                        <filter string="Event Type" name="group_event_type" context="{'group_by': 'event_type'}"/>
                        <filter string="Category" name="group_event_category" context="{'group_by': 'event_category'}"/>
                        <filter string="User" name="group_user" context="{'group_by': 'user_id'}"/>
                        <filter string="Branch" name="group_branch" context="{'group_by': 'branch_id'}"/>
                        <filter string="Severity" name="group_severity" context="{'group_by': 'severity'}"/>
                        <filter string="Date" name="group_date" context="{'group_by': 'create_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Pivot View: Analytics -->
        <record id="view_ops_corporate_audit_log_pivot" model="ir.ui.view">
            <field name="name">ops.corporate.audit.log.pivot</field>
            <field name="model">ops.corporate.audit.log</field>
            <field name="arch" type="xml">
                <pivot string="Audit Log Analytics" sample="1">
                    <field name="event_category" type="row"/>
                    <field name="user_id" type="row"/>
                    <field name="create_date" type="col" interval="day"/>
                </pivot>
            </field>
        </record>

        <!-- Graph View: Trends -->
        <record id="view_ops_corporate_audit_log_graph" model="ir.ui.view">
            <field name="name">ops.corporate.audit.log.graph</field>
            <field name="model">ops.corporate.audit.log</field>
            <field name="arch" type="xml">
                <graph string="Audit Log Trends" type="line" sample="1">
                    <field name="create_date" type="row" interval="day"/>
                    <field name="event_category" type="col"/>
                </graph>
            </field>
        </record>

        <!-- Action: Corporate Audit Log -->
        <record id="action_ops_corporate_audit_log" model="ir.actions.act_window">
            <field name="name">Corporate Audit Log</field>
            <field name="res_model">ops.corporate.audit.log</field>
            <field name="view_mode">list,form,pivot,graph</field>
            <field name="context">{
                'search_default_filter_this_week': 1,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No audit logs found
                </p>
                <p>
                    The Corporate Audit Log automatically tracks all critical events including:
                    <ul>
                        <li>User authentication (login/logout)</li>
                        <li>Data changes (create/write/delete)</li>
                        <li>Financial transactions</li>
                        <li>Approval workflows</li>
                        <li>Security events</li>
                        <li>Data exports</li>
                    </ul>
                    This provides a comprehensive audit trail for SOX, ISO 27001, and GDPR compliance.
                </p>
            </field>
        </record>

        <!-- Action: Pending Reviews -->
        <record id="action_ops_corporate_audit_log_pending_reviews" model="ir.actions.act_window">
            <field name="name">Audit Logs - Pending Review</field>
            <field name="res_model">ops.corporate.audit.log</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('requires_review', '=', True), ('reviewed', '=', False)]</field>
            <field name="context">{}</field>
        </record>

        <!-- Action: SOX Compliance -->
        <record id="action_ops_corporate_audit_log_sox" model="ir.actions.act_window">
            <field name="name">SOX Compliance Audit Trail</field>
            <field name="res_model">ops.corporate.audit.log</field>
            <field name="view_mode">list,form,pivot,graph</field>
            <field name="domain">[('compliance_category', '=', 'sox')]</field>
            <field name="context">{
                'search_default_filter_this_month': 1,
                'search_default_group_event_type': 1
            }</field>
        </record>

        <!-- Action: GDPR Compliance -->
        <record id="action_ops_corporate_audit_log_gdpr" model="ir.actions.act_window">
            <field name="name">GDPR Data Processing Records</field>
            <field name="res_model">ops.corporate.audit.log</field>
            <field name="view_mode">list,form,pivot,graph</field>
            <field name="domain">[('compliance_category', '=', 'gdpr')]</field>
            <field name="context">{
                'search_default_filter_this_month': 1,
                'search_default_group_user': 1
            }</field>
        </record>

        <!-- Menu: Corporate Audit Log (under Settings > Technical) -->
        <menuitem id="menu_ops_corporate_audit_log"
                  name="Corporate Audit Log"
                  parent="menu_ops_settings_root"
                  action="action_ops_corporate_audit_log"
                  sequence="60"
                  groups="ops_matrix_core.group_ops_admin_power,ops_matrix_core.group_ops_compliance_officer"/>

        <!-- Menu: Pending Reviews -->
        <menuitem id="menu_ops_corporate_audit_log_pending_reviews"
                  name="Audit Log Reviews"
                  parent="menu_ops_corporate_audit_log"
                  action="action_ops_corporate_audit_log_pending_reviews"
                  sequence="10"
                  groups="ops_matrix_core.group_ops_compliance_officer"/>

        <!-- Menu: SOX Compliance -->
        <menuitem id="menu_ops_corporate_audit_log_sox"
                  name="SOX Audit Trail"
                  parent="menu_ops_corporate_audit_log"
                  action="action_ops_corporate_audit_log_sox"
                  sequence="20"
                  groups="ops_matrix_core.group_ops_compliance_officer"/>

        <!-- Menu: GDPR Compliance -->
        <menuitem id="menu_ops_corporate_audit_log_gdpr"
                  name="GDPR Data Records"
                  parent="menu_ops_corporate_audit_log"
                  action="action_ops_corporate_audit_log_gdpr"
                  sequence="30"
                  groups="ops_matrix_core.group_ops_compliance_officer"/>

    </data>
</odoo>
