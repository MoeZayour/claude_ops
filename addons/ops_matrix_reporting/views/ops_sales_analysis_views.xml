<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sales Analysis List View -->
    <record id="view_ops_sales_analysis_tree" model="ir.ui.view">
        <field name="name">ops.sales.analysis.list</field>
        <field name="model">ops.sales.analysis</field>
        <field name="arch" type="xml">
            <list string="Sales Analysis" edit="false" create="false" delete="false">
                <field name="date_order" />
                <field name="product_id" />
                <field name="partner_id" />
                <field name="ops_branch_id" />
                <field name="ops_business_unit_id" />
                <field name="product_uom_qty" sum="Total Qty" />
                <field name="price_subtotal" sum="Total Revenue" />
                <field name="margin" sum="Total Margin" />
                <field name="margin_percent" avg="Avg Margin %" />
            </list>
        </field>
    </record>

    <!-- Sales Analysis Pivot View -->
    <record id="view_ops_sales_analysis_pivot" model="ir.ui.view">
        <field name="name">ops.sales.analysis.pivot</field>
        <field name="model">ops.sales.analysis</field>
        <field name="arch" type="xml">
            <pivot string="Sales Analysis Pivot">
                <field name="date_order" type="row" />
                <field name="ops_branch_id" type="col" />
                <field name="price_subtotal" type="measure" />
                <field name="margin" type="measure" />
                <field name="margin_percent" type="measure" />
            </pivot>
        </field>
    </record>

    <!-- Sales Analysis Graph View -->
    <record id="view_ops_sales_analysis_graph" model="ir.ui.view">
        <field name="name">ops.sales.analysis.graph</field>
        <field name="model">ops.sales.analysis</field>
        <field name="arch" type="xml">
            <graph string="Sales Analysis" type="bar">
                <field name="ops_business_unit_id" type="row" />
                <field name="price_subtotal" type="measure" />
                <field name="margin" type="measure" />
            </graph>
        </field>
    </record>

    <!-- Sales Analysis Search View -->
    <record id="view_ops_sales_analysis_search" model="ir.ui.view">
        <field name="name">ops.sales.analysis.search</field>
        <field name="model">ops.sales.analysis</field>
        <field name="arch" type="xml">
            <search string="Sales Analysis">
                <field name="date_order" />
                <field name="product_id" />
                <field name="partner_id" />
                <field name="ops_branch_id" />
                <field name="ops_business_unit_id" />
                <separator />
                <filter name="high_margin" string="High Margin (&gt;30%)" domain="[('margin_percent', '&gt;', 30)]" />
                <filter name="low_margin" string="Low Margin (&lt;10%)" domain="[('margin_percent', '&lt;', 10)]" />
                <filter name="negative_margin" string="Negative Margin" domain="[('margin', '&lt;', 0)]" />
                <separator />
                <filter name="group_by_date" string="Date" context="{'group_by': 'date_order:month'}" />
                <filter name="group_by_branch" string="Branch" context="{'group_by': 'ops_branch_id'}" />
                <filter name="group_by_bu" string="Business Unit" context="{'group_by': 'ops_business_unit_id'}" />
                <filter name="group_by_product" string="Product" context="{'group_by': 'product_id'}" />
            </search>
        </field>
    </record>

    <!-- Action for Sales Analysis -->
    <record id="action_ops_sales_analysis" model="ir.actions.act_window">
        <field name="name">Sales Analysis</field>
        <field name="res_model">ops.sales.analysis</field>
        <field name="view_mode">list,pivot,graph</field>
        <field name="context">{'search_default_group_by_branch': 1}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Sales analysis view by Branch and Business Unit.
            </p>
            <p>
                This read-only view provides analytics on sales performance with dimension-based filtering.
            </p>
        </field>
    </record>
</odoo>
