services:
  gemini_odoo19:
    image: odoo:${ODOO_VERSION:-19.0}
    container_name: gemini_odoo19
    restart: unless-stopped
    depends_on:
      gemini_odoo19_db:
        condition: service_healthy
    # FIX: Removed command overrides. We will rely on odoo.conf for settings.
    # If you need to force the config path:
    command: odoo -c /etc/odoo/odoo.conf
    environment:
      - HOST=gemini_odoo19_db
      - USER=odoo
      - PASSWORD=odoo
    volumes:
      - ./config:/etc/odoo:ro
      - ./addons:/mnt/extra-addons
      - odoo_web_data:/var/lib/odoo
    ports:
      - "8089:8089"
      - "8082:8082"
    # FIX: Odoo needs to be on BOTH networks
    networks:
      - gemini_odoo19_internal
      - nginx_network

  gemini_odoo19_db:
    image: postgres:${POSTGRES_VERSION:-16}
    container_name: gemini_odoo19_db
    restart: unless-stopped
    # command: postgres -c password_encryption=md5 # Not strictly needed for PG16/Odoo17+, but fine to keep
    environment:
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=odoo
      - POSTGRES_DB=postgres
    volumes:
      # FIX: Use a dedicated volume for DB
      - odoo_db_data:/var/lib/postgresql/data
    networks:
      - gemini_odoo19_internal
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U odoo -d postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  gemini_odoo19_internal:
    name: gemini_odoo19_internal
    driver: bridge
  nginx_network:
    name: nginx_network
    external: true

volumes:
  odoo_db_data:
    name: gemini_odoo19_db_vol
  odoo_web_data:
    name: gemini_odoo19_web_vol
